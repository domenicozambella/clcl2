\documentclass[10pt,oneside]{amsproc}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{comment}
\usepackage[alphabetic]{amsrefs}
\usepackage{tikz}
\usepackage{xcolor}
\usepackage{datetime2} 
\usepackage[colorlinks=true,linkcolor=blue,]{hyperref}

\usepackage[a4paper,margin=30mm]{geometry}
\usepackage{stackengine}
\usepackage{scalerel}
\usepackage{mathtools}
\usepackage{calc}
\usepackage{amsthm}
\usepackage{thmtools}
\usepackage[framemethod=TikZ]{mdframed}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{euscript}
% \def\EuScript#1{\mathscr#1}
\usepackage{fourier}
% \usepackage{palatino}
% \usepackage{mathpazo} % add possibly `sc` and `osf` options
%\usepackage{eulervm}
%\usepackage{bbm}
%\usepackage{latexsym}
% \usepackage{mathrsfs}
% \usepackage{stmaryrd}
% \usepackage{stix}
\def\dotminus{\stackon[.2ex]{$-$}{$.$}}
\usepackage{dsfont}
% \newcommand*{\TakeFourierOrnament}[1]{{%
% \fontencoding{U}\fontfamily{futs}\selectfont\char#1}}
% \renewcommand*{\danger}{\TakeFourierOrnament{66}}
\parindent0ex
\parskip1.2ex
% \makeatletter
% \DeclareOldFontCommand{\rm}{\normalfont\rmfamily}{\mathrm}
% \DeclareOldFontCommand{\sf}{\normalfont\sffamily}{\mathsf}
% \DeclareOldFontCommand{\tt}{\normalfont\ttfamily}{\mathtt}
% \DeclareOldFontCommand{\bf}{\normalfont\bfseries}{\mathbf}
% \DeclareOldFontCommand{\it}{\normalfont\itshape}{\mathit}
% \DeclareOldFontCommand{\sl}{\normalfont\slshape}{\@nomath\sl}
% \DeclareOldFontCommand{\sc}{\normalfont\scshape}{\@nomath\sc}
% \makeatother

\newcommand{\mylabel}[1]{{#1}\hfill}
\renewenvironment{itemize}
  {\begin{list}{$\cdot$}{%
  \setlength{\parskip}{0mm}
  \setlength{\topsep}{.4\baselineskip}
  \setlength{\rightmargin}{0mm}
  \setlength{\listparindent}{0mm}
  \setlength{\itemindent}{0mm}
  \setlength{\labelwidth}{3ex}
  \setlength{\itemsep}{.2\baselineskip}
  \setlength{\parsep}{.2\baselineskip}
  \setlength{\partopsep}{0mm}
  \setlength{\labelsep}{1ex}
  \setlength{\leftmargin}{\labelwidth+\labelsep}
  \let\makelabel\mylabel}}{%
\end{list}}

\declaretheoremstyle[
  headfont=\normalfont\bfseries,
  notefont=\bfseries,
  notebraces={(}{)},
  bodyfont=\normalfont,
  postheadspace=1em,
  mdframed={
  outerlinewidth=1pt,
  linecolor=gray!20,
  roundcorner = 1ex,    
  backgroundcolor=gray!10, 
  innerleftmargin=1ex,
  leftmargin=-1ex,
  innerrightmargin=1ex,
  rightmargin=-1ex,
  innertopmargin=1.5ex, 
  innerbottommargin=1ex, 
  skipabove=3ex,
  skipbelow=1ex}, 
]{mystyle}

\declaretheorem[style=mystyle]%
{theorem}
\declaretheorem[style=mystyle,sibling=theorem]%
{lemma,proposition,fact,corollary,definition,remark,example,claim,question}

\let\proof\relax
\declaretheoremstyle[
  spaceabove=6pt, 
  spacebelow=6pt, 
  headfont=\normalfont\itshape, 
  bodyfont = \normalfont,
  postheadspace=1em, 
  qed=\qedsymbol, 
  headpunct={.}]
{myproof} 
\declaretheorem[style=myproof, unnumbered]{proof}

\renewcommand*{\emph}[1]{%
   \smash{\tikz[baseline]\node[rectangle, fill=teal!25, rounded corners, inner xsep=0.5ex, inner ysep=0.2ex, anchor=base, minimum height = 2.7ex]{\strut #1};}}


% \def\forallH{\forall\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}}
% \def\existsH{\exists\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}}
% \def\forallI{\forall\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}}
% \def\existsI{\exists\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}}


\def\forallH{\forall}
\def\existsH{\exists}
\def\forallI{\forall}
\def\existsI{\exists}

\newcommand\questionsign[1][2ex]{%
  \renewcommand\stacktype{L}%
  \scaleto{\stackon[-.6pt]{\color{red}$\triangle$}{\color{red}\bfseries\small ?}}{#1}%
}

\newcommand\dangersign[1][3.5ex]{%
  \renewcommand\stacktype{L}%
  \scaleto{\stackon[1.9pt]{\Huge\color{red}$\triangle$}{\color{red}\bfseries\small !}}{#1}%
}

%%%%%%% GETCOMMIT
\newcommand\dotGitHEAD{}
\newcommand\branch{}
\newcommand\commit{}


% \makeatletter\let\myfilehandle\@inputcheck\makeatother

% \openin\myfilehandle=.git/HEAD\relax

% \begingroup\endlinechar-1
%   \global\read\myfilehandle to \dotGitHEAD
% \endgroup
% \closein\myfilehandle

% \newcommand\GetBranch{}
% \def\GetBranch ref: refs/heads/#1\relax{\renewcommand{\branch}{#1}}

% \expandafter\GetBranch\dotGitHEAD\relax

% \makeatother

\linespread{1.1}
\author{C. L. C. L. Polymath}
\begin{document}
\title{Standard analysis}
\hfill\texttt{Branch:\ \branch\ \DTMnow}\bigskip
\maketitle
\raggedbottom

\begin{abstract}
  Let ${\EuScript L}$ be a first-order two-sorted language.
  Let $I$ be some fixed structure.
  An ${\EuScript L}$-structure of the form $\langle M,I\rangle$ is called a standard structure.
  When $I$ is a compact topological space a significative fraction of model theory still applies if we restrict to standard structures.
  Roughly, we show that at the level of types model theory remains classical (and at the level of formulas \textit{approximately\/} classical).
  This approach offer a slick formalism that is alternative to nonstandard analysis and to continuous logic.

  \noindent Our approach is based on~\cite{clcl} and, in turn, inspired by the Henson-Iovino model theory of Banach spaces~\cite{HI}.
\end{abstract}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}\label{intro}


\def\ceq#1#2#3{\parbox[t]{23ex}{$\displaystyle #1$}\parbox{6ex}{\hfil $#2$}{$\displaystyle #3$}}

As a minimal motivating example, consider a real vector space $M$.
This is are among the most simple strucures considered in model theory.
Now, expand it by adding a norm.
A norm is a function that, given vector, outputs a real number.
We may formalize this in a natural way by using a two-sorted structure $\langle M,\mathds{R}\rangle$.
Now, we have two conflicting aspirations
\begin{itemize}
  \item[i.] to apply the basic tools of model theory (such as elementarity, compactness, and saturation);
  \item[ii.] to stay within the realm of normed spaces (hence insist that 
  $\mathds{R}$ should remain $\mathds{R}$ throughout).
\end{itemize}

These two requests are blatantly incompatible, something has to give.
Different people have attemped different paths.
\begin{itemize}
  \item[1.] Nonstandard analysts happily embrace norms that take values in some ${}^*\mathds{R}\succeq\mathds{R}$.
  These normed spaces are nonstandard, but there are tricks to transfer results from nonstandard to standard normed spaces and vice versa. See~\cite{G} for a survey.
  Model theorists, when confronted with similar problems, have used similar approaches (in greater generality and with different notation).
  \item[2.] Henson and Iovino propose to stick to the standard notion of norm but restrict the notion of elementarity and saturation to a smaller class of \textit{positive\/} formulas.
  They demostrate that most standard tools of model theory apply in their setting.
  The work of Henson and Iovino is focussed on Banach spaces and has hardly been applied to broader contexts. See~\cite{HI} for a survey.
  \item[3.] Real valued logicians opt for an esoteric approach.
  They abandon classical true/false valued logic in favour of a logic valued in the interval $[0,1]$.
  See~\cite{K} or~\cite{H} for a survey.
  This esoteric flavor helped the approach with some popularity but this approach adds unnatural notational burden.
  Our back-to-classical-logic approach is proposed as a more natural alternative.
\end{itemize}

We elaborate on the ideas of Henson and Iovino and generalize them to a larger class of structures.
Following Henson and Iovino we restrict the notions of elementarity and saturation to positive formulas (though we use a larger class of positive formulas, which more convenient, and inessentially stronger).
We also borrow intuitions and results from nonstandard analysis to an extent that we could claim the title: \textit{nonstandard analysis for the standard logician}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{A class of structures}\label{uno}

Let \emph{$I$\/} be some fixed first-order structure which is endowed with a Hausdorff compact\footnote{The requirement of compactness seems to exclude the motivational example mentioned above. To include this and others similar examples we have to replace $\mathds{R}$ with $\mathds{R}\cup\{\pm\infty\}$.} topology (in particular, a normal topology).
The language \emph{$L_{\sf I}$\/} contains relation symbols for the compact subsets $C\subseteq I^n$ and a function symbol for each continuous functions $f:I^n\to I$.
In particular, there is a constant for each element of $I$.
According to the context, $C$ and $f$ denote either the symbols of $L_{\sf I}$ or their interpretation in the stucture $I$.
Such a language $L_{\sf I}$ is much larger than necessary but it is convenient because it uniquely associates a structure to a topological space.

The most straightforward examples of structures $I$ are the unit interval $[0,1]$, with the usual topology, and its homeomophic copies $\mathds{R}^+\cup\{0,\infty\}$ and $\mathds{R}\cup\{\pm\infty\}$.

We also fix a first-order language \emph{$L_{\sf H}$\/} which we call the language of the \emph{home sort.}

\begin{definition}\label{def_0}
  Let ${\EuScript L}$ be a two sorted language that expands both $L_{\sf H}$ and $L_{\sf I}$.
  A \emph{standard structure\/} is a two-sorted ${\EuScript L}$-structure of the form $\langle  M,I\rangle$, where $M$ is any $L_{\sf H}$-structure, while $I$ is the structure we fixed above.
  We write \emph{${\sf H}$} and \emph{${\sf I}$\/} to denote the two sorts of ${\EuScript L}$.
  
  The language ${\EuScript L}$ adds a relation symbol for every $L_{\sf H}$-definable subset of $M$, in other words, ${\EuScript L}$ performs the Morleyzation of $L_{\sf H}$.
    
  Finally and most relevantly, ${\EuScript L}$ contains arbitrarily many function symbols of sort ${\sf H}^n\to {\sf I}$. 

  Standard structures are denoted by the domain of their home sort.
\end{definition}

% In some examples we need to replace the sort ${\sf H}$ with many sorts ${\sf H}_1\dots,{\sf H}_k$.
% In this case the language $L_{\sf H}$ is replaced with $L_{{\sf H}_1\dots,{\sf H}_k}$, the language that governs the structure $\langle M_1\dots,M_k\rangle$.
% Models have the form $\langle M _1\dots,M_k, I\rangle$.
% The new symbols in the language ${\EuScript L}$ are of sort ${\sf H}_1^{n_1}\dots,{\sf H}_k^{n_k}\to {\sf I}$.

Clearly, saturated ${\EuScript L}$-structures exist but, with the exception of trivial cases (when $I$ is finite), they are not standard.
As a remedy, below we carve out a set of formulas ${\EuScript L}^{\rm p}$, the set of positive formulas, such that every model has an positive elementary saturated extension that is also standard.

As usual, $L_{\sf I}$, $L_{\sf H}$, and ${\EuScript L}$ denote both first-order languages and the corresponding set of formulas.
When we restrict to formulas with a fix tuple of free variables we write ${\EuScript L}_x$.
% The symbols ${\EuScript L}^{\rm p}$ and ${\EuScript H}$ defined below denote only sets of ${\EuScript L}$-formulas.

\begin{definition}\label{def_LL}
  A formula in ${\EuScript L}$ is \emph{positive\/} if it uses only the Boolean connectives $\wedge$, $\vee$; the quantifiers $\forall\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}$, $\exists\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}$ of sort ${\sf H}$; and the quantifiers $\forall\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}$, $\exists\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}$ of sort ${\sf I}$.

  The set of posive formulas is denoted by \emph{${\EuScript L}^{\rm p}$.}

  We will use Latin letters $x,y,z$ for variables of sort ${\sf H}$ and Greek letters $\eta,\varepsilon$ for variables of sort ${\sf I}$.
  Therefore we can safely drop the superscript from quantifiers if they are followed by variables.
\end{definition}

% \noindent\llap{\textcolor{red}{\Large\dangersign}\kern1ex}\ignorespaces

Note that ${\EuScript L}$ has two types of atomic formulas: those of sort ${\sf H}$ (that is, those equivalent to formulas in $L_{\sf H}$) and those of the form $t(x\,;\eta)\in C$, where $C\subseteq I^n$ is compact and $t(x\,;\eta)$ is a tuple of terms of sort ${\sf H}^{|x|}\times {\sf I}^{|\eta|}\to {\sf I}$.

Henson and Iovino have a more stringent notion of positive formulas (that they define in the language of normed spaces).
Their positive formulas exclude formulas in $L_{\sf H}$ and quantifiers of sort ${\sf I}$.
In our setting $L_{\sf H}$-formulas are positive (up to equivalence) which comes at a small price: the failure of the Perturbation Lemma~\cite{HI}*{Proposition~5.15}.
However, we will recover part of it in Proposition~\ref{prop_perturbation}.
Instead, somewhat surprisingly, allowing quantifiers of sort ${\sf I}$ is almost for free.
We will see (cf.\@ Propositions~\ref{prop_LHapprox1}) that the formulas in ${\EuScript L}^{\rm p}$ are approximated by formulas without quantifiers of sort ${\sf I}$.

Note that the extra espressivity offered by quantifiers of sort ${\sf I}$ is convenient.
For instance, it is easy to see (cf.\@ Example~\ref{ex_Rvlogic} for a hint) that ${\EuScript L}^{\rm p}$ has at least the same expressive power as real valued logic%
%\footnote{This unsubstantited claim should be interpreted as concjecture.
%A painstaking technical comparison with real valued logic is not in the scope of this indroductory exploratory paper.}.

\begin{example}\label{ex_Rvlogic}
  Let $I=[0,1]$, the unit interval in $\mathds{R}$.
  Let $t(x)$ be a term of sort ${\sf H}^{|x|}\to {\sf I}$.
  Then there is a positive formula that says $\sup_{x} t(x)=\tau$.
  Indeed, consider the formula

  \ceq{\hfill\forallH x\ \big[t(x)\dotminus\tau\in\{0\}\big]}
  {\wedge}{\forallI \varepsilon \Big[\varepsilon\in\{0\}\ \vee\ \existsH x\ \big[\tau\dotminus (t(x)+\varepsilon)\in\{0\}\big]\Big]}

  which, in a more legible form, becomes

  \ceq{\hfill\forallH x\ \big[t(x)\le\tau\big]}{\wedge}{\forallI \varepsilon>0\ \existsH x\ \big[\tau\le t(x)+ \varepsilon\big].}
\end{example}

The following example is inspired by~\cite{HPP}.

\begin{example}\label{ex_HPP}
  Let ${\EuScript U}$ be a monster model of signature $L_{\sf H}$.
  The relevant part of ${\EuScript L}$ contains symbols for the functions $f:{\EuScript U}^n\to I$ that are continuous in the following sense: the inverse image of every compact $C\subseteq I$ is type-definable in $L_{\sf H}(M)$ for every $M\preceq{\EuScript U}$.
  It is easy to verify that $\langle{\EuScript U}, I\rangle$ is positively saturated, see Section~\ref{compactness}.
\end{example}

We mentioned normed spaces as a motivating example.
Essentially, functional analysis and model theory are only interested in the unit ball of normed spaces.
To formalize the unit ball of a normed space as a standard structure (where $I$ is the unit interval) is straightforward but pretty ugly.
Alternatively one can view a normed space as a many-sorted structure: a sort for each ball of radius $n\in\mathds{Z}^{\rm p}$.
Unfortunately, this also results into a bloated formalism.

A neater formalization is possible if one accepts that some potitive elementary extensions (to be defined below) of a normed space could contain vectors of infinite norm hence not be themselves normed spaces.
These infinities are harmless if one is only interested in the unit ball.
In fact, inside any ball of finite radius these nonstandard normed spaces are completely standard.

\begin{example}\label{ex_normed_spaces}
Let $I=\mathds{R}\cup\{\pm\infty\}$.
Let $L_{\sf H}$ be the language of real (or complex) vector spaces.
The language ${\EuScript L}$ contains a function symbol $\|\mbox{-}\|$ of sort ${\sf H}\to {\sf I}$.
Normed space are standard structures with the natural interpretation of the language.
It is easy to verify that the unit ball of a standard structure is the unit ball of a normed space.
Note that the same remains true if we add to the language any continuous (equivalently, bounded) operator or functional.
\end{example}

We conclude this introduction by advertizing a question of~\cite{clcl}.
Is it possible to extend the Positive Compactness Theorem (Theorem~\ref{thm_compattezza}) to a larger class of formulas?
E.g.\@ can we allow in ${\EuScript L}$ (and in ${\EuScript L}^{\rm p}$) function symbols of sort ${\sf H}^n\times {\sf I}^m\to {\sf I}$ with both $n$ and $m$ positive?
These would have natural interpretations, e.g.\@ a group acting on a compact set $I$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Henson-Iovino approximations}\label{ultrapws}

For $\varphi,\varphi'$ (free variables are hidden) positive formulas possibly with parameters we write \emph{$\varphi'>\varphi$\/} if $\varphi'$ is obtained by replacing in $\varphi$ each atomic formula of the form $t\in C$ with $t\in C'$, where $C'$ is some compact neighborhood of $C$.
If no such atomic formulas occurs in $\varphi$, then $\varphi>\varphi$.
We call $\varphi'$ a \emph{weakening\/} of $\varphi$.
Note that $>$ is a dense transitive relation and that  $\varphi\to\varphi'$ in every ${\EuScript L}$-structure.

We write \emph{$\tilde{\varphi}\perp\varphi$\/} when $\tilde{\varphi}$ is obtained by replacing each atomic formula $t\in C$ occurring in $\varphi$ with $t\in\tilde{C}$ where $\tilde{C}$ is some compact set disjoint from $C$.
The atomic formulas in $L_{\sf H}$ are replaced with their negation.
Finally each connective is replaced by its dual i.e., $\vee, \wedge, \exists,\forall$ are replaced by $\wedge,\vee,\forall,\exists$, respectively.
We say that  $\tilde{\varphi}$ is a \emph{strong negation} of $\varphi$.
It is clear that $\tilde{\varphi}\rightarrow\neg\varphi$ in every ${\EuScript L}$-structure.

\begin{lemma}\label{lem_interpolation}
  For all positive formulas $\varphi$
  \begin{itemize}
    \item[1.]for every $\varphi'>\varphi$ there is a formula $\tilde{\varphi}\perp\varphi$ such that $\varphi\rightarrow\neg \tilde{\varphi}\rightarrow\varphi'$;
    \item[2.] for every\, $\tilde{\varphi}\perp\varphi$ there is a formula $\varphi'>\varphi$ such that  $\varphi\rightarrow\varphi'\rightarrow\neg \tilde{\varphi}$.
  \end{itemize}
\end{lemma}

\begin{proof}
  If $\varphi\in L_{\sf H}$ the claims are obvious.
  Suppose $\varphi$ is of the form $t\in C$.
  Let $\varphi'$ be $t\in C'$, for some compact neighborhood of $C$.
  Let $O$ be an open set such that $C\subseteq O\subseteq C'$.
  Then $\tilde{\varphi}=(t\in I\smallsetminus O)$ is as required by the lemma.
  Suppose instead that $\tilde{\varphi}$ is of the form $t\in\tilde{C}$ for some compact $\tilde{C}$ disjoint from $C$.
  By the normality of $I$, there is  $C'$, a compact neighborhood of $C$ disjoint from $\tilde{C}$.
  Then  $\varphi'=\big(t\in C'\big)$ is as required.
  The lemma follows easily by induction.
\end{proof}

For every type $p(x)$, we write 

\ceq{\hfill \emph{$p'(x)$}}{=}{\big\{\varphi'(x)\ :\ \varphi'>\varphi\textrm{ for some }\varphi(x)\in p\big\}}

in particular \emph{$\{\varphi(x)\}'$} = $\big\{\varphi'(x)\ :\ \varphi'>\varphi\big\}$.

\begin{definition}\label{def_dense}
  A set of formulas ${\EuScript F}\subseteq{\EuScript L}$ is \emph{dense\/} modulo $T$, a theory, if for every positive $\varphi(x)$ and every $\varphi'>\varphi$, there is $\psi(x)\in{\EuScript F}$ such that $\varphi(x)\rightarrow\psi(x)\rightarrow\varphi'(x)$ holds in every standard structure that models $T$.
  If $T$ is empty, we say: dense modulo ${\EuScript L}$.
\end{definition}

\begin{example}
  By Lemma~\ref{lem_interpolation}, the set of negations of positive formulas is dense modulo ${\EuScript L}$.
\end{example}

\begin{example}
  Read $\alpha=\beta$ as synonimous of $\langle\alpha,\beta\rangle\in\Delta$, where $\Delta$ is the diagonal of ${\sf I}^2$, a compact set.
  It is easy to see that the set of formulas build inductively from the atomic formulas of sort ${\sf H}$ and $t(x)=s(x)$ is dense modulo ${\EuScript L}$.
\end{example}

\begin{example}
  Let ${\EuScript H}$ be the set of positive formulas without quantifiers of sort ${\sf I}$.
  In Section~\ref{Ielimination} we will prove that this set is dense.
\end{example}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Morphisms}\label{morphisms}

\def\ceq#1#2#3{\parbox[t]{35ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

Let $M$ and $N$ be two standard structures.
We say that a partial map $f:M\to N$ is \emph{p-elementary\/} if for every $\varphi(x)\in{\EuScript L}^{\rm p}$ and every $a\in({\rm dom }f)^{|x|}$

\ceq{1.\hfill M\models\varphi(a)}{\Rightarrow}{N\models\varphi(fa).}

A p-elementary map that is total is called an \emph{p-elementary embedding.}
When the map ${\rm id}_M:M\rightarrow N$ is an p-elementary embedding, 
% that is, if for every  $\varphi(x)\in{\EuScript L}^{\rm p}$ and every $a\in M^{|x|}$
%
% \ceq{\hfill{\EuScript M}\models\varphi(a)}{\Rightarrow}{N\models\varphi(a)},
%
we write \emph{$M\preceq^{\rm p} N$\/} and say that $M$ is an \emph{p-elementary substructure\/} of $N$. 

As p-elementary maps are in particular $L_{\sf H}$-elementary, they are injective.
However, their inverse need not be p-elementary.
In other words, the converse of the implication in (1) may not hold.
Hence the following notion of elementarity which is more roboust.
% We have chosen to work with the classical notion of satisfaction at the cost of this asymmetric notion of elementarity.
% This differs from the approach of Henson and Iovino.
% They introduce the notion of \textit{approximate satisfaction.} 
% The approximate ${\EuScript H}$-morphisms we define below are the maps that preserve Henson-Iovino approximate satisfaction.
% These morphisms are invertible, cf.\@ Fact~\ref{fact_HImorphisms}.
We say that the map $f:M\to N$ is an \emph{approximate p-elementary\/} if for every formula $\varphi(x)\in{\EuScript L}^{\rm p}$, and every $a\in({\rm dom }f)^{|x|}$

\ceq{2.\hfill M\models\varphi(a)}{\Rightarrow}{N\models\big\{\varphi(fa)\big\}'.}

One convenient feature of approximate p-elementarity is that it suffices verify (2) for any/some dense set of formulas.
It is clear that p-elementarity implies its approximate variant.
We will see that with a slight amount of saturation also the converse holds (Proposition~\ref{prop_approx}).
Finally, under full saturation, all differences disappear as these morphims becomes ${\EuScript L}$-elementarity maps (Corollary~\ref{corol_Lcomplete}).

The following holds in general.

\begin{fact}\label{fact_HImorphisms}
  If $f:M\to N$ is approximate p-elementary then

  \ceq{\hfill M\models\big\{\varphi(a)\big\}'}{\Leftrightarrow}{N\models\big\{\varphi(fa)\big\}'.}

  for every $\varphi(x)\in{\EuScript L}^{\rm p}$, and every $a\in({\rm dom }f)^{|x|}$.
\end{fact}

\begin{proof}
  $\Rightarrow$ \ Fix $\varphi'>\varphi$ and assume $M\models\varphi'(a)$.
  Let  $\varphi'>\varphi''>\varphi$.
  By the definition of approximate elementarity, $N\models\varphi''(fa)$ and $N\models\varphi'(fa)$ follows.
  
  $\Leftarrow$  \ 
  Assume the r.h.s.\@ of the equivalence.
  Fix $\varphi'>\varphi$ and prove $M\models\varphi'(a)$.
  Let  $\varphi'>\varphi''>\varphi$.
  By Lemma~\ref{lem_interpolation} there is some $\tilde{\varphi}\perp\varphi''$ such that $\varphi''\rightarrow\neg\tilde{\varphi}\rightarrow\varphi'$.
  Then $N\models\neg\tilde{\varphi}(fa)$ and therefore  $M\models\neg\tilde{\varphi}(a)$.
  Then $M\models\varphi'(a)$.
\end{proof}

% \begin{comment}
Finally, we consider the notion of partial embeddings.
Though the definition seems weaker, we prove that the notion is competely classical.
We say that the map $f:M\to N$ is a \emph{partial embedding\/} if the implication in (1) holds for all atomic formulas $\varphi(x)$.
Note that this is the same as requiring that (1) holds for all formulas without quantifiers of sort ${\sf H}$.

\begin{fact}\label{fact_partial_emb}
  If $f:M\to N$ is a partial embedding then 

  \ceq{\hfill M\models\varphi(a)}{\Leftrightarrow}{N\models\varphi(fa)}

  for every $a\in({\rm dom }f)^{|x|}$ and every formula $\varphi(x)\in{\EuScript L}^{\rm p}$ without quantifiers of sort ${\sf H}$.
\end{fact}

\begin{proof}
  The equivalence is trivial for formulas in $L_{\sf H}$ so we only consider atomic formulas of the form $t\in C$.
  Implication $\Rightarrow$ holds by definition. 
  Vice versa, if $M\models t(a)\notin C$ then, by normality,  $M\models t(a)\in\tilde{C}$ for some compact $\tilde C$ disjoint of $C$.
  By the definition of partial embedding, $N\models t(a)\in\tilde{C}$.
  Hence $N\models t(a)\notin C$.
  Induction is immediate.
\end{proof}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The standard part}\label{standard_part}

Our goal is to prove a compactness theorem for positive theories.
To bypass lengthy routine applications of ultrafilters, ultrapowers, and ultralimits, % -- as it would be like reinventing the wiel.
we assume the Classical Compactness Theorem and built on that.

In this section we recall the notion of standard part of an element of the elementary extension of a compact Hausdorff topological space.
Our goal is to prove Lemma~\ref{lem_st} which in turn is required for the proof of the Positive Compactness Theorem (Theorem~\ref{thm_compattezza}).
The reader willing to accept it without proof may skip this section.

Let $\langle N, {}^*\!\!I\rangle$ be an ${\EuScript L}$-structure that extends ${\EuScript L}$-elementarily the standard structure $M$. %$\langle M, I\rangle$.
Let $\eta$ be a free variable of sort ${\sf I}$.
For each $\beta\in I$, we define the type

\ceq{\hfill{\rm m}_\beta(\eta)}{=}{\{\eta\in D\ :\  D \textrm{ compact neighborhood of }\beta\}.}

The set of the realizations of ${\rm m}_\beta(\eta)$ in ${}^*\!\!I$ is known to nonstandard analysts as the monad of $\beta$. 
% We write \emph{$\alpha\approx\alpha'$\/} if $\alpha\approx\beta\approx\alpha'$ for some $\beta\in I$.
% From the following fact it follows that $\,\approx\,$ is an equivalence relation on ${}^*\!\!I$.
The following fact is well-known.

\begin{fact}\label{fact_uniqueness_st}
  For every $\alpha\in{}^*\!\!I$ there is a unique $\beta\in I$ such that ${}^*\!\!I\models{\rm m}_\beta(\alpha)$.
\end{fact}

\begin{proof}
  Negate the existence of $\beta$.
  For every $\gamma\in I$ pick some compact neighborhood $D_\gamma$ of $\gamma$, such that ${}^*\!\!I\ \models\ \alpha\notin D_\gamma$.
  By compactness there is some finite $\Gamma\subseteq I$ such that $D_\gamma$, with $\gamma\in\Gamma$, cover $I$.
  By elementarity these $D_{\gamma}$ also cover ${}^*\!\!I$.
  A contradiction.
  The uniqueness of $\beta$ follows from normality.
\end{proof}

We denote by \emph{${\rm st}(\alpha)$\/} the unique $\beta\in I$ such that ${}^*\!\!I\models{\rm m}_\beta(\alpha)$.
% We write \emph{$\alpha\approx\alpha'$\/} if ${\rm st}(\alpha)={\rm st}(\alpha')$.

\begin{fact}\label{fact_st1}
  For every $\alpha\in{}^*\! I$ and every compact $C\subseteq I$

\ceq{\hfill{}^*\!\!I}{\models}{\alpha\in C\ \rightarrow\ {\rm st}(\alpha)\in C.}
\end{fact}

\begin{proof}
  Assume ${\rm st}(\alpha)\notin C$.
  By normality there is a compact set $D$ disjoint from $C$ that is a neighborhood of ${\rm st}(\alpha)$.
  Then  ${}^*\!\!I\models\alpha\in D\subseteq\neg C$.
\end{proof}

\begin{fact}\label{fact_terms_st}
  For every $\alpha\in({}^*\!\!I)^{|\alpha|}$ and every function symbol $f$ of sort ${\sf I}^{|\alpha|}\to{\sf I}$

  \ceq{\hfill{}^*\!\!I}{\models}{{\rm st}\big(f(\alpha)\big)=f\big({\rm st}(\alpha)\big).}
\end{fact}

\begin{proof}
  By Fact~\ref{fact_uniqueness_st} and the definition of st(-) it suffices to prove that ${}^*\!\!I\models f(\alpha)\in D$ for every compact neighborhood $D$ of $f\big({\rm st}(\alpha)\big)$.
  
  Fix one such $D$.
  Then ${\rm st}(\alpha)\in f^{-1}[D]$ .
  By continuity $f^{-1}[D]$ is a compact neighborhood of ${\rm st}(\alpha)$.
  Therefore ${}^*\!\!I\models \alpha\in f^{-1}[D]$ and, as $I\preceq{}^*\!\!I$ we obtain ${}^*\!\!I\models f(\alpha)\in D$.
\end{proof}

The \emph{standard part of $\langle N,{}^*\!\!I\rangle$\/} is the standard structure $\langle N,I\rangle$ that interprets the symbols $f$ of sort ${\sf H}^n\to {\sf I}$ as the functions

\ceq{\hfill f^N(a)}{=}{{\rm st}\big({}^*\!\!f(a)\big)}\hfill for all $a\in N^n$,

where ${}^*\!\!f$ is the interpretation of $f$ in  $\langle N,{}^*\!\!I\rangle$.
Symbols in $L_{\sf H}$ maintain the same interpretation.

\begin{fact}\label{fact_st2} 
  With the notation as above.
  Let $t(x\,;\eta)$ be a term of sort ${\sf H}^{|x|}\times{\sf I}^{|\eta|}\to {\sf I}$.
  Then for every $a\in M^{|x|}$ and $\alpha\in({}^*\!\!I)^{|\eta|}$\vskip-.7\baselineskip

  \ceq{\hfill t^N\big(a\,;{\rm st}(\alpha)\big)}{=}{{\rm st}\big({}^*\!t(a\,;\alpha)\big)}
\end{fact}
\begin{proof}
  When a $t$ is a function symbol of sort  ${\sf H}^{|x|}\to {\sf I}$, the claim holds by definition.
  When $t$ is a function symbol of sort ${\sf I}^{|\eta|}\to {\sf I}$, the claim follows from Fact~\ref{fact_terms_st}.
  Now, assume inductively that 

  \ceq{\hfill t_i^N\big(a\,;{\rm st}(\alpha)\big)}{=}{{\rm st}\big({}^*t_i(a\,;\alpha)\big)}

  holds for the terms $t_1(x\,;\eta),\dots,t_n(x\,;\eta)$ and let $t=f(t_1,\dots,t_n)$ for some function $f$ of sort ${\sf I}^n\to {\sf I}$.
  Then the claim follows immediately from the induction hypothesis and Fact~\ref{fact_terms_st}.
\end{proof}

% Symbols in $L_{\sf I}$ have the interpretation they have in models.

\begin{lemma}\label{lem_st}
  With the notation as above.
  For every $\varphi(x\,;\eta)\in{\EuScript L}^{\rm p}$, \  $a\in N^{|x|}$ and $\alpha\in({}^*\!\!I)^{|\eta|}$ 
  
  \ceq{\hfill\langle N,{}^*\!\!I\rangle\models\varphi(a\,;\alpha)}
  {\Rightarrow}
  {N\models\varphi\big(a\,;{\rm st}(\alpha)\big)}
\end{lemma}

\begin{proof}
  Suppose $\varphi(x\,;\eta)$ is ${\EuScript L}^{\rm p}$-atomic.
  If $\varphi(x\,;\eta)$ is a formula of $L_{\sf H}$ the claim is trivial. 
  Otherwise $\varphi(x\,;\eta)$ has the form $t(x\,;\eta)\in C$.
  Assume that the tuple $t(x\,;\eta)$ consists of a single term.
  The general case follows easily from this special case. 
  Assume that $\langle N,{}^*\!\!I\rangle\models t(a\,;\alpha)\in C$.
  Then ${\rm st}\big({}^*t(a\,;\alpha)\big)\in C$ by Fact~\ref{fact_st1}.
  Therefore $t^N\big(a\,;{\rm st}(\alpha)\big)\in C$ follows from Fact~\ref{fact_st2}.
  This proves the lemma for atomic formulas.
  Induction is immediate. 
\end{proof}

\begin{corollary}\label{corol_st}
  Let $M$ be a standard structure.
  Let $p(\eta)\subseteq{\EuScript L}^{\rm p}(M)$ be a type that does not contain existential quantifiers of sort ${\sf H}$.
  Then, if $p(\eta)$ is finitely consistent in $M$, it is realized in $M$.
 \end{corollary}
 
 The corollary has also a direct proof.
 This goes through the observation that the formulas in $p(\eta)$ define compact subsets of $I$.

 \begin{proof}
  Let $\langle ^*\!M,^*\!\!I\rangle$ be an ${\EuScript L}$-elementary saturated superstructure of $\langle M,I\rangle$.
  Then $\langle ^*\!M,^*\!\!I\rangle\models p(\alpha)$ for some $\alpha\in ^*\!\!I$.
  By the lemma above, $^*\!M\models p({\rm st}(\alpha))$.
  Now observe that the truth of formulas without  existential quantifiers of sort ${\sf H}$ is preserved by substructures.
 \end{proof}
 
 The exclusion of existential quantifiers of sort ${\sf H}$ is necessary.
 For a counterexample take $M=I=[0,1]$.
 Assume that ${\EuScript L}$ contains a function symbol for the identity map $\iota:M\to I$.
 Let $p(\eta)$ contain the formulas $\exists x\,\big(x>0\,\wedge\;\iota x+\eta\in[0,1/n]\big)$ for all positive integers $n$.

% \begin{corollary}\label{corol_Isaturation}
%   Let $M$ be a model and let $p(\eta)\subseteq{\EuScript L}^{\rm p}(M)$ be a type that is finitely consistent in $M$, where $\eta$ is a tuple of variables of sort ${\sf I}$.
%   Then $p(\eta)$ is realized in a model $N$ such that $M\preceq^{\rm p}N$.
% \end{corollary}

% \begin{proof}
%   By the classical Compactess Theorem, the type $p(\eta)$ is realized in some ${\EuScript L}$-structure $\langle N,{}^*\!\!I\rangle$ by
%   some $\alpha\in ({}^*\!\!I)^{|\eta|}$.
%   Therefore, by the lemma above $N\models p\big({\rm st}(\alpha)\big)$.
% \end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Compactness}\label{compactness}

It is convenient to distinguish between consistency with respect to standard structures and consistency with respect to ${\EuScript L}$-structures.
We say that a theory $T$ is \emph{${\EuScript L}$-consistent\/} when $\langle M,{}^*\!\!I\rangle\models T$ for some ${\EuScript L}$-structure.
We say that $T$ is \emph{consistent\/} when $M\models T$  is for some standard structure $M$.

\begin{theorem}[Positive Compactness Theorem]\label{thm_compattezza}
  Let $T$ be a positive theory that is finitely ${\EuScript L}$-consistent.
  Then $T$ is consistent.
\end{theorem}

\begin{proof}
  Suppose $T$ is finitely ${\EuScript L}$-consistent.
  By the Classical Compactness Theorem, there is an ${\EuScript L}$-structure $\langle M,{}^*\!\!I\rangle\models T$.
  Let $\langle M,I\rangle$ be its standard part as defined in Section~\ref{standard_part}.
  Then $M\models T$ by Lemma~\ref{lem_st}.
\end{proof}

% \begin{corollary}\label{prop_tipi_compattezza}
%   Let $p(x\,;y)\subseteq{\EuScript L}^{\rm p}(M)$ be finitely consistent in $M$, a model.
%   Then $N\models\existsH x\,\exists^I y\,p(x\,;y)$ for some model $N$ such that $M\preceq^{\rm p}N$.
% \end{corollary}

% \noindent\llap{\dangersign\kern2ex}%


% \begin{definition}
%   We say that $M$ is \emph{positively saturated\/} if for every $p(x)$ as in 1 and 2 below, $M\models\existsH x\, p(a)$.
%   \begin{itemize}
%     \item[1.] $p(x)\subseteq{\EuScript L}^{\rm p}(A)$ for some $A\subseteq  M$ of cardinality $<|M|$ and $|x|=1$;
%     \item[2.] $p(x)$ is finitely satisfied in $M$.
%   \end{itemize}
% \end{definition}
A model $N$ is \emph{positively $\lambda$-saturated\/} if it realizes all types $p(x\,;\eta)\subseteq{\EuScript L}^{\rm p}(N)$ with fewer than $\lambda$ parameters that are finitely consistent in $N$.
When $\lambda=|N|$ we simply say  \emph{positively saturated.}
The existence of positively saturated models is obtained from the classical case just as for Theorem~\ref{thm_compattezza}.

\begin{theorem}
  Every standard structure has an p-elementary extension to a positively saturated standard structure (possibly of inaccessible cardinality).
\end{theorem}

% Homogeneity follows from saturation by the usual back-and-forth contruction.

% \begin{proposition}(Homogeneity)
%   Let $N$ be saturated and of cardinality larger than $|{\EuScript L}^{\rm p}|$.
%   Then for every $ab\in M^\alpha$, where $\alpha<|N|$, such that $a\equiv b$, there is an ${\EuScript L}^{\rm p}$-automorphism of $N$ that maps $a$ to $b$.
% \end{proposition}

The following proposition shows that a slight amount of saturation tames the positive formulas.

\begin{proposition}\label{prop_approx}
  Let $N$ be a positively $\omega$-saturated standard structure.
  Then 
  
  \ceq{\hfill\big\{\varphi(x\,;\eta)\big\}'}{\leftrightarrow}{\varphi(x\,;\eta)}
  
  holds in $N$ for every formula $\varphi(x,;\alpha)\in{\EuScript L}^{\rm p}(N)$.
\end{proposition}

\begin{proof}
  We prove $\rightarrow$, the non trivial implication.
  The claim is clear for atomic formulas.
  Induction for conjunction, disjunction and the universal quantifiers is immediate.
 % 
  % Consider disjunction.
  % Let $\varphi=\varphi_i\vee\varphi_1$.
  % Assume inductively
 % 
  % \ceq{\hfill\varphi_i(x)}
  % {\leftrightarrow}
  % {\bigwedge_{\varphi_i'>\varphi_i}\varphi_i'(x)}
%
  % Then
%
  % \ceq{\hfill\varphi(x)}
  % {\leftrightarrow}
  % {\bigwedge_{\varphi_1'>\varphi_1}\varphi_1'(x) \ \vee \bigwedge_{\varphi_2'>\varphi_2}\varphi_2'(x)}
%
  % \ceq{}
  % {\leftrightarrow}
  % {\bigwedge_{\substack{\varphi_1'>\varphi_1\\ \varphi_2'>\varphi_2}}\varphi_1'(x) \vee\varphi_2'(x)}
%
  % \ceq{}
  % {\leftrightarrow}
  % {\bigwedge_{\varphi'>\varphi}\varphi'(x)}
%
  We consider case of the existential quantifiers of sort ${\sf H}$.
  Assume inductively
  
  \ceq{\textrm{ih.}\hfill\{\varphi(x,z\,;\eta)\}'}
  {\rightarrow}
  {\varphi(x,z\,;\eta)}

  We need to prove

  \ceq{\hfill\{\existsH z\,\varphi(x,z\,;\eta)\}'}
  {\rightarrow}
  {\existsH z\,\varphi(x,z\,;\eta)}

  From (ih) we have

  \ceq{\hfill\existsH z\,\{\varphi(x,z\,;\eta)\}'}
  {\rightarrow}
  {\existsH z\,\varphi(x,z\,;\eta)}

  Therefore it suffices to prove

  \ceq{\hfill\{\existsH z\,\varphi(x,z\,;\eta)\}'}
  {\rightarrow}
  {\existsH z\,\{\varphi(x,z\,;\eta)\}'}

Replace the variables $x\,;\eta$ with parameters, say $a\,;\alpha$ and assume that the theory $\{\existsH z\,\varphi'(a,z,;\alpha):\varphi'>\varphi\}$ is true in $N$.
We need to prove the consistency of the type $\{\varphi'(a,z,;\alpha):\varphi'>\varphi\}$.
By saturation, finite concistency suffices.
This is clear if we show that the antecedent is closed under conjunction.
Indeed it is easy to verify that if $\varphi_1,\varphi_2>\varphi$ then $\varphi_1\wedge\varphi_2>\varphi'$ for some $\varphi'>\varphi$.
In words, the set of approximations of $\varphi$ is a directed set.

For existential quantifiers of sort ${\sf I}$ we argue similarly.% by applying Corollary~\ref{corol_Isaturation}.
%
% \noindent\llap{\textcolor{red}{\Large\danger}\kern1ex}\ignorespaces
% Consider the existential quantifiers of sort $I$
% Assume inductively
%
% \ceq{\hfill\bigwedge_{\varphi'>\varphi}\varphi'(x;y)}
% {\rightarrow}
% {\varphi(x;y)}
%
% As above, it suffices to prove
%
% \ceq{\#\hfill\bigwedge_{\varphi'>\varphi}\exists^C\! y\,\varphi'(x;y)}
% {\rightarrow}
% {\exists^C\! y\,\bigwedge_{\varphi'>\varphi}\varphi'(x;y)}
%
\end{proof}

% \begin{remark}
%   If we restrict to formulas without quantifiers of sort ${\sf H}$, the proposition above holds in every model (this is clear from the proof).
% \end{remark}

\def\ceq#1#2#3{\parbox[t]{20ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

% \begin{remark}\label{remk_approx_EH_free}
  By Corollary~\ref{corol_st}, when $\varphi(x\,;\eta)$ does not contains existential quantifiers of sort ${\sf H}$, the proposition above does not require the assumption of saturation.
  In general, some saturation is necessary: consider the model presented after Corollary~\ref{corol_st} and the formula $\exists x\,\big(x>0\ \wedge\ \iota(x)\in\{0\}\big)$. 
% \end{remark}

A consequence of Proposition~\ref{prop_approx} is that the approximate morphisms defined in Section~\ref{morphisms} coincide with their unapproximate version when the codomain is positively $\omega$-saturated.
% In particular, the following follows from Fact~\ref{fact_HImorphisms}.

% \begin{corollary}\label{corol_omega_sat}
%   Let $N$ be an positively $\omega$-saturated model.
%   Let $f:M\to N$ be an p-elementary map.
%   Then

%   \ceq{\hfill M\models\varphi(a)}{\Leftrightarrow}{N\models\varphi(fa)}

%   for every formula $\varphi(x)\in{\EuScript L}^{\rm p}$ and every $a\in({\rm dom }f)^{|x|}$.
% \end{corollary}  


% \begin{fact}\label{fact_saturation_invertible}
%   Let $M$ be a model that is $\lambda$-positively saturated for some $\lambda\ge|{\EuScript L}|$.
%   Let $f:M\to N$ be an p-elementary map.
%   Then

%   \ceq{\hfillM\models\varphi(a)}{\Leftrightarrow}{{\EuScript N}\models\varphi(fa)}

%   for every ${\EuScript L}^{\rm p}$-atomic formula $\varphi(x)$ and every $a\in({\rm dom }f)^{|x|}$
% \end{fact}

% \begin{proof}
%   Assume ${\EuScript N}\models\varphi(fa)$.
%   It sufficies to prove the fact for $f$ of finite cardinality.
%   By the downward L\"owenheim-Skolem Theorem, there is a model ${\EuScript N_0}\preceq^{\EuScript L}{\EuScript N}$ of cardinality $|{\EuScript L}|$ containing $f(a)$.
%   By saturation there is a model ${\EuScript M_0}\preceq^{\rm p}M$ that is isomorphic to ${\EuScript N_0}$ over $f$.
%   By isomorphism ${\EuScript M_0}\models\varphi(a)$ and therefore $M\models\varphi(a)$
% \end{proof}
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The monster model}\label{monster}

We denote by \emph{${\EuScript U}$\/} some large positively saturated standard structure which we call the \emph{monster model.}
% For convenience we assume that the cardinality of ${\EuScript U}$ is an inaccessible cardinal.
Truth is evaluated in ${\EuScript U}$ unless otherwise is specified.
Below we say \emph{model\/} for p-elementary substructure of ${\EuScript U}$.
We stress once again that the truth of some $\varphi\in{\EuScript L}^{\rm p}(M)$ in a model $M$ implies the truth of $\varphi$ (in ${\EuScript U}$) but not vice versa.
If also the converse implication holds we say $M$ a \emph{strong model.}
However, all models agree on the approximated truth, see Fact~\ref{fact_HImorphisms},

\ceq{\hfill M\models\{\varphi\}'}{\Leftrightarrow}{\{\varphi\}'}

Strong models are those that realize the equivalence in Proposition~\ref{prop_approx}, e.g.\@ positively $\omega$-saturated models are strong models.

% Let $A\subseteq{\EuScript U}$ be a small set throughout this section.
% We define a topology on ${\EuScript U}^{|x|}$ which we call the \emph{${\EuScript L}^{\rm p}(A)$-topology.}
% The closed sets of this topology are the sets defined by the types $p(x)\subseteq{\EuScript L}^{\rm p}(A)$.
% This is a compact topology by the Compactness Theorem for ${\EuScript L}^{\rm p}$.
The following fact demostrates how positive compactness applies.
There are some subtle differences from the classical setting.
% \begin{lemma}
%   For every $\varphi(x\,;y)\in{\EuScript L}^{\rm p}(A)$ the set $\varphi(U\,;I)$ is a compact subset of ${\EuScript U}^{|x|}\times I^{|y|}$.
% \end{lemma}

% \begin{proof}
%   We prove that every finitely intersecting family of closed subsets of $\varphi(U\,;I)$ has nonempty intersection.
%   Without loss of generality we can assume that the sets in this family have the form $\psi(U)\times C_1\times\dots\times C_{|y|}$ for some compact sets $C_i\subseteq I$ and some $\psi(x)\in{\EuScript L}^{\rm p}$.
%   Then by ${\EuScript L}^{\rm p}$-compactness the intersection of the family is nonempty.
% \end{proof}

\begin{fact}\label{fact_compactness_imp}
  Let $p(x)\subseteq{\EuScript L}^{\rm p}(A)$ be a type.
  Then for every  $\varphi(x)\in{\EuScript L}^{\rm p}({\EuScript U})$
  \begin{itemize}
    \item[1.] if $p(x)\rightarrow\neg\varphi(x)$ then $\psi(x)\rightarrow\neg\varphi(x)$ for some $\psi(x)$ conjunction of formulas in $p(x)$;
    \item[2.] if $p(x)\rightarrow\varphi(x)$ and $\varphi'>\varphi$ then $\psi(x)\rightarrow\varphi'(x)$ for some conjunction of formulas in $p(x)$.
  \end{itemize} 
\end{fact}

\begin{proof}
  (1) is immediate by saturation;  (2) follows from (1) by Lemma~\ref{lem_interpolation}.
\end{proof}



% \begin{example}
%   The equivalence in the proposition above does not extend to all formulas in ${\EuScript L}^{\rm p}$.
%   For a counter example, let both $M$ and $I$ are the real interval $[0,1]$.
%   The language has a function symbol ${\rm d}$ of sort $M^2\to I$.
%   Its interpretation is ${\rm d}^{\EuScript M}(x,y)=|x-y|$.
%   The formula 
  
%   \ceq{\hfill\varphi}{=}{\exists\varepsilon\big[\varepsilon\in\{0\}\ \wedge\ \existsH x,y\ \ {\rm d}(x,y)\cdot\varepsilon\in\{1\}\big]}

%   is false, though every $\varphi'>\varphi$ is true (in ${\EuScript M}$ and any ${\EuScript L}^{\rm p}$-extension of ${\EuScript M}$).\hfill\qedsymbol
% \end{example}


% The following fact is an immediate consequence.



% \begin{corollary}
%   If $\varphi(x),\psi(x)\in{\EuScript L}^{\rm p}(U)$ are mutually inconsistent then there are $\varphi'>\varphi$ and $\psi'>\psi$ that are mutually inconsistent.
% \end{corollary}





% \begin{fact}
%   Let $a\in M^{|x|}$ be such that ${\EuScript M}\not\models\varphi(a)$
%   Then, ${\EuScript M}\not\models\varphi'(a)$ for some $\varphi'>\varphi$.\hfill\qedsymbol
% \end{fact}














% \begin{fact}
%   Let $\varphi(x)\in{\EuScript L}^{\rm p}(A)$, where $A\subseteq M$.
%   Then for every $a\in M^{|x|}$ such that ${\EuScript M}\not\models\varphi(a)$ there is a formula $\tilde\varphi(x)\in{\EuScript L}^{\rm p}(A)$ such that ${\EuScript M}\models\tilde\varphi(a)$ and ${\EuScript M}\models\neg\existsH x\,[\tilde\varphi(x)\wedge\varphi(x)]$.
% \end{fact}


% \begin{fact}
%   For every $\varphi(x),\psi(x)\in{\EuScript L}^{\rm p}(U)$ such that $\neg\existsH x\,[\varphi(x)\wedge\psi(x)]$ there are $\varphi'>\varphi$ and $\psi'>\psi$ such that $\neg\existsH x\,[\varphi'(x)\wedge\psi'(x)]$.
% \end{fact}

% \begin{proof}
%   By Proposition~\ref{prop_approx} and saturation.
% \end{proof}

% The following are immediate consequences of the proposition above and Lemma~\ref{lem_interpolation}.

% \begin{corollary}\label{corol_Hcomplete1}
%   For every $a\in {\EuScript U}^{|x|}$ and $\varphi(x)\in{\EuScript H}(U)$, if $\neg\varphi(a)$ then $\tilde\varphi(a)$ for some $\tilde\varphi\perp\varphi$.\hfill\qedsymbol
% \end{corollary}

When $A\subseteq{\EuScript U}$, we write \emph{$S^{\rm p}_x(A)$\/} for the set of maximally consistent subsets of ${\EuScript L}^{\rm p}_x(A)$.
We define \emph{$\mbox{p-tp}(a/A)$,} the positive type of $a$ over $A$, to be the set of formulas $\big\{\varphi(x)\in{\EuScript L}^{\rm p}(A)\ :\ \varphi(a)\big\}$.
In general, if ${\EuScript F}$ is any set of formulas, we write \emph{${\EuScript F}\mbox{-tp}(a/A)$,} for the type $\big\{\varphi(x)\in{\EuScript F}(A)\ :\ \varphi(a)\big\}$. 
The undecorated symbol $\mbox{tp}(a/A)$ denotes the ${\EuScript L}$-type.

\begin{fact}\label{fact_max_cons_L}
  Let $p(x)\subseteq{\EuScript L}^{\rm p}(A)$.
  The following are equivalent 
  \begin{itemize}
    \item[1.] $p(x)$ is a maximally consistent subsets of ${\EuScript L}^{\rm p}_x(A)$;
    \item[2.] $p(x)=\mbox{p-tp}(a/A)$ for some $a\in{\EuScript U}^{|x|}$.
  \end{itemize}
\end{fact}

\begin{proof}
  (1$\Rightarrow$2) By the saturation of ${\EuScript U}$, there is an $a\in{\EuScript U}^{|x|}$ such that $p(x)\subseteq\mbox{p-tp}(a/A)$.
  By maximality $p(x)=\mbox{p-tp}(a/A)$.


  (2$\Rightarrow$1) 
  From Lemma~\ref{lem_interpolation} and Proposition~\ref{prop_approx} we obtain

  \ceq{\hfill\neg\varphi(x)}
  {\rightarrow}
  {\bigvee_{\tilde{\varphi}\perp\varphi}\tilde{\varphi}(x).}

  Suppose $\varphi(x)\in{\EuScript L}^{\rm p}(A)\smallsetminus  p$.
  Then $\neg\varphi(a)$.
  Hence $\tilde{\varphi}(a)$ holds for some $\tilde{\varphi}\perp\varphi$ and $p(x)\rightarrow\neg\varphi(x)$ follows.
\end{proof}

Let ${\EuScript H}$ be the set of positive formulas without quantifiers of sort ${\sf I}$.
Note that in the proof above we could replace ${\EuScript L}^{\rm p}$ with any class of positive formulas closed under strong negation.
Therefore we can also claim the following.

\begin{fact}\label{fact_max_cons_H}
  Let $p(x)\subseteq{\EuScript H}(A)$.
  The following are equivalent 
  \begin{itemize}
    \item[1.] $p(x)$ is a maximally consistent subset of ${\EuScript H}_x(A)$;
    \item[2.] $p(x)={\EuScript H}\mbox{-tp}(a/A)$ for some $a\in{\EuScript U}^{|x|}$.
  \end{itemize}
\end{fact}

% \begin{proposition}\label{prop_LHapprox2}
%   Let ${\EuScript F}$ be a dense set of positive formulas.
%   Let $\varphi(x)\in{\EuScript L}^{\rm p}(A)$ be such that $\neg\varphi(x)$ is consistent.
%   Then  $\psi'(x)\rightarrow\neg\varphi(x)$ for some consistent $\psi(x)\in{\EuScript F}(A)$ and some $\psi'>\psi$.
% \end{proposition}
 

% One interesting consequence of the proposition above is that in Fact~\ref{fact_max_cons_L} we can replace ${\EuScript L}^{\rm p}$ with any dense set of positive formula.

% \begin{fact}
%   Let ${\EuScript F}$ be a dense set of positive formulas.
%   Let $p(x)\subseteq{\EuScript F}(A)$.
%   The following are equivalent 
%   \begin{itemize}
%     \item[1.] $p(x)$ is maximally consistent;
%     \item[2.] $p(x)={\EuScript F}\mbox{-tp}(a/A)$ for some $a\in{\EuScript U}^{|x|}$.
%   \end{itemize}
% \end{fact}

% \begin{proof}
%   (1$\Rightarrow$2) Again, by the saturation of ${\EuScript U}$.

%   (2$\Rightarrow$1)
%   Let $\varphi(x)\in{\EuScript L}^{\rm p}(A)\smallsetminus p$.
%   From Proposition~\ref{prop_LHapprox2} we obtain that $\psi(a)$ holds for some $\psi(x)\in{\EuScript F}(A)$ such that $\psi(x)\rightarrow\neg\varphi(x)$.
%   Therefore $p(x)\rightarrow\neg\varphi(x)$ follows.
% \end{proof}

% \begin{corollary}\label{corol_Hcomplete3}
%   The inverse of an ${\EuScript H}$-elementary map $f:{\EuScript U}\to{\EuScript U}$ is ${\EuScript H}$-elementary.
% \end{corollary}






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Elimination of quantifiers of sort \textsf{I}}\label{Ielimination}

We show that the quantifiers of sort ${\sf I}$ can be eliminated up to some approximation.
Precisely, we prove that the set formulas ${\EuScript H}$ defined above is dense (modulo the theory of ${\EuScript U}$), see Definion~\ref{def_dense}.

We say that partial map $f:{\EuScript U}\to{\EuScript U}$ is ${\EuScript H}$-elementary if it preserves the truth of formulas in ${\EuScript H}$.

\begin{proposition}
  Every ${\EuScript H}$-elementary map of cardinality $<|{\EuScript  U}|$ extends to an automorphism of ${\EuScript H}$.
\end{proposition}

\begin{proof}
  By Fact~\ref{fact_max_cons_H}, the inverse of an ${\EuScript H}$-elementary map is also ${\EuScript H}$-elementary.
  Then we can extend the map by back-and-forth as usual.
\end{proof}

Let $A\subseteq{\EuScript U}$ be a small set throughout this section.
We apply the proposition above to obtain a strengthening of Fact~\ref{fact_max_cons_H}.
For $a,b\in {\EuScript U}^{|x|}$ we write \emph{$a\equiv_Ab$\/} if $a$ and $b$ satisfy the same ${\EuScript L}$-formulas over $A$.

\begin{corollary}\label{corol_Lcomplete}
  Let $p(x)={\EuScript H}(A)\mbox{-tp}(a/A)$ and $q(x)=\mbox{tp}(a/A)$. Then $p(x)\leftrightarrow q(x)$.
\end{corollary}

\begin{proof}
  Only $\rightarrow$ requires a proof.
  If $b\models p(x)={\EuScript H}\mbox{-tp}(a/A)$ then there is an ${\EuScript H}$-elementary map $f\supseteq{\rm id}_A$ such that $fa=b$.
  Then $f$ exends to an automorphism.
  As every automorphism is ${\EuScript L}$-elementary, $a\equiv_Ab$, and the corollary follows.
\end{proof}

This corollary says that at the level of types there is no difference between ${\EuScript L}$, ${\EuScript L}^{\rm p}$, and ${\EuScript H}$.

In the classical setting, from an equivalence between types one derives an  equivalence between formulas.
Without negation, this is not true.
Still, we can infer an approximate form of equivalence.

\begin{proposition}\label{prop_LHapprox1}
  The set ${\EuScript H}$ is dense (modulo the theory of ${\EuScript U}$).
\end{proposition}

\begin{proof}
  Let $\varphi(x)$ be a positive formula.
  We need to prove that for every $\varphi'>\varphi$ there is some $\psi(x)\in{\EuScript H}$ such that $\varphi(x)\rightarrow\psi(x)\rightarrow\varphi'(x)$.
  By Corollary~\ref{corol_Lcomplete} and Proposition~\ref{prop_approx}

  \ceq{\hfill\neg\varphi(x)}{\rightarrow}{\bigvee_{p'(x)\rightarrow\neg\varphi(x)}p'(x)}

  where $p(x)$ ranges over the maximally consistent ${\EuScript H}$-types.
  By Fact~\ref{fact_compactness_imp} and Lemma~\ref{lem_interpolation}

  \ceq{\hfill\neg\varphi(x)}{\rightarrow}{\bigvee_{\neg\tilde{\psi}(x)\rightarrow\neg\varphi(x)}\neg\tilde{\psi}(x),}

  where $\tilde{\psi}(x)\in{\EuScript H}$.
  Equivalently,

  \ceq{\hfill\varphi(x)}{\leftarrow}{\bigwedge_{\tilde{\psi}(x)\leftarrow\varphi(x)}\tilde{\psi}(x).}

  By compactness, see Fact~\ref{fact_compactness_imp}, for every $\varphi'>\varphi$ there are some finitely many $\tilde{\psi}_i(x)\in{\EuScript H}$ such that

  \ceq{\hfill\varphi'(x)}{\leftarrow}{\bigwedge_{i=1,\dots,n}\tilde{\psi}_i(x)\ \ \leftarrow\ \ \varphi(x)}

  which yields the interpolant required by the proposition.
\end{proof}

% \begin{proposition}\label{prop_LHapprox2}
%   Let $\varphi(x)\in{\EuScript L}^{\rm p}(A)$. For every given $\tilde{\varphi}\perp\varphi$ there is some $\psi(x)\in{\EuScript H}(A)$ such that $\varphi(x)\rightarrow\psi(x)\rightarrow\neg\tilde{\varphi}(x)$.
% \end{proposition}


\begin{proposition}\label{prop_Fapprox}
  Let ${\EuScript F}$ be a dense set of positive formulas.
  Then for every $\varphi(x)\in{\EuScript L}$ 
  
  \ceq{\hfill\varphi(x)}
  {\leftrightarrow}
  {\bigvee\big\{\psi(x)\in{\EuScript F}\ :\ \psi'(x)\rightarrow\varphi(x)\textrm{ for some }\psi'>\psi\big\}.}
\end{proposition}
 
\begin{proof}
  Only $\rightarrow$ requires a proof.
  We will make reteated use of the equivalence $p(x)\leftrightarrow p'(x)$ that holds for all $p(x)\subseteq{\EuScript L}^{\rm p}$.
  Let $a\in {\EuScript U}^{|x|}$ be such that $\varphi(a)$.
  Let $p(x)={\EuScript H}\mbox{-tp}(a/A)$.
  By Corollary~\ref{corol_Lcomplete}, $p(x)\rightarrow\varphi(x)$.
  As ${\EuScript F}$ is dense, $p'(x)\leftrightarrow q(x)={\EuScript F}\mbox{-tp}(a/A)$.
  Then $q(x)\rightarrow\varphi(x)$ and, by compactness, $\psi'(x)\rightarrow\varphi(x)$ for some $\psi'>\psi\in{\EuScript F}$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The Tarski-Vaught test and the L\"owenheim-Skolem theorem}

The following proposition is our version of the Tarski-Vaught test.

\begin{proposition}\label{prop_Tarski_Vaught}
  Let $M$ be a subset of ${\EuScript U}$.
  Let ${\EuScript F}$ be a dense set of positive formulas.
  Then the following are equivalent
  \begin{itemize}
    \item[1.] $M$ is a model;
    \item[2.] for every formula $\psi(x)\in{\EuScript F}(M)$
    
    \noindent\kern-\leftmargin
    \ceq{\hfill\existsH x\,\psi(x)}{\Rightarrow}
    {\textrm{ for every }\psi'>\psi\textrm{ there is an }a\in M\textrm{ such that }\psi'(a);}
  
    \item[3.] for every formula $\psi(x)\in{\EuScript F}(M)$
    
    \noindent\kern-\leftmargin
    \ceq{\hfill \existsH x\,\neg\psi(x)}{\Rightarrow}
    {\textrm{ there is an }a\in M\textrm{ such that }\neg\psi(a).}
  \end{itemize}
\end{proposition}

\begin{proof}
  (1$\Rightarrow$2) Assume $\existsH x\,\psi(x)$ and let $\psi'>\psi$ be given.
  By Lemma~\ref{lem_interpolation} there is some $\tilde{\psi}\perp\psi$ such that  $\psi(x)\rightarrow\neg\tilde{\psi}(x)\rightarrow\psi'(x)$.
  Then $\neg\forallH x\,\tilde{\psi}(x)$ hence, by (1), $M\models\neg\forallH x\,\tilde{\psi}(x)$.
  Then $M\models\neg\tilde{\psi}(a)$ for some $a\in M$. Hence $M\models\psi'(a)$ and $\psi'(a)$ follows from (1).

  (2$\Rightarrow$3)
  Assume (2) and let $\psi(x)\in{\EuScript F}(M)$ be such that $\existsH x\,\neg\psi(x)$.
  By Proposition~\ref{prop_disjunction_dense}, there are a consistent $\varphi(x)\in{\EuScript F}(M)$ and some $\varphi'>\varphi$ such that $\varphi'(x)\rightarrow\neg\psi(x)$.
  Then (3) follows.

  (2$\Rightarrow$1)
  Assume (2).
  By the classical Tarski-Vaught test $M\preceq_{\sf H}{\EuScript U}$.
  Then $M$ is the domain of an ${\EuScript L}$-substructure of ${\EuScript U}$.
  Then $\varphi(a)\ \Leftrightarrow\ M\models\varphi(a)$ holds for every atomic formula $\varphi(x)$ and for every $a\in M^{|x|}$.
  Now, assume inductively
  
  \ceq{\hfill M\models\varphi(a,b)}{\Rightarrow}{\varphi(a,b).}

  Using (2) and the induction hypothesis we prove by contrapposition that

  \ceq{\hfill M\models\forallH y\,\varphi(a,y)}{\Rightarrow}{\forallH y\,\varphi(a,y)}.

  Indeed,

  \ceq{\hfill\neg\forallH y\,\varphi(a,y)}
  {\Rightarrow}{\existsH y\,\neg\varphi(a,y)}
  
  \ceq{}
  {\Rightarrow}{\existsH y\,\neg\varphi'(a,y)}\hfill \rlap{for some $\varphi'>\varphi$}\kern52ex
  
  \ceq{}
  {\Rightarrow}{\existsH y\,\neg\psi(a,y)}\hfill\rlap{for some $\psi\in{\EuScript F}$ such that $\varphi(a,y)\rightarrow\psi(a,y)\rightarrow\varphi'(a,y)$}\kern52ex% in every ${\EuScript L}$-structure
  
  \ceq{}
  {\Rightarrow}
  {\neg\psi(a,b)}\hfill\rlap{for some $b\in M$ by (2)}\kern52ex
  
  \ceq{}
  {\Rightarrow}
  {\neg\varphi(a,b)}
  
  \ceq{}
  {\Rightarrow}
  {M\models\neg\varphi(a,b)}\hfill\rlap{by induction hypothesis}\kern52ex

  \ceq{}
  {\Rightarrow}
  {M\not\models\forallH y\,\varphi(a,y).}

  Induction for the connectives $\vee$, $\wedge$, $\exists\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}$, $\exists\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}$, and $\forall\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}$ is straightforward.
\end{proof}

Classically, the main application of the Tarski-Vaught test is in the proof of the downward L\"owenheim-Skolem Theorem.
Note that here the classical downward L\"owenheim-Skolem Theorem holds in full for all ${\EuScript L}$-structures.
In particular every $A\subseteq{\EuScript U}$ is contained in a model of cardinality $|{\EuScript L}(A)|$.
In this form the L\"owenheim-Skolem Theorem is not very informative.
In fact, the cardinality of ${\EuScript L}$ is eccessively large because of the aboundance of symbols in $L_{\sf I}$.

We say that ${\EuScript L}$ is \emph{separable\/} if there is a countable set  ${\EuScript F}$ of positive formulas that is dense modulo ${\EuScript L}$.
% In Section~\ref{separability} we will present examples of separable models.

\begin{proposition}\label{prop_disjunction_dense}
  Assume that ${\EuScript L}$ is separable.
  Let $A\subseteq{\EuScript U}$ be countable.
  Then there is a countable model $M$ containing $A$. 
\end{proposition}

\begin{proof}
  As in the classical proof of the L\"owenheim-Skolem Theorem,
  we construct $M\subseteq{\EuScript U}$ that contain a witness for every consistent formula in ${\EuScript F}(M)$.
  By separability and Proposition~\ref{prop_Tarski_Vaught}, $M$ is a model.
\end{proof}
% \begin{fact}
%   Then there is a countable set   countable language $L_{\sf Q}\subseteq L_{\sf I}$ such that 
% \end{fact}

We have defined separability as a property of ${\EuScript L}$.
Arguably, it could have been introduced as a property of the theory of ${\EuScript U}$.
The following proposition provides the examples that motivate the definition of separability (in these examples the property depends soley on ${\EuScript L}$).

\begin{proposition}
  Assume that $L_{\sf H}$ is countable and that ${\EuScript L}$ has at most countably many symbols of sort ${\sf H}^n\to {\sf I}$.
  Then, if $I$ is a second countable (the topology has a countable base), ${\EuScript L}$ is separable.
\end{proposition}
\begin{proof}
  Fix a countable filter of compact neighborhoods of the diagonal of ${\sf I}^2$.  
\end{proof}



% The \emph{weight\/} of ${\EuScript L}$, which we denote by \emph{${\rm wgt}\big({\EuScript L}\big)$\/} is the minimal cardinality of a set of formulas ${\EuScript H}'$ such that for every $\varphi''>\varphi\in{\EuScript H}$ there is a $\varphi'\in{\EuScript H}'$ such that $\varphi''>\varphi'>\varphi$.
% If this minimal cardinality is $\omega$, we say that ${\EuScript L}$ is sparable. 
% It is not difficult to see that when $I$ is the real unit interval and ${\EuScript L}$ contains at most countably many symbols of sort ${\sf H}^n\to{\sf I}$ then ${\EuScript L}$ is separable.

% \begin{proposition}
%   Let $A\subseteq U$.
%   Then  $A$ is contained in a model of cardinality at most ${\rm wgt}\big({\EuScript L}\big)+|A|$.  
% \end{proposition}

% \begin{proof}
%   As in the classical L\"owenheim-Skolem Theorem, using (2) of Proposition~\ref{prop_Tarski_Vaught}.
% \end{proof}


% \begin{proposition}
%   The following are equivalent
%   \begin{itemize}
%     \item[1.] ${\EuScript L}$ is separable;
%     \item[2.] there is an ${\EuScript L}$-structure $\langle M_0,R_0\rangle\preceq{\EuScript U}$ with $|M_0|=|R_0|=\omega$.
%   \end{itemize}  
% \end{proposition}





%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
\section{Cauchy complete models}\label{Cauchy}


For $t(x,z)$ a term of sort ${\sf H}^{|x|+|z|}\to {\sf I}$ we define the formula


\ceq{\hfill\emph{$x\sim_ty$}}{=}{\forallH z\ \ t(x,z)=t(y,z).}

We also define the type 

\ceq{\hfill\emph{$x\sim_{\sf I}\!y$}}{=}{\Big\{x\sim_ty\ :\ t(x,z)\textrm{ as above}\Big\}.}

% We define the following equivalence relation on $U$

% \ceq{\hfill\emph{$a\sim_{\sf I}\!b$}}{=}{\forallH y\ \big[t(a,y)=t(b,y)\big]}\hfill 

% When two tuples of the same length $\bar a=\langle a_i:i<\lambda\rangle$ and $\bar b=\langle b_i:i<\lambda\rangle$ are such that $a_i\sim_{\sf I}\!b_i$ for every $i<\lambda$ we write \emph{$\bar a\sim_{\sf I}\bar b$.}


\begin{fact}\label{fact_productUniformity}
  For any $a=\langle a_i:i<\lambda\rangle$ and $b=\langle b_i:i<\lambda\rangle$ 
  
  \ceq{\hfill a\sim_{\sf I} b}{\Leftrightarrow}{a_i\sim_{\sf I} b_i}\quad for every $i<\lambda$.
\end{fact}

\begin{proof} 
  \def\ceq#1#2#3{\parbox[t]{30ex}{$\displaystyle #1$}\parbox{4ex}{\hfil $#2$}{$\displaystyle #3$}}
  %
  Only implication $\Leftarrow$ requires a proof.
  Assume $a_i\sim_{\sf I} b_i$ for every $i$.
  Let $|a|=|b|=\lambda$ and assume inductively that
  
  \ceq{\hfill\forallH y,z\ \ \ t(a,y,z)}{=}{t(b,y,z)}

  holds for every term $t(x,y,z)$, with $|x|=\lambda$ (universal quantification over the free variables is understood throughout the proof).  
  In particular for any $a_\lambda$

  \ceq{1.\hfill\forallH z\ \ \  t(a,a_\lambda,z)}{=}{t(b,a_\lambda,z).}

  As $a_\lambda\sim_{\sf I}\!b_\lambda$ then

  \ceq{\hfill\forallH x,z\ \ \   t(x,a_\lambda,z)}{=}{t(x,b_\lambda,z)}

  and in particular 

  \ceq{2.\hfill\forallH z\ \ \ t(b,a_\lambda,z)}{=}{t(b,b_\lambda,z).}

  From (1) and (2) we obtain

  \ceq{\hfill\forallH z\ \ \ t(a,a_\lambda,z)}{=}{t(b,b_\lambda,z).}

  For limit ordinals induction is trivial.
\end{proof}

Note that the approximations of the formula $x\sim_t\!y$ have the form

\ceq{\hfill\emph{$x\sim_{t,D}y$}}{=}{\forallH z\ \ \langle t(x,z),t(y,z)\rangle\in D}

for some compact neighborhood $D$ of $\Delta$, the diagonal of $I^2$.
Hence we define

\ceq{\hfill\emph{$x\sim'_{\sf I}\!y$}}{=}{\Big\{x\sim_{t,D}y\ :\ t(x,z)\textrm{ parameter-free term, } D\textrm{ compact neigborhood of }\Delta\Big\}.}

If $t(x,z)=t_1(x,z),\dots,t_n(x,z)$ is a tuple of terms, by $x\sim_{t,D}y$ we denote the conjunction of the formulas $x\sim_{t_i,D}y$.
As $D$ ranges over the compact neighborhoods of $\Delta$ and $t(x,z)$ ranges over the finite tuples parameter-free terms.
These formulas $x\sim_{t,D}y$ define a system of entougages on ${\EuScript U}^{|x|}$.
We refer to this uniformity and the topology associated as the \emph{${\sf I}$-topology.}
Though not needed in the sequel, it is worth mentioning that the ${\sf I}$-topology on ${\EuScript U}^{|x|}$ coincides with the product of the ${\sf I}$-topology on ${\EuScript U}$.
This can be verified by an argument similar to the proof of Fact~\ref{fact_productUniformity}.

We say that $p(x)\subseteq{\EuScript L}^{\rm p}({\EuScript U})$ is \emph{${\sf I}$-invariant\/} if $x\sim_{\sf I}\!y\rightarrow[p(x)\leftrightarrow p(y)]$.
It is clear that all formulas that do not contain atomic formulas of sort ${\sf H}$ are invariant.
The following proposition is an immediate consequence of compactness.
It corresponds to the Perturbation Lemma~\cite{HI}*{Proposition~5.15}.

\begin{proposition}\label{prop_perturbation}
  The following are equivalent for every $\varphi(x)\in{\EuScript L}^{\rm p}({\EuScript U})$ 
  \begin{itemize}
    \item[1.] $\varphi(x)$ is ${\sf I}$-invariant;
    \item[2.] for every $\varphi'>\varphi$ there are a tuple of therm $t$ and a compact neighborhood of $\Delta$ such that

    \ceq{\hfill x\sim_{t,D}\!y\ \wedge\ \varphi(x)}{\rightarrow}{\varphi'(y).}
  \end{itemize}
\end{proposition}

% It is immediate that ${\EuScript L}^{\rm p}$-formulas constructed without using (ii) of Definition~\ref{def_LL} are ${\sf I}$-invariant.
We say that $p(x)$ is a \emph{Cauchy type\/} if it is consistent and $p(x)\wedge p(y)\rightarrow x\sim_{\sf I}\!y$.

We say that a type $q(x)$ is \emph{finitely satisfiable\/} in $M$ if every conjunction of formulas in $q(x)$ has a solution in $M$.
This definition is classical but note that, though classically every type over $M$ is finitely saisfiable in $M$, here, unless $M$ is sufficiently saturated, we can only infer that $q'(x)$ is finitely satisfiable.

\begin{lemma}\label{lem_Cauchyequiv}
  The following are equivalent for every model $M$
  \begin{itemize}
    \item[1.]  $p(x)\subseteq{\EuScript L}^{\rm p}(M)$ is an ${\sf I}$-invariant Cauchy type;
    \item[2.] $p(x)\leftrightarrow a\sim_{\sf I}\!x$ for some/any $a\models p(x)$;
    \item[3.] $a\sim'_{\sf I}\!x$ is finitely satisfiable in $M$ for some/any $a\models p(x)$.
  \end{itemize}
\end{lemma}

\begin{proof}
  (1$\Rightarrow$2)
  Let $a\models p(x)$.
  Substituting $a$ for $y$ in the definition of Cauchy type we obtain $p(x)\rightarrow a\sim_{\sf I}\!x$
  Similarly, from the definition of ${\sf I}$-invariance we obtain $a\sim_{\sf I}\!x\rightarrow p(x)$.

  (2$\Rightarrow$3) 
  By compactness, as $p'(x)$ is finitely satisfiable in $M$.

  (3$\Rightarrow$1)  
  Let $a_{t,D}\in M$ be a realization of $a\sim_{t,D}x$ as $D$ ranges over the compact neighborhoods of the diagonal and $t(x,z)$ over the finite tuples parameter-free terms.
  Then, by the uniqueness of the limit (up to $\sim_I$-equivalence), the type $p(x)$ cointaining the formulas $x\sim_{t,D}a_{t,D}$ is as required by the lemma.
\end{proof}

We say that a set $A\subseteq{\EuScript U}$ is \emph{Cauchy complete\/} if every ${\sf I}$-invariant Cauchy type $p(x)\subseteq{\EuScript L}^{\rm p}(A)$ is realized by some $c\in A^{|x|}$.
% % We say that ${\EuScript M}$ is \emph{existentially closed (e.c.)\/} if every consistent conjunction of ${\EuScript L}^{\rm p}$-atomic formulas is satsfied in ${\EuScript M}$.
% Note that if $p(x)$ is Cauchy type then any consistent type $q(x)$ containing $p(x)$ is also Cauchy.
% In particular the type $p(x)\ \cup\ {\EuScript L}^{\rm p}\mbox{-Th}({\EuScript U}/M)$ is Cauchy.
% The following trivial consequence of this fact that is worth noticing

% \begin{remark}
%   Cauchy complete models are strong models.
%   I.e., $M\models\varphi$ for every true $\varphi\in{\EuScript L}^{\rm p}(M)$.
% \end{remark}

\begin{fact}
  Let $M$ be a model that is positively $\lambda$-saturated for some $\lambda>|{\EuScript L}|$.
  Then $M$ is Cauchy complete.
\end{fact}

\begin{proof}  
  Let $p(x)\subseteq{\EuScript L}^{\rm p}(M)$ be an ${\sf I}$-invariant Cauchy type.
  Pick any $a\models p(x)$.
  By Lemma~\ref{lem_Cauchyequiv}, $p(x)\leftrightarrow a\sim_{\sf I}\!x$.
  For every formula $\varphi(x)$ in the type $a\sim_{\sf I}\!x$ and every $\varphi'>\varphi$ pick some $\psi(x)\in p$ such that $\psi(x)\rightarrow\varphi'(x)$.
  There are $|{\EuScript L}|$ many formulas in $a\sim_{\sf I}\!x$.
  Then by saturation the formulas $\psi(x)$ we picked above have a common solution $b$ in $M$.
  Then $b\sim_{\sf I}\!a$ and, by invariance, $b\models p(x)$.
\end{proof}

It is clear from the proof that when ${\EuScript L}$ is separable it suffices to require $\lambda>\omega$.

\begin{comment}
  
We say that the set $B$ is a \emph{Cauchy closure\/} of $A$ if 
\begin{itemize}
  \item[1.] every ${\sf I}$-invariant Cauchy type $p(x)\subseteq{\EuScript L}^{\rm p}(A)$ is realized in $B$
  \item[2.] ${\EuScript L}^{\rm p}\mbox{-tp}(b/A)$ is Cauchy for every $b\in B$.
\end{itemize}

\begin{proposition}\label{prop_Cauchyclosure}
  Assume $L_{\sf H}$ is a functional language.
  Let $M$ be model.
  Then any Cauchy closure of $M$ is a model.
\end{proposition}

\begin{proof} ???
\end{proof}
  {\color{blue}
  (messy/wrong/incomplete)
  We need a few easy observations.
  Let $a\sim_{\sf I}a'$ be finite tuples.
  Let $\langle a\rangle$ be the $L_{\sf H}$ substructure of $U$ generated by $a$.
  Then for every $b\in U\smallsetminus\langle a\rangle$ there is a $b'\in U\smallsetminus\langle a'\rangle$ such that $a,b\sim_{\sf I}a',b'$.
  In fact, $\sim_{\sf I}$-classes are infinite, hence they ave the cardinality of $U$.
  Therefore, by back-and-forth, $a\equiv a'$.
  We also have that for every formula $\varphi(x,z)$ and $b\in U\smallsetminus\big(\langle a\rangle\cup\big)$ 

  \ceq{}{~}{\forallH x\notin{\rm rng}(a,a')\big[\varphi(x,a)\leftrightarrow\varphi(x,a')\big].}

  Let $N$ be a Cauchy closure of $M$.
  We verify that $N$ satisfies (2) of Proposition~\ref{prop_Tarski_Vaught}.
  Let $\varphi(x,z)\in{\EuScript H}$ and $a\in N^{|z|}$ be be such that $\existsH x\ \varphi(x,a)$.
  We can assume that $a$ is a tuple of distinct elements.
  By the observations above
  
  \ceq{\hfill a\sim_{\sf I}z}{\rightarrow}{\forallH x\notin{\rm rng}(a,z)\big[\varphi(x,a)\leftrightarrow\varphi(x,z)\big]}

  By compactness,

  \ceq{\hfill a\sim_{t,D}z}{\rightarrow}{\forallH x\notin{\rm rng}(a,z)\big[\varphi'(x,a)\leftrightarrow\varphi'(x,z)\big]}

  Every finite injective map $k:U\to U$ that preserves $\sim_{\sf I}$-classes is ${\EuScript L}$-elementary.
  By preserving $\sim_{\sf I}$-classes we mean that $a\sim_{\sf I}ka$ for every $a\in{\rm dom}(k)$.
  To prove the fact, pick any $b\in U\smallsetminus{\rm dom}(k)$ and note that, as $\sim_{\sf I}$-classes are infinite. there is a $c\in U\smallsetminus{\rm rng}(k)$ such that $k\cup\{\langle b,c\rangle$ preserves $\sim_{\sf I}$.
  The fact follows from the claim by back-and-forth.

  
  \ceq{\hfill a\sim_{\sf I}z}{\rightarrow}{\forallH x\notin{\rm rng}(a,z)\big[\varphi(x,a)\leftrightarrow\varphi(x,z)\big]}

  By compactness,

  \ceq{\hfill a\sim_{t,D}z}{\rightarrow}{\forallH x\notin{\rm rng}(a,z)\big[\varphi'(x,a)\leftrightarrow\varphi'(x,z)\big]}



\begin{proposition}
  \noindent\llap{\textcolor{red}{\Large\questionsign}\kern18ex}\ignorespaces
  Let ${\EuScript M}$ be an e.c.C.c\@ model.
  Then for every consistent formula $\varphi(x)\in{\EuScript H}(M)$ there is Cauchy type $p(x)\subseteq{\EuScript H}(M)$ such that $p(x)\rightarrow\varphi(x)$.
\end{proposition}

\begin{proof}
  If $\varphi(x)$ is a conjunction of ${\EuScript L}^{\rm p}$-atomic formulas then, as ${\EuScript M}$ is e.c., it is realized by some $a\in M^{|x|}$ hence we can take the type $\{x{=}a,\, \varphi(x)\}$. 
  Induction is immediate for the connectives $\vee,\forallH,\existsH$.
  This suffices because, up to equivalence, we can assume that $\wedge$ only occurs in front of ${\EuScript L}^{\rm p}$-atomic formulas.
\end{proof}

\begin{corollary}
  \noindent\llap{\textcolor{red}{\Large\questionsign}\kern16.5ex}\ignorespaces
  Let ${\EuScript M}$ be an e.c.C.c.\@ model.
  Then ${\EuScript M}\models\varphi$ for every true $\varphi\in{\EuScript H}(M)$.
\end{corollary}

\begin{proof}
  Apply the proposition in the case when $\varphi(x)$ does not depend on $x$.
  Let $p(x)\subseteq{\EuScript H}(M)$ be a Cauchy type such that $p(x)\rightarrow\varphi$.
  Then $\existsH y\sim_{\sf I}\! x\ p(y)$ is an ${\sf I}$-invariant Cauchy type that implies $\varphi$.
  Hence ${\EuScript M}\models\varphi$ by Cauchy completeness.
\end{proof}

  }


% Let $|x|=1$.
% It is easy to prove by induction on $\varphi(x,z)\in{\EuScript H}$ that if $\varphi(b,a)$ then either $b\in\range a$ or $b\sim_{\sf I}x\to\varphi(x,a)$.

% The proposition is proved by applying Theorem~\ref{prop_Tarski_Vaught}.Assume $\existsH x\ \varphi(x,a)$ and let $b\in U$ be such that $\varphi(b,a)$. 
% By the claim above either 


% and compactness, there is a formula $\psi(x)\in{\EuScript L}^{\rm p}(M)$ such that  $\psi(x)\to\varphi'(x,a)$.
% As 

% \begin{comment}
  {\color{blue}
The pr ${\EuScript M}$oof of the following proposition uses the same compactness argument used for Proposition~\ref{prop_LHapprox1}.

\begin{proposition}\label{prop_sim_approx}
  Let $\varphi(x)\in{\EuScript L}^{\rm p}(U)$ be ${\sf I}$-invariant.
  For every given $\varphi'>\varphi$ there are some $a_i\models\varphi(x)$, some terms $t_i(x,z)$, and some compact $C_i\subseteq I^2\smallsetminus\Delta$ such that 

  \ceq{\hfill\varphi(x)}{\rightarrow}{\bigwedge_{i=1,\dots,n}\tilde\tau_{t_i,C_i}(x,a_i)\ \ \rightarrow\ \ \varphi'(x),}

  where

  \ceq{\hfill\tilde\tau_{t,C}(x,z)}{=}{\existsH z\ \langle t(x,z),t(y,z)\rangle\in C.}

\end{proposition}

\begin{proof}
  As $\neg\varphi(x)$ is ${\sf I}$-invariant 

  \ceq{\hfill\neg\varphi(x)}{\leftrightarrow}{\bigvee_{a\,\models\neg\varphi(x)}\big\{\tau_{t,\Delta}(x,a)\ :\ t(x,z)\textrm{ a term}\big\}.}

  By Fact~\ref{fact_compactness_imp} and Lemma~\ref{lem_interpolation}

    \ceq{\hfill\neg\varphi(x)}{\leftrightarrow}{\bigvee_{\neg\tilde\tau_{t,C}(a,x)\rightarrow\neg\varphi(x)}\neg\tilde\tau_{t,C}(x,a),}

  where $C$ ranges over the compact subsetes of $I^2\smallsetminus\Delta$.
  Equivalently

  \ceq{\hfill\varphi(x)}{\leftrightarrow}{\bigwedge_{\varphi(x)\rightarrow\tilde\tau_{t,C}(x,a)}\tilde\tau_{t,C}(x,a).}

  By compactness, see Fact~\ref{fact_compactness_imp}, there are some some $a_i,t_i,C_i$ as in the lemma such that 

  \ceq{\hfill\varphi(x)}{\rightarrow}{\bigwedge_{i=1,\dots,n}\tilde\tau_{t_i,C_i}(x,a_i)\ \ \rightarrow\ \ \varphi'(x)}
\end{proof}
  }
\end{comment}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Example: metric spaces}

We discuss a simple example.
Let $I$ be $\mathds{R}^+\cup\{0,\infty\}$, with the topology that makes it homeomorphic to the unit interval.
Let $M,d$ is a metric space.
Let $L_{\sf H}$ contain symbols for functions $M^n\to M$ that are uniformly continuous.
Let ${\EuScript L}$ contain a symbol for $d$ and possibly for some funtions of $M^n\to I$ that are uniformly continuous w.r.t.\@ the metric $d$.

Let $\langle M,I\rangle$ be the structure that interprets the symbols of the language as natural.

Let ${\EuScript U}$ be a monster model that is  an ${\EuScript L}^{\rm p}$ elementary extension of $M$.
Clearly, $d$ does not define a metric on ${\EuScript U}$ as there are pairs of elements at infinite distance.
However, when restricted to a ball of finite radius, $d$ defines a pseudometric on  ${\EuScript U}$.
Therefore the notion of convergent sequence makes perfectly sense in ${\EuScript U}$.
As all functions have been required to be uniformly continuous, it is immediate that $x\sim_{\sf I}y$ is equivalent to $d(x,y)=0$.

\begin{fact}
  Let $ {\EuScript U}$ be as above.
  Then for every model $N$ the following are equivalent for every $a\in{\EuScript U}$
  \begin{itemize}
    \item[1.] $p(x)=\mbox{p-tp}(a/N)$ is a Cauchy type;
    \item[2.] there is a sequence $\langle a_i: i\in\omega\rangle$ of elements of $N$ that converges to $a$.
  \end{itemize} 
\end{fact}

\begin{proof}

  (2$\Rightarrow$1) 
  Let $\langle \varepsilon_i: i\in\omega\rangle$ be a sequence of reals that converges to $0$ and such that $d(a_i,a)\le\varepsilon_i$ for every $i\in\omega$.
  Then the formulas $d(a_i,x)\le\varepsilon_i$ are in $p(x)$.
  Then every element realizing $p(x)$ is at distance $0$ from $a$.
  Therefore  $p(x)\rightarrow a\sim_{\sf I}\!x$.


  (1$\Rightarrow$2) 
  As $p(x)$ is Cauchy type, $p(x)\rightarrow a\sim_{\sf I}\!x$.
  Then $p'(x)\rightarrow d(a,x)<2^{-i}$ for all $i$.
  By compactness (see Fact~\ref{fact_compactness_imp}) there are formulas $\varphi_i(x)\in p$ such that $\varphi'_i(x)\rightarrow d(a,x)<2^{-i}$ for some $\varphi'_i>\varphi_i$.
  By ${\EuScript L}^{\rm p}$-elementarity there is an $a_i\in N$ such that $\varphi'(a_i)$.
  As $d(a,a_i)<2^{-i}$ for all $i$, the sequence $\langle a_i: i\in\omega\rangle$ converges to $a$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Omitting types and countable categoricity}

A type $p(x)\subseteq{\EuScript L}({\EuScript U})$ is isolated by $\varphi(x)$, a consistent formula in ${\EuScript L}({\EuScript U})$, if $\varphi(x)\rightarrow p(x)$.
We say that $p(x)$ is isolated over $A$ if it is isolated by some formula in ${\EuScript L}(A)$. 
By Fact~\ref{prop_Fapprox}, if $p(x)$ is isolated by $\varphi(x)$ then it is isolated by a positive formula with the same parameters as $\varphi(x)$.






%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Continuous group actions}
% Let $M$ be a topological space.
% Let $G\le{\rm Homeo}(M)$ be a subgroup closed in the topology of the pointwise convergence.
% Then there is a compact topological space $I$ and a model ${\EuScript M}=\langle M,I\rangle$ such that ${\rm Aut}({\EuScript M})$ is isomorphic to $G$ as a topological group.

% Assume $M$ is compact, or otherwise substitute it with its Stone-Chech compactification.
% Consider $M^\omega$ as a topological space with the product topology.
% Let $G$ acts on $M^\omega$ coordinatewise. 
% Let $I$ be the set containing the topological closures of the $G$-orbits of elements of $M^\omega$, in notation this is the set $\big\{{\rm cl}(Ga):a\in M^\omega\big\}$.

% % First note that we can embed $M^{<\omega}$ into $M^\omega$, namely we map the tuple  $\langle a_1,\dots,a_n\rangle$, to the sequence  $\langle a_1,\dots,a_n^\omega\rangle$, where $a_n^\omega$ stands for an infinite sequence with constant value $a_n$.

% Let ${\EuScript M}=\langle M,I\rangle$.
% The language $L_{\sf H}$ is empty while ${\EuScript L}$ contains symbols for the functions

% \ceq{\hfill \pi^n\ :\ M^n}{\to}{I}

% \ceq{\hfill (a_1,\dots,a_n)}{\mapsto}{{\rm cl}\big(G(a_1,\dots,a_n^\omega)\big)},

% Where $a_n^\omega$ stands for the element $a_n$ repeated $\omega$-times.
% We claim that the ${\sf I}$-topology on $M$ coincides with its original topology.
% There is a natural embedding of $G$ into ${\rm Aut}({\EuScript M})$.
% Let $\gamma\in{\rm Aut}({\EuScript M})$ we claim that for every $a_1,\dots,a_n$ and every there is a $g\in G$ such that $\tau_{t,C}(\gamma(a),ga)$




%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
\newcommand\biburl[1]{\url{#1}}
\BibSpec{arXiv}{%
  +{}{\PrintAuthors}{author}
  +{,}{ \textit}{title}
  +{}{ \parenthesize}{date}
  +{,}{ arXiv:}{eprint}
  % +{,}{ \url}
}

\begin{bibdiv}
\begin{biblist}[]\normalsize

\bib{G}{article}{
  label={G},
  author = {Goldbring, Isaac},
  title = {Lecture notes on nonstandard analysis},
  conference={
    title={UCLA Summer School in Logic 2012}
   },
  eprint = {www.math.uci.edu/~isaac/NSA\%20notes.pdf},
}

\bib{H}{arXiv}{
  label={H},
  author = {Hart, Bradd},
  title = {An Introduction To Continuous Model Theory},
  eprint={2303.03969},
  doi = {10.48550/arXiv.2303.03969},
  url = {https://arxiv.org/abs/},
  publisher = {arXiv},
  date = {2023},
}

\bib{Hr}{article}{
   label={Hr},
   author={Hrushovski, Ehud},
   title={Stable group theory and approximate subgroups},
   journal={J. Amer. Math. Soc.},
   volume={25},
   date={2012},
   number={1},
   pages={189--243},
   %issn={0894-0347},
   %doi={10.1090/S0894-0347-2011-00708-X},
}

\bib{HPP}{article}{
   label={HPP},
   author={Hrushovski, Ehud},
   author={Peterzil, Ya'acov},
   author={Pillay, Anand},
   title={Groups, measures, and the NIP},
   journal={J. Amer. Math. Soc.},
   volume={21},
   date={2008},
   number={2},
   pages={563--596},
  %  issn={0894-0347},
  %  review={\MR{2373360}},
  %  doi={10.1090/S0894-0347-07-00558-9},
}

\bib{HI}{article}{
  label={HI},
  author={Henson, C. Ward},
  author={Iovino, Jos\'{e}},
  title={Ultraproducts in analysis},
  conference={
    title={Analysis and logic},
    address={Mons},
    date={1997},
   },
   book={
      series={London Math. Soc. Lecture Note Ser.},
      volume={262},
      publisher={Cambridge Univ. Press, Cambridge},
   },
   date={2002},
   pages={1--110},
  %  review={\MR{1967834}},
}

\bib{clcl}{article}{
  label={CLCL},
  author = {Polymath, C.L.C.L.},
  title = {Continuous Logic for the Classical Logician},
  note={T.a.},
  date = {202?},
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Continuous group actions}
\end{biblist}
\end{bibdiv}


\vskip5ex

\hfil\dangersign[8ex]
%%%%%%%%%%%%%%
%\noindent\llap{\dangersign}\kern1ex\ignorespaces

\hfil Danger after this point
\vskip10ex


%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
\section{Elimination of quantifiers}

Let $T$ be a positive theory.
We say that $T$ has (approximate, positive) elimination of quantifiers if the quantifier-free positive formulas are dense modulo $T$.
Equivalently, if every complete type is equivalent to a quantifier-free positive types.

%for every $\varphi(x)\in{\EuScript L}^{\rm p}$ and every $\varphi'>\varphi$ there is a formula $\psi(x)\in{\EuScript L}^{\rm p}$ without quantifiers of sort ${\sf H}$ such that $\varphi(x)\rightarrow\psi(x)\rightarrow\varphi'(x)$ holds modulo $T$.

The following fact is routinely proved by back-and-forth.

\begin{fact}\label{fact_backandforth}
  The following are equivalent
  \begin{itemize}
    \item[1.] $T$ has elimination of quantifiers;
    \item[2.] every finite partial embedding $k:M\to N$ beween models of $T$ is an approximate p-elementary map;
    \item[3.]  for every finite partial embedding $k:M\to N$ between positively $\omega$-saturated models of $T$, and for every $b\in M$ there is a $c\in N$ such that $k\cup\{\langle b,c\rangle\}:M\to N$ is also a partial embedding.
  \end{itemize}
\end{fact}



%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
\section{Pseudofinite randomizations}

\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\parbox[t]{6ex}{$\displaystyle\hfil #2$}{$\displaystyle #3$}}

Let $T$ be a complete first-order theory of signature $L$ with an infinite model.
Let ${\EuScript U}$ be a model of $T$.
Let $\Omega$ be a finite set.
We denote by ${\EuScript U}^\Omega$ the set of functions $\Omega\to{\EuScript U}$.
The elements of ${\EuScript U}^\Omega$ are denoted by letters decorated with a circonflexe accent $\hat a,\hat b,$ etc.
The value of $\hat a$ at $\omega\in\Omega$ is denoted by $a_\omega$.
We now define models of the form $\langle{\EuScript U}^\Omega, I\rangle$, where $I$ is the real interval $[0,1]$ with the usual topology.

The language $L_{\sf H}$ is empty.
The language ${\EuScript L}$ contains functions of sort ${\sf H}^{|x|}\to{\sf I}$, one for each formula $\varphi(x)\in L$.
These are denoted by $\Pr\varphi(\hat x)$. 
Variables of sort ${\sf H}$ are decorated with a circonflexe accent.
The interpretation of the function symbol $\Pr\varphi(\hat x)$ is 

\ceq{\hfill\Pr\big(\varphi(\hat a)\big)}
{=}
{\frac{\#\llbracket\varphi(\hat a)\rrbracket}{\#\Omega},}

where by $\#$ denotes the finite cardinality, and

\ceq{\hfill\llbracket\varphi(\hat a)\rrbracket}{=}{\big\{\omega\in\Omega\ :\ {\EuScript U}\models\varphi(a_\omega)\big\}.}

The pseudofinite randomization of $T$ is the positive theory

\ceq{\hfill T^{\rm pfr}}
{=}
{\Big\{\varphi\in{\EuScript L}^{\rm p}\ :\ \langle{\EuScript U}^\Omega, I\rangle\models\varphi\textrm{ for all sufficiently large finite set }\Omega\Big\}}

In this section we prove that $T^{\rm pfr}$ is a compete theory with elimination of quantifiers.
We prove the lemma that is required for the back-and-forth.

\begin{lemma}
  Let $k:M\to N$ be a finite partial embedding between positively $\omega$-saturated models of $T^{\rm pfr}$.
  Then for every $\hat b\in M$ and there is a $\hat c\in N$ such that $k\cup\{\langle\hat b,\hat c\rangle\}:M\to N$ is a partial embedding.
\end{lemma}

\begin{proof}
  Let $\hat a$ be an enumeration of ${\rm dom} k$.
  Let $p(\hat x,\hat z)$ be set of formulas of the form $\gamma=\Pr\varphi(\hat x,\hat z)$, for some $\gamma\in I$, that hold in $M,\hat b,\hat a$.
  Note that $p(\hat x,\hat z)$ implies the atomic type of $\hat b,\hat a$ in $M$.
  Therefore it suffices to show that $p(\hat x,k\hat a)$ is finitely consistent in $N$.

  Pick a finite set of these formulas, say $\gamma_i=\Pr\varphi_i(\hat x,\hat z)$, for $i<n$.
  Me may assume that the fomulas $\varphi_i(x,z)$ define a partition of ${\EuScript U}^{|x,z|}$.
  By the saturation of $N$, it suffices to prove that for every $\varepsilon>0$ there is a $\hat c\in N$ such that
  
  \ceq{\hfill\gamma_i}{=_\varepsilon}{\Pr\varphi_i(\hat c,k\hat a)}\hfill ($\alpha=_\varepsilon\beta$ is a shorthand for $|\alpha-\beta|\le\varepsilon$)
  
  is true in $N$ for all $i<n$.
  
  Some preliminary work is required.
  For each $J\subseteq n$ define the following $L$-formulas

  \ceq{\hfill \xi_J(z)}{=}{\bigwedge_{i\in J}\exists x\;\varphi_i(x,z)\wedge\bigwedge_{i\in n\smallsetminus J}\neg\exists x\;\varphi_i(x,z)}

  These formulas $\xi_J(z)$ partition ${\EuScript U}^{|z|}$.
  For $J\subseteq n$ let $\alpha_J$ be such that 
  
  \ceq{2.\hfill\alpha_J}{=}{\Pr\big(\xi_J(\hat z)\big)}
  
  is in $p(\hat x,\hat z)$.
  Let ${\EuScript J}=\{J\subseteq n\ :\ \alpha_J\neq0\}$. 
  When $J\in{\EuScript J}$, there are some $\beta_{i,J}$ such that the formulas

  \ceq{3.\hfill \beta_{i,J}}{=}{\Pr\bigg(\varphi_i(\hat x,\hat z)\ \Big|\ \xi_J(\hat z)\bigg).}

  are are among the consequences of $p(\hat x,\hat z)$.
  As the formulas $\varphi_i(x,z)$ define a partition, the $\beta_{i,J}$ add up to $1$ for any fixed $J$.
  Note that $\beta_{i,J}=0$ for $i\notin J$.
  Clearly, have that 

  \ceq{4.\hfill \gamma_i}{=}{\sum_{J\in{\EuScript J}}\beta_{i,J}\alpha_J.}

  It is plain that for $i\in J$ the following is a consequence of $p(\hat x,\hat z)$

  \ceq{5.\hfill 1}{=}{\Pr\bigg(\exists x\,\varphi_i(x,\hat z)\ \Big|\ \xi_J(\hat z)\bigg)}

  Now we prove that (2) \& (5) $\Rightarrow$ (1) holds in ${\EuScript U}^\Omega$ when $\Omega$ large enough (larger than $n/\varepsilon$ suffices).
  Strictly speaking, this implication is not a positive formula, but the reader can easily verify that a suitable approximation of (2) and (5) suffices. 
  
  Let $\hat a'\in{\EuScript U}^\Omega$ satisfy (2) and (5) for every $i\in J\subseteq n$. 
  We define $\hat c'\in{\EuScript U}^\Omega$ such that 
  
  \ceq{\hfill{\EuScript U}^\Omega}{\models}{\beta_{i,J}=_\varepsilon\Pr\bigg(\varphi_i(\hat c',\hat a')\ \Big|\ \xi_J(\hat a')\bigg).}
  
  We may define $\hat c'$ separately in each event $\llbracket\xi_J(\hat a')\rrbracket$.
  Partition $\llbracket\xi_J(\hat a')\rrbracket$ into events $E_i\subseteq\Omega$, for $i\in J$, such that $\# E_i/\#\Omega=_\varepsilon\beta_{i,J}$.
  Then define $c'_\omega$ for $\omega\in E_i$ to be any witness of $\exists x\,\varphi_i(x,a_\omega)$.
  By (5), we can always find such a witness.
  
  Finally, by (4), we deduce

  \ceq{\hfill{\EuScript U}^\Omega}{\models}{\gamma_i=_\varepsilon\Pr\big(\varphi_i(\hat c',\hat a')\big).}

  As $k\hat a$ satisfy (2) and (5), we conclude that some $\hat c\in N$ satisfy (1).
\end{proof}

Now, from Fact~\ref{fact_backandforth} we obtain that $T^{\rm pfr}$ has elimination of quantifiers.
Completeness follows.

\begin{corollary}
  The theory  $T^{\rm pfr}$ is compete and has elimination of quantifiers.
\end{corollary}

\section{Stability}

A partitioned formula $\varphi(x\,;z)\in{\EuScript L}^{\rm p}$ is stable if there is no sequence $\langle a_i\,;b_i\,:\,i<\omega\rangle$ and no $\tilde\varphi\perp\varphi$ such that for every $i,j<\omega$

\ceq{\hfill i<j}{\Rightarrow}{\varphi(a_i\,;b_j)}

\ceq{\hfill i>j}{\Rightarrow}{\tilde\varphi(a_i\,;b_j)}

Using the terminology of~\cite{Hr}, $\varphi(x\,;z)$ is stable if it is stably separated from all $\tilde\varphi\perp\varphi$.

Note that by compactness if $\varphi(x\,;z)$ and $\tilde\varphi\perp\varphi$ are stably separated then there is a maximal length $m$ of a sequence $\langle a_i\,;b_i\,:\,i<m\rangle$ such that (1) and (2) above.

\end{document}







% Proposition~\ref{prop_Cauchyclosure} provides a sufficient condition 
% for the Cauchy closure of a model to be a model.
% We need the following notion.
% We say that ${\EuScript U}$ is \emph{decomposable\/} if for every two tuples $a,b$ of elements of $U$ 

% \ceq{\hfill a\equiv_{\sf H}b\ \textrm{ and }a\sim_{\sf I}b}{\Rightarrow}{a\equiv b}

% Incidentally, $L_{\sf H}$-free formulas are ${\sf I}$-invariant, independently of ${\EuScript U}$.

% We do not know of any simple caracterisation of decomposable models.
% The following proposition provides some examples.

% \begin{proposition}
%   If the $L_{\sf H}$-theory of $U$ is $\omega$-categorical and strongly minimal then ${\EuScript U}$ is decomposable.
% \end{proposition}

% \begin{proof}
%   Let $k:U\to U$ is a finite map that preserves $\equiv_{\sf H}$  and $\sim_{\sf I}$.
%   Let $b\in U$.
%   We claim that there is a $c\in U$ such that $k\cup\{\langle b,c\rangle$ also preserves  $\equiv_{\sf H}$  and $\sim_{\sf I}$.
%   The proposition follows from the claim by back-and-forth.
%   Let $a$ enumerate ${\rm dom}(k)$.
%   Suppose first that $b\notin{\rm acl}(a)$.
%   There are infinitely many witnesses of $b\sim_{\sf I}x$ then, by strong minimality, we can pick one $c\notin{\rm acl}(ka)$.
%   Then $k\cup\{\langle b,c\rangle$ is as required.
% \end{proof}


%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
\section{Separability}\label{separability}




\hrulefill

Let $t(x,y)$ and $D$ be a term of sort ${\sf H}^{|x|+|z|}\to {\sf I}$, respectively a compact neighborhood of the diagonal.
For $\gamma,\xi\in{\rm Aut}({\EuScript U})$ and $a$ a finite tuple of elements of $M$ we write $\gamma\sim_{a,t,C}\xi$ for $\gamma a\sim_{t,D} \xi a$.
This defines a system of entourages on ${\rm Aut}({\EuScript U})$.

By ${\rm Aut}({\EuScript U}/\{\!M\!\})$ we denote the set of automorphisms of ${\EuScript U}$ that fix $M$ setwise.
When ${\rm Aut}({\EuScript U}/\{\!M\!\})$ is dense in ${\rm Aut}({\EuScript U})$ with respect to the topology above, we say that ${\EuScript M}$ is \emph{approximatively $\omega$-homogeneous.}
Note that this is the classical notion of homogeneity only with the discrete topology replaced by the ${\sf I}$-topology.

We write ${\EuScript L}^{\rm p}_\forall$ for the set of ${\EuScript L}^{\rm p}$-formulas where the quantifier $\exists\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}$ do not occur.
Let $T_0$ be an ${\EuScript L}^{\rm p}_\forall$-theory with countable models ($L_{\sf H}$ is countable).
Let ${\EuScript C}$ be a category whose objects, which we call ${\EuScript C}$-models, are countable models of $T_0$.
For ease of speaking we identify these models with the domain of their sort ${\sf H}$.
The morphisms of ${\EuScript C}$, which we call  ${\EuScript C}$-morphisms, are finite maps between ${\EuScript C}$-models.

\begin{itemize} 
  \item[c1.] the identity map ${\rm id}_A:M\to M$ is a ${\EuScript C}$-morphism, for any $A\subseteq M$;
  \item[c2.]  ${\EuScript C}$-morphisms are partial embeddings;
  \item[c3.]  the inverse of a ${\EuScript C}$-morphism is a  ${\EuScript C}$-morphism;
  \item[c3.] if $M$ is a ${\EuScript C}$-model and $f:M\to N$ and  p-elementary map, then $N$ is a ${\EuScript C}$-model and $f$ is a  ${\EuScript C}$-morphism.
\end{itemize}

We write $M\le N$ if the identity map ${\rm id}_M:M\to N$ is a ${\EuScript C}$-morphism.
We also assume that ${\EuScript C}$ is connected (c4) and that it has the amalgamation property (c5).

\begin{itemize} 
  \item[c4.] the empty map between two ${\EuScript C}$-models is a ${\EuScript C}$-morphism;
  \item[c5.] for every ${\EuScript C}$-morphism $k:M\to N$ and every $b\in M$ there is a ${\EuScript C}$-model $N\ge M$ and a ${\EuScript C}$-morphism $h:M\to N'$ that exiends $k$ and is defined on $b$.
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Measure spaces}

Let ${\EuScript B}$ be a $\sigma$-algebra of subsets of $\Omega$.
Let $F$ be the set of ${\EuScript L}^{\rm p}$-valued ${\EuScript B}$-simple functions, i.e.\@ linear combinations of indicator functions of sets in ${\EuScript B}$.
Let $M$ be the set of ${\EuScript L}^{\rm p}$-valued ${\EuScript B}$-measures concentrated on finitely many points of $\Omega$.

Let ${\EuScript M}=\langle M,F,I\rangle$, where $I={\EuScript L}^{\rm p}\cup\{\pm\infty\}$.
The sort ${\sf H}$ in the previous section is replaced here by two sorts which we call ${\sf H}$ and ${\sf F}$.
Here $L_{\sf MF}$ is the language of the structure $\langle M,F\rangle$.
As both $F$ and $M$ are lattice ${\EuScript L}^{\rm p}$-algebras, we assume that $L_{\sf MF}$ has symbols for these lattice algebras.
There is also a function symbol of sort ${\sf F}\times{\sf H}\to{\sf H}$ that is interpreted as the natural action of functions on measures (via multiplication).
Finally, in ${\EuScript L}$ there is a function symbol ${\rm I}$ of sort ${\sf H}\to{\sf I}$ that is interpreted as the integral over $\Omega$.

Let ${\EuScript U}=\langle {}^*\!M,{}^*\!F,I\rangle$ be a monster model such that ${\EuScript M}\preceq^{\rm p}{\EuScript U}$.

\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

Let $\mu$ be a ${\EuScript L}^{\rm p}$-valued ${\EuScript B}$-measure.
By saturation, there is some ${}^*\!\mu\in{}^*\!M$ such that $g\,{\cdot}{}^*\!\mu=\int_\Omega g\,{\rm d}\mu$ for every $g\in F$.

Let $\gamma:\Omega\to{\EuScript L}^{\rm p}$. 
By saturation, there is some ${}^*\!\gamma\in{}^*\!F$ such that ${}^*\!\gamma\mathbin\cdot m=\gamma\mathbin\cdot m$ for every $m\in M$. 
Note that, as $m$ has finite support, $\gamma\mathbin\cdot m$ is a well-defined element of $M$ for all $\gamma$.

For $X\in{\EuScript B}$ we write ${\rm I}_X(\,\mbox{-}\,)$ for ${\rm I}(1_X\cdot\,\mbox{-}\,)$.

\begin{lemma}
Assume $\gamma$ is measurable.
Then for every $X\in{\EuScript B}$

\ceq{\hfill {\rm I}_X\big({}^*\!\gamma\cdot{}^*\!\mu\big)}{=}{\int_X \gamma\,{\rm d}\mu}


\end{lemma}

\begin{proof}
  Assume for simplicity that both $\gamma$ and $\mu$ are non-negative.
  % The general case follows by decomposition.
  Let $G\subseteq I$ be the following set

  \ceq{\hfill G}{=} {\bigg\{\int_X g\,{\rm d}\mu\ :\ 0\le g\le\gamma,\ g\in F\bigg\}.}

  If $G$ is bounded, pick for every $\varepsilon\in{\EuScript L}^{\rm p}^{\rm p}$ some $\alpha_{\varepsilon}\in G$ such that 

  \ceq{\hfill\int_X \gamma\,{\rm d}\mu}{\le}{\alpha_{\varepsilon,f}+\varepsilon.}
 
  If $G_f$ is unbounded, let $\alpha_{\varepsilon,f}=+\infty$ for all $\varepsilon$.
  Let $y$ be a variable of sort ${\sf H}$.
  Let $p(y)$ be the ${\EuScript L}^{\rm p}$-type that contains, for all $f$ as in the lemma, the formulas 

  \ceq{\hfill{\rm I}\big( f{\cdot} y\big)}{\ge}{\alpha}
  \hfill for all $\alpha\in G_f$;

  \ceq{\hfill{\rm I}\big( f{\cdot} y\big)}{\le}{\alpha_{\varepsilon,f}+\varepsilon}
  \hfill for all $\varepsilon\in{\EuScript L}^{\rm p}^{\rm p}$\cdot.

  By basic measure theory, $p(y)$ is finitely consistent in ${\EuScript M}$.
  Any realization of $p(y)$ in ${\EuScript U}$ proves the lemma.
\end{proof}


In $M$ and $F$ we use the functions $\,\mbox{-}^{\rm p}$, $\,\mbox{-}^-$, $\,|\mbox{-}|$, and the relation $\le$ as usually defined in lattice vector spaces.
We use the symbol $0$ to denote the zeros of $M$, $F$, and $I$.
We denote by $1\in F$ the function that is identically $1\in I$.

The ${\EuScript L}^{\rm p}$-formula $\forall^{\sf F}\!f\ge0\,\ {\rm I}\big(f{\cdot}\mu^{\rm p}\big)\ge0$ is obviously true in ${\EuScript M}$ and so is the same formula for $\mu^-$.
As the action of $F$ on $M$ distributes with the algebraic operations of $M$ and $F$, properties such as the Hahn decomposition are immediate in ${\EuScript M}$ and are inherited by $\EuScript U$.

Note that the $L_{\sf H}$-formula $\forall^{\sf F}\!f\!\in[0,1]\,\ f^2{=}\,f$ defines the indicator functions. 

For $\nu,\mu\in{}^*\!M$ we write $\nu\ll\mu$ for the ${\EuScript L}$-formula 

\hfil$\forallI \varepsilon\ \existsI \delta\ \forall^{\sf F}\!f\ \big[{\rm I}\big(|f{\cdot}\mu|\big)<\delta\rightarrow {\rm I}\big(|f{\cdot}\nu|\big)<\varepsilon\big]$.

\begin{proposition} 
  Let $\nu,\mu\in{}^*\!M$ be bounded and non-negative such that  $\nu\ll\mu$.
  Then there is a $g\in{}^*\!F$ such that $|\nu-g\mu|\sim_R0$.
\end{proposition}

\begin{proof}
  The following ${\EuScript L}^{\rm p}$-formula is true in ${\EuScript M}$.
  
  $
\forall\mu,\nu\ \forall\varepsilon>0\ \Big[\forall^{\sf F}\!f\ {\rm I}\big(|f{\cdot}\nu|\dotminus|f{\cdot}\mu|\big)<\varepsilon \rightarrow \exists^{\sf F}\!g\ \forall^{\sf F}\! f\ {\rm I}\big(f{\cdot}|\nu-g{\cdot}\mu|\big)\le\varepsilon\Big]$


\end{proof}

\begin{theorem}[Radon-Nikodym] 
  Let $\nu,\mu$ be bounded non-negative ${\EuScript B}$-measures on $\Omega$ such that $\nu\ll\mu$.
  Then there is a ${\EuScript B}$-measurable $f:\Omega\to{\EuScript L}^{\rm p}$ such that 
  $$
  \int_X f{\rm d}\mu = \int_X {\rm d}\nu
  $$
  for every $X\in{\EuScript B}$.
\end{theorem}
\end{document}
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
\section{Equivalences}


We define an equivalence relation \emph{$(\sim_{\EuScript U})$\/} on $ U$ as follows

\ceq{1.\hfill a\,\sim_{\EuScript U}b}
{\Leftrightarrow}
{\Big({\EuScript U}\models t(a)= t(b)}
\ \ for every $t(x)\in\mathds{T}(U)\Big)$,

where $|x|=|a|=|b|=1$.

Hence $a\,\sim_{\EuScript U}b$ if and only if ${\rm d}_t(a,b)=0$ for all the pseudometrics ${\rm d}_t(\mbox{-},\mbox{-})$ defined below. 

\begin{definition}\label{def_uniformity}
  Let $x$ be a single variable.
  Let $t(x)\in\mathds{T}(U)^{<\omega}$ be a finte tuple of terms, say $t(x)=t_1(x),\dots,t_n(x)$.
  We define a pseudometric ${\rm d}_t(\mbox{-},\mbox{-})$ on $U$ as follows

  \ceq{\hfill\emph{${\rm d}_t(a,b)$}}{=}{\max_{i=1,\dots,n}\big\{|t_i^{\EuScript U}(a)-t_i^{\EuScript U}(b)|\big\}}

\end{definition}

We say that $a\in U$ is close to $M$ if 


\ceq{\hfill a\,\equiv^{\EuScript L}^{\rm p}_{\EuScript M}x}
{\rightarrow}
{a\sim_{\EuScript U}x},


\begin{proposition}
  The following are equivalent for every $a\in U$
  \begin{itemize}
    \item[1.] $a$ is close to ${\EuScript M}$;
    \item[2.] there is a net of elements of $M$ that converges to $a$. 
  \end{itemize}
\end{proposition}

\begin{proof}
  Let $p(x)={\rm tp}_{\EuScript L}^{\rm p}(a/U)$.

  (1$\Rightarrow$2) \ 
  The set of metrics ${\rm d}_t$ in Definion~\ref{def_uniformity} is a directed set under the relation of refinement.
  For every such metric ${\rm d}_t$ we have that

  \ceq{\hfill p_{\restriction M}(x)}{\rightarrow}{{\rm d}_t(x,a)\le0}

  By Lemma~\ref{lem_compactness_implication}, for every $\varepsilon>0$ there some consistent $\varphi(x)\in p$ such that

  \ceq{\hfill \varphi(x)}{\rightarrow}{{\rm d}_t(x,a)<\varepsilon}

  As $\varphi(x)$ is consistent in ${\EuScript M}$, there is some $b_{t,\varepsilon}\in M$ such that ${\rm d}_t(b_{t,\varepsilon},a)<\varepsilon$.
  This defines a net of elements of $M$ that converges to $a$.

  (2$\Rightarrow$1) \ 
  Let $I$ be a directed set.
  Let $\langle b_i:i\in I\rangle$ be a net of elements of $M$ that converges to $a$.
  Then, $c\sim_{\EuScript U} a$ for every $c\models p_{\restriction M}(x)$.
  Hence $p_{\restriction M}(x)\rightarrow p(x)$.
\end{proof}

\end{document}


\clearpage

  The language $L_{\sf H}$ and its interpretation are subject to the following conditions.
  \begin{itemize}
  \item[1.] Functions only have one of the following sorts (for any $m,n\in\omega$)
  \begin{itemize}
    \item[a.] ${\EuScript L}^{\rm p}^n\to{\EuScript L}^{\rm p}$
    \item[b.] $ M^n\times{M}^m\to\textrm{any of }  M,\ M,\textrm{ or }{\EuScript L}^{\rm p}$
    % \item[c.] $ M^n\times{M}^m\to M$
    % \item[d.] $ M^n\times{M}^m\to{\EuScript L}^{\rm p}$
  \end{itemize}
  \item[2.] There is a symbol for every (total) uniformly continuous function ${\EuScript L}^{\rm p}^n\to{\EuScript L}^{\rm p}$.
  \item[3.] The interpretation of functions symbolsof sort $M^n\to{\EuScript L}^{\rm p}$ have \textit{bounded\/} range.
  \item[4.] Every element of $M$ is the image of some term of sort $ M^n\to M$.  
  \item[5.] There is only one unary predicate: $x\le0$, of sort ${\EuScript L}^{\rm p}$.
  \end{itemize}
  Below, when the sort $M$ is not displaied in the definitions, we assume that $M=M$ and that the language contains the identity map ${\rm id}: M\to M$.
  In other words, that $M$ is redundant.


We call $M$ the \emph{unit ball\/} of ${\EuScript M}$: there is where the action takes place.
The auxiliary sort ${M}$ can be ignored at a first reading.
Is is introduced as it makes the description of many important examples less contrived, e.g.\@ Example~\ref{ex_banach} below.

\begin{definition}
  We write \emph{$\mathds{T}(A)$\/} for the set of terms of sort $ M^n\times{\EuScript L}^{\rm p}^m\to{\EuScript L}^{\rm p}$ with parameters in some $A\subseteq  M$.
  Up to equivalence, these terms have the form $f(t(x),y)$, where $t(x)$ is a tuple of terms of sort $M^{|x|}\to{\EuScript L}^{\rm p}$, and $f$ is a function ${\EuScript L}^{\rm p}^{|t|+|y|}\to{\EuScript L}^{\rm p}$.
  Note that the terms $\mathds{T}(A)$ have bounded range.
\end{definition}

Now define a subset of the set first order formulas with parameters in a set $A\subseteq M$.
Note that we do not allow negation, nor quantification over $M$.
Also, equality among elements of $M$ is excluded.

\begin{definition}
  We define the set of formulas \emph{${\EuScript L}^{\rm p}(A)$\/} inductively
  \begin{itemize}
  \item[i.] ${\EuScript L}^{\rm p}(A)$ contains the atomic formula $t\le0$ for every term $t\in\mathds{T}(A)$.
  \item[ii.] It is closed under the Boolean connectives $\bot$, $\top$, $\wedge$, $\vee$, and the quantifiers $\forall\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}$, $\existsH $ of sort $ M$.
  \item[iii.] It is closed under the quantifier $\forall\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}$ of sort ${\EuScript L}^{\rm p}$ relativized to any definable subset of ${\EuScript L}^{\rm p}$.
  \end{itemize}
\end{definition}

Note that in iii of the definition above, definability is intended with respect to $L(M)$, the full first order language of ${\EuScript M}$, which is strictly larger than ${\EuScript L}^{\rm p}(A)$.
In particular, if $\varphi(x,\varepsilon)\in{\EuScript L}^{\rm p}(A)$, also $\forall\varepsilon{>}0\;\varphi(x,\varepsilon)\in{\EuScript L}^{\rm p}(A)$.

\begin{example}[Banach spaces]\label{ex_banach}
  Given a Banach space  $V$ we define a structure ${\EuScript M}=\langle  M,M,{\EuScript L}^{\rm p}\rangle$ as follows.
  Let $M=V$ and let $M=\{a\in M: \|a\|\le1\}$ be the closed unit ball of $V$.
  Besides the symbols mentioned above, ${\EuScript L}^{\rm p}$ contains a function symbol for the natural embedding ${\rm id}: M\to M$.
  It also contains a symbol for the norm $\|\mbox-\|:M\to{\EuScript L}^{\rm p}$.
  Finally, ${\EuScript L}^{\rm p}$ contains the usual symbols of the language of vector spaces.
  These have sort ${M}^n\to M$, for the appropiate $n\in\{0,1,2\}$.

  Terms of sort $M^{|x|}\to{\EuScript L}^{\rm p}$ have the form $f(t(x))$ where $f$ is a uniformly continuous function and

  \ceq{\hfill t(x)}{=}{\Big\|\sum_{i=1}^{|x|}\lambda_i x_i\,\Big\|.}

  Therefore, as for all $a\in M^{|x|}$

  \ceq{\hfill t^{{\EuScript M}}(a)}{\le}{\sum_{i=1}^{|x|}|\lambda_i|,}

  condition 3 of Definition~\ref{def_LL} is  satisfied.
  Conditions 4 is immediate.
\end{example}


\begin{example}[Metric spaces of finite diameter]\label{ex_metric}
  Given a metric space $(M,{\rm d})$ of finite diameter we define a structure ${\EuScript M}=\langle  M,{\EuScript L}^{\rm p}\rangle$ as follows.
  The only function symbols is ${\rm d}$.
  Note that 3 is satisfied because ${\rm d}$ is bounded.
\end{example}

%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%
\section{${\EuScript L}^{\rm p}$-relations}\label{L-relations}

Equality between elements in the unit ball is not among the formulas that Definition~\ref{def_LL} enumerates in ${\EuScript L}^{\rm p}$.
Logic without equality is not uncommon in mathematics.
For instance, in the theory of integration equality beween functions is not significative notion.
Of course, there is a quick remedy to this.
One can work with equivalence classes of functions that coincide almost everywhere.
In this way, equality regains it meaning.
But this has some drawbacks.
In fact, this makes impossible to speak of the value that a function takes at a point and there are situations when this is inconvenient.

In our general setting, for similar reasons, structures that contain irrelevat copies of equivalent objects may offer a better grasp than terse quotiented structures.

Without equality, relations, rather than partial maps, are the natural tool to discuss elementarity. 

Let ${\EuScript M}$ and ${\EuScript N}$ be models.
We say that $I\subseteq M\times N$ is an \emph{${\EuScript L}^{\rm p}$-(elementary) relation\/} between ${\EuScript M}$ and ${\EuScript N}$ (or on ${\EuScript M}$ if the two coicide) if for every $\varphi(x)\in{\EuScript L}^{\rm p}$

\ceq{\hfill{\EuScript M}\models\varphi(a)}{\Leftrightarrow}{{\EuScript N}\models\varphi(b)} \hfill for every $a$ and $b$ such that $a\mathbin{I}b$.

Recall that, when $a=a_1,\dots,a_n$ and $b=b_1,\dots,b_n$ are tuples, $a\mathbin{I}b$ stands for $a_i\mathbin{I}b_i$ for every $i\in\{1,\dots,n\}$.

We define an equivalence relation \emph{$(\sim_{\EuScript M})$\/} on $ M$ as follows

\ceq{1.\hfill a\,\sim_{\EuScript M\!}b}
{\Leftrightarrow}
{\Big({\EuScript M}\models\varphi(a)\leftrightarrow\varphi(b)}
\ \ for every $\varphi(x)\in{\EuScript L}^{\rm p}( M)\Big)$,

where $|x|=|a|=|b|=1$.
Note that this relation would be trivial had we included  in ${\EuScript L}^{\rm p}(M)$ equality between elements of $M$.

The following proposition is easily proved by induction on the syntax. 

\begin{proposition}
  The following are equivalent for every $a,b\in M$.
  \begin{itemize}
    \item[1.] $a\equiv_{\EuScript M}b$;
    \item[2.] ${\EuScript M}\models t(a)=t(b)$ for every $t(x)\in\mathds{T}(M)$, with $|x|=1$.
  \end{itemize}
\end{proposition}

\begin{lemma}
  The relation $(\sim_{\EuScript M\!})\subseteq  M^2$ is an ${\EuScript L}^{\rm p}$-relation.
  Moreover, it is maximal among the ${\EuScript L}^{\rm p}$-relations on ${\EuScript M}$, i.e.\@ no ${\EuScript L}^{\rm p}$-relation properly contains $(\sim_{\EuScript M\!})$.
\end{lemma}

\begin{proof}
  Assume $a\sim_{\EuScript M\!}b$, where $a=a_1,\dots,a_n$ and $b=b_1,\dots,b_n$.
  Recall that this means that $a_i\sim_{\EuScript M\!}b_i$ for all $i\in\{1,\dots,n\}$.
  Let $\Delta$ denote the diagonal relation on $ M$.
  Note that $a_i\sim_{\EuScript M\!}b_i$ is equivalent to saying that $\Delta\cup\{(a_i,b_i)\}$ is an ${\EuScript L}^{\rm p}$-relation.
  As ${\EuScript L}^{\rm p}$-relations are closed under composition $\Delta\cup\big\{(a_1,b_1),\dots,(a_n,b_n)\big\}$ is p-elementary.
  It follows that for every $\varphi(x)\in{\EuScript L}^{\rm p}$

  \ceq{2.\hfill{\EuScript M}\models\varphi(a)}{\Leftrightarrow}{{\EuScript M}\models\varphi(b).}
  
  This proves that $(\sim_{\EuScript M\!})$ is an ${\EuScript L}^{\rm p}$-relation.
  Finally, maximality is immediate.
  % Suppose $E$ and equivalence ${\EuScript L}^{\rm p}$-relation on ${\EuScript M\!}$ properly containing $(\sim_{\EuScript M\!})$.
  % Pick $a,b\in M$ such that $a\mathbin{E}b$ and $a\not\sim_{\EuScript M\!}b$.
\end{proof}


\begin{lemma}
  Let $I\subseteq  M\times N$ be total and surjective ${\EuScript L}^{\rm p}$-relation.
  Then there is a unique maximal ${\EuScript L}^{\rm p}$-relation containing $I$.
  This maximal ${\EuScript L}^{\rm p}$-relation is equal to both $(\sim_{\EuScript M\!})\,I$ and $I\,(\sim_{\EuScript N\!})$, where justapposition of relations stands for composition.
\end{lemma}
\begin{proof}
  It is immediate to verify that $(\sim_{\EuScript M\!})\,I$ is an ${\EuScript L}^{\rm p}$-relation containing $I$.
  Let $S$ be any maximal ${\EuScript L}^{\rm p}$-relation containing $I$.
  By maximality, $(\sim_{\EuScript M\!})\,S=S$.
  As $S$ is a total relation $(\sim_{\EuScript M\!})\subseteq SS^{-1}$.
  Therefore, by the lemma above, $(\sim_{\EuScript M\!})=SS^{-1}$.
  As $I$ is a surjective relation, $S\subseteq S\,S^{-1}I$.
  Finally, by maximality, we conclude that $S=(\sim_{\EuScript M\!})\,I$.
  A similar argument proves that $S=I\,(\sim_{\EuScript N\!})$.
\end{proof}

We write ${\rm Aut}({\EuScript M})$ for the set of maximal, total and surjective, ${\EuScript L}^{\rm p}$-relations $I\subseteq  M^2$.
The choice of the symbol Aut is motivated by the lemma above.
In fact any such relation $I$ induces a unique automorphism on the (properly defined) quotient structure ${\EuScript M}/{\sim_{\EuScript M\!}}$.

% Thought in most situations one could dispense with ${\EuScript M}$ in favour of ${\EuScript M}/{\sim_{\EuScript M\!}}$, in concrete cases one has a better grip on the first than on the latter.
% Therefore below we insist in working with ${\EuScript L}^{\rm p}$-relations in place of p-elementary maps.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Elementary substructures}

An \emph{${\EuScript L}^{\rm p}$-(elementary) embedding\/} is an ${\EuScript L}^{\rm p}$-relation that is functional, injective and total.

When $\varnothing$ is an ${\EuScript L}^{\rm p}$-relation between ${\EuScript M}$ and ${\EuScript N}$ we say that ${\EuScript M}$ and ${\EuScript N}$ are \emph{${\EuScript L}^{\rm p}$-(elementary) equivalent\/} and write \emph{${\EuScript M}\equiv^{\EuScript L}^{\rm p} {\EuScript N}$.}
When $A\subseteq M\cap N$, we write \emph{${\EuScript M}\equiv_{\!A}{\EuScript N}$\/} if $\Delta_{\!A}$, the diagonal relation on $A$, is an ${\EuScript L}^{\rm p}$-relation.
In words, we say that ${\EuScript M}$ and ${\EuScript N}$ are ${\EuScript L}^{\rm p}$-equivalent \emph{over $A$.}
Finally, we write \emph{${\EuScript M}\preceq^{\rm p}{\EuScript N}$\/} when ${\EuScript M}\subseteq{\EuScript N}$, i.e.\@ ${\EuScript M}$ is a substructure of ${\EuScript N}$, and ${\EuScript M}\equiv_M^{\EuScript L}^{\rm p}{\EuScript N}$.
In words, we say that ${\EuScript M}$ is an \emph{${\EuScript L}^{\rm p}$-(elementary) substructure\/} of ${\EuScript N}$.


Let $A\subseteq  M$.
The \emph{${\EuScript L}^{\rm p}(A)$-topology\/} on $M^{|x|}$ is the topology that has, as a base of closed sets, the ${\EuScript L}^{\rm p}(A)$-definable sets.

The ${\EuScript L}^{\rm p}(A)$-topology is not T$_0$.
The following lemma asserts that to obtain a Hausdorff topology it suffices to quotient by $\equiv_A^{\EuScript L}^{\rm p}$.
This is the so-called the Kolmogorov quotient.

We need the following definitions that will be relevant in many of the proofs below.
If $\varphi(x)\in L(A)$ and $\varepsilon>0$ we write \emph{${}^{\varepsilon\kern-2pt}\varphi(x)$\/} for the formula obtained by replacing every occurence in $\varphi$ of the atomic formula $t(x)\le0$ with $t(x)-\varepsilon\le0$ or, less pedantically, $t(x)\le\varepsilon$.
We write \emph{${}^{\neg\varepsilon\kern-2pt}\varphi(x)$\/} for the formula obtained by replacing $t(x)\le0$ with $\varepsilon\le t(x)$.

Note that, if $\varphi(x)\in{\EuScript L}^{\rm p}(A)$ then ${}^{\varepsilon\kern-2pt}\varphi(x),\ {}^{\neg\varepsilon\kern-2pt}\varphi(x)\in{\EuScript L}^{\rm p}(A)$.
Moreover, the positivity of the formulas in ${\EuScript L}^{\rm p}(A)$ ensures that

\ceq{\hfill\varphi(x)}{\to}{{}^{\varepsilon\kern-2pt}\varphi(x)}

\ceq{\textrm{and}\hfill {}^{\neg\varepsilon\kern-2pt}\varphi(x)}{\to}{\neg\varphi(x)}

The following fact is immediate.

\begin{fact}\label{fact_immediate}
  For every $a\in M^{|x|}$ and very $\varphi(x)\in{\EuScript L}^{\rm p}(A)$
  
  \ceq{\hfill{\EuScript M}\ \models\ \forall\varepsilon > 0\ {}^{\phantom{\neg}\varepsilon\kern-2pt}\varphi(a)}{\Leftrightarrow}{{\EuScript M}\ \models\ \varphi(a)}
  
  \ceq{\hfill{\EuScript M}\ \models\ \exists\varepsilon > 0\ {}^{\neg\varepsilon\kern-2pt}\varphi(a)}{\Leftrightarrow}{{\EuScript M}\ \models\ \neg\varphi(a)}\hfill\qedsymbol
\end{fact}

\begin{lemma}
  If $a\nequiv_A^{\EuScript L}^{\rm p}b$ are two elements of $M^{|x|}$ then there are two formulas $\varphi(x), \psi(x)\in{\EuScript L}^{\rm p}(A)$ such that $\varphi(a)$ and $\psi(b)$ hold and $\varphi(M)\cap\psi(M)=\varnothing$.
\end{lemma}

\begin{proof}
  Let $\varphi(x)\in{\EuScript L}^{\rm p}(A)$ be such that $\varphi(a)$ and $\neg\varphi(b)$.
  By the fact above ${}^{\neg\varepsilon\kern-2pt}\varphi(b)$ holds for some $\varepsilon>0$.
  Then let $\psi(x)={}^{\neg\varepsilon\kern-2pt}\varphi(x)$.
\end{proof}

\begin{proposition}[Tarski-Vaught test]\label{prop_Tarski_Vaught} Let ${\EuScript M}\subseteq{\EuScript N}$.
  Let $x$ be a single variable.
  Then the following are equivalent
  \begin{itemize}
    \item[1.] ${\EuScript M}\preceq^{\rm p}{\EuScript N}$;
    % \item[2.] $M$ is dense in $N$ w.r.t.\@ the ${\EuScript L}^{\rm p}(M)$-topology on $N$;
    \item[2.] for every $\varphi(x)\in {\EuScript L}^{\rm p}(M)$, if $\varphi(N)\neq\varnothing$, then ${\EuScript N}\models\varphi(b)$ for some $b\in M$.
  \end{itemize}
\end{proposition}
\begin{proof}
  % Equivalence 2$\Leftrightarrow$3 is tautological.

  

  Implication 1$\Rightarrow$2 is clear.
  As for 2$\Rightarrow$1, we prove by induction on the syntax of $\varphi(z)$, where $z$ is a finite tuple, that

  \ceq{3.\hfill {\EuScript N}\models\varphi(a)}{\Leftrightarrow}{{\EuScript M}\models\varphi(a)} \hfill for every $a\in  M^{|z|}$

  For $\varphi(z)$ atomic 3 follows from ${\EuScript M}\subseteq{\EuScript N}$.
  Induction for the connectives $\wedge$ and $\vee$ is straightforward.
  Induction for the existential quantifier is as in the classical case.
  We prove the case of the universal quantifier over the unit ball.
  Assume that 3 holds for the formula $\psi(z,y)$ and prove that it holds for the formula $\forallH y\,\psi(z,y)$.
  The the implication $\Rightarrow$ is immediate.
  To prove $\Leftarrow$, note that

  \ceq{\hfill{\EuScript N}\models\neg\forallH y\ \psi(a,y)}{\Rightarrow}{{\EuScript N}\models\forallH y\,{}^{\neg\varepsilon}\psi(a,y)} \hfill for some $\varepsilon>0$

  \ceq{}{\Rightarrow}{{\EuScript M}\models\forallH y\,{}^{\neg\varepsilon\kern-.2pt}\psi(a,y)}\hfill for some $\varepsilon>0$

  \ceq{}{\Rightarrow}{{\EuScript M}\models\neg\forallH y\ \psi(a,y)}.

  Induction for the universal quantifier of sort ${\EuScript L}^{\rm p}$ is immediate.
\end{proof}

% \begin{theorem}[Downward L\"owenheim-Skolem] For every $A\subseteq N$ there is a model $A\subseteq  M\preceq N$ of cardinality $\le |L(A)|$.
% \end{theorem}
% \begin{proof} (Needs some checking.)
%   For every set $A$ there is a base for the $A\mbox{-}$topology that has cardinality $\le |L(A)|$. A set $ M$ of the required cardinality that is dense in the  $ M\mbox{-}$topology is obtained as in the classical downward L\"owenheim-Skolem theorem.
% \end{proof}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Ultraproducts}\label{ultrapws}

\def\ceq#1#2#3{\parbox[t]{20ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}


We recall some standard definitions about limits.
Let $I$ be a non-empty set.
Let $F$ be a filter on $I$.
If $f:I\to{\mathds I}$ and $\lambda\in{\mathds I}\cup\{\pm\infty\}$ we write

\hfil$\displaystyle \lim_{i\to F}f(i)=\lambda$

if $f^{-1}[A]\in F$ for every $A\subseteq{\mathds I}\cup\{\pm\infty\}$ that is a neighborhood of $\lambda$.
Such a $\lambda$ is unique and, when $F$ is an ultrafilter, it always exists.
When $f$ is bounded, $\lambda\in{\EuScript L}^{\rm p}$.

Let $I$ be an infinite set.
Let $\langle {\EuScript M}_i:i\in I\rangle$ be a sequence of structures, say  ${\EuScript M}_i=\langle  M_i,M_i,{\EuScript L}^{\rm p}\rangle$, that are \emph{uniformly bounded,} that is, the bounds in 3 of Definition~\ref{def_LL} are the same for all ${\EuScript M}_i$.

Let $F$ be an ultrafilter on $I$.

\begin{definition}\label{def_ultraproduct}
  We define a structure \emph{${\EuScript N}=\langle  N,N,{\EuScript L}^{\rm p}\rangle$\/} that we call the \emph{ultraproduct\/} of the models $\langle{\EuScript M}_i:i\in I\rangle$.
  \begin{itemize}
    \item[1.] $N$ comprise the sequences $\hat a: I\to\bigcup_{i\in I} M_i$ such that $\hat a\,i\in  M_i$.
    \item[2.] $N$ comprise the sequences $t^{\EuScript N}(\hat a)$ of the form $t^{{\EuScript M}_i}(\hat ai)$, where $t(x)$ is a term of sort $ M^n\to M$.
    \item[3.] If $f$ is a function of sort $ M^n\times{M}^m\to  M$ then $f^{\EuScript N}(\hat a,t^{{\EuScript N}}\big(\hat c)\big)$ is the sequence 
    $f^{{\EuScript M}_i}\big(\hat ai,t^{{\EuScript M}_i}(\hat ci)\big)$.
    \item[4.] Similarly when $f$ is of sort $ M^n\times{M}^m\to M$.
    \item[5.] If $f$ is a function of sort $ M^n\times{M}^m\to{\EuScript L}^{\rm p}$ then 
    $$
    f^{\EuScript N}\big(\hat a,t^{\EuScript N}(\hat c)\big)\ =\ \lim_{i\to F}f^{{\EuScript M}_i}\big(\hat ai,t^{{\EuScript M}_i}(\hat ci)\big).
    $$ 
  \end{itemize}
  As usual, if ${\EuScript M}_i={\EuScript M}$ for all $i\in I$, we say that ${\EuScript N}$ is an \emph{ultrapower\/} of ${\EuScript M}$.
\end{definition}

The limit in 5 of the definition above always exists because $F$ is an ultrafilter.
It is finite because all models ${\EuScript M}_i$ have the same bounds.

The following fact is easily proved by induction on the syntax.

\begin{fact}
  For every term $t(x)$ of sort $ M^n\to{\EuScript L}^{\rm p}$  
  
  \ceq{\hfill t^{\EuScript N}\big(\hat a\big)}{=}{\lim_{i\to F}t^{{\EuScript M}_i}\big(\hat ai\big).}\hfill\qedsymbol
\end{fact}

Finally, we prove 

\begin{proposition}[\L\v{o}\'s Theorem]\label{thm_Los}
  Let ${\EuScript N}$ be as above and let $\varphi(x,y)\in{\EuScript L}^{\rm p}(A)$.
  Let $\hat a\in N^{|x|}$.
  Then there is a function $u_{-}:{\EuScript L}^{\rm p}^{\rm p}\to F$ such that for every $\lambda\in{\EuScript L}^{\rm p}^{|y|}$

  \ceq{1.\hfill {\EuScript N}\models\varphi(\hat a, \lambda)}
  {\Rightarrow}
  {u_\varepsilon\subseteq\big\{ i\in I\ :\ {\EuScript M}_i\models{}^{\varepsilon\kern-2pt}\varphi(\hat ai,\lambda)\big\} \ \textrm{for every }\varepsilon>0.}

  \ceq{2.\hfill {\EuScript N}\not\models\varphi(\hat a, \lambda)}
  {\Rightarrow}
  {u_\varepsilon\subseteq\big\{ i\in I\ :\ {\EuScript M}_i\not\models{}^{\varepsilon\kern-2pt}\varphi(\hat ai,\lambda)\big\} \ \textrm{for some }\varepsilon>0.}

\end{proposition}
\begin{proof}
  Suppose that $\varphi(x,y)$ is atomic, say

  \ceq{\hfill\varphi(x,y)}
  {=}
  {f(t(x),\,y)\le0,} 
  
  where $t$ is a tuple of terms of sort  $ M^{|x|}\to{\EuScript L}^{\rm p}$ and $f$ is a uniformly continuous function ${\EuScript L}^{\rm p}^{|t|+|y|}\to{\EuScript L}^{\rm p}$. 


  Let $\beta'\in{\EuScript L}^{\rm p}^{|t|}$ be such that
  $\displaystyle\lim_{i\to F}\ t(\hat ai)=\beta'$.

  Given $\varepsilon>0$, let $B_\varepsilon$ be a neighborhood of $\beta'$ such that 
  
  \ceq{}{\ }{\big|f(\beta,\,\lambda)-f(\beta',\lambda)\big|<\varepsilon}\hfill for every $\beta\in B_\varepsilon$ and every $\lambda\in{\EuScript L}^{\rm p}^{|y|}$.
  
  Such a neighborhood exists by the uniform continuity of $f$.
  Finally, to obtain 1 and 2 above it suffices to define 

  \ceq{\hfill u_\varepsilon}{=}{\big\{i\ :\  t(\hat a i)\in B_\varepsilon\big\}.}

  The rest of the inductive proof is straightforward and is left to the reader.
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Saturation}


Let $p(x)\subseteq{\EuScript L}^{\rm p}(M)$, where $x$ has the sort of the unit ball.
We say that $p(x)$ is \emph{finitely satisfied in ${\EuScript M}$\/} if for every conjunction of formulas in $p(x)$, say $\varphi(x)$, and for every $\varepsilon>0$, there is an $a\in  M^{|x|}$ such that ${\EuScript M}\models{}^{\varepsilon\kern-2pt}\varphi(a)$.

The following definition is completely standard

\begin{definition}
  We say that ${\EuScript M}$ is \emph{${\EuScript L}^{\rm p}$-saturated\/} if for every $p(x)$ as in 1 and 2 below, there is an $a\in  M^{|x|}$ such that ${\EuScript M}\models p(a)$
  \begin{itemize}
    \item[1.] $p(x)\subseteq{\EuScript L}^{\rm p}(A)$ for some $A\subseteq  M$ of cardinality $<|M|$ and $|x|=1$;
    \item[2.] $p(x)$ is finitely satisfied in ${\EuScript M}$.
  \end{itemize}
\end{definition}

Now we prove that every model embeds ${\EuScript L}^{\rm p}$-elementarily in an ${\EuScript L}^{\rm p}$-saturated one.
First we prove the following lemma.

\begin{lemma}\label{lem_compattezza}
  Every model ${\EuScript M}$ embeds ${\EuScript L}^{\rm p}$-elementarily in a model ${\EuScript N}$ that realizes all types as in the definition above.
\end{lemma}

\begin{proof}
  Consider the collection of types such that 1 and 2 above.
  Assume that each type has a distinct variable and let $x$ be the concatenation of all these variables.
  We denote by $p(x)$ the union of all these types.
  Let $I$ be the set of formulas $\xi(x)$ that are satisfied in ${\EuScript M}$.
  For every formula $\varphi(x)$ and every $\varepsilon>0$ define $X_{\varphi,\varepsilon}\subseteq I$ as follows

  \ceq{\hfill X_{\varphi,\varepsilon}}{=}{\Big\{\xi(x)\in I\ :\ \xi(M)\ \subseteq\ {}^{\varepsilon\kern-2pt}\varphi(M)\Big\}}

  Note that ${}^{\varepsilon\kern-2pt}\varphi(x)$ is satisfied in ${\EuScript M}$ if and only if $X_\varphi\neq\varnothing$ if and only if ${}^{\varepsilon\kern-2pt}\varphi(x)\in X_{\varphi,\varepsilon}$.
  Moreover 
  
  \ceq{\hfill X_{\varphi\wedge\psi,\ \min\{\varepsilon,\delta\}}}{\subseteq}{X_{\varphi,\varepsilon}\cap X_{\psi,\delta}.}
  
  Then, as $p(x)$ is finitely consistent, the set 
  
  \ceq{\hfill B}{=}{\big\{X_{\varphi,\varepsilon}\,:\,\varphi(x)\in p\textrm{ and }\varepsilon>0\big\}}
  
  has the finite intersection property.
  Extend $B$ to an ultrafilter $F$ on $I$.
  Let ${\EuScript N}$ be the ultrapower of ${\EuScript M}$ over $F$.
  That is, the model with unit ball $N=M^I$ obtained as in Definition~\ref{def_ultraproduct}.
  By \L\v o\'s Theorem, ${\EuScript M}$ embeds elementary into ${\EuScript N}$.
  It remains to prove that ${\EuScript N}$ realizes $p(x)$.

  For every formula $\xi(x)\in I$ choose some $a_\xi\in  M^{|x|}$ such that $\xi(a_\xi)$.
  %For legibility we conflate $(M^I)^{|x|}$ with $(M^{|x|})^I$.
  Let $\hat a\in (M^{|x|})^I$ be the function that maps $\xi(x)\mapsto a_\xi$.
  We claim that ${\EuScript N}\models\varphi(\hat a)$ for every $\varphi(x)\in p$.
  By Fact~\ref{fact_immediate}, it suffices to prove that ${\EuScript N}\models{}^{\varepsilon\kern-2pt}\varphi(\hat a)$ for every $\varepsilon>0$.
  Suppose not, then by \L\v o\'s Theorem (Proposition~\ref{thm_Los} with $\varepsilon$ for $\lambda$), for some $\varepsilon'>0$ the set 

  \ceq{\hfill Y_{\varphi,\varepsilon+\varepsilon'}}{=}{\Big\{\xi(x)\in I\ :\ {\EuScript M}\not\models{}^{\varepsilon+\varepsilon'\kern-2pt}\varphi(a_\xi)\Big\}}

  belongs to $F$.
  This is a contradiction because $B\subseteq F$ contains the set $X_{\varphi,\varepsilon+\varepsilon'}\subseteq Y_{\varphi,\varepsilon+\varepsilon'}$. 
\end{proof}

\begin{corollary}\label{thm_compattezza}
  Every model ${\EuScript M}$ is an p-elementary subtructure of some saturated model ${\EuScript N}$ (possibly of inaccessible cardinality).
\end{corollary}

We denote by \emph{${\EuScript U}$\/} some large ${\EuScript L}^{\rm p}$-saturated structure which we call the \emph{monster model.}
The unit ball of ${\EuScript U}$ is denoted by \emph{$U$.}
The cardinality of ${\EuScript U}$ is an inaccessible cardinal that we denote by \emph{$\kappa$.}
Below we say \emph{model\/} for ${\EuScript L}^{\rm p}$-elementary substructure of ${\EuScript U}$.


\begin{lemma}\label{lem_compactness_implication}
  Let $p(x)\subseteq{\EuScript L}^{\rm p}(A)$, where $A\subseteq U$ has small cardinality.
  Let $\varphi(x)\in{\EuScript L}^{\rm p}(U)$ be such that $p(x)\rightarrow\varphi(x)$.
  Then for every $\varepsilon>0$ there is a formula $\psi(x)$, conjunction of formulas in $p(x)$, such that $\psi(x)\rightarrow\neg{}^{\neg\varepsilon\kern-2pt}\varphi(x)$.
\end{lemma}

\begin{proof}
  Let $\varepsilon>0$ be given.
  Suppose that $\psi(x)\wedge{}^{\neg\varepsilon\kern-2pt}\varphi(x)$ is consistent for every $\psi(x)$ that is conjunction of formulas in $p(x)$.
  By saturation there is a realization of $p(x)\cup{}^{\neg\varepsilon\kern-2pt}\varphi(x)$.
  By Fact~\ref{fact_immediate}, $p(x)\wedge\neg\varphi(x)$ is also consistent.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%
\section{Complete models}

\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

Let ${\EuScript M}$ be a model.
Let $a\in {\EuScript U}^{|x|}$.
We say that ${\EuScript M}$ \emph{defines $a$ in the limit\/} if 

\ceq{\hfill p_{\restriction M}(x)}{\rightarrow}{p(x):={\rm tp}_{\EuScript L}^{\rm p}(a/U)}

or, in other words, if $a'\equiv^{\EuScript L}^{\rm p}_Ma$ implies $a'\sim_{\EuScript U}a$.

Note that the definability of a tuple in the limit is equivalent to the definability of its components.
This follows from the following obvious identity

\ceq{\hfill {\rm tp}_{\EuScript L}^{\rm p}(a,b/U)}
{=}
{{\rm tp}_{\EuScript L}^{\rm p}(a/U)\ \cup\ {\rm tp}_{\EuScript L}^{\rm p}(b/U).}

Now we characterize definability in the limit in topological terms.


\begin{definition}
  A model ${\EuScript M}$ is complete if it contains, up to $(\sim_{\EuScript U})$-equivalence, all points it defines in the limit.
\end{definition}

Let \emph{$\bar M$\/} be the set points that are defined in the limit by ${\EuScript M}$.
We denote by \emph{$\bar{\EuScript M}$\/} the (unique) substructure of ${\EuScript U}$ with unit ball $\bar M$.
We call  $\bar{\EuScript M}$ the \emph{completion\/} of ${\EuScript M}$.

We say that a model ${\EuScript N}$ is $M$-${\EuScript L}^{\rm p}$-saturated if it realizes all constistent types $p(x)\subseteq{\EuScript L}^{\rm p}(M)$.
The following proposition is easy to prove.

\begin{proposition}
  $\bar{\EuScript M}$ is the intersection of all $M$-${\EuScript L}^{\rm p}$-saturated models.
\end{proposition}

\begin{proposition}
  $\bar{\EuScript M}$ is complete.
\end{proposition}

\begin{proof}
  Suppose $a\in U$ is defined in the limit by $\bar{\EuScript M}$, that is

  \ceq{\hfill p'(x,b)}{\rightarrow}{p(x):={\rm tp}_{\EuScript L}^{\rm p}(a/U)}
  
  for some $b\in\bar M^{|z|}$ and $p'(x,z)\subseteq{\EuScript L}^{\rm p}(M)$ such that $p_{\restriction\bar M}(x)=p'(x,b)$.  
  Let $q(z)={\rm tp}_{\EuScript L}^{\rm p}(b/U)$, then

  \ceq{\hfill q_{\restriction M}(z)\ \cup\ p'(x,z)}{\rightarrow}{p(x)}
  
  Finally, $a\in\bar M$ follows because

  \ceq{\hfill p_{\restriction M}(x)}{\rightarrow}{\existsH z\ \big[q_{\restriction M}(z)\ \cup\ p'(x,z)\big].}
\end{proof}

\begin{question}
  $\bar{\EuScript M}\preceq_{\EuScript L}^{\rm p}{\EuScript U}$ \ ?
\end{question}
% %%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%
% %%%%%%%%%%%%%%%%%%%%%%%


% Let ${\EuScript M}$ be a substructure of ${\EuScript U}$.
% Let $a\in {\EuScript U}^{|x|}$.
% We say that ${\EuScript M}$ \emph{defines $a$ in the limit\/} if there is a formula $\varphi(x)\in{\EuScript L}^{\rm p}(M)$ and some infinite sets $B_1,\dots,B_n\subseteq M$ such that

% \ceq{\hfill\big\{\varphi(x)\big\}\ \cup\ p_{\restriction C}(x)}{\rightarrow}{p(x):={\rm tp}_{\EuScript L}^{\rm p}(a/U)}

% for every $C$ that has infinite intersection with all $B_1,\dots,B_n$.



% The following proposition is an immediate consequence of the definition of the relation $(\sim_{\EuScript U})$ in Section~\ref{L-relations}.

% \begin{proposition}
%   Suppose that $a'\equiv^{\EuScript L}^{\rm p}_Ma$ are both defined in the limit by ${\EuScript M}$.
%   Then $a'\sim_{\EuScript U}a$.
% \end{proposition}

% Finally we define completeness as a weak form of saturation.
% It is easy to verify that if ${\EuScript M}$ is the metric space in Example~\ref{ex_metric}, then the completeness of ${\EuScript M}$ is equivalent to the Cauchy-completeness of $(M,{\rm d})$.

% The proof of the following proposition is tedious but straightforward.

% \begin{proposition}
%   $\bar{\EuScript M}$ is complete.
% \end{proposition}

% \begin{proof}
%   Let $a\in U$ be defined in the limit by $\bar{\EuScript M}$.
%   For some formula $\varphi(x)\in{\EuScript L}^{\rm p}(\bar M)$ and some infinite set $B\subseteq\bar M$ we have that for every infinite $C\subseteq B$

%   \ceq{\hfill\big\{\varphi(x)\big\}\ \cup\ p_{\restriction C}(x)}{\rightarrow}{p(x):={\rm tp}_{\EuScript L}^{\rm p}(a/U)}

%   Let $b$ be a tuple that enumerates $B$ and the parameters of  $\varphi(x)$.
%   We rewrite the condition above with the dependence from $b$ displaied

%   \ceq{\hfill\big\{\varphi(x,b)\big\}\ \cup\ p_{\restriction C}(x,b)}{\rightarrow}{p(x,b).}

%   where $p(x,z)={\rm tp}_{\EuScript L}^{\rm p}(a,b/U)$.
%   As $b$ is defined in the limit by ${\EuScript M}$, there is a 

%   \ceq{\hfill\big\{\psi(z)\big\}\ \cup\ q_{\restriction C}(z)}{\rightarrow}{q(z)={\rm tp}_{\EuScript L}^{\rm p}(b/U)}
% \end{proof}

% Without additional hypothesis we cannot guarantee that $\bar{\EuScript M}$ is a model.

% \begin{theorem}
%   $\bar{\EuScript M}$ is an existentially closed substructure of ${\EuScript U}$.
% \end{theorem}

% \begin{proposition}
%   $\bar{\EuScript M}\preceq^{\rm p}{\EuScript U}$.
% \end{proposition}

% \begin{proof}
%   Apply the Tarski-Vaught Test~\ref{prop_Tarski_Vaught}.
%   Let $\psi(x,z)\in{\EuScript L}^{\rm p}$ and $a\in\bar M^{|z|}$ be such that $\psi(x,a)$ is consistent.
% Let $p(z)={\rm tp}_{\EuScript L}^{\rm p}(a/U)$.
% For some $B\subseteq M$ and some formula $\varphi(z)\in{\EuScript L}^{\rm p}(M)$ 

%   \ceq{\hfill\big\{\varphi(z)\big\}\ \cup\ p_{\restriction C}(z)}{\rightarrow}{\existsH x\ \psi(x, z)}
% \end{proof}



%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Homogeneity}
Recall that $\kappa$,  the cardinality of ${\EuScript U}$, is an inaccessible cardinal.

\begin{fact}
  Let $I\subseteq{\EuScript U}^2$ be an ${\EuScript L}^{\rm p}$-relation of cardinality $<\kappa$.
  Then there is a total and surjective ${\EuScript L}^{\rm p}$-relation $S\subseteq{\EuScript U}^2$ containing $I$.
\end{fact}

\begin{proof}
  We apply the usual back-and-forth construction with a pinch of extra caution.
  Let $a$ be an enumeration of the domain of $I$.
  Let $\bar a=\langle a_i:i<\lambda\rangle$ be an enumeration of all tuples of length $|a|$ such that $aRa_i$.
  As $\kappa$ is inaccessible, $\lambda<\kappa$.
  Let $b\in U$.
  It suffices to prove that there is a $c$ such that $I\cup\{\langle b,c\rangle\}$ is an ${\EuScript L}^{\rm p}$-relation.
  Let $p(x,z)={\rm tp}(b,a)$ and let
  
  \ceq{\hfill q(x,\bar z)}{=}{\bigcup_{i<\lambda}p(x,z_i).}

  We claim that $q(x,\bar a)$ is a finitely consistent type.
  A finite conjunction of formulas in $q(x,\bar a)$ has the form $\psi(x,a_{i_1})\wedge\dots\wedge\psi(x,a_{i_n})$.
  As $\psi(b,a)$ and $a_{i_1},\dots,a_{i_n}\,I\;a,\dots,a$, we conclude that the condition $\psi(x,a_{i_1})\wedge\dots\wedge\psi(x,a_{i_n})$ is satisfied.
  The existence of the required element $c$ follows by saturation.
\end{proof}

\begin{corollary}
  Let $A\subseteq{\EuScript U}$ have cardinality $<\kappa$.
  Let $p(x)={\rm tp}_{\EuScript L}^{\rm p}(a/A)$, where $a\in{\EuScript U}^{|x|}$ is a tuple of length $|x|<\kappa$.
  Then

  \ceq{\hfill p({\EuScript U})}{=}{\big\{b : bRa,\ I\in{\rm Aut}({\EuScript U}/A)\big\}}
\end{corollary}


% The following corollary of \L\v{o}\'s Theorem is identical to its classical counterpart.

% \begin{corollary}
%   For every model ${\EuScript M}$ and every ultrafilter $F$ on $I$, an infinite set, let ${\EuScript N}$ be corresponding ultrapower of ${\EuScript M}$.
%   Then there is an p-elementary embedding of ${\EuScript M}$ in ${\EuScript N}$.\qed
% \end{corollary}

% Note also that, unlike the classical ultraproduct, here we do not quotient the structure obtained in Definition~\ref{def_ultraproduct}.
% However, we note the following fact which is an easy consequence of \L\v o\'s Theorem.

% \begin{fact}
%   Let $I\subseteq N^2$ be the set of those pairs $(\hat a, \hat b)$ such that $\{i\in I:\hat ai=\hat bi\}\in F$.
%   Then $I$ is an ${\EuScript L}^{\rm p}$-relation.\qed
% \end{fact}

\end{document}


%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
\section{Examples}

\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

\begin{itemize}
  \item [1.] Firstly, we leave to the reader to check that classical first-order models are a (trivial) special cases of the models introduced above.
        Classical relations take values in $\{0,1\}$ where $0$ is interpreted as ``true''.
        The unit ball is the whole of ${\EuScript M}$.
        The function $n_{\mbox-}$ is constantly $1$.
        To obtain the full strength of first-order logic one has to add equality as a predicate as it is absent from our logic.

  \item [2.] Secondly, any {\sc bbhu}-premodel is also a model as those in Section~\ref{uno} if we let the unit ball coincide with ${\EuScript M}$.
        The language $L_{\sf H}$ contains a relation symbol $d(x,y)$ for a metric and, possibly, symbols for all other functions and relations of ${\EuScript M}$.
        As all relations of ${\EuScript M}$ (including the metric) take values in the interval $[0,1]$, the function $n_{\mbox-}$ can be set to be the constant $1$.

  \item [3.] Now we consider an example that is non trivial and distant both from classical models and from {\sc bbhu}-models: weighted graphs.
        The set $L_{\rm fun}$ is empty and $L_{\rm rel}$ contains only a binary relation $r$.
        We require that $r^{\EuScript M}(a,b)=r^{\EuScript M}(b,a)\in[0,1]$.
        As unit ball take, again,the whole of ${\EuScript M}$.
        The function $n_{\mbox-}$ is constant $1$.


  \item [4.] Finally, and example where the unit ball is non trivial.
        Let $L_{\sf H}$ be the language of Banach spaces.
        Here we have only one symbol in $L_{\rm rel}$, the symbol $\|\mbox-\|$ for the norm.
        The set $L_{\rm fun}$ is the same as for real vector spaces in classical logic.
        Let ${\EuScript M}$ be a Banach space and define a uniformly continuous model as follows.
        The interpretation of the symbols in $L_{\rm rel}\cup L_{\rm fun}$ is the natural one.
        The unit ball of is $ M=\{a\in  M: \|a\|\le1\}$.
        

        % Let $\varphi(x)$ be an atomic formula.
        % This has form $\|t(x)\|$ for some $t(x)\in L_{\rm trm}$.  
        % Note that $\sup\{\|t(a)\|: a\in {\EuScript U}^{|x|}\}$ does not depend on $ M$.
        % Therefore we can set it to be $n_{\varphi(x)}$

\end{itemize}

%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%
\section{Conditions and types}

For $\varphi, \psi\in L( M)$ some closed formulas, we write \emph{${\EuScript M}\models\ \varphi\le\psi$} for $\varphi^{\EuScript M}\le\psi^{\EuScript M}$.
The meaning of \emph{${\EuScript M}\models\ \varphi=\psi$\/} and of \emph{${\EuScript M}\,\models\ \varphi<\psi$\/} is similar.

Expressions of the form $\varphi(x)\le0$ are called \emph{conditions}.
We write ${\EuScript M}\models\existsH x\,\varphi(x)\le0$ if there is an $a\in  M^{|x|}$ such that ${\EuScript M}\models\varphi(a)\le0$.
Observe that $\varphi(x)=0$ is equivalent to $|\varphi(x)|\le0$ and that $\varphi(x)\le0$ is equivalent to $\big(\varphi(x)\vee0\big)=0$.
So, when convenient, we may use equalities to denote conditions.

The negation of a condition is called a \emph{co-conditions}.
So, $\varphi(x)\neq0$, $\varphi(x)<0$ or $\varphi(x)>0$ are co-conditions.

It is easy to see that conditions are cosed under logical disjunction and logical conjunction.

\ceq{\hfill {\EuScript M}\models\varphi\vee\psi\le0}
{\Leftrightarrow}
{{\EuScript M}\models\varphi\le0 \textrm{ and }{\EuScript M}\models\psi\le0}

\ceq{\hfill {\EuScript M}\models\varphi\wedge\psi\le0}{\Leftrightarrow}{{\EuScript M}\models\varphi\le0 \textrm{ \ or \ }{\EuScript M}\models\psi\le0}

Condition are also closed under universal quanfication (over the unit ball).

\ceq{\hfill {\EuScript M}\models\bigvee_x\varphi(x)\le0}{\Leftrightarrow}{{\EuScript M}\models\forallH x\ \varphi(x)\le0}

Closure under existential quanfication is a more subtle point.
It is not true in general but it can be ensured by a small amount of saturation (cf.~Fact~\ref{fact_existential}).

A set of conditions is called a \emph{type\/} or, when $x$ is the empty tuple, a \emph{theory.}
For $p(x)\subseteq L( M)$, we define

\hfil\emph{$p(x)\le0$}\ \ =\ \ $\big\{\varphi(x)\le0 \ \  :\ \  \varphi(x)\in p\big\}.$

Up to equivalence, all types have the form above.

Beware that $p(x)$ denotes just a set of formulas, the expression $p(x)\le0$ denotes a type.

We write \emph{${\EuScript M}\models p(a)\le0$} if ${\EuScript M}\models\varphi(a)\le0$ for every $\varphi(x)\in p$.
We write \emph{${\EuScript M}\models \existsH x\ p(x)\le0$} if ${\EuScript M}\models p(a)\le0$ for some $a\in  M^{|x|}$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Saturation}\label{saturation}

\def\ceq#1#2#3{\parbox[t]{20ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

From this section on, we assume the existence of unboundedly many inaccessible cardinals as this simplifies the exposition.
We prove directly the existence of ${\EuScript L}^{\rm p}$-saturated extension (monster models), skipping the proof of the Compactness Theorem for ${\EuScript L}^{\rm p}$ as it is not required in the following.
However this could be proved along the same lines.

Let $p(x)\subseteq L( M)$.
We say that $p(x)\le 0$ is \emph{finitely satisfied in ${\EuScript M}$\/} if for every disjunction of formulas in $p(x)$, say $\psi(x)$, there is an $a\in  M^{|x|}$ such that ${\EuScript M}\models\psi(a)\le0$.

\begin{definition}
  We say that ${\EuScript M}$ is \emph{saturated\/} if for every $p(x)$ as in 1 and 2 below, there is an $a\in  M^{|x|}$ such that ${\EuScript M}\models p(a)\le0$
  \begin{itemize}
    \item[1.] $p(x)\subseteq L(A)$ for some $A\subseteq  M$ of cardinality $<| M|$ and $|x|=1$;
    \item[2.] $p(x)\le0$ is finitely satisfied in $ M$.
  \end{itemize}
\end{definition}

From \L\v{o}\'s Theorem we obtain that every model embeds ${\EuScript L}^{\rm p}$-elementarily in a saturated one.
First we prove the following lemma.

\begin{lemma}\label{thm_compattezza}
  Every model ${\EuScript M}$ embeds ${\EuScript L}^{\rm p}$-elementarily in a model ${\EuScript N}$ that realizes all types as in 1 and 2.
\end{lemma}

\begin{proof}
  Consider the collection of types such that 1 and 2 above.
  Assume that each type has its own set of variables and let $x$ be the concatenation of all these variables.
  We denote by $p(x)$ the union of all these types.
  Let $I$ be the set of formulas $\xi(x)$ such that $\xi(x)\le0$ is satisfied in $ M$.
  For every condition $\varphi(x)\le0$ define $X_\varphi\subseteq I$ as follows

  \ceq{\hfill X_\varphi}{=}{\Big\{\xi(x)\in I\ :\ \xi( M)\le0\ \subseteq\ \varphi( M)\le0\Big\}}

  Note that $\varphi(x)\le0$ is consistent if and only if $X_\varphi\neq\varnothing$ if and only if $\varphi(x)\in X_{\varphi}$.
  Moreover $X_{\varphi\vee\psi}\ =\ X_\varphi\cap X_\psi$. Then, as $p(x)$  is finitely consistent, the set $B=\big\{X_\varphi\,:\,\varphi(x)\in p\big\}$ has the finite intersection property.
  Extend $B$ to an ultrafilter $F$ on $I$.
  Let ${\EuScript N}$ be the ultrapower of ${\EuScript M}$ over $F$.
  That is the model with unit ball $N= M^I$ obtained as in Definition~\ref{def_ultraproduct}.

  For every formula $\xi(x)\in I$ choose some $a_\xi\in  M^{|x|}$ such that $\xi(a_\xi)\le0$.
  We may confuse $( M^I)^{|x|}$ with $( M^{|x|})^I$ as it simplifies notation.
  Let $\hat a\in ( M^{|x|})^I$ be the function that maps $\xi(x)\mapsto a_\xi$.
  By \L\v o\'s Theorem, for every formula $\varphi(x)$

  \ceq{\hfill \varphi^{\EuScript N}\big(\hat a\big)}{=}{\lim_{\xi\to F}\varphi^{ M}\big(a_\xi\big).}

  Therefore $\hat a$ realizes $p(x)\le0$ in ${\EuScript N}$.
\end{proof}

\begin{theorem}
  Every model ${\EuScript M}$ embeds ${\EuScript L}^{\rm p}$-elementarily in a saturated model.
\end{theorem}

\begin{proof}
  As usual, iterate the lemma to construct a chain of length $\lambda$, a sufficiently large inaccessible cardinal.
\end{proof}

We conclude with a convenient property of saturated models.

\begin{fact}\label{fact_existential}
  Let $ M$ is saturated.
  Then for every $\varphi(x)\in L( M)$ the following are equivalent
  \begin{itemize}
    \item[1.] $ M\models\existsH x\ \big(\varphi(x)\le0\big)$;
    \item[2.] \smash{$ M\models\displaystyle \bigwedge_x \varphi(x)\;\le\;0$}
  \end{itemize}
\end{fact}
\begin{proof}
  Only 2$\Rightarrow$1 requires a proof.
  Let $p(x)=\{\varphi(x)-\alpha: \alpha\in{\mathds I}^{\rm p}\}$.
  If 2, then $p(x)\le0$ is finitely satisfied in $ M$.
  Hence 1 follows by saturation.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Homogeneity}

Throughout the following we fix a saturated model \emph{$\EuScript U$\/} of cardinality $\kappa$, an inaccessible cardinal larger than $|L|$, where $|L|$ stands for $\max\big\{|L_{\rm fun}|,|L_{\rm rel}|,2^\omega\big\}$.

Let $a\in{\EuScript U}^{|x|}$.
We write $p(x)={\rm tp}(a/A)$ for $p(x)=\big\{\psi(x)\in L(A):{\EuScript U}\models \psi(a)\le0\big\}$.
We write ${\rm tp}(a)$ when $A=\varnothing$.

\begin{fact}
  Let $I\subseteq{\EuScript U}^2$ be an ${\EuScript L}^{\rm p}$-relation of cardinality $<\kappa$.
  Then there is a total and surjective ${\EuScript L}^{\rm p}$-relation $S\subseteq{\EuScript U}^2$ containing $I$.
\end{fact}

\begin{proof}
  We apply the usual back-and-forth construction with a pinch of extra caution.
  Below we will make free use of Fact~\ref{fact_existential}.
  Let $a$ be an enumeration of the domain of $I$.
  Let $\bar a=\langle a_i:i<\lambda\rangle$ be an enumeration of all tuples of length $|a|$ such that $aRa_i$.
  As $\kappa$ is inaccessible, $\lambda<\kappa$.
  Let $b\in{\EuScript U}$.
  It suffices to prove that there is a $c$ such that $I\cup\{\langle b,c\rangle\}$ is an ${\EuScript L}^{\rm p}$-relation.
  Let $p(x,z)={\rm tp}(b,a/A)$ and let
  
  \ceq{\hfill q(x,\bar z)}{=}{\bigcup_{i<\lambda}p(x,z_i).}

  We claim that $q(x,\bar a)\le0$ is finitely consistent.
  A finite conjunction of formulas in $q(x,\bar a)$ has the form $\psi(x,a_{i_1})\wedge\dots\wedge\psi(x,a_{i_n})$.
  As $\psi(b,a)\le0$ and $a_{i_1},\dots,a_{i_n}\,I\;a,\dots,a$, we conclude that the condition $\psi(x,a_{i_1})\wedge\dots\wedge\psi(x,a_{i_n})\le0$ is satisfied.
  The existence of the required element $c$ follows from saturation.
\end{proof}

\begin{corollary}
  Let $a\in{\EuScript U}^{|x|}$, where $|x|<\kappa$.
  Let $A\subseteq{\EuScript U}$ have cardinality $<\kappa$.
  Then

  \ceq{\hfill p({\EuScript U})\le0}{=}{\big\{b : bRa,\ I\in{\rm Aut}({\EuScript U}/A)\big\}}
\end{corollary}


\hrulefill

Di qui in poi solo esperimenti selvaggi.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Random variables}

Let ${\EuScript A}$ be a $\sigma$-algebra of subsets of $\Omega$.
Let ${\EuScript M}$ be the set of bounded $\sigma$-additive measures on ${\EuScript A}$.
Let ${\EuScript L}^{\rm p}$ be the set of functions $f:\Omega\to{\mathds I}$ that are measurable w.r.t.\@ all measures in ${\EuScript M}$.

We define a $3$-sorted structure $\langle{\EuScript A},{}^{\circ\!}{\EuScript L}^{\rm p},{}^{\circ\!}{\EuScript M}\rangle$.

The domain of the first sort is ${\EuScript A}$.
The language contains functions for the Boolean operations.

% On $\Omega$ we define the equivalence relation $\sim_{\EuScript A}$ as follows: $a\sim_{\EuScript A} b$ if $a\in A\leftrightarrow b\in A$ for every $A\in{\EuScript A}$.
% We make use of $\Omega$ and  $\sim_{\EuScript A}$ in the definitions of $\langle{\EuScript A},{}^{\circ\!}{\EuScript L}^{\rm p},{}^{\circ\!}{\EuScript M}\rangle$ but they will not directly appear in the structure.

% We now define ${}^{\circ\!}{\EuScript L}^{\rm p}$ and ${}^{\circ\!}{\EuScript M}$.
% We warn the reader that, at a deeper level these two domain contains the same elements, the difference being only in the syntax.

The domain of the second sort ${}^{\circ\!}{\EuScript L}^{\rm p}$ contains the functions $f\in{\mathds I}$ that are linear combinations of indicator functions of sets in ${\EuScript A}$.
In the language we include the functions that make ${}^{\circ\!}{\EuScript L}^{\rm p}$ an ${\mathds I}$-algebra (sum and and multiplications are defined pointwise).
We also include operations for the pointwise maximum and minimum of two functions.
% The unit ball, $S$, contains functions that are $\le1$ in absolute value.

The domain of the third sort, ${}^{\circ\!}{\EuScript M}$, contains signed measures $\mu:{\EuScript A}\to{\mathds I}$ that are linear combinations of measures of the form $\delta_a$, for $a\in\Omega$.
These are defined as follows: $\delta_a(A)$ is $1$ if $a\in A$ and $0$ otherwise.
The language is that of lattice vector spaces.
% The unit ball, $ M$, contains the measures in ${}^{\circ\!}{\EuScript M}$ that are $\le1$ in absolute value.

There is a function of sort ${}^{\circ\!}{\EuScript L}^{\rm p}\times{}^{\circ\!}{\EuScript M}\to{}^{\circ\!}{\EuScript M}$ that maps $(f,\mu)$ to the measure $f\mu$ obtained multiplying in the natural way $f$ and $\mu$.

Finally, there is a predicate $I$ of sort ${\EuScript A}\times{}^{\circ\!}{\EuScript M}$ such that $I(A,\mu)=\mu(A)$.

The unit ball of $\langle{\EuScript A},{}^{\circ\!}{\EuScript L}^{\rm p},{}^{\circ\!}{\EuScript M}\rangle$ is $\langle{\EuScript A},{}^{\circ\!\!}I, M\rangle$ where ${}^{\circ\!\!}I$ and ${}^{\circ\!\!} M$ are the set of functions, respectively measures, that are $\le1$ in absolute value.

The readers can easily convince themselfs that a bounding function exist.
Its explicit definition is not required in the sequel.

\hfil ***

The following discrete version of the Radon-Nikodym theorem is completely trivial.
For simplicity we state it for (nonnegative) measures.
As the Hahn decomposition theorem holds (trivially) in ${}^{\circ\!}{\EuScript M}$, this is no loss of generality.

\begin{fact}\label{thm_fRN}
  [Discrete Radon-Nikodym]
  Let $\mu,\nu\in{}^{\circ\!\!} M$, where ${}^{\circ\!\!} M$ is the unit ball of ${}^{\circ\!}{\EuScript M}$, be non negative.
  For every $\varepsilon > 0$ there are $E\in{\EuScript A}$ and $f\in {}^{\circ\!\!}I$, where ${}^{\circ\!\!}I$ is the unit ball of ${}^{\circ\!}{\EuScript L}^{\rm p}$, such that
  \begin{itemize}
    \item[1.] $I(E,|\nu-\varepsilon^{-1}f\mu|)\ =\ 0$
    \item[2.] $|I(\neg E, \mu)|\le\varepsilon$.
  \end{itemize}
\end{fact}

We will use the following version of the fact above.

% \begin{fact}\label{thm_fRN2}
%   [Iterated discrete Radon-Nikodym]
%   Let $\mu,\nu\in{}^{\circ\!\!} M$, where ${}^{\circ\!\!} M$ is the unit ball of ${}^{\circ\!}{\EuScript M}$.
%   For every $n>0$ there are $E_1,\dots,E_n\in{\EuScript A}$ and $f\in{}^{\circ\!\!}I$, such that
%   \begin{itemize}
%     \item[0.] $E_n\subseteq E_{n-1}\subseteq {\dots\dots} \subseteq E_1\subseteq E_0=\Omega$
%     \item[1.] $I\big(E_i\smallsetminus E_{i+1},\ |\nu-2^{-(i+1)}f\mu|\big)\ =\ 0$
%     \item[2.] $|I(E_{i+1},\ \mu)|\le2^{-(i+1)}$;
%     \item[3.] $f_{i+1}\big[E_i\smallsetminus E_{i+1}\big]=\{0\}$.
%   \end{itemize}
% \end{fact}

% \begin{proof}
%   Apply inductively the theorem above, with $E_i$ for $\Omega$, to find $E_{i+1}$ and $f_{i+1}$ such that
%   \begin{itemize}
%     \item[1$_i$.] $I\big(E_i\smallsetminus E_{i+1},\ |\nu-2^{-(i+1)}f_{i+1}\mu|\big)\ =\ 0$;
%     \item[2$_i$.] $|I(E_{i+1},\ \mu)|\le2^{-(i+1)}$;
%     \item[3$_i$.] $f_{i+1}\big[E_i\smallsetminus E_{i+1}\big]=\{0\}$.
%   \end{itemize}
%   Finally, let $f=f_1+\dots+f_n$.
% \end{proof}


\begin{fact}\label{thm_fRN2}
  [Iterated discrete Radon-Nikodym]
  Let $\mu,\nu\in{}^{\circ\!\!} M$ be non negative.
  For every $n>0$ there are $E_1,\dots,E_n\in{\EuScript A}$ and $f\in{}^{\circ\!\!}I$ such that
  \begin{itemize}
    \item[0.] the $E_i$ are pairwise disjoint;
    \item[1.] $I\big(E_i,\ |\nu-2^if\mu|\big)\ =\ 0$
    \item[2.] $|I(X,\ \mu)|\le2^{-i}$, where $X=\neg(E_1\cup\dots\cup E_i)$;
  \end{itemize}
\end{fact}


\begin{proof}
  Apply inductively the theorem above, with $E_i$ for $\Omega$, to find $E_{i+1}$ and $f_{i+1}$ such that
  \begin{itemize}
    \item[1$_i$.] $I\big(E_i,\ |\nu-2^if_i\mu|\big)\ =\ 0$;
    \item[2$_i$.] $|I(X,\ \mu)|\le2^{-i}$, where $X=\neg(E_1\cup\dots\cup E_i)$;
    \item[3$_i$.] $f_i\big[\neg E_i]=\{0\}$.
  \end{itemize}
  Finally, let $f=f_1+\dots+f_n$.
  The third condition above (which is immediate to obtain) ensures that $f\in{}^{\circ\!\!}I$.
\end{proof}

% Write $\nu\ll\mu$ if for every $\varepsilon>0$ there is a $\delta>0$ such that $I(X,\mu)\le\delta\Rightarrow I(X,\nu)\le\varepsilon$ for all $X\in$.


% \begin{corollary}\label{cor_fRN}
%   Let $\mu,\nu\in{}^{\circ\!\!} M$ be such that $\nu\ll\mu$.
%   For every $\varepsilon > 0$ there exist an exceptional set $E\in{\EuScript A}$ and an $f\in S$, the unit ball of ${}^{\circ\!}{\EuScript L}^{\rm p}$, such that
%   \begin{itemize}
%     \item[1.] $I(X,1,\nu)\ =\ I(X,f/\varepsilon,\mu)$ for evey $X\subseteq\neg E$;
%     \item[2.] $\displaystyle\sup_{X\subseteq E}|I(X, \mu)|\le\varepsilon$.
%   \end{itemize}
% \end{corollary}

% We note that 1 \& 2 of Theorem~\ref{thm_fRN} can be expressed by a condition.
% Infact, if $\varphi(X)$ is a formula, where $X$ is a variable of sort ${\EuScript A}$, then $\sup_{Y\subseteq X}\varphi(Y)$ is a formula --~as it is equivalent to $\sup_Y\varphi(Y\cap X)$.
% Also, recall that conditions are closed under the Boolean operations of conjunction and disjunction.
% They are also closed under universal quantification.

We now consider a saturated extension of $\langle{\EuScript A},{}^{\circ\!}{\EuScript L}^{\rm p},{}^{\circ\!}{\EuScript M}\rangle$ that we denote by $\langle{}^{*\!\!\!}{\EuScript A},{}^{*\!}{\EuScript L}^{\rm p},{}^{*\!}{\EuScript M}\rangle$.
The following fact is a direct consequence of saturation.

\begin{fact}
  Let $\mu\in{\EuScript M}$.
  Then there is ${}^{*\!\!}\mu\in{}^{*\!}{\EuScript M}$ such that $\mu_{\restriction{\EuScript A}}={}^{*\!\!}\mu_{\restriction{\EuScript A}}$.
\end{fact}

\begin{proof}
  It suffices to check that the following type is finitely consistent in ${\EuScript A}$ (read $\nu$ as a variable and $\mu(X)$ as a real number)
  $$
  \big\{\nu(X)=\mu(X) \ :\ X\in{\EuScript A}\big\},
  $$
  which immediate.
\end{proof}

We can improve on the fact above.
In fact, we can also control the value of ${}^{*\!\!}\mu(A)$ for any $A\in{\EuScript A}$.

\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

\begin{fact}
  Let $\mu$ be a bounded measure on ${\EuScript A}$, not necessarily in ${}^{\circ\!}{\EuScript M}$.
  Let $A\in{}^{*\!\!\!}{\EuScript A}$.
  Define 
  
  \ceq{\hfill m_{\rm in\,}}{=}{\sup\{\mu(X): X\in{\EuScript A},\ X\subseteq A\}}

  \ceq{\hfill m_{\rm ex}}{=}{\,\inf\{\mu(X): X\in{\EuScript A}, \  A\subseteq X \}}

  Then for every $m_{\rm in\,}\le r\le m_{\rm ex}$ there is a measure ${}^{*\!\!}\mu\in{}^{*\!}{\EuScript M}$ such that ${}^{*\!\!}\mu_{\restriction{\EuScript A}}=\mu_{\restriction{\EuScript A}}$ and  ${}^{*\!\!}\mu(A)=r$.
\end{fact}

\begin{proof}[Proof (sketch)]
Assume for simplicity that $\mu$ is bounded by $1$.
It suffices to check that the following type is finitely consistent (read $\nu$ as a variable and $\mu(X)$ as a real number).
$$
\big\{\nu(X)=\mu(X) \ :\ X\in{\EuScript A}\big\}
\ \ \cup\ \ \
\big\{\nu(A)=r\big\}.
$$
In fact, any ${}^{*\!\!}\mu$ realizing this type is as required by the lemma.

Let ${\EuScript A}'\subseteq{\EuScript A}$ be a finite Boolean algebra.
We define a measure $\nu$ on the Boolean algebra generated by $A,X_1,\dots,X_n$ that satisfies the type above restrected to ${\EuScript A}'\cup\{A\}$.
Let $X_1,\dots,X_n$ be the atoms of ${\EuScript A}'$.
Assume $A\notin{\EuScript A}$, to avoid trivialities.
Then there are some sets $X_i$ such that both $X_i\cap A$ and $X_i\smallsetminus A$ are nonempty.
Suppose these sets are $X_1,\dots,X_m$.
For $i\le m$ we define $\nu(X_i\cap A)=\varepsilon\,\mu(X)$ and $\nu(X_i\smallsetminus A)=(1-\varepsilon)\mu(X_i)$, where $0\le\varepsilon\le1$ is specified below.
For $i>m$ let $\nu(X_i)=\mu(X_i)$.
Note that $\mu(X_1\cup\dots\cup X_m)\ge m_{\rm ex}-m_{\rm in}$.
Therefore with a suitable $\varepsilon$, we can obtain $\nu(A)=r$.
\end{proof}

If ${\EuScript A}$ is a $\sigma$-algebra and $\mu$ is a $\sigma$-additive measure then the supremum and the infimum in the fact above are attained.
We will use the following.

\begin{corollary}
  Let $\mu\in{\EuScript M}$.
  Then for every $A\in{}^{*\!\!\!}{\EuScript A}$ there are $A_{\rm in},A_{\rm ex}\in{\EuScript A}$ such that $A_{\rm in}\subseteq A\subseteq A_{\rm ex}$ and a measures ${}^{*\!\!}\mu$ such that 
  ${}^{*\!\!}\mu_{\restriction{\EuScript A}}=\mu_{\restriction{\EuScript A}}$ and ${}^{*\!\!}\mu(A)=\mu(A_{\rm ex})$.  
  A similar claim holds for $A_{\rm in}$.
  %We can also require it holds simultaneously for any family of sets $\{A_i:i<\lambda\}\subseteq{}^{*\!\!\!}{\EuScript A}$ of small cardinality (???).
\end{corollary}
\end{document}

\begin{question}
  Let $\mu\in{\EuScript M}$.
  Let ${}^{*\!\!}\mu\in{}^{*\!}{\EuScript M}$ be as above.
  Let $f\in{}^{*\!\!}I$, the unit ball of ${}^{*\!}{\EuScript L}^{\rm p}$, be given and assume $f$ is non negative.
  We define the function ${}^{\mu\!\!}f:\Omega\to{\mathds I}$ as follows (tentative)
  $$
  {}^{\mu\!\!}f(a)\ =\ \inf\big\{\alpha : I(A, f\,{}^{*\!\!}\mu)\le \alpha \mu(A) \ :\ A\in{\EuScript A},\ a\in A\big\}
  $$
  Is it true that for every $A\in{\EuScript A}$ 
  $$
  \int_A{}^{\mu\!\!}f{\rm d}\mu\ =\ I(A,f\,{}^{*\!\!}\mu)\ \ ?
  $$
\end{question}

\begin{theorem}[Radon-Nikodym] 
  Let $\nu,\mu\in{\EuScript M}$ be such that $\nu\ll\mu$.
  Then there is an $f\in{\EuScript L}^{\rm p}$ such that 
  $$
  \int_X f{\rm d}\mu = \int_X {\rm d}\nu
  $$
  for every $X\in{\EuScript A}$.
\end{theorem}

\begin{proof}
  ???????????????????
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Completeness vs.\@ saturation\quad !` please expand !}

% The $A$-limit uniformity on $ M^{|x|}$ is the uniformity that has the following entourages 

% \ceq{\hfill V_{\varphi(x),\, \varepsilon}}{=}{\Big\{(a,b)\in  M^{|x|}\times  M^{|x|}\quad :\quad \big|\varphi^{\EuScript M}(a)-\varphi^{\EuScript M}(b)\big|<\varepsilon\Big\}}

% for $\varphi(x)\in L(A)$ and $\varepsilon\in{\mathds I}^{\rm p}$. It is the coarsest uniformity that makes all formulas in $L(A)$ uniformly continuous.

% Let $p(x)\subseteq L( M)$ be a type.
% We say that $p(x)\le0$ is \emph{Cauchy\/} (in the $A$-limit uniformity) if for every $\varphi(x)\in L(A)$ and every $\varepsilon\in{\mathds I}^{\rm p}$ there is a disjunction of formulas in $p(x)$, say $\psi(x)$, such that $\varnothing\neq\big(\psi( M)\le0\big)^2\subseteq V_{\varphi(x),\, \varepsilon}$.

% \begin{fact}
%   Let $\lambda=L(A)$.
%   If ${}^{\circ\!\!} M$ is $\lambda$-saturated then and $p(x)\subseteq L( M)$ is Cauchy, then $p(x)$ is realized in ${}^{\circ\!\!} M$.
% \end{fact}


% For every $\varphi(x)\in\ L(A)$ and $n\in{\mathds N}$ let 


% Suppose ${\EuScript N}\models p(a)\le0$ and let $\big(\psi( M)\le0\big)^2\subseteq V_{\varphi(x),\, \varepsilon}$


\end{document}
