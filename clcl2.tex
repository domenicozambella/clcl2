\documentclass[10pt,oneside]{amsproc}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{comment}
\usepackage[alphabetic]{amsrefs}
\usepackage{tikz}
\usepackage{xcolor}
\usepackage{datetime2} 
\usepackage[colorlinks=true,linkcolor=blue,]{hyperref}

\usepackage[a4paper,hmargin=34mm, vmargin=30mm]{geometry}
\usepackage{stackengine}
\usepackage{scalerel}
\usepackage{mathtools}
\usepackage{calc}
\usepackage{amsthm}
\usepackage{thmtools}
\usepackage[framemethod=TikZ]{mdframed}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{euscript}
% \def\EuScript#1{\mathscr#1}
\usepackage{fourier}
% \usepackage{palatino}
% \usepackage{mathpazo} % add possibly `sc` and `osf` options
%\usepackage{eulervm}
%\usepackage{bbm}
%\usepackage{latexsym}
% \usepackage{mathrsfs}
% \usepackage{stmaryrd}
% \usepackage{stix}
\def\dotminus{\stackon[.2ex]{$-$}{$.$}}
\usepackage{dsfont}
% \newcommand*{\TakeFourierOrnament}[1]{{%
% \fontencoding{U}\fontfamily{futs}\selectfont\char#1}}
% \renewcommand*{\danger}{\TakeFourierOrnament{66}}
\parindent0ex
\parskip1.2ex
% \makeatletter
% \DeclareOldFontCommand{\rm}{\normalfont\rmfamily}{\mathrm}
% \DeclareOldFontCommand{\sf}{\normalfont\sffamily}{\mathsf}
% \DeclareOldFontCommand{\tt}{\normalfont\ttfamily}{\mathtt}
% \DeclareOldFontCommand{\bf}{\normalfont\bfseries}{\mathbf}
% \DeclareOldFontCommand{\it}{\normalfont\itshape}{\mathit}
% \DeclareOldFontCommand{\sl}{\normalfont\slshape}{\@nomath\sl}
% \DeclareOldFontCommand{\sc}{\normalfont\scshape}{\@nomath\sc}
% \makeatother

\newcommand{\mylabel}[1]{{#1}\hfill}
\renewenvironment{itemize}
  {\begin{list}{$\triangleright$}{%
  \setlength{\parskip}{0mm}
  \setlength{\topsep}{.4\baselineskip}
  \setlength{\rightmargin}{0mm}
  \setlength{\listparindent}{0mm}
  \setlength{\itemindent}{0mm}
  \setlength{\labelwidth}{3ex}
  \setlength{\itemsep}{.2\baselineskip}
  \setlength{\parsep}{.2\baselineskip}
  \setlength{\partopsep}{0mm}
  \setlength{\labelsep}{1ex}
  \setlength{\leftmargin}{\labelwidth+\labelsep}
  \let\makelabel\mylabel}}{%
\end{list}}

\declaretheoremstyle[
  headfont=\normalfont\bfseries,
  notefont=\bfseries,
  notebraces={(}{)},
  bodyfont=\normalfont,
  postheadspace=1em,
  mdframed={
  outerlinewidth=1pt,
  linecolor=gray!20,
  roundcorner = 1ex,    
  backgroundcolor=gray!10, 
  innerleftmargin=1ex,
  leftmargin=-1ex,
  innerrightmargin=1ex,
  rightmargin=-1ex,
  innertopmargin=1.5ex, 
  innerbottommargin=1ex, 
  skipabove=3ex,
  skipbelow=1ex}, 
]{mystyle}

\declaretheorem[style=mystyle]%
{theorem}
\declaretheorem[style=mystyle,sibling=theorem]%
{lemma,proposition,fact,corollary,definition,remark,example,claim,question}

\let\proof\relax
\declaretheoremstyle[
  spaceabove=6pt, 
  spacebelow=6pt, 
  headfont=\normalfont\itshape, 
  bodyfont = \normalfont,
  postheadspace=1em, 
  qed=\qedsymbol, 
  headpunct={.}]
{myproof} 
\declaretheorem[style=myproof, unnumbered]{proof}

\renewcommand*{\emph}[1]{%
   \smash{\tikz[baseline]\node[rectangle, fill=teal!25, rounded corners, inner xsep=0.5ex, inner ysep=0.2ex, anchor=base, minimum height = 2.7ex]{\strut #1};}}


% \def\forallH{\forall\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}}
% \def\existsH{\exists\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}}
% \def\forallI{\forall\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}}
% \def\existsI{\exists\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}}


\def\forallH{\forall}
\def\existsH{\exists}
\def\forallI{\forall}
\def\existsI{\exists}

\newcommand\questionsign[1][2ex]{%
  \renewcommand\stacktype{L}%
  \scaleto{\stackon[-.6pt]{\color{red}$\triangle$}{\color{red}\bfseries\small ?}}{#1}%
}

\newcommand\dangersign[1][3.5ex]{%
  \renewcommand\stacktype{L}%
  \scaleto{\stackon[1.9pt]{\Huge\color{red}$\triangle$}{\color{red}\bfseries\small !}}{#1}%
}

%%%%%%% GETCOMMIT
\newcommand\dotGitHEAD{}
\newcommand\branch{}


\makeatletter\let\myfilehandle\@inputcheck\makeatother

\openin\myfilehandle=.git/HEAD\relax

\begingroup\endlinechar-1
  \global\read\myfilehandle to \dotGitHEAD
\endgroup
\closein\myfilehandle

\newcommand\GetBranch{}
\def\GetBranch ref: refs/heads/#1\relax{\renewcommand{\branch}{#1}}

\expandafter\GetBranch\dotGitHEAD\relax

\makeatother

\linespread{1.1}
\author{C. L. C. L. Polymath}
\begin{document}
\title{Standard analysis}
\hfill\texttt{Branch:\ \branch\ \DTMnow}\bigskip
\maketitle
\raggedbottom

\begin{abstract}
  Let ${\EuScript L}$ be a first-order two-sorted language.
  Let $I$ be some fixed structure.
  A \textit{standard\/} structure is an ${\EuScript L}$-structure of the form $\langle M,I\rangle$ where $I$ is fixed.
  When $I$ is a compact topological space (and ${\EuScript L}$ meets a few requirements) it is possible to adapt a significant part of model theory to the restricted class of standard strutures.
  This has been demostrated by Henson and Iovino for Banach spaces (see, e.g.~\cite{HI}) and has been generalized to arbitrary structures in~\cite{clcl}.
  The starting point is to prove that every standard structure has a \textit{positive\/} elementary extension that is standard and realizes all positive types that are finitely consistent.
  The main tool is the notion of approximation of a positive formula and of its negation.
  These have been introduced by Henson and Iovino.\\[1ex]
  \noindent
  We review and elaborate on the properties of positive formulas.
  In parallel, we introduce \textit{continuous\/} formulas which are convenient to discuss examples and provide a better counterpart to Henson and Iovino theory and/or real-valued model theory.
  Finally, we discuss criteria for elimination of quantifers, omitting types, $\omega$-categoricity, stability, and indiscernibles within the setting of standard structures.
\end{abstract}



% The model theory of standard structures is based on the notions of positive formulas and of approximations.
% These evolved from the Henson-Iovino model theory of Banach spaces~\cite{HI}.
% Note that though the model theory of standard structures is an example of positive model theory there are important differences.
% For instance, we show that the negation of a positive formula is equivalent to an infinite disjunction of positive formulas.
% We also prove that these negations can be \textit{approximated\/} arbitrarily well by positive formulas.
% This makes the model theory of standard structures closer to classical model theory than one may expect.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Standard structures}\label{uno}


We refer to the introduction of~\cite{clcl} for motivations.
Aside from that, this paper is reasonably self-contained.
In the first part we revisit some results of~\cite{clcl}.
We rephrase some theorems and add a few remarks and examples\footnote{In the final version of this paper we will omit Section~\ref{standard_part} and refer to~\cite{clcl} instead. We will also omit some proofs.}.
Our notation and terminology diverges slightly where needed.

\def\ceq#1#2#3{\parbox[t]{23ex}{$\displaystyle #1$}\parbox{6ex}{\hfil $#2$}{$\displaystyle #3$}}

Let \emph{$I$\/} be some fixed first-order structure which is endowed with a Hausdorff compact topology (in particular, a normal topology).
The language \emph{${\EuScript L}_{\sf I}$\/} contains relation symbols for the compact subsets $C\subseteq I^n$ and a function symbol for each continuous functions $f:I^n\to I$.
In particular, there is a constant for each element of $I$.
According to the context, $C$ and $f$ denote either the symbols of ${\EuScript L}_{\sf I}$ or their interpretation in the stucture $I$.
Such a language ${\EuScript L}_{\sf I}$ is much larger than necessary but it is convenient because it uniquely associates a structure to a topological space.
The notion of a \textit{dense set of formulas\/} (Definition~\ref{def_dense}) helps to reduce the size of the language when required.

The most straightforward examples of structures $I$ are the unit interval $[0,1]$ with the usual topology, and its homeomophic copies $\mathds{R}^+\cup\{0,\infty\}$ and $\mathds{R}\cup\{\pm\infty\}$.

We also fix a first-order language \emph{${\EuScript L}_{\sf H}$\/} which we call the language of the \emph{home sort.}

\begin{definition}\label{def_0}
  Let ${\EuScript L}$ be a two sorted language that expands both ${\EuScript L}_{\sf H}$ and ${\EuScript L}_{\sf I}$.
  A \emph{standard structure\/} is a two-sorted ${\EuScript L}$-structure of the form $\langle M,I\rangle$, where $M$ is any ${\EuScript L}_{\sf H}$-structure, while $I$ is the structure above.
  We write \emph{${\sf H}$} and \emph{${\sf I}$\/} to denote the two sorts of ${\EuScript L}$.
  
  The language ${\EuScript L}$ adds a relation symbol $R_{\varphi}(x)$ for every $\varphi(x)\in {\EuScript L}_{\sf H}$.
  All ${\EuScript L}$-structures are assumed to model $R_{\varphi}(x)\leftrightarrow\varphi(x)$. 
  In other words, the Morleyzation of ${\EuScript L}_{\sf H}$ is built in the definition of ${\EuScript L}$-structure.
  
  Finally and most relevantly, ${\EuScript L}$ contains arbitrarily many function symbols of sort ${\sf H}^n\to {\sf I}$.

  Standard structures are denoted by the domain of their home sort.
\end{definition}

% In some examples we need to replace the sort ${\sf H}$ with many sorts ${\sf H}_1\dots,{\sf H}_k$.
% In this case the language ${\EuScript L}_{\sf H}$ is replaced with $L_{{\sf H}_1\dots,{\sf H}_k}$, the language that governs the structure $\langle M_1\dots,M_k\rangle$.
% Models have the form $\langle M _1\dots,M_k, I\rangle$.
% The new symbols in the language ${\EuScript L}$ are of sort ${\sf H}_1^{n_1}\dots,{\sf H}_k^{n_k}\to {\sf I}$.

Clearly, saturated ${\EuScript L}$-structures exist but, with the exception of trivial cases (when $I$ is finite), they are not standard.
As a remedy, below we carve out a set of formulas ${\EuScript L}^{\rm p}$, the set of positive formulas, such that every model has an positive elementary saturated extension that is also standard.

As usual, ${\EuScript L}_{\sf I}$, ${\EuScript L}_{\sf H}$, and ${\EuScript L}$ denote both first-order languages and the corresponding set of formulas.
We write ${\EuScript L}_x$ when when we restrict variables to $x$.
If $\varphi(x)\in{\EuScript L}$ contains only terms of sort ${\sf H}^n\to{\sf H}$ and relations of sort ${\sf H}^n$ we will improperly say that $\varphi(x)\in {\EuScript L}_{\sf H}$ (which is only correct up to equivalence).
% The symbols ${\EuScript L}^{\rm p}$ and ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$ defined below denote only sets of ${\EuScript L}$-formulas.

Note that ${\EuScript L}$ has two types of atomic formulas: 
\begin{itemize}
  \item[1.] atomic formulas in ${\EuScript L}_{\sf H}$ (hence, up to equivalence, all formulas of ${\EuScript L}_{\sf H}$);
  \item[2.] formulas of the form $\tau(x\,;\eta)\in C$, where $C\subseteq I^n$ is compact and $\tau(x\,;\eta)$ is a tuple of terms of sort ${\sf H}^{|x|}\times {\sf I}^{|\eta|}\to {\sf I}$.
\end{itemize}

\begin{definition}\label{def_LL}
  A formula in ${\EuScript L}$ is \emph{positive\/} if it uses only the Boolean connectives $\wedge$, $\vee$; the quantifiers $\forall\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}$, $\exists\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}$ of sort ${\sf H}$; and the quantifiers $\forall\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}$, $\exists\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}$ of sort ${\sf I}$.

  The set of positive formulas is denoted by \emph{${\EuScript L}^{\rm p}$.}

  A \emph{continuous\/} formula is a positive formula where only atomic formulas as in (2) above occur.
  The set of continuous formulas is denoted by \emph{${\EuScript L}^{\rm c}$.}

  We will use Latin letters $x,y,z$ for variables of sort ${\sf H}$ and Greek letters $\eta,\varepsilon$ for variables of sort ${\sf I}$.
  Therefore we can safely drop the superscript from quantifiers if they are followed by variables.
\end{definition}

% \noindent\llap{\textcolor{red}{\Large\dangersign}\kern1ex}\ignorespaces


The positive formulas of Henson and Iovino correspond to those formulas in ${\EuScript L}^{\rm c}$ that do not have quantifiers of sort ${\sf I}$.

Working within ${\EuScript L}^{\rm p}$ simplifies the comparision with classical model theory but comes at a price.
Instead, allowing quantifiers of sort ${\sf I}$ comes almost for free.
We will see (cf.\@ Propositions~\ref{prop_LHapprox1}) that the formulas in ${\EuScript L}^{\rm p}/{\EuScript L}^{\rm c}$ are approximated by formulas without quantifiers of sort ${\sf I}$.

The extra expressive power offered by quantifiers of sort ${\sf I}$ is convenient.
For instance, it is easy to see (cf.\@ Example~\ref{ex_Rvlogic}) that ${\EuScript L}^{\rm c}$ has at least the same expressive power as real valued logic%
%\footnote{This unsubstantited claim should be interpreted as concjecture.
%A painstaking technical comparison with real valued logic is not in the scope of this indroductory exploratory paper.}.

\begin{example}\label{ex_Rvlogic}
  Let $I=[0,1]$, the unit interval in $\mathds{R}$.
  Let $\tau(x)$ be a term of sort ${\sf H}^{|x|}\to {\sf I}$.
  Then there is a positive formula that says $\sup_x \tau(x)=\alpha$.
  Indeed, consider the formula

  \ceq{\hfill\forallH x\ \big[\tau(x)\dotminus\alpha\in\{0\}\big]}
  {\wedge}{\forallI \varepsilon \Big[\varepsilon\in\{0\}\ \vee\ \existsH x\ \big[\alpha\dotminus (\tau(x)+\varepsilon)\in\{0\}\big]\Big]}

  which, in a more legible form, becomes

  \ceq{\hfill\forallH x\ \big[\tau(x)\le\alpha\big]}{\wedge}{\forallI \varepsilon>0\ \existsH x\ \big[\alpha\le \tau(x)+ \varepsilon\big].}
\end{example}

The following example is inspired by~\cite{HPP}.

\begin{example}\label{ex_HPP}
  Let $\bar M$ be a saturated structure of signature ${\EuScript L}_{\sf H}$.
  The relevant part of ${\EuScript L}$ contains symbols for the functions $f:\bar M^n\to I$ that are continuous in the following sense: the inverse image of every compact $C\subseteq I$ is type-definable in ${\EuScript L}_{\sf H}(M)$ for every $M\preceq\bar M$.
  It is easy to verify that $\langle\bar M, I\rangle$ is positively saturated as defined in Section~\ref{compactness}.
\end{example}

The theory of normed spaces is one of the motivating examples of standard structures.
Essentially, functional analysis and model theory are only interested in the unit ball of normed spaces.
To formalize the unit ball of a normed space as a standard structure (where $I$ is the unit interval) is straightforward but cumbersome.
Alternatively one can view a normed space as a many-sorted structure: a sort for each ball of radius $n\in\mathds{Z}^+$.
Unfortunately, this also results in a bloated formalism.

A neater formalization is possible if one accepts that some positive elementary extensions (to be defined below) of a normed space could contain vectors of infinite norm hence not be themselves proper normed spaces.
However these infinities are harmless if one is only interested in the unit ball.
In fact, inside any ball of finite radius these improper normed spaces are completely standard.

\begin{example}\label{ex_normed_spaces}
Let $I=\mathds{R}\cup\{\pm\infty\}$.
Let ${\EuScript L}_{\sf H}$ be the language of real (or complex) vector spaces.
The language ${\EuScript L}$ contains a function symbol $\|\mbox{-}\|$ of sort ${\sf H}\to {\sf I}$.
Normed space are standard structures with the natural interpretation of the language.
It is easy to verify that the unit ball of a standard structure is the unit ball of a normed space.
Note that the same remains true if we add to the language any continuous (equivalently, bounded) operator or functional.
\end{example}

We conclude this introduction by advertising a question in~\cite{clcl}.
Is it possible to extend the Positive Compactness Theorem (Theorem~\ref{thm_compattezza}) to a larger class of languages?
E.g.\@ can we allow in ${\EuScript L}$ (and in ${\EuScript L}^{\rm p}$) function symbols of sort ${\sf H}^n\times {\sf I}^m\to {\sf I}$ with both $n$ and $m$ positive?
These would have natural interpretations, e.g.\@ a group acting on a compact set $I$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Henson-Iovino approximations}\label{ultrapws}

For $\varphi,\varphi'$ (free variables are hidden) positive formulas possibly with parameters we write \emph{$\varphi'>\varphi$\/} if $\varphi'$ is obtained by replacing in $\varphi$ each atomic formula of the form $t\in C$ with $t\in C'$, where $C'$ is some compact neighborhood of $C$.
If no such atomic formulas occurs in $\varphi$, then $\varphi>\varphi$.
We call $\varphi'$ a \emph{weakening\/} of $\varphi$.
Note that $>$ is a dense transitive relation and that  $\varphi\to\varphi'$ in every ${\EuScript L}$-structure.

We write \emph{$\tilde{\varphi}\perp\varphi$\/} when $\tilde{\varphi}$ is obtained by replacing each atomic formula $t\in C$ occurring in $\varphi$ with $t\in\tilde{C}$ where $\tilde{C}$ is some compact set disjoint from $C$.
The atomic formulas in ${\EuScript L}_{\sf H}$ are replaced with their negation.
Finally each connective is replaced by its dual i.e., $\vee, \wedge, \exists,\forall$ are replaced by $\wedge,\vee,\forall,\exists$, respectively.
We say that  $\tilde{\varphi}$ is a \emph{strong negation} of $\varphi$.
It is clear that $\tilde{\varphi}\rightarrow\neg\varphi$ in every ${\EuScript L}$-structure.

\begin{lemma}\label{lem_interpolation}
  For all positive formulas $\varphi$
  \begin{itemize}
    \item[1.]for every $\varphi'>\varphi$ there is a formula $\tilde{\varphi}\perp\varphi$ such that $\varphi\rightarrow\neg \tilde{\varphi}\rightarrow\varphi'$;
    \item[2.] for every\, $\tilde{\varphi}\perp\varphi$ there is a formula $\varphi'>\varphi$ such that  $\varphi\rightarrow\varphi'\rightarrow\neg \tilde{\varphi}$.
  \end{itemize}
\end{lemma}

\begin{proof}
  If $\varphi\in {\EuScript L}_{\sf H}$ the claims are obvious.
  Suppose $\varphi$ is of the form $t\in C$.
  Let $\varphi'$ be $t\in C'$, for some compact neighborhood of $C$.
  Let $O$ be an open set such that $C\subseteq O\subseteq C'$.
  Then $\tilde{\varphi}=(t\in I\smallsetminus O)$ is as required by the lemma.
  Suppose instead that $\tilde{\varphi}$ is of the form $t\in\tilde{C}$ for some compact $\tilde{C}$ disjoint from $C$.
  By the normality of $I$, there is  $C'$, a compact neighborhood of $C$ disjoint from $\tilde{C}$.
  Then  $\varphi'=\big(t\in C'\big)$ is as required.
  The lemma follows easily by induction.
\end{proof}

For every type $p(x)$, we write 

\ceq{\hfill \emph{$p'(x)$}}{=}{\big\{\varphi'(x)\ :\ \varphi'>\varphi\textrm{ for some }\varphi(x)\in p\big\}}

in particular \emph{$\{\varphi(x)\}'$} = $\big\{\varphi'(x)\ :\ \varphi'>\varphi\big\}$.

\begin{definition}\label{def_dense}
  A set of formulas ${\EuScript F}\subseteq{\EuScript L}$ is \emph{p-dense\/} modulo $T$, a theory, if for every positive $\varphi(x)$ and every $\varphi'>\varphi$, there is $\psi(x)\in{\EuScript F}$ such that $\varphi(x)\rightarrow\psi(x)\rightarrow\varphi'(x)$ holds in every standard structure that models $T$.
  If $T$ is empty, we say that ${\EuScript F}$ is p-dense modulo ${\EuScript L}$.

  We say \emph{c-dense\/} if the property above is only required to hold for continuous formulas.
\end{definition}

\begin{example}
  By Lemma~\ref{lem_interpolation}, the set of negations of positive formulas is p-dense modulo ${\EuScript L}$.
\end{example}

\begin{example}
  Let $I=[0,1]$.
  The set of formulas built inductively from atomic formulas of the form $\tau\in\{0\}$, is c-dense modulo ${\EuScript L}$.
  In fact, as every compact subset of $I$ is the intersection of finite unions of closed intervals, the set of formulas containing only atomic formulas of the form $\tau\in[\alpha,\beta]$ is c-dense.
  Finally note that $\tau\in[\alpha,\beta]$ is equivalent to $\tau\dotminus\beta\in\{0\}\ \wedge\ \alpha\dotminus\tau\in\{0\}$.
\end{example}

\begin{example}
  In Section~\ref{Ielimination} we prove that the set of positive/continuous formulas without quantifiers of sort ${\sf I}$ is p-dense/c-dense.
\end{example}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Morphisms}\label{morphisms}

\def\ceq#1#2#3{\parbox[t]{35ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

Let $M$ and $N$ be two standard structures.
We say that a partial map $f:M\to N$ is \emph{p-elementary\/} if for every $\varphi(x)\in{\EuScript L}^{\rm p}$ and every $a\in({\rm dom }f)^{|x|}$

\ceq{1.\hfill M\models\varphi(a)}{\Rightarrow}{N\models\varphi(fa).}

In words, we say that $f$ \emph{preserve the truth\/} of the positive formulas.
A p-elementary map that is total is called a p-elementary \emph{embedding.}
When the identity map ${\rm id}_M:M\rightarrow N$ is an p-elementary embedding, 
% that is, if for every  $\varphi(x)\in{\EuScript L}^{\rm p}$ and every $a\in M^{|x|}$
%
% \ceq{\hfill{\EuScript M}\models\varphi(a)}{\Rightarrow}{N\models\varphi(a)},
%
we write \emph{$M\preceq^{\rm p} N$\/} and say that $M$ is an p-elementary \emph{substructure\/} of $N$.

The discussion of c-elementarity needs some extra care because ${\EuScript L}^{\rm c}$ does not contains equality in the home sort.
Therefore we postpone it till Section~\ref{IeliminationC}.

On the other hand, as p-elementary maps are in particular ${\EuScript L}_{\sf H}$-elementary, they are injective.
However, their inverse need not be p-elementary.
In other words, the converse of the implication in (1) may not hold.
Hence the following notion of elementarity which is more roboust.
% We have chosen to work with the classical notion of satisfaction at the cost of this asymmetric notion of elementarity.
% This differs from the approach of Henson and Iovino.
% They introduce the notion of \textit{approximate satisfaction.} 
% The approximate ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-morphisms we define below are the maps that preserve Henson-Iovino approximate satisfaction.
% These morphisms are invertible, cf.\@ Fact~\ref{fact_HImorphisms}.
We say that the map $f:M\to N$ is an \emph{approximate\/} p-elementary if for every formula $\varphi(x)\in{\EuScript L}^{\rm p}$, and every $a\in({\rm dom }f)^{|x|}$

\ceq{2.\hfill M\models\varphi(a)}{\Rightarrow}{N\models\big\{\varphi(fa)\big\}'.}

One convenient feature of approximate p-elementarity is that it suffices verify (2) for any/some p-dense set of formulas.
It is clear that p-elementarity implies its approximate variant.
We will see that with a slight amount of saturation also the converse holds (Proposition~\ref{prop_approx}).
Moreover, under full saturation, these morphims becomes ${\EuScript L}$-elementarity maps (Corollary~\ref{corol_Lcomplete}).

The following holds in general.

\begin{fact}\label{fact_HImorphisms}
  If $f:M\to N$ is approximate p-elementary then

  \ceq{\hfill M\models\big\{\varphi(a)\big\}'}{\Leftrightarrow}{N\models\big\{\varphi(fa)\big\}'.}

  for every $\varphi(x)\in{\EuScript L}^{\rm p}$, and every $a\in({\rm dom }f)^{|x|}$.
\end{fact}

\begin{proof}
  $\Rightarrow$ \ Fix $\varphi'>\varphi$ and assume $M\models\varphi'(a)$.
  Let  $\varphi'>\varphi''>\varphi$.
  By the definition of approximate elementarity, $N\models\varphi''(fa)$ and $N\models\varphi'(fa)$ follows.
  
  $\Leftarrow$  \ 
  Assume the r.h.s.\@ of the equivalence.
  Fix $\varphi'>\varphi$ and prove $M\models\varphi'(a)$.
  Let  $\varphi'>\varphi''>\varphi$.
  By Lemma~\ref{lem_interpolation} there is some $\tilde{\varphi}\perp\varphi''$ such that $\varphi''\rightarrow\neg\tilde{\varphi}\rightarrow\varphi'$.
  Then $N\models\neg\tilde{\varphi}(fa)$ and therefore  $M\models\neg\tilde{\varphi}(a)$.
  Then $M\models\varphi'(a)$.
\end{proof}

% \begin{comment}
Finally, we consider the notion of partial embeddings.
Though the definition seems weaker, we show that the notion is competely classical.
We say that the map $f:M\to N$ is a \emph{partial embedding\/} if the implication in (1) holds for all atomic formulas $\varphi(x)$.
Note that this is the same as requiring that (1) holds for all formulas without quantifiers of sort ${\sf H}$.

\begin{fact}\label{fact_partial_emb}
  If $f:M\to N$ is a partial embedding then 

  \ceq{\hfill M\models\varphi(a)}{\Leftrightarrow}{N\models\varphi(fa)}

  for every $a\in({\rm dom }f)^{|x|}$ and every formula $\varphi(x)\in{\EuScript L}^{\rm p}$ without quantifiers of sort ${\sf H}$.
\end{fact}

\begin{proof}
  The equivalence is trivial for formulas in ${\EuScript L}_{\sf H}$ so we only consider atomic formulas of the form $t\in C$.
  Implication $\Rightarrow$ holds by definition. 
  Vice versa, if $M\models \tau(a)\notin C$ then, by normality,  $M\models \tau(a)\in\tilde{C}$ for some compact $\tilde C$ disjoint of $C$.
  By the definition of partial embedding, $N\models \tau(a)\in\tilde{C}$.
  Hence $N\models \tau(a)\notin C$.
  Induction is immediate.
\end{proof}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The standard part}\label{standard_part}

Our goal is to prove a compactness theorem for positive theories that only requires standard structures.
To bypass lengthy routine applications of ultrafilters, ultrapowers, and ultralimits, % -- as it would be like reinventing the wiel.
we assume the Classical Compactness Theorem and build on that.

In this section we recall the notion of standard part of an element of the elementary extension of a compact Hausdorff topological space.
Our goal is to prove Lemma~\ref{lem_st} which in turn is required for the proof of the Positive Compactness Theorem (Theorem~\ref{thm_compattezza}).
The reader willing to accept it without proof may skip this section.

Let $\langle N, {}^*\!\!I\rangle$ be an ${\EuScript L}$-structure that extends ${\EuScript L}$-elementarily the standard structure $M$. %$\langle M, I\rangle$.
Let $\eta$ be a free variable of sort ${\sf I}$.
For each $\beta\in I$, we define the type

\ceq{\hfill{\rm m}_\beta(\eta)}{=}{\{\eta\in D\ :\  D \textrm{ compact neighborhood of }\beta\}.}

The set of the realizations of ${\rm m}_\beta(\eta)$ in ${}^*\!\!I$ is known to nonstandard analysts as the monad of $\beta$. 
% We write \emph{$\alpha\approx\alpha'$\/} if $\alpha\approx\beta\approx\alpha'$ for some $\beta\in I$.
% From the following fact it follows that $\,\approx\,$ is an equivalence relation on ${}^*\!\!I$.
The following fact is well-known.

\begin{fact}\label{fact_uniqueness_st}
  For every $\alpha\in{}^*\!\!I$ there is a unique $\beta\in I$ such that ${}^*\!\!I\models{\rm m}_\beta(\alpha)$.
\end{fact}

\begin{proof}
  Negate the existence of $\beta$.
  For every $\gamma\in I$ pick some compact neighborhood $D_\gamma$ of $\gamma$, such that ${}^*\!\!I\ \models\ \alpha\notin D_\gamma$.
  By compactness there is some finite $\Gamma\subseteq I$ such that $D_\gamma$, with $\gamma\in\Gamma$, cover $I$.
  By elementarity, the interpretation in ${}^*\!\!I$ of these $D_{\gamma}$ cover ${}^*\!\!I$.
  A contradiction.
  The uniqueness of $\beta$ follows from normality.
\end{proof}

We denote by \emph{${\rm st}(\alpha)$\/} the unique $\beta\in I$ such that ${}^*\!\!I\models{\rm m}_\beta(\alpha)$.
% We write \emph{$\alpha\approx\alpha'$\/} if ${\rm st}(\alpha)={\rm st}(\alpha')$.

\begin{fact}\label{fact_st1}
  For every $\alpha\in{}^*\! I$ and every compact $C\subseteq I$

\ceq{\hfill{}^*\!\!I}{\models}{\alpha\in C\ \rightarrow\ {\rm st}(\alpha)\in C.}
\end{fact}

\begin{proof}
  Assume ${\rm st}(\alpha)\notin C$.
  By normality there is a compact set $D$ disjoint from $C$ that is a neighborhood of ${\rm st}(\alpha)$.
  Then  ${}^*\!\!I\models\alpha\in D\subseteq\neg C$.
\end{proof}

\begin{fact}\label{fact_terms_st}
  For every $\alpha\in({}^*\!\!I)^{|\alpha|}$ and every function symbol $f$ of sort ${\sf I}^{|\alpha|}\to{\sf I}$

  \ceq{\hfill{}^*\!\!I}{\models}{{\rm st}\big(f(\alpha)\big)=f\big({\rm st}(\alpha)\big).}
\end{fact}

\begin{proof}
  By Fact~\ref{fact_uniqueness_st} and the definition of st(-) it suffices to prove that ${}^*\!\!I\models f(\alpha)\in D$ for every compact neighborhood $D$ of $f\big({\rm st}(\alpha)\big)$.
  
  Fix one such $D$.
  Then ${\rm st}(\alpha)\in f^{-1}[D]$ .
  By continuity $f^{-1}[D]$ is a compact neighborhood of ${\rm st}(\alpha)$.
  Therefore ${}^*\!\!I\models \alpha\in f^{-1}[D]$ and, as $I\preceq{}^*\!\!I$ we obtain ${}^*\!\!I\models f(\alpha)\in D$.
\end{proof}

The \emph{standard part of $\langle N,{}^*\!\!I\rangle$\/} is the standard structure $\langle N,I\rangle$ that interprets the symbols $f$ of sort ${\sf H}^n\to {\sf I}$ as the functions

\ceq{\hfill f^N(a)}{=}{{\rm st}\big({}^*\!\!f(a)\big)}\hfill for all $a\in N^n$,

where ${}^*\!\!f$ is the interpretation of $f$ in  $\langle N,{}^*\!\!I\rangle$.
Symbols in ${\EuScript L}_{\sf H}$ maintain the same interpretation.

\begin{fact}\label{fact_st2} 
  With the notation as above.
  Let $\tau(x\,;\eta)$ be a term of sort ${\sf H}^{|x|}\times{\sf I}^{|\eta|}\to {\sf I}$.
  Then for every $a\in M^{|x|}$ and $\alpha\in({}^*\!\!I)^{|\eta|}$\vskip-.7\baselineskip

  \ceq{\hfill \tau^N\big(a\,;{\rm st}(\alpha)\big)}{=}{{\rm st}\big({}^*\!\tau(a\,;\alpha)\big)}
\end{fact}
\begin{proof}
  When a $t$ is a function symbol of sort  ${\sf H}^{|x|}\to {\sf I}$, the claim holds by definition.
  When $t$ is a function symbol of sort ${\sf I}^{|\eta|}\to {\sf I}$, the claim follows from Fact~\ref{fact_terms_st}.
  Now, assume inductively that 

  \ceq{\hfill t_i^N\big(a\,;{\rm st}(\alpha)\big)}{=}{{\rm st}\big({}^*t_i(a\,;\alpha)\big)}

  holds for the terms $t_1(x\,;\eta),\dots,t_n(x\,;\eta)$ and let $t=f(t_1,\dots,t_n)$ for some function $f$ of sort ${\sf I}^n\to {\sf I}$.
  Then the claim follows immediately from the induction hypothesis and Fact~\ref{fact_terms_st}.
\end{proof}

% Symbols in ${\EuScript L}_{\sf I}$ have the interpretation they have in models.

\begin{lemma}\label{lem_st}
  With the notation as above.
  For every $\varphi(x\,;\eta)\in{\EuScript L}^{\rm p}$, \  $a\in N^{|x|}$ and $\alpha\in({}^*\!\!I)^{|\eta|}$ 
  
  \ceq{\hfill\langle N,{}^*\!\!I\rangle\models\varphi(a\,;\alpha)}
  {\Rightarrow}
  {N\models\varphi\big(a\,;{\rm st}(\alpha)\big)}
\end{lemma}

\begin{proof}
  Suppose $\varphi(x\,;\eta)$ is ${\EuScript L}^{\rm p}$-atomic.
  If $\varphi(x\,;\eta)$ is a formula of ${\EuScript L}_{\sf H}$ the claim is trivial. 
  Otherwise $\varphi(x\,;\eta)$ has the form $\tau(x\,;\eta)\in C$.
  Assume that the tuple $\tau(x\,;\eta)$ consists of a single term.
  The general case follows easily from this special case. 
  Assume that $\langle N,{}^*\!\!I\rangle\models \tau(a\,;\alpha)\in C$.
  Then ${\rm st}\big({}^*\tau(a\,;\alpha)\big)\in C$ by Fact~\ref{fact_st1}.
  Therefore $\tau^N\big(a\,;{\rm st}(\alpha)\big)\in C$ follows from Fact~\ref{fact_st2}.
  This proves the lemma for atomic formulas.
  Induction is immediate. 
\end{proof}

\begin{corollary}\label{corol_st}
  Let $M$ be a standard structure.
  Let $p(\eta)\subseteq{\EuScript L}^{\rm p}(M)$ be a type that does not contain existential quantifiers of sort ${\sf H}$.
  Then, if $p(\eta)$ is finitely consistent in $M$, it is realized in $M$.
 \end{corollary}
 
 The corollary has also a direct proof.
 This goes through the observation that the formulas in $p(\eta)$ define compact subsets of $I$.

 \begin{proof}
  Let $\langle ^*\!M,^*\!\!I\rangle$ be an ${\EuScript L}$-elementary saturated superstructure of $\langle M,I\rangle$.
  Then $\langle ^*\!M,^*\!\!I\rangle\models p(\alpha)$ for some $\alpha\in ^*\!\!I$.
  By the lemma above, $^*\!M\models p({\rm st}(\alpha))$.
  Now observe that the truth of formulas without  existential quantifiers of sort ${\sf H}$ is preserved by substructures.
 \end{proof}
 
 The exclusion of existential quantifiers of sort ${\sf H}$ is necessary.
 For a counterexample take $M=I=[0,1]$.
 Assume that ${\EuScript L}$ contains a function symbol for the identity map $\iota:M\to I$.
 Let $p(\eta)$ contain the formulas $\exists x\,\big(x>0\,\wedge\;\iota x+\eta\in[0,1/n]\big)$ for all positive integers $n$.

% \begin{corollary}\label{corol_Isaturation}
%   Let $M$ be a model and let $p(\eta)\subseteq{\EuScript L}^{\rm p}(M)$ be a type that is finitely consistent in $M$, where $\eta$ is a tuple of variables of sort ${\sf I}$.
%   Then $p(\eta)$ is realized in a model $N$ such that $M\preceq^{\rm p}N$.
% \end{corollary}

% \begin{proof}
%   By the classical Compactess Theorem, the type $p(\eta)$ is realized in some ${\EuScript L}$-structure $\langle N,{}^*\!\!I\rangle$ by
%   some $\alpha\in ({}^*\!\!I)^{|\eta|}$.
%   Therefore, by the lemma above $N\models p\big({\rm st}(\alpha)\big)$.
% \end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Compactness}\label{compactness}

It is convenient to distinguish between consistency with respect to standard structures and consistency with respect to ${\EuScript L}$-structures.
We say that a theory $T$ is \emph{${\EuScript L}$-consistent\/} if $\langle M,{}^*\!\!I\rangle\models T$ for some ${\EuScript L}$-structure $\langle M,{}^*\!\!I\rangle$ (this is the classical notion of concistency).
We say that $T$ is \emph{standardly\/}  consistent if $M\models T$  is for some standard structure $M$.
By Lemma~\ref{lem_st} these two notions coincide if $T$ is positive.
Therefore we have the following.

\begin{theorem}[Positive Compactness Theorem]\label{thm_compattezza}
  Let $T$ be a positive theory. Then, if $T$ is finitely ${\EuScript L}$-consistent, it is also standardly consistent.
\end{theorem}

% \begin{proof}
%   Suppose $T$ is finitely ${\EuScript L}$-consistent.
%   By the Classical Compactness Theorem, there is an ${\EuScript L}$-structure $\langle M,{}^*\!\!I\rangle\models T$.
%   Let $\langle M,I\rangle$ be its standard part as defined in Section~\ref{standard_part}.
%   Then $M\models T$ by Lemma~\ref{lem_st}.
% \end{proof}

% \begin{corollary}\label{prop_tipi_compattezza}
%   Let $p(x\,;y)\subseteq{\EuScript L}^{\rm p}(M)$ be finitely consistent in $M$, a model.
%   Then $N\models\existsH x\,\exists^I y\,p(x\,;y)$ for some model $N$ such that $M\preceq^{\rm p}N$.
% \end{corollary}

% \noindent\llap{\dangersign\kern2ex}%


% \begin{definition}
%   We say that $M$ is \emph{positively saturated\/} if for every $p(x)$ as in 1 and 2 below, $M\models\existsH x\, p(a)$.
%   \begin{itemize}
%     \item[1.] $p(x)\subseteq{\EuScript L}^{\rm p}(A)$ for some $A\subseteq  M$ of cardinality $<|M|$ and $|x|=1$;
%     \item[2.] $p(x)$ is finitely satisfied in $M$.
%   \end{itemize}
% \end{definition}
An ${\EuScript L}$-structure $N$ is \emph{positively $\lambda$-saturated\/} if it realizes all types $p(x\,;\eta)\subseteq{\EuScript L}^{\rm p}(N)$ with fewer than $\lambda$ parameters that are finitely consistent in $N$.
When $\lambda=|N|$ we simply say \emph{p-saturated.}
The existence of p-saturated standard structures is obtained from the classical case just as for Theorem~\ref{thm_compattezza}.

\begin{theorem}
  Every standard structure has a p-elementary extension to a p-saturated standard structure (possibly of inaccessible cardinality).
\end{theorem}

\begin{proof}
  Let $\langle {}^*\!\!M,{}^*\!\!I\rangle$ be an ${\EuScript L}$-saturated ${\EuScript L}$-elementary extension of the standard structure $\langle M,I\rangle$.
  Let $\langle {}^*\!\!M,I\rangle$ be its standard part as defined in Section~\ref{standard_part}.
  By Lemma~\ref{lem_st}, $\langle {}^*\!\!M,I\rangle$ realizes all finitely consistent positive types with fewer than $|{}^*\!\!M|$ parameters.
\end{proof}



% Homogeneity follows from saturation by the usual back-and-forth contruction.

% \begin{proposition}(Homogeneity)
%   Let $N$ be saturated and of cardinality larger than $|{\EuScript L}^{\rm p}|$.
%   Then for every $ab\in M^\alpha$, where $\alpha<|N|$, such that $a\equiv b$, there is an ${\EuScript L}^{\rm p}$-automorphism of $N$ that maps $a$ to $b$.
% \end{proposition}

The following proposition shows that a slight amount of saturation tames the positive formulas.

\begin{proposition}\label{prop_approx}
  Let $N$ be a positively $\omega$-saturated standard structure.
  Then 
  
  \ceq{\hfill\big\{\varphi(x\,;\eta)\big\}'}{\leftrightarrow}{\varphi(x\,;\eta)}
  
  holds in $N$ for every formula $\varphi(x\,;\eta)\in{\EuScript L}^{\rm p}(N)$.
\end{proposition}

\begin{proof}
  We prove $\rightarrow$, the non trivial implication.
  The claim is clear for atomic formulas.
  Induction for conjunction, disjunction and the universal quantifiers is immediate.
 % 
  % Consider disjunction.
  % Let $\varphi=\varphi_i\vee\varphi_1$.
  % Assume inductively
 % 
  % \ceq{\hfill\varphi_i(x)}
  % {\leftrightarrow}
  % {\bigwedge_{\varphi_i'>\varphi_i}\varphi_i'(x)}
%
  % Then
%
  % \ceq{\hfill\varphi(x)}
  % {\leftrightarrow}
  % {\bigwedge_{\varphi_1'>\varphi_1}\varphi_1'(x) \ \vee \bigwedge_{\varphi_2'>\varphi_2}\varphi_2'(x)}
%
  % \ceq{}
  % {\leftrightarrow}
  % {\bigwedge_{\substack{\varphi_1'>\varphi_1\\ \varphi_2'>\varphi_2}}\varphi_1'(x) \vee\varphi_2'(x)}
%
  % \ceq{}
  % {\leftrightarrow}
  % {\bigwedge_{\varphi'>\varphi}\varphi'(x)}
%
  We consider case of the existential quantifiers of sort ${\sf H}$.
  Assume inductively
  
  \ceq{\textrm{ih.}\hfill\{\varphi(x,z\,;\eta)\}'}
  {\rightarrow}
  {\varphi(x,z\,;\eta)}

  We need to prove

  \ceq{\hfill\{\existsH z\,\varphi(x,z\,;\eta)\}'}
  {\rightarrow}
  {\existsH z\,\varphi(x,z\,;\eta)}

  From (ih) we have

  \ceq{\hfill\existsH z\,\{\varphi(x,z\,;\eta)\}'}
  {\rightarrow}
  {\existsH z\,\varphi(x,z\,;\eta)}

  Therefore it suffices to prove

  \ceq{\hfill\{\existsH z\,\varphi(x,z\,;\eta)\}'}
  {\rightarrow}
  {\existsH z\,\{\varphi(x,z\,;\eta)\}'}

Replace the variables $x\,;\eta$ with parameters, say $a\,;\alpha$, and assume that $N\models\existsH z\,\varphi'(a,z,;\alpha)$ for every $\varphi'>\varphi$.
We need to prove the consistency of the type $\{\varphi'(a,z,;\alpha):\varphi'>\varphi\}$.
By saturation, finite consistency suffices.
This is clear if we show that the antecedent is closed under conjunction.
Indeed it is easy to verify that if $\varphi_1,\varphi_2>\varphi$ then $\varphi_1\wedge\varphi_2>\varphi'$ for some $\varphi'>\varphi$.
In words, the set of approximations of $\varphi$ is a directed set.

For existential quantifiers of sort ${\sf I}$ we argue similarly.% by applying Corollary~\ref{corol_Isaturation}.
%
% \noindent\llap{\textcolor{red}{\Large\danger}\kern1ex}\ignorespaces
% Consider the existential quantifiers of sort $I$
% Assume inductively
%
% \ceq{\hfill\bigwedge_{\varphi'>\varphi}\varphi'(x;y)}
% {\rightarrow}
% {\varphi(x;y)}
%
% As above, it suffices to prove
%
% \ceq{\#\hfill\bigwedge_{\varphi'>\varphi}\exists^C\! y\,\varphi'(x;y)}
% {\rightarrow}
% {\exists^C\! y\,\bigwedge_{\varphi'>\varphi}\varphi'(x;y)}
%
\end{proof}

% \begin{remark}
%   If we restrict to formulas without quantifiers of sort ${\sf H}$, the proposition above holds in every model (this is clear from the proof).
% \end{remark}

\def\ceq#1#2#3{\parbox[t]{20ex}{$\displaystyle #1$}\parbox{5ex}{\hfil $#2$}{$\displaystyle #3$}}

% \begin{remark}\label{remk_approx_EH_free}
  By Corollary~\ref{corol_st}, when $\varphi(x\,;\eta)$ does not contains existential quantifiers of sort ${\sf H}$, the proposition above does not require the assumption of saturation.
  In general, some saturation is necessary: consider the model presented after Corollary~\ref{corol_st} and the formula $\exists x\,\big(x>0\ \wedge\ \iota(x)\in\{0\}\big)$. 
% \end{remark}

\begin{remark}\label{rem_model_approx}
  A consequence of Proposition~\ref{prop_approx} is that the approximate morphisms defined in Section~\ref{morphisms} coincide with their unapproximate version when the codomain is positively $\omega$-saturated.
\end{remark}
% In particular, the following follows from Fact~\ref{fact_HImorphisms}.

% \begin{corollary}\label{corol_omega_sat}
%   Let $N$ be an positively $\omega$-saturated model.
%   Let $f:M\to N$ be an p-elementary map.
%   Then

%   \ceq{\hfill M\models\varphi(a)}{\Leftrightarrow}{N\models\varphi(fa)}

%   for every formula $\varphi(x)\in{\EuScript L}^{\rm p}$ and every $a\in({\rm dom }f)^{|x|}$.
% \end{corollary}  


% \begin{fact}\label{fact_saturation_invertible}
%   Let $M$ be a model that is $\lambda$-positively saturated for some $\lambda\ge|{\EuScript L}|$.
%   Let $f:M\to N$ be an p-elementary map.
%   Then

%   \ceq{\hfillM\models\varphi(a)}{\Leftrightarrow}{{\EuScript N}\models\varphi(fa)}

%   for every ${\EuScript L}^{\rm p}$-atomic formula $\varphi(x)$ and every $a\in({\rm dom }f)^{|x|}$
% \end{fact}

% \begin{proof}
%   Assume ${\EuScript N}\models\varphi(fa)$.
%   It sufficies to prove the fact for $f$ of finite cardinality.
%   By the downward L\"owenheim-Skolem Theorem, there is a model ${\EuScript N_0}\preceq^{\EuScript L}{\EuScript N}$ of cardinality $|{\EuScript L}|$ containing $f(a)$.
%   By saturation there is a model ${\EuScript M_0}\preceq^{\rm p}M$ that is isomorphic to ${\EuScript N_0}$ over $f$.
%   By isomorphism ${\EuScript M_0}\models\varphi(a)$ and therefore $M\models\varphi(a)$
% \end{proof}
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The monster model}\label{monster}

We denote by \emph{${\EuScript U}$\/} some large p-saturated standard structure which we call the \emph{positive monster\/} model.
% For convenience we assume that the cardinality of ${\EuScript U}$ is an inaccessible cardinal.
Truth is evaluated in ${\EuScript U}$ unless otherwise is specified.
We denote by $T$ the positive theory of {${\EuScript U}$.
The density of a set of formulas is understood modulo $T$.
Below we say \emph{p-model\/} for p-elementary substructure of ${\EuScript U}$.
We stress once again that the truth of some $\varphi\in{\EuScript L}^{\rm p}(M)$ in a p-model $M$ implies the truth of $\varphi$ (in ${\EuScript U}$) but not vice versa.
If also the converse implication holds we say $M$ a \emph{strong p-model.}
However, all p-models agree on the approximated truth, see Fact~\ref{fact_HImorphisms} and Remark~\ref{rem_model_approx},

\ceq{\hfill M\models\{\varphi\}'}{\Leftrightarrow}{\{\varphi\}'.}

Strong p-models are those that realize the equivalence in Proposition~\ref{prop_approx}, e.g.\@ $\omega$-saturated p-models are strong p-models.

% Let $A\subseteq{\EuScript U}$ be a small set throughout this section.
% We define a topology on ${\EuScript U}^{|x|}$ which we call the \emph{${\EuScript L}^{\rm p}(A)$-topology.}
% The closed sets of this topology are the sets defined by the types $p(x)\subseteq{\EuScript L}^{\rm p}(A)$.
% This is a compact topology by the Compactness Theorem for ${\EuScript L}^{\rm p}$.
The following fact demostrates how positive compactness applies.
There are some subtle differences from the classical setting.
Let $A\subseteq{\EuScript U}$ be a small set throughout this section.
% \begin{lemma}
%   For every $\varphi(x\,;y)\in{\EuScript L}^{\rm p}(A)$ the set $\varphi(U\,;I)$ is a compact subset of ${\EuScript U}^{|x|}\times I^{|y|}$.
% \end{lemma}

% \begin{proof}
%   We prove that every finitely intersecting family of closed subsets of $\varphi(U\,;I)$ has nonempty intersection.
%   Without loss of generality we can assume that the sets in this family have the form $\psi(U)\times C_1\times\dots\times C_{|y|}$ for some compact sets $C_i\subseteq I$ and some $\psi(x)\in{\EuScript L}^{\rm p}$.
%   Then by ${\EuScript L}^{\rm p}$-compactness the intersection of the family is nonempty.
% \end{proof}

\begin{fact}\label{fact_compactness_imp}
  Let $p(x)\subseteq{\EuScript L}^{\rm p}(A)$ be a type.
  Then for every  $\varphi(x)\in{\EuScript L}^{\rm p}({\EuScript U})$
  \begin{itemize}
    \item[1.] if $p(x)\rightarrow\neg\varphi(x)$ then $\psi(x)\rightarrow\neg\varphi(x)$ for some $\psi(x)$ conjunction of formulas in $p(x)$;
    \item[2.] if $p(x)\rightarrow\varphi(x)$ and $\varphi'>\varphi$ then $\psi(x)\rightarrow\varphi'(x)$ for some conjunction of formulas in $p(x)$.
  \end{itemize} 
\end{fact}

\begin{proof}
  (1) is immediate by saturation;  (2) follows from (1) by Lemma~\ref{lem_interpolation}.
\end{proof}

\begin{fact}\label{fact_Fdense}
  Let ${\EuScript F}$ be a p-dense/c-dense set of positive formulas.
  Then ${\EuScript F}'$ is p-dense/c-dense.
\end{fact}

\begin{proof}
  Let $\varphi'>\varphi$.
  Pick $\varphi''$ such that $\varphi'>\varphi''>\varphi$ and $\psi\in{\EuScript F}$ such that $\varphi(x)\rightarrow\psi(x)\rightarrow\varphi''(x)$.
  It suffices to prove that $\psi'(x)\rightarrow\varphi'(x)$ for some $\psi'>\psi$.
  By Proposition~\ref{prop_approx}, $\psi(x)\leftrightarrow\{\psi(x)\}'$.
  Therefore, $\psi'(x)\rightarrow\varphi'(x)$ follows from Fact~\ref{fact_compactness_imp}.
\end{proof}

% \begin{example}
%   The equivalence in the proposition above does not extend to all formulas in ${\EuScript L}^{\rm p}$.
%   For a counter example, let both $M$ and $I$ are the real interval $[0,1]$.
%   The language has a function symbol ${\rm d}$ of sort $M^2\to I$.
%   Its interpretation is ${\rm d}^{\EuScript M}(x,y)=|x-y|$.
%   The formula 
  
%   \ceq{\hfill\varphi}{=}{\exists\varepsilon\big[\varepsilon\in\{0\}\ \wedge\ \existsH x,y\ \ {\rm d}(x,y)\cdot\varepsilon\in\{1\}\big]}

%   is false, though every $\varphi'>\varphi$ is true (in ${\EuScript M}$ and any ${\EuScript L}^{\rm p}$-extension of ${\EuScript M}$).\hfill\qedsymbol
% \end{example}


% The following fact is an immediate consequence.



% \begin{corollary}
%   If $\varphi(x),\psi(x)\in{\EuScript L}^{\rm p}(U)$ are mutually inconsistent then there are $\varphi'>\varphi$ and $\psi'>\psi$ that are mutually inconsistent.
% \end{corollary}





% \begin{fact}
%   Let $a\in M^{|x|}$ be such that ${\EuScript M}\not\models\varphi(a)$
%   Then, ${\EuScript M}\not\models\varphi'(a)$ for some $\varphi'>\varphi$.\hfill\qedsymbol
% \end{fact}














% \begin{fact}
%   Let $\varphi(x)\in{\EuScript L}^{\rm p}(A)$, where $A\subseteq M$.
%   Then for every $a\in M^{|x|}$ such that ${\EuScript M}\not\models\varphi(a)$ there is a formula $\tilde\varphi(x)\in{\EuScript L}^{\rm p}(A)$ such that ${\EuScript M}\models\tilde\varphi(a)$ and ${\EuScript M}\models\neg\existsH x\,[\tilde\varphi(x)\wedge\varphi(x)]$.
% \end{fact}


% \begin{fact}
%   For every $\varphi(x),\psi(x)\in{\EuScript L}^{\rm p}(U)$ such that $\neg\existsH x\,[\varphi(x)\wedge\psi(x)]$ there are $\varphi'>\varphi$ and $\psi'>\psi$ such that $\neg\existsH x\,[\varphi'(x)\wedge\psi'(x)]$.
% \end{fact}

% \begin{proof}
%   By Proposition~\ref{prop_approx} and saturation.
% \end{proof}

% The following are immediate consequences of the proposition above and Lemma~\ref{lem_interpolation}.

% \begin{corollary}\label{corol_Hcomplete1}
%   For every $a\in {\EuScript U}^{|x|}$ and $\varphi(x)\in{\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}(U)$, if $\neg\varphi(a)$ then $\tilde\varphi(a)$ for some $\tilde\varphi\perp\varphi$.\hfill\qedsymbol
% \end{corollary}

We write \emph{$S^{\rm p}_x(A)$\/} for the set of maximally consistent subsets of ${\EuScript L}^{\rm p}_x(A)$.
We define \emph{$\mbox{p-tp}(a/A)$,} the positive type of $a$ over $A$, to be the set of formulas $\big\{\varphi(x)\in{\EuScript L}^{\rm p}(A)\ :\ \varphi(a)\big\}$.
Similarly, we define \emph{$S^{\rm c}_x(A)$\/} and \emph{$\mbox{c-tp}(a/A)$.}

In general, if ${\EuScript F}$ is any set of formulas, we write \emph{${\EuScript F}\mbox{-tp}(a/A)$,} for the type $\big\{\varphi(x)\in{\EuScript F}(A)\ :\ \varphi(a)\big\}$. 
The undecorated symbol \emph{$\mbox{tp}(a/A)$\/} denotes the ${\EuScript L}$-type.

\begin{fact}\label{fact_max_cons_L}
  Let $p(x)\subseteq{\EuScript L}^{\rm p}(A)$.
  The following are equivalent 
  \begin{itemize}
    \item[1.] $p(x)$ is a maximally consistent subsets of ${\EuScript L}^{\rm p}_x(A)$;
    \item[2.] $p(x)=\mbox{p-tp}(a/A)$ for some $a\in{\EuScript U}^{|x|}$.
  \end{itemize}
\end{fact}

\begin{proof}
  (1$\Rightarrow$2) By the saturation of ${\EuScript U}$, there is an $a\in{\EuScript U}^{|x|}$ such that $p(x)\subseteq\mbox{p-tp}(a/A)$.
  By maximality $p(x)=\mbox{p-tp}(a/A)$.


  (2$\Rightarrow$1) 
  From Lemma~\ref{lem_interpolation} and Proposition~\ref{prop_approx} we obtain

  \ceq{\hfill\neg\varphi(x)}
  {\rightarrow}
  {\bigvee_{\tilde{\varphi}\perp\varphi}\tilde{\varphi}(x).}

  Suppose $\varphi(x)\in{\EuScript L}^{\rm p}(A)\smallsetminus  p$.
  Then $\neg\varphi(a)$.
  Hence $\tilde{\varphi}(a)$ holds for some $\tilde{\varphi}\perp\varphi$ and $p(x)\rightarrow\neg\varphi(x)$ follows.
\end{proof}
 
Note that in the proof above we could replace ${\EuScript L}^{\rm p}$ with any set of positive formulas closed under strong negation.
Therefore we can also claim the following.

\begin{fact}\label{fact_max_cons_H}
  Let $p(x)\subseteq{\EuScript F}(A)$, where ${\EuScript F}$ is a set of positive formulas closed under strong negation.
  Then the following are equivalent 
  \begin{itemize}
    \item[1.] $p(x)$ is a maximally consistent subset of ${\EuScript F}_x(A)$;
    \item[2.] $p(x)={\EuScript F}\mbox{-tp}(a/A)$ for some $a\in{\EuScript U}^{|x|}$.
  \end{itemize}
\end{fact}



\begin{proposition}\label{prop_Fapprox}
  Let ${\EuScript F}$ be a p-dense set of positive formulas.
  Then for every $\varphi(x)\in{\EuScript L}^{\rm p}$
  
  \ceq{\hfill\neg\varphi(x)}
  {\leftrightarrow}
  {\bigvee\big\{\psi(x)\in{\EuScript F}\ :\ \psi(x)\rightarrow\neg\varphi(x)\big\}.}
\end{proposition}
 
\begin{proof}
  Only $\rightarrow$ requires a proof.
  Let $a\in {\EuScript U}^{|x|}$ be such that $\neg\varphi(a)$.
  Let $p(x)=\mbox{p-tp}(a)$.
  By Fact~\ref{fact_max_cons_L}, $p(x)\rightarrow\neg\varphi(x)$.
  As ${\EuScript F}$ is p-dense, $p(x)\leftrightarrow q(x)={\EuScript F}\mbox{-tp}(a)$.
  Then, by compactness, $\psi(x)\rightarrow\neg\varphi(x)$ for some $\psi\in q\subseteq{\EuScript F}$.
\end{proof}

We will need a similar result for larger class formulas.
We write \emph{$\Sigma^{\rm p}$\/} for the set of formulas of the form $\exists y\,\vartheta(x,y)$ where $\vartheta(x,y)$ is a Boolean combination of formulas in ${\EuScript F}$.
The following follows easily from the proposition above by induction on the syntax of $\varphi(x)$.

\begin{proposition}\label{prop_Sigma_approx}
  For every $\varphi(x)\in\Sigma^{\rm p}$
  
  \ceq{\hfill\varphi(x)}
  {\leftrightarrow}
  {\bigvee\big\{\psi(x)\in{\EuScript F}\ :\ \psi(x)\rightarrow\varphi(x)\big\}.}
\end{proposition}


% \begin{proposition}\label{prop_LHapprox2}
%   Let ${\EuScript F}$ be a dense set of positive formulas.
%   Let $\varphi(x)\in{\EuScript L}^{\rm p}(A)$ be such that $\neg\varphi(x)$ is consistent.
%   Then  $\psi'(x)\rightarrow\neg\varphi(x)$ for some consistent $\psi(x)\in{\EuScript F}(A)$ and some $\psi'>\psi$.
% \end{proposition}
 

% One interesting consequence of the proposition above is that in Fact~\ref{fact_max_cons_L} we can replace ${\EuScript L}^{\rm p}$ with any dense set of positive formula.

% \begin{fact}
%   Let ${\EuScript F}$ be a dense set of positive formulas.
%   Let $p(x)\subseteq{\EuScript F}(A)$.
%   The following are equivalent 
%   \begin{itemize}
%     \item[1.] $p(x)$ is maximally consistent;
%     \item[2.] $p(x)={\EuScript F}\mbox{-tp}(a/A)$ for some $a\in{\EuScript U}^{|x|}$.
%   \end{itemize}
% \end{fact}

% \begin{proof}
%   (1$\Rightarrow$2) Again, by the saturation of ${\EuScript U}$.

%   (2$\Rightarrow$1)
%   Let $\varphi(x)\in{\EuScript L}^{\rm p}(A)\smallsetminus p$.
%   From Proposition~\ref{prop_LHapprox2} we obtain that $\psi(a)$ holds for some $\psi(x)\in{\EuScript F}(A)$ such that $\psi(x)\rightarrow\neg\varphi(x)$.
%   Therefore $p(x)\rightarrow\neg\varphi(x)$ follows.
% \end{proof}

% \begin{corollary}\label{corol_Hcomplete3}
%   The inverse of an ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-elementary map $f:{\EuScript U}\to{\EuScript U}$ is ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-elementary.
% \end{corollary}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Elimination of quantifiers of sort \textsf{I} for positive formulas}\label{Ielimination}

We show that the quantifiers of sort ${\sf I}$ can be eliminated up to some approximation.
Precisely, we prove that \emph{${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$}, the set of positive formulas without quantifiers of sort ${\sf I}$, is p-dense modulo $T$ (the theory of ${\EuScript U}$).

A partial map is \emph{${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-elementary\/} if it preserves the truth of formulas in ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$.

\begin{proposition}
  Every ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-elementary map $f:{\EuScript U}\to{\EuScript U}$ of small cardinality extends to an automorphism of ${\EuScript U}$.
\end{proposition}

\begin{proof}
  By Fact~\ref{fact_max_cons_H}, the inverse of an ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-elementary map is also ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-elementary.
  Then we can extend the map by back-and-forth as usual.
\end{proof}

Let $A\subseteq{\EuScript U}$ be a small set throughout this section.
We apply the proposition above to obtain a strengthening of Fact~\ref{fact_max_cons_H}.
For $a,b\in {\EuScript U}^{|x|}$ we write \emph{$a\equiv_Ab$\/} if $a$ and $b$ satisfy the same ${\EuScript L}$-formulas over $A$.

\begin{corollary}\label{corol_Lcomplete}
  Let $p(x)={\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}\mbox{-tp}(a/A)$ and $q(x)=\mbox{tp}(a/A)$. Then $p(x)\leftrightarrow q(x)$.
\end{corollary}

\begin{proof}
  Only $\rightarrow$ requires a proof.
  If $b\models p(x)$ then there is an ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-elementary map $f\supseteq{\rm id}_A$ such that $fa=b$.
  Then $f$ extends to an automorphism.
  As every automorphism is ${\EuScript L}$-elementary, $a\equiv_Ab$, and the corollary follows.
\end{proof}

The corollary says that ${\EuScript U}$ does not distinguish between ${\EuScript L}$, ${\EuScript L}^{\rm p}$, and ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$ types.
In the classical setting, from an equivalence between types one derives an equivalence between formulas.
Without negation, this is not true.
Still, we can infer an approximate form of equivalence.

\begin{proposition}\label{prop_LHapprox1}
  The set ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$ is p-dense modulo $T$.
\end{proposition}

\begin{proof}
  Let $\varphi(x)$ be a positive formula.
  We need to prove that for every $\varphi'>\varphi$ there is some formula $\psi(x)\in{\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$ such that $\varphi(x)\rightarrow\psi(x)\rightarrow\varphi'(x)$.
  By Corollary~\ref{corol_Lcomplete} and Proposition~\ref{prop_approx}

  \ceq{\hfill\neg\varphi(x)}{\rightarrow}{\bigvee_{p'(x)\rightarrow\neg\varphi(x)}p'(x)}

  where $p(x)$ ranges over the maximally consistent ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-types.
  By Fact~\ref{fact_compactness_imp} and Lemma~\ref{lem_interpolation}

  \ceq{\hfill\neg\varphi(x)}{\rightarrow}{\bigvee_{\neg\tilde{\psi}(x)\rightarrow\neg\varphi(x)}\neg\tilde{\psi}(x),}

  where $\tilde{\psi}(x)\in{\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$.
  Equivalently,

  \ceq{\hfill\varphi(x)}{\leftarrow}{\bigwedge_{\tilde{\psi}(x)\leftarrow\varphi(x)}\tilde{\psi}(x).}

  By compactness, see Fact~\ref{fact_compactness_imp}, for every $\varphi'>\varphi$ there are some finitely many $\tilde{\psi}_i(x)\in{\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$ such that

  \ceq{\hfill\varphi'(x)}{\leftarrow}{\bigwedge_{i=1,\dots,n}\tilde{\psi}_i(x)\ \ \leftarrow\ \ \varphi(x)}

  which yields the interpolant required by the proposition.
\end{proof}

% \begin{proposition}\label{prop_LHapprox2}
%   Let $\varphi(x)\in{\EuScript L}^{\rm p}(A)$. For every given $\tilde{\varphi}\perp\varphi$ there is some $\psi(x)\in{\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}(A)$ such that $\varphi(x)\rightarrow\psi(x)\rightarrow\neg\tilde{\varphi}(x)$.
% \end{proposition}

%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
\section{Cauchy completeness and c-models}\label{Cauchy}


For $\tau(x,z)$ a term of sort ${\sf H}^{|x|+|z|}\to {\sf I}$ we define the formula

\ceq{\hfill\emph{$x\sim_\tau y$}}{=}{\forallH z\ \ \tau(x,z)=\tau(y,z),}

where the expression $\alpha=\beta$ is shorthand for $\langle\alpha,\beta\rangle\in\Delta$, where $\Delta$ is the diagonal of $I^2$.
We also define the type 

\ceq{\hfill\emph{$x\sim y$}}{=}{\Big\{x\sim_\tau y\ :\ \tau(x,z)\textrm{ as above}\Big\}.}

% We define the following equivalence relation on $U$

% \ceq{\hfill\emph{$a\sim b$}}{=}{\forallH y\ \big[\tau(a,y)=\tau(b,y)\big]}\hfill 

% When two tuples of the same length $\bar a=\langle a_i:i<\lambda\rangle$ and $\bar b=\langle b_i:i<\lambda\rangle$ are such that $a_i\sim b_i$ for every $i<\lambda$ we write \emph{$\bar a\sim_{\sf I}\bar b$.}

\begin{fact}\label{fact_productUniformity}
  For any $a=\langle a_i:i<\lambda\rangle$ and $b=\langle b_i:i<\lambda\rangle$ 
  
  \ceq{\hfill a\sim b}{\Leftrightarrow}{a_i\sim b_i}\quad for every $i<\lambda$.
\end{fact}

\begin{proof} 
  \def\ceq#1#2#3{\parbox[t]{30ex}{$\displaystyle #1$}\parbox{4ex}{\hfil $#2$}{$\displaystyle #3$}}
  %
  Only implication $\Leftarrow$ requires a proof.
  Assume $a_i\sim b_i$ for every $i$.
  Let $|a|=|b|=\lambda$ and assume inductively that
  
  \ceq{\hfill\forallH y,z\ \ \ \tau(a,y,z)}{=}{\tau(b,y,z)}

  holds for every term $\tau(x,y,z)$, with $|x|=\lambda$ (universal quantification over the free variables is understood throughout the proof).  
  In particular for any $a_\lambda$

  \ceq{1.\hfill\forallH z\ \ \  \tau(a,a_\lambda,z)}{=}{\tau(b,a_\lambda,z).}

  As $a_\lambda\sim b_\lambda$ then

  \ceq{\hfill\forallH x,z\ \ \   \tau(x,a_\lambda,z)}{=}{\tau(x,b_\lambda,z)}

  and in particular 

  \ceq{2.\hfill\forallH z\ \ \ \tau(b,a_\lambda,z)}{=}{\tau(b,b_\lambda,z).}

  From (1) and (2) we obtain

  \ceq{\hfill\forallH z\ \ \ \tau(a,a_\lambda,z)}{=}{\tau(b,b_\lambda,z).}

  For limit ordinals induction is trivial.
\end{proof}

Note that the approximations of the formula $x\sim_\tau\!y$ have the form

\ceq{\hfill\emph{$x\sim_{\tau,D}y$}}{=}{\forallH z\ \ \langle \tau(x,z),\tau(y,z)\rangle\in D}

for some compact neighborhood $D$ of $\Delta$.
Hence we define

\ceq{\hfill\emph{$x\sim'y$}}{=}{\Big\{x\sim_{\tau,D}y\ :\ \tau(x,z)\textrm{ as above } D\textrm{ compact neigborhood of }\Delta\Big\}.}

If $\tau(x,z)=\tau_1(x,z),\dots,\tau_n(x,z)$ is a tuple of terms, by $x\sim_{\tau,D}y$ we denote the conjunction of the formulas $x\sim_{\tau_i,D}y$.

The formulas $x\sim_{\tau,D}y$, as $D$ ranges over the compact neighborhoods of $\Delta$ and $\tau(x,z)$ ranges over the finite tuples parameter-free terms, define a system of entougages on ${\EuScript U}^{|x|}$.
We refer to this uniformity and the topology associated as the \emph{$I$-topology.}
Though not needed in the sequel, it is worth mentioning that the $I$-topology on ${\EuScript U}^{|x|}$ coincides with the product of the $I$-topology on ${\EuScript U}$.
This can be verified by an argument similar to the proof of Fact~\ref{fact_productUniformity}.

\begin{fact}\label{fact_continuous}
  For every $\varphi(x)\in{\EuScript L}^{\rm c}$

  \ceq{\hfill x\sim y}{\rightarrow}{\varphi(x,\eta)\leftrightarrow\varphi(y,\eta)}
\end{fact}

\begin{proof}
  By induction on $\varphi(x,\eta)$.
  Suppose $\varphi(x,\eta)$ as the form $\tau(x,\eta)\in C$.
  Then clearly
  
  \ceq{\hfill x\sim_\tau y}{\rightarrow}{\varphi(x,\eta)\leftrightarrow\varphi(y,\eta)}

  Induction is easy.
  As an example, we spell out the proof for the quantifier $\exists^{\scriptscriptstyle\sf H}$.
  Assume inductively that
  
  \ceq{\hfill x,x'\sim y,y'}{\rightarrow}{\varphi(x,x',\eta)\leftrightarrow\varphi(y,y',\eta)}

  Then in paricular 

  \ceq{\hfill x\sim y}{\rightarrow}{\varphi(x,z,\eta)\leftrightarrow\varphi(y,z,\eta).}

  Therefore

  \ceq{\hfill x\sim y}{\rightarrow}{\exists z\,\varphi(x,z,\eta)\leftrightarrow\exists z\,\varphi(y,z,\eta).} 
\end{proof}

The following proposition corresponds to the Perturbation Lemma~\cite{HI}*{Proposition~5.15}.

\begin{proposition}\label{prop_perturbation}
  For every $\varphi(x)\in{\EuScript L}^{\rm c}({\EuScript U})$

  \ceq{\hfill x\sim y}{\rightarrow}{\big[\varphi(x)\leftrightarrow\varphi(y)\big]}
  
  hence, by compactness, for every $\varphi'>\varphi$ there are a tuple of terms $\tau$ and a compact neighborhood $D$ of $\Delta$ such that

  \ceq{\hfill x\sim_{\tau,D}\!y}{\rightarrow}{\big[\varphi(x)\rightarrow\varphi'(y)\big].}
\end{proposition}

% It is immediate that ${\EuScript L}^{\rm p}$-formulas constructed without using (ii) of Definition~\ref{def_LL} are ${\sf I}$-invariant.
We say that $p(x)\subseteq{\EuScript L}^{\rm c}({\EuScript U})$ is a \emph{Cauchy type\/} if it is consistent and $p(x)\wedge p(y)\rightarrow x\sim y$.
Equivalenltly, $p(x)$ is a Cauchy type if $p(x)\leftrightarrow a\sim x$ for some/any $a\models p(x)$.
We say that a set $A\subseteq{\EuScript U}$ is \emph{Cauchy complete\/} if $p({\EuScript U})\subseteq A^{|x|}$ for every Cauchy type $p(x)\subseteq{\EuScript L}^{\rm c}(A)$.
Note that Cauchy complete sets are in particular closed under $\sim$-equivalence.
We say that $M\subseteq{\EuScript U}$ is a \emph{c-model\/} if it is Cauchy complete and 

\ceq{{\rm c.}\hfill M\models\varphi(a)}{\Rightarrow}{\varphi(a)}
\hfill
for all formulas $\varphi(x)\in{\EuScript L}^{\rm c}$ and $a\in M^{|x|}$.

Note that ${\EuScript L}^{\rm c}$ is closed under weakening and strong negation.
Therefore the argument in the proof of Fact~\ref{fact_HImorphisms} proves that for every c-model $M$

\ceq{{\rm ac.}\hfill M\models\{\varphi(a)\}'}{\Leftrightarrow}{\{\varphi(a)\}'}
\hfill
for all formulas $\varphi(x)\in{\EuScript L}^{\rm c}$ and $a\in M^{|x|}$.

We say what a type $q(x)$ is \emph{finitely satisfiable\/} in $M$ if every conjunction of formulas in $q(x)$ has a solution in $M$.

\begin{fact}\label{fact_finsat}
  Let $M\subseteq{\EuScript L}^{\rm c}(M)$ satisfy (c) above.
  Then the following are equivalent
  \begin{itemize}
    \item[1.] $M$ is Cauchy complete, hence it is a c-model;
    \item[2.] $a\in M$ whenever $a\sim'x$ is finitely satisfied in $M$. 
  \end{itemize}
\end{fact}

\begin{proof}
  (1$\Rightarrow$2)
  Assume that $a\sim'x$ is finitely satisfied in $M$. 
  Let $a_{\tau,D}\in M$ be a solution of $a\sim_{\tau,D}x$ where $D$ ranges over the compact neighborhoods of the diagonal and $\tau(x,z)$ ranges over the finite tuples parameter-free terms.
  Then, by the uniqueness of the limit (up to $\sim$-equivalence), the type $p(x)$ containing the formulas $x\sim_{\tau,D}a_{\tau,D}$ is a Cauchy type.
  By (1), $p(x)$ is realized in $M$.
  Then all its realizations belong to $M$.
  
  (2$\Rightarrow$1)
  Let $p(x)\subseteq{\EuScript L}^{\rm c}(M)$ be a Cauchy type.
  Then $p(x)\leftrightarrow a\sim x$ for some $a\models p(x)$.
  By elementarity $p'(x)$ is finitely satisfied in $M$. 
  Then also $a\sim' x$ is finitely satisfied. 
  Then $p(x)$ is realized in $M$. 
\end{proof}

\begin{fact}\label{fact_cmodel_substr}
  Let $M$ be a c-model. Then $M$ is a substructure of ${\EuScript U}$.
\end{fact}

\begin{proof}
  Let $a\in M^{n}$ and let $f$ be a function symbol of sort ${\sf H}^{n}\to{\sf H}$.
  We prove that $fa\in M$.
  By Fact~\ref{fact_finsat}, it suffices to show that $fa\sim' x$ is finitely satisfied in $M$.
  This is the case, in fact, $\{\exists x\ fa\sim_\tau x\}'$ holds in ${\EuScript U}$ hence, by (ac), it holds also in $M$.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Elimination of quantifiers of sort \textsf{I} for continuous formulas}\label{IeliminationC}

We adapt the argument in the previous section to continuous formulas.
But first we need some definitions.

Let ${\EuScript U}/{\sim}$ be the quotient of ${\EuScript U}$ by the equivalence relation defined in Section~\ref{Cauchy}.
The equivalence class of $a\in{\EuScript U}$ is denoted by $[a]$.
A \emph{c-elementary\/} map is a (partial) map $f:{\EuScript U}/{\sim}\ \to\ {\EuScript U}/{\sim}$ such that $\varphi(a)\rightarrow\varphi(b)$ for every $\varphi(x)\in{\EuScript L}^{\rm c}$ and $a,b$ such that $f\big([a]\big)=[b]$.

The class ${\EuScript L}^{\rm c}_{{\sf I}{\rm qf}}$ and the \emph{${\EuScript L}^{\rm c}_{{\sf I}{\rm qf}}$-elementary\/} maps are defined in analogy to the respective positive variant.
An automorphism of ${\EuScript U}/{\sim}$ is a total and surjective  ${\EuScript L}^{\rm c}_{{\sf I}{\rm qf}}$-elementary map (which is also c-elementary).

For brevity we will often confuse $[a]$ with $a$.

\begin{proposition}
  All ${\EuScript L}^{\rm c}_{{\sf I}{\rm qf}}$-elementary maps of small cardinality extend to automorphisms of ${\EuScript U}/{\sim}$.
\end{proposition}

\begin{proof}
  By Fact~\ref{fact_max_cons_H}, the inverse of an ${\EuScript L}^{\rm c}_{{\sf I}{\rm qf}}$-elementary map is also ${\EuScript L}^{\rm c}_{{\sf I}{\rm qf}}$-elementary.
  Then we can extend the map by back-and-forth as usual........
\end{proof}



 
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The Tarski-Vaught test and the L\"owenheim-Skolem theorem}

The following proposition is our version of the Tarski-Vaught test.

\begin{proposition}\label{prop_Tarski_Vaught}
  Let $M$ be a subset of ${\EuScript U}$.
  Let ${\EuScript F}$ be a p-dense set of positive formulas.
  Then the following are equivalent
  \begin{itemize}
    \item[1.] $M$ is a p-model;
    \item[2.] for every formula $\psi(x)\in{\EuScript F}(M)$
    
    \noindent\kern-\leftmargin
    \ceq{\hfill\existsH x\,\psi(x)}{\Rightarrow}
    {\textrm{ for every }\psi'>\psi\textrm{ there is an }a\in M\textrm{ such that }\psi'(a);}
  
    \item[3.] for every formula $\psi(x)\in{\EuScript F}(M)$
    
    \noindent\kern-\leftmargin
    \ceq{\hfill \existsH x\,\neg\psi(x)}{\Rightarrow}
    {\textrm{ there is an }a\in M\textrm{ such that }\neg\psi(a).}
  \end{itemize}
  If $M$ is Cauchy compelte and ${\EuScript F}$ is a c-dense set of continuous formulas then (2) and (3) above are equivalent to
  \begin{itemize}
    \item[1$'$.] $M$ is a c-model.
  \end{itemize}
\end{proposition}

\begin{proof}
  (1$\Rightarrow$2) Assume $\existsH x\,\psi(x)$ and let $\psi'>\psi$ be given.
  By Lemma~\ref{lem_interpolation} there is some $\tilde{\psi}\perp\psi$ such that  $\psi(x)\rightarrow\neg\tilde{\psi}(x)\rightarrow\psi'(x)$.
  Then $\neg\forallH x\,\tilde{\psi}(x)$ hence, by (1), $M\models\neg\forallH x\,\tilde{\psi}(x)$.
  Then $M\models\neg\tilde{\psi}(a)$ for some $a\in M$. Hence $M\models\psi'(a)$ and $\psi'(a)$ follows from (1).

  (2$\Rightarrow$3)
  Assume (2) and let $\psi(x)\in{\EuScript F}(M)$ be such that $\existsH x\,\neg\psi(x)$.
  By Proposition~\ref{prop_disjunction_dense}, there are a consistent $\varphi(x)\in{\EuScript F}(M)$ and some $\varphi'>\varphi$ such that $\varphi'(x)\rightarrow\neg\psi(x)$.
  Then (3) follows.

  (2$\Rightarrow$1)
  Assume (2).
  By the classical Tarski-Vaught test $M\preceq_{\sf H}{\EuScript U}$.
  Then $M$ is the domain of a substructure of ${\EuScript U}$.
  Then $\varphi(a)\ \Leftrightarrow\ M\models\varphi(a)$ holds for every atomic formula $\varphi(x)$ and for every $a\in M^{|x|}$.
  Now, assume inductively
  
  \ceq{\hfill M\models\varphi(a,b)}{\Rightarrow}{\varphi(a,b).}

  Using (2) and the induction hypothesis we prove by contrapposition that

  \ceq{\hfill M\models\forallH y\,\varphi(a,y)}{\Rightarrow}{\forallH y\,\varphi(a,y)}.

  Indeed,

  \ceq{\hfill\neg\forallH y\,\varphi(a,y)}
  {\Rightarrow}{\existsH y\,\neg\varphi(a,y)}
  
  \ceq{}
  {\Rightarrow}{\existsH y\,\neg\varphi'(a,y)}\hfill \rlap{for some $\varphi'>\varphi$}\kern52ex
  
  \ceq{}
  {\Rightarrow}{\existsH y\,\neg\psi(a,y)}\hfill\rlap{for some $\psi\in{\EuScript F}$ such that $\varphi(a,y)\rightarrow\psi(a,y)\rightarrow\varphi'(a,y)$}\kern52ex% in every ${\EuScript L}$-structure
  
  \ceq{}
  {\Rightarrow}
  {\neg\psi(a,b)}\hfill\rlap{for some $b\in M$ by (2)}\kern52ex
  
  \ceq{}
  {\Rightarrow}
  {\neg\varphi(a,b)}
  
  \ceq{}
  {\Rightarrow}
  {M\models\neg\varphi(a,b)}\hfill\rlap{by induction hypothesis}\kern52ex

  \ceq{}
  {\Rightarrow}
  {M\not\models\forallH y\,\varphi(a,y).}

  Induction for the connectives $\vee$, $\wedge$, $\exists\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}$, $\exists\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}$, and $\forall\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}$ is straightforward.

  Finally, note that the proof of (1$\Rightarrow$2) also proves (1$'\Rightarrow$2) while the proof of (3$\Rightarrow$1) proves (3$\Rightarrow$1$'$) if we can show that $M$ is a substructure of ${\EuScript U}$.
  But this the case by Fact~\ref{fact_cmodel_substr}.
\end{proof}

% \begin{remark}
%   We will need the Tarski-Vaught test for strong p-models.
%   The classical proof yields the following:
%   if $M$ and ${\EuScript F}$ are as above, then the following are equivalent
%   \begin{itemize}
%     \item[1.] $M$ is a strong p-model;
%     \item[2.] for every formula $\psi(x)\in{\EuScript F}(M)$
    
%     \noindent\kern-\leftmargin
%     \ceq{\hfill\existsH x\,\psi(x)}{\Rightarrow}
%     {\textrm{ there is an }a\in M\textrm{ such that }\psi(a);}
   
%   \end{itemize}
% \end{remark}

Classically, the main application of the Tarski-Vaught test is in the proof of the downward L\"owen\-heim-Skolem Theorem.
Note that here the classical downward L\"owenheim-Skolem Theorem holds in full for all ${\EuScript L}$-structures.
In particular every $A\subseteq{\EuScript U}$ is contained in a standard structure of cardinality $|{\EuScript L}(A)|$.
In this form the L\"owenheim-Skolem Theorem is not very informative.
In fact, the cardinality of ${\EuScript L}$ is eccessively large because of the aboundance of symbols in ${\EuScript L}_{\sf I}$.

We say that ${\EuScript L}$ is \emph{separable\/} modulo $T$ if there is a countable set of positive formulas that is p-dense modulo $T$.
% In Section~\ref{separability} we will present examples of separable p-models.

\begin{proposition}\label{prop_disjunction_dense}
  Assume that ${\EuScript L}$ is separable modulo the theory of ${\EuScript U}$.
  Let $A\subseteq{\EuScript U}$ be countable.
  Then there is a countable p-model $M$ containing $A$.
  (The size of a p-model is the size of the domain of its home sort.)
\end{proposition}

\begin{proof}
  As in the classical proof of the L\"owenheim-Skolem Theorem,
  we construct $M\subseteq{\EuScript U}$ that contains a witness for every consistent formula in ${\EuScript F}(M)$.
  By separability and Proposition~\ref{prop_Tarski_Vaught}, $M$ is a p-model.
\end{proof}

\begin{proposition}
  Assume that ${\EuScript L}_{\sf H}$ is countable and that ${\EuScript L}$ has at most countably many symbols of sort ${\sf H}^n\to {\sf I}$.
  Then, if $I$ is a second countable (the topology has a countable base), ${\EuScript L}$ is separable modulo ${\EuScript L}$.
\end{proposition}

\begin{proof}
  Fix a countable filter of compact neighborhoods of the diagonal of ${\sf I}^2$.  
\end{proof}



% The \emph{weight\/} of ${\EuScript L}$, which we denote by \emph{${\rm wgt}\big({\EuScript L}\big)$\/} is the minimal cardinality of a set of formulas ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}'$ such that for every $\varphi''>\varphi\in{\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$ there is a $\varphi'\in{\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}'$ such that $\varphi''>\varphi'>\varphi$.
% If this minimal cardinality is $\omega$, we say that ${\EuScript L}$ is sparable. 
% It is not difficult to see that when $I$ is the real unit interval and ${\EuScript L}$ contains at most countably many symbols of sort ${\sf H}^n\to{\sf I}$ then ${\EuScript L}$ is separable.

% \begin{proposition}
%   Let $A\subseteq U$.
%   Then  $A$ is contained in a p-model of cardinality at most ${\rm wgt}\big({\EuScript L}\big)+|A|$.  
% \end{proposition}

% \begin{proof}
%   As in the classical L\"owenheim-Skolem Theorem, using (2) of Proposition~\ref{prop_Tarski_Vaught}.
% \end{proof}


% \begin{proposition}
%   The following are equivalent
%   \begin{itemize}
%     \item[1.] ${\EuScript L}$ is separable;
%     \item[2.] there is an ${\EuScript L}$-structure $\langle M_0,R_0\rangle\preceq{\EuScript U}$ with $|M_0|=|R_0|=\omega$.
%   \end{itemize}  
% \end{proposition}




%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Positive omitting types.}

\def\ceq#1#2#3{\parbox[t]{30ex}{$\displaystyle #1$}\parbox{4ex}{\hfil $#2$}{$\displaystyle #3$}}

A type $p(x)$ is \emph{weakly isolated\/} by $\varphi(x)$, a consistent positive formula, if for every $\psi(x)\in p$ there is some $\varphi'>\varphi$ such that $\varphi'(x)\rightarrow\psi(x)$.
If $p(x)$ is weakly isolated by some $\varphi(x)\in{\EuScript L}^{\rm p}(A)$ we say that it is weakly isolated by $A$.
% When $A$ is clear from the context (e.g., when $p(x)$ is presented as a type over $A$) we say simply p-isolated. 
% Note that, by Propsition~\ref{prop_Tarski_Vaught}, if $p(x)$ is p-isolated over $A$, then $p(x)$ is realized in every p-model containing $A$.

\begin{proposition}\label{prop_isolation}
  Let ${\EuScript F}$ be a p-dense set of positive formulas.
  Then the following are equivalent
\begin{itemize}
  \item[1.] $p(x)$ is p-isolated over $A$;
  \item[2.] $p(x)$ is isolated by $\neg\psi(x)$ for some $\psi(x)\in{\EuScript F}(A)$;
  \item[3.] $p(x)$ is isolated by some $\psi'(x)$ such that  $\psi'>\psi$ for some consistent $\psi(x)\in{\EuScript F}(A)$;
  \item[4.] $p(x)$ is isolated by some formula $\varphi(x)\in\Sigma^{\rm p}(A)$.
\end{itemize}
\end{proposition}

\begin{proof}
  (1$\Rightarrow$2) By density

  \ceq{\hfill\varphi(x)}
  {\leftrightarrow}
  {\bigwedge\big\{\psi(x)\in{\EuScript F}\ :\ \varphi(x)\rightarrow\psi(x)\big\}}
  
  therefore, negating both sides of the equivalence,
  
  \ceq{\hfill\neg\varphi(x)}
  {\leftrightarrow}
  {\bigvee\big\{\neg\psi(x)\ :\ \psi(x)\in{\EuScript F}\textrm{ and }\neg\psi(x)\rightarrow\neg\varphi(x)\big\}.}

  If $\neg\varphi(x)$ isolates $p(x)$ then any consistent formula in the disjunction on the l.h.s.\@ also isolates $p(x)$.
  
  (1$\Rightarrow$3) Recall that ${\EuScript F}'$ is p-dense by Fact~\ref{fact_Fdense}.
  Apply Proposition~\ref{prop_Fapprox} with ${\EuScript F}'$ for ${\EuScript F}$.

  (3$\Rightarrow$4) Trivial.

  (4$\Rightarrow$1) By Proposition~\ref{prop_Sigma_approx}.
\end{proof}


\begin{lemma}\label{lem_kuratowskiUlam}
Let ${\EuScript L}$ be separable and let $A$ be countable.
Assume that $p(x)\subseteq{\EuScript L}^{\rm p}(A)$ is not p-isolated over $A$.
Then every consistent formula $\neg\psi(z)$, with $\psi(z)\in{\EuScript L}^{\rm p}(A)$, has a solution $a$ such that $p(x)$ is not isolated over $A,a$.
\end{lemma}
\begin{proof}
We construct a sequence of ${\EuScript L}^{\rm p}(A)$-formulas $\langle\gamma_i(z):i<\omega\rangle$ such that any realization $a$ of the type $\big\{\gamma_i(z):i<\omega\big\}$ is the required solution of $\neg\psi(z)$.

Let $\langle\xi_i(x\,;z):i<\omega\rangle$ enumerate a countable p-dense subset of ${\EuScript L}^{\rm p}_{x\,;z}(A)$.
Let $\gamma_0(z)$ be a consistent positive formula such that $\gamma_0(z)\rightarrow\neg\psi(z)$, which exists by Proposition~\ref{prop_Fapprox}.
Define $\gamma_{i+1}(z)$ inductively as follows.

\begin{itemize}
   \item[1.] If $\xi_i(x\,;z)\wedge\gamma_i(z)$ is inconsistent, let $\gamma_{i+1}(z)=\gamma_i(z)$;
   \item[2.] otherwise, pick $\varphi(x)\in p$ such that (\#) below is consistent
   
   (\#)\hfil$\gamma_i(z)\ \wedge\ \exists x\,\big[\xi_i(x\,;z)\wedge\neg\varphi(x)\big].$\kern19ex
   
   Finally, let $\gamma_{i+1}(z)$ be a consistent positive formula that implies (\#).
   Such a formula exists by Proposition~\ref{prop_Sigma_approx}.
\end{itemize}
Let $a\models\{\gamma_i(z):i<\omega\}$.
We claim that that $A,a$ does not weakly isolate $p(x)$.
Otherwise, by density and Fact~\ref{fact_Fdense}, some $\xi_i(x\,;a)$ would weakly isolate $p(x)$.
This contradicts $a\models\gamma_{i+1}(z)$.

Therefore the proof is complete if we can show that it is always possible to find the formula $\varphi(x)$ required in (2).

Suppose for a contradiction that $\neg\xi_i(x\,;z)\wedge\gamma'_i(z)$ is consistent while (\#) is inconsistent for all formulas $\varphi(x)\in p$, that is, 

\ceq{\hfill\neg\xi_i(x\,;z)\wedge\gamma'_i(z)}{\rightarrow}{\varphi(x).} 

This immediately implies that 

\ceq{\hfill\exists z\;\big[\neg\xi_i(x\,;z)\wedge\gamma'_i(z)\big]}{\rightarrow}{p(x).}

Then $p(x)$ is isolated by a formula in $\Sigma^{\rm p}(A)$.
By Proposition~\ref{prop_isolation}, this is a contradiction.
\end{proof}

\begin{theorem}[Positive Omitting Types]\label{prop_OTT}
  Assume that ${\EuScript L}$ is separable and that $A$ is countable.
  Assume also that $p(x)\subseteq{\EuScript L}(A)$ is not p-isolated.
  Then there is a p-model $M$ containing $A$ that omits $p(x)$. 
\end{theorem}

\begin{proof}
  As in the classical proof, appy the lemma above and the Tarski-Vaught test (Proposition~\ref{prop_Tarski_Vaught}) to obtain a countable p-model $M$ that does not isolate $p(x)$.
  For p-models, isolating and realizing are equivalent.
  % As in the classical proof we construct $M\subseteq{\EuScript U}$ that contains a witness for every consistent formula in ${\EuScript F}(M)$.
  % By separability and Proposition~\ref{prop_Tarski_Vaught}, $M$ is a p-model.
\end{proof}

Assume that ${\EuScript L}$ is separable modulo $T$.
A theory $T$ is \emph{positively $\omega$-categorical\/} if any two countable p-models $M,N\models T$ are isomorphic.
The following analogue of Ryll-Nardzewski's Theorem follows as usual.

\begin{theorem}
  Assume that ${\EuScript L}$ is separable modulo $T$.
  The following are equivalent
  \begin{itemize}
    \item[1.] $T$ is positively $\omega$-categorical;
    \item[2.] every positive type $p(x)\subseteq{\EuScript L}^{\rm p}$, for $x$ any finite tuple of variables, is p-isolated over $\varnothing$.
  \end{itemize}
\end{theorem}

The classical argument proves also the following.

\begin{proposition}
  Fix a finite tuple of variables $x$.
  The following are equivalent
  \begin{itemize}
    \item[1.] every positive type $p(x)\subseteq{\EuScript L}^{\rm p}(A)$ is p-isolated over $A$;
    \item[2.] there are finitely many complete types.
  \end{itemize}
\end{proposition}

\begin{proof}
  (1$\Rightarrow$2) 
  Let $p_i(x)=\mbox{p-tp}(a_i/A)$, for $i<\lambda$, be an enumeration without repetitions of all positive types.
  Let $\neg\varphi_i(x)$ be the negative formulas that isolate the $p_i(x)$.
  As these are complete types, $\neg\varphi_i(x)\leftrightarrow p_i(x)$.
  If $\lambda$ is infinite then the positive type $\{\varphi_i(x):i<\lambda\}$ is consistent.
  Any realization of this type yield a contradiction.

  (2$\Rightarrow$1)
  Let $p_i(x)=\mbox{p-tp}(a_i/A)$, for $i<n$, be an enumeration without repetitions of all positive types.
  Pick a formula $\varphi_i(x)\in p_i\smallsetminus\bigcup\big\{ p_j : j\in n\smallsetminus\{i\}\big\}$.
  Then the formula $\neg\bigvee\big\{\varphi_i(x):j\in n\smallsetminus\{i\}p\big\}$ isolates $p_i(x)$.
\end{proof}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Example: metric spaces}

We discuss a simple example.
Let $I$ be $\mathds{R}^+\cup\{0,\infty\}$, with the topology that makes it homeomorphic to the unit interval.
Let $M,d$ is a metric space.
Let ${\EuScript L}_{\sf H}$ contain symbols for functions $M^n\to M$ that are uniformly continuous.
Let ${\EuScript L}$ contain a symbol for $d$ and possibly for some funtions of $M^n\to I$ that are uniformly continuous w.r.t.\@ the metric $d$.

Let $\langle M,I\rangle$ be the structure that interprets the symbols of the language as natural.

Let ${\EuScript U}$ be a positive monster model that is  an ${\EuScript L}^{\rm p}$ elementary extension of $M$.
Clearly, $d$ does not define a metric on ${\EuScript U}$ as there are pairs of elements at infinite distance.
However, when restricted to a ball of finite radius, $d$ defines a pseudometric on ${\EuScript U}$.
Therefore the notion of convergent sequence makes perfectly sense in ${\EuScript U}$.
As all functions have been required to be uniformly continuous, it is immediate that $x\sim_{\sf I}y$ is equivalent to $d(x,y)=0$.

\begin{fact}
  Let $ {\EuScript U}$ be as above.
  Then for every p-model $N$ and $a\in{\EuScript U}$ the following are equivalent
  \begin{itemize}
    \item[1.] $p(x)=\mbox{p-tp}(a/N)$ is a Cauchy type;
    \item[2.] there is a sequence $\langle a_i: i\in\omega\rangle$ of elements of $N$ that converges to $a$.
  \end{itemize} 
\end{fact}

\begin{proof}

  (2$\Rightarrow$1) 
  Let $\langle \varepsilon_i: i\in\omega\rangle$ be a sequence of reals that converges to $0$ and such that $d(a_i,a)\le\varepsilon_i$ for every $i\in\omega$.
  Then the formulas $d(a_i,x)\le\varepsilon_i$ are in $p(x)$.
  Then every element realizing $p(x)$ is at distance $0$ from $a$.
  Therefore  $p(x)\rightarrow a\sim x$.

  (1$\Rightarrow$2) 
  As $p(x)$ is Cauchy type, $p(x)\rightarrow a\sim x$.
  Then $p'(x)\rightarrow d(a,x)<2^{-i}$ for all $i$.
  By compactness (see Fact~\ref{fact_compactness_imp}) there are formulas $\varphi_i(x)\in p$ such that $\varphi'_i(x)\rightarrow d(a,x)<2^{-i}$ for some $\varphi'_i>\varphi_i$.
  By ${\EuScript L}^{\rm p}$-elementarity there is an $a_i\in N$ such that $\varphi'(a_i)$.
  As $d(a,a_i)<2^{-i}$ for all $i$, the sequence $\langle a_i: i\in\omega\rangle$ converges to $a$.
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Continuous group actions}
% Let $M$ be a topological space.
% Let $G\le{\rm Homeo}(M)$ be a subgroup closed in the topology of the pointwise convergence.
% Then there is a compact topological space $I$ and a p-model ${\EuScript M}=\langle M,I\rangle$ such that ${\rm Aut}({\EuScript M})$ is isomorphic to $G$ as a topological group.

% Assume $M$ is compact, or otherwise substitute it with its Stone-Chech compactification.
% Consider $M^\omega$ as a topological space with the product topology.
% Let $G$ acts on $M^\omega$ coordinatewise. 
% Let $I$ be the set containing the topological closures of the $G$-orbits of elements of $M^\omega$, in notation this is the set $\big\{{\rm cl}(Ga):a\in M^\omega\big\}$.

% % First note that we can embed $M^{<\omega}$ into $M^\omega$, namely we map the tuple  $\langle a_1,\dots,a_n\rangle$, to the sequence  $\langle a_1,\dots,a_n^\omega\rangle$, where $a_n^\omega$ stands for an infinite sequence with constant value $a_n$.

% Let ${\EuScript M}=\langle M,I\rangle$.
% The language ${\EuScript L}_{\sf H}$ is empty while ${\EuScript L}$ contains symbols for the functions

% \ceq{\hfill \pi^n\ :\ M^n}{\to}{I}

% \ceq{\hfill (a_1,\dots,a_n)}{\mapsto}{{\rm cl}\big(G(a_1,\dots,a_n^\omega)\big)},

% Where $a_n^\omega$ stands for the element $a_n$ repeated $\omega$-times.
% We claim that the $I$-topology on $M$ coincides with its original topology.
% There is a natural embedding of $G$ into ${\rm Aut}({\EuScript M})$.
% Let $\gamma\in{\rm Aut}({\EuScript M})$ we claim that for every $a_1,\dots,a_n$ and every there is a $g\in G$ such that $\tau_{t,C}(\gamma(a),ga)$




%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
\newcommand\biburl[1]{\url{#1}}
\BibSpec{arXiv}{%
  +{}{\PrintAuthors}{author}
  +{,}{ \textit}{title}
  +{}{ \parenthesize}{date}
  +{,}{ arXiv:}{eprint}
  % +{,}{ \url}
}

\begin{bibdiv}
\begin{biblist}[]\normalsize

\bib{G}{article}{
  label={G},
  author = {Goldbring, Isaac},
  title = {Lecture notes on nonstandard analysis},
  conference={
    title={UCLA Summer School in Logic 2012}
   },
  eprint = {www.math.uci.edu/~isaac/NSA\%20notes.pdf},
}

\bib{H}{arXiv}{
  label={H},
  author = {Hart, Bradd},
  title = {An Introduction To Continuous Model Theory},
  eprint={2303.03969},
  doi = {10.48550/arXiv.2303.03969},
  url = {https://arxiv.org/abs/},
  publisher = {arXiv},
  date = {2023},
}

\bib{Hr}{article}{
   label={Hr},
   author={Hrushovski, Ehud},
   title={Stable group theory and approximate subgroups},
   journal={J. Amer. Math. Soc.},
   volume={25},
   date={2012},
   number={1},
   pages={189--243},
   %issn={0894-0347},
   %doi={10.1090/S0894-0347-2011-00708-X},
}

\bib{HPP}{article}{
   label={HPP},
   author={Hrushovski, Ehud},
   author={Peterzil, Ya'acov},
   author={Pillay, Anand},
   title={Groups, measures, and the NIP},
   journal={J. Amer. Math. Soc.},
   volume={21},
   date={2008},
   number={2},
   pages={563--596},
  %  issn={0894-0347},
  %  review={\MR{2373360}},
  %  doi={10.1090/S0894-0347-07-00558-9},
}

\bib{HI}{article}{
  label={HI},
  author={Henson, C. Ward},
  author={Iovino, Jos\'{e}},
  title={Ultraproducts in analysis},
  conference={
    title={Analysis and logic},
    address={Mons},
    date={1997},
   },
   book={
      series={London Math. Soc. Lecture Note Ser.},
      volume={262},
      publisher={Cambridge Univ. Press, Cambridge},
   },
   date={2002},
   pages={1--110},
  %  review={\MR{1967834}},
}

\bib{clcl}{article}{
  label={CLCL},
  author = {Polymath, C.L.C.L.},
  title = {Continuous Logic for the Classical Logician},
  note={T.a.},
  date = {202?},
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Continuous group actions}
\end{biblist}
\end{bibdiv}


% \end{document}

\vskip5ex

\hfil\dangersign[8ex]
%%%%%%%%%%%%%%
%\noindent\llap{\dangersign}\kern1ex\ignorespaces

\hfil Danger after this point
\vskip10ex


%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
\section{Elimination of quantifiers}

Let $T$ be a positive theory.
We say that $T$ has (approximate, positive) elimination of quantifiers if the quantifier-free positive formulas are p-dense modulo $T$.
Equivalently, if every complete type is equivalent to a quantifier-free positive types.

%for every $\varphi(x)\in{\EuScript L}^{\rm p}$ and every $\varphi'>\varphi$ there is a formula $\psi(x)\in{\EuScript L}^{\rm p}$ without quantifiers of sort ${\sf H}$ such that $\varphi(x)\rightarrow\psi(x)\rightarrow\varphi'(x)$ holds modulo $T$.

The following fact is routinely proved by back-and-forth.

\begin{fact}\label{fact_backandforth}
  The following are equivalent
  \begin{itemize}
    \item[1.] $T$ has elimination of quantifiers;
    \item[2.] every finite partial embedding $k:M\to N$ beween p-models of $T$ is an approximate p-elementary map;
    \item[3.]  for every finite partial embedding $k:M\to N$ between $\omega$-saturated p-models of $T$, and for every $b\in M$ there is a $c\in N$ such that $k\cup\{\langle b,c\rangle\}:M\to N$ is also a partial embedding.
  \end{itemize}
\end{fact}



%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
\section{Pseudofinite randomizations}

\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\parbox[t]{6ex}{$\displaystyle\hfil #2$}{$\displaystyle #3$}}

Let $T$ be a complete first-order theory of signature $L$ with an infinite model.
Let ${\EuScript U}$ be a model of $T$.
Let $\Omega$ be a finite set.
We denote by ${\EuScript U}^\Omega$ the set of functions $\Omega\to{\EuScript U}$.
The elements of ${\EuScript U}^\Omega$ are denoted by letters decorated with a circonflexe accent $\hat a,\hat b,$ etc.
The value of $\hat a$ at $\omega\in\Omega$ is denoted by $a_\omega$.
We now define models of the form $\langle{\EuScript U}^\Omega, I\rangle$, where $I$ is the real interval $[0,1]$ with the usual topology.

The language ${\EuScript L}_{\sf H}$ is empty.
The language ${\EuScript L}$ contains functions of sort ${\sf H}^{|x|}\to{\sf I}$, one for each formula $\varphi(x)\in L$.
These are denoted by $\Pr\varphi(\hat x)$. 
Variables of sort ${\sf H}$ are decorated with a circonflexe accent.
The interpretation of the function symbol $\Pr\varphi(\hat x)$ is 

\ceq{\hfill\Pr\big(\varphi(\hat a)\big)}
{=}
{\frac{\#\llbracket\varphi(\hat a)\rrbracket}{\#\Omega},}

where by $\#$ denotes the finite cardinality, and

\ceq{\hfill\llbracket\varphi(\hat a)\rrbracket}{=}{\big\{\omega\in\Omega\ :\ {\EuScript U}\models\varphi(a_\omega)\big\}.}

The pseudofinite randomization of $T$ is the positive theory

\ceq{\hfill T^{\rm pfr}}
{=}
{\Big\{\varphi\in{\EuScript L}^{\rm p}\ :\ \langle{\EuScript U}^\Omega, I\rangle\models\varphi\textrm{ for all sufficiently large finite set }\Omega\Big\}}

In this section we prove that $T^{\rm pfr}$ is a compete theory with elimination of quantifiers.
We prove the lemma that is required for the back-and-forth.

\begin{lemma}
  Let $k:M\to N$ be a finite partial embedding between positively $\omega$-saturated models of $T^{\rm pfr}$.
  Then for every $\hat b\in M$ and there is a $\hat c\in N$ such that $k\cup\{\langle\hat b,\hat c\rangle\}:M\to N$ is a partial embedding.
\end{lemma}

\begin{proof}
  Let $\hat a$ be an enumeration of ${\rm dom} k$.
  Let $p(\hat x,\hat z)$ be set of formulas of the form $\gamma=\Pr\varphi(\hat x,\hat z)$, for some $\gamma\in I$, that hold in $M,\hat b,\hat a$.
  Note that $p(\hat x,\hat z)$ implies the atomic type of $\hat b,\hat a$ in $M$.
  Therefore it suffices to show that $p(\hat x,k\hat a)$ is finitely consistent in $N$.

  Pick a finite set of these formulas, say $\gamma_i=\Pr\varphi_i(\hat x,\hat z)$, for $i<n$.
  Me may assume that the fomulas $\varphi_i(x,z)$ define a partition of ${\EuScript U}^{|x,z|}$.
  By the saturation of $N$, it suffices to prove that for every $\varepsilon>0$ there is a $\hat c\in N$ such that
  
  \ceq{\hfill\gamma_i}{=_\varepsilon}{\Pr\varphi_i(\hat c,k\hat a)}\hfill ($\alpha=_\varepsilon\beta$ is a shorthand for $|\alpha-\beta|\le\varepsilon$)
  
  is true in $N$ for all $i<n$.
  
  Some preliminary work is required.
  For each $J\subseteq n$ define the following $L$-formulas

  \ceq{\hfill \xi_J(z)}{=}{\bigwedge_{i\in J}\exists x\;\varphi_i(x,z)\wedge\bigwedge_{i\in n\smallsetminus J}\neg\exists x\;\varphi_i(x,z)}

  These formulas $\xi_J(z)$ partition ${\EuScript U}^{|z|}$.
  For $J\subseteq n$ let $\alpha_J$ be such that 
  
  \ceq{2.\hfill\alpha_J}{=}{\Pr\big(\xi_J(\hat z)\big)}
  
  is in $p(\hat x,\hat z)$.
  Let ${\EuScript J}=\{J\subseteq n\ :\ \alpha_J\neq0\}$. 
  When $J\in{\EuScript J}$, there are some $\beta_{i,J}$ such that the formulas

  \ceq{3.\hfill \beta_{i,J}}{=}{\Pr\bigg(\varphi_i(\hat x,\hat z)\ \Big|\ \xi_J(\hat z)\bigg).}

  are are among the consequences of $p(\hat x,\hat z)$.
  As the formulas $\varphi_i(x,z)$ define a partition, the $\beta_{i,J}$ add up to $1$ for any fixed $J$.
  Note that $\beta_{i,J}=0$ for $i\notin J$.
  Clearly, have that 

  \ceq{4.\hfill \gamma_i}{=}{\sum_{J\in{\EuScript J}}\beta_{i,J}\alpha_J.}

  It is plain that for $i\in J$ the following is a consequence of $p(\hat x,\hat z)$

  \ceq{5.\hfill 1}{=}{\Pr\bigg(\exists x\,\varphi_i(x,\hat z)\ \Big|\ \xi_J(\hat z)\bigg)}

  Now we prove that (2) \& (5) $\Rightarrow$ (1) holds in ${\EuScript U}^\Omega$ when $\Omega$ large enough (larger than $n/\varepsilon$ suffices).
  Strictly speaking, this implication is not a positive formula, but the reader can easily verify that a suitable approximation of (2) and (5) suffices. 
  
  Let $\hat a'\in{\EuScript U}^\Omega$ satisfy (2) and (5) for every $i\in J\subseteq n$. 
  We define $\hat c'\in{\EuScript U}^\Omega$ such that 
  
  \ceq{\hfill{\EuScript U}^\Omega}{\models}{\beta_{i,J}=_\varepsilon\Pr\bigg(\varphi_i(\hat c',\hat a')\ \Big|\ \xi_J(\hat a')\bigg).}
  
  We may define $\hat c'$ separately in each event $\llbracket\xi_J(\hat a')\rrbracket$.
  Partition $\llbracket\xi_J(\hat a')\rrbracket$ into events $E_i\subseteq\Omega$, for $i\in J$, such that $\# E_i/\#\Omega=_\varepsilon\beta_{i,J}$.
  Then define $c'_\omega$ for $\omega\in E_i$ to be any witness of $\exists x\,\varphi_i(x,a_\omega)$.
  By (5), we can always find such a witness.
  
  Finally, by (4), we deduce

  \ceq{\hfill{\EuScript U}^\Omega}{\models}{\gamma_i=_\varepsilon\Pr\big(\varphi_i(\hat c',\hat a')\big).}

  As $k\hat a$ satisfy (2) and (5), we conclude that some $\hat c\in N$ satisfy (1).
\end{proof}

Now, from Fact~\ref{fact_backandforth} we obtain that $T^{\rm pfr}$ has elimination of quantifiers.
Completeness follows.

\begin{corollary}
  The theory  $T^{\rm pfr}$ is compete and has elimination of quantifiers.
\end{corollary}
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
\section{Stability}

A partitioned formula $\varphi(x\,;z)\in{\EuScript L}^{\rm p}$ is stable if there is no sequence $\langle a_i\,;b_i\,:\,i<\omega\rangle$ and no $\tilde\varphi\perp\varphi$ such that for every $i,j<\omega$

\ceq{\hfill i<j}{\Rightarrow}{\varphi(a_i\,;b_j)}

\ceq{\hfill i>j}{\Rightarrow}{\tilde\varphi(a_i\,;b_j)}

Using the terminology of~\cite{Hr}, $\varphi(x\,;z)$ is stable if it is stably separated from all $\tilde\varphi\perp\varphi$.

Note that by compactness if $\varphi(x\,;z)$ and $\tilde\varphi\perp\varphi$ are stably separated then there is a maximal length $m$ of a sequence $\langle a_i\,;b_i\,:\,i<m\rangle$ such that (1) and (2) above.

%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
\section{Elementary relations}

Let $M$ and $N$ be models.
We say that $R\subseteq M\times N$ is an \emph{p-elementary relation\/} between $M$ and $N$ if for every $\varphi(x)\in{\EuScript L}$

\ceq{\hfill M\models\varphi(a)}{\Rightarrow}{N\models\varphi(b)}\hfill for every $a$ and $b$ such that $a\mathbin{R}b$.

Note that, when $a=a_1,\dots,a_n$ and $b=b_1,\dots,b_n$ are tuples, $a\mathbin{R}b$ stands for $a_i\mathbin{R}b_i$ for every $i\in\{1,\dots,n\}$.

\begin{fact}
  Let $R\subseteq{\EuScript U}^2$ be an p-elementary relation of cardinality $<\kappa$.
  Then there is a total and surjective p-elemenrary relation $S\subseteq{\EuScript U}^2$ containing $R$.
\end{fact}

\begin{proof}
  We apply the usual back-and-forth construction with a pinch of extra caution.
  Let $a$ be an enumeration of the domain of $R$.
  Let $\bar a=\langle a_i:i<\lambda\rangle$ be an enumeration of all tuples of length $|a|$ such that $aRa_i$.
  As $\kappa$ is inaccessible, $\lambda<\kappa$.
  Let $b\in U$.
  It suffices to prove that there is a $c$ such that $R\cup\{\langle b,c\rangle\}$ is an $\mathds{L}$-relation.
  Let $p(x,z)={\rm tp}(b,a)$ and let
  
  \ceq{\hfill q(x,\bar z)}{=}{\bigcup_{i<\lambda}p(x,z_i).}

  We claim that $q(x,\bar a)$ is a finitely consistent type.
  A finite conjunction of formulas in $q(x,\bar a)$ has the form $\psi(x,a_{i_1})\wedge\dots\wedge\psi(x,a_{i_n})$.
  As $\psi(b,a)$ and $a_{i_1},\dots,a_{i_n}\,R\;a,\dots,a$, we conclude that the condition $\psi(x,a_{i_1})\wedge\dots\wedge\psi(x,a_{i_n})$ is satisfied.
  The existence of the required element $c$ follows by saturation.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
\section{}

\begin{corollary}
  Let $A\subseteq{\EuScript U}$ have cardinality $<\kappa$.
  Let $p(x)={\rm tp}_\mathds{L}(a/A)$, where $a\in{\EuScript U}^{|x|}$ is a tuple of length $|x|<\kappa$.
  Then

  \ceq{\hfill p({\EuScript U})}{=}{\big\{b : bRa,\ R\in{\rm Aut}({\EuScript U}/A)\big\}}
\end{corollary}



Let ${\EuScript M}$ and ${\EuScript N}$ be models.
We say that $R\subseteq M\times N$ is an \emph{$\mathds{L}$-(elementary) relation\/} between ${\EuScript M}$ and ${\EuScript N}$ (or on ${\EuScript M}$ if the two coicide) if for every $\varphi(x)\in\mathds{L}$

\ceq{\hfill{\EuScript M}\models\varphi(a)}{\Leftrightarrow}{{\EuScript N}\models\varphi(b)} \hfill for every $a$ and $b$ such that $a\mathbin{R}b$.

Recall that, when $a=a_1,\dots,a_n$ and $b=b_1,\dots,b_n$ are tuples, $a\mathbin{R}b$ stands for $a_i\mathbin{R}b_i$ for every $i\in\{1,\dots,n\}$.

We define an equivalence relation \emph{$(\sim_{\EuScript M})$\/} on $ M$ as follows

\ceq{1.\hfill a\,\sim_{\EuScript M\!}b}
{\Leftrightarrow}
{\Big({\EuScript M}\models\varphi(a)\leftrightarrow\varphi(b)}
\ \ for every $\varphi(x)\in\mathds{L}( M)\Big)$,

where $|x|=|a|=|b|=1$.
Note that this relation would be trivial had we included  in $\mathds{L}(M)$ equality between elements of $M$.

The following proposition is easily proved by induction on the syntax. 

\begin{proposition}
  The following are equivalent for every $a,b\in M$.
  \begin{itemize}
    \item[1.] $a\equiv_{\EuScript M}b$;
    \item[2.] ${\EuScript M}\models \tau(a)=\tau(b)$ for every $\tau(x)\in\mathds{T}(M)$, with $|x|=1$.
  \end{itemize}
\end{proposition}

\begin{lemma}
  The relation $(\sim_{\EuScript M\!})\subseteq  M^2$ is an $\mathds{L}$-relation.
  Moreover, it is maximal among the $\mathds{L}$-relations on ${\EuScript M}$, i.e.\@ no $\mathds{L}$-relation properly contains $(\sim_{\EuScript M\!})$.
\end{lemma}

\begin{proof}
  Assume $a\sim_{\EuScript M\!}b$, where $a=a_1,\dots,a_n$ and $b=b_1,\dots,b_n$.
  Recall that this means that $a_i\sim_{\EuScript M\!}b_i$ for all $i\in\{1,\dots,n\}$.
  Let $\Delta$ denote the diagonal relation on $ M$.
  Note that $a_i\sim_{\EuScript M\!}b_i$ is equivalent to saying that $\Delta\cup\{(a_i,b_i)\}$ is an $\mathds{L}$-relation.
  As $\mathds{L}$-relations are closed under composition $\Delta\cup\big\{(a_1,b_1),\dots,(a_n,b_n)\big\}$ is $\mathds{L}$-elementary.
  It follows that for every $\varphi(x)\in\mathds{L}$

  \ceq{2.\hfill{\EuScript M}\models\varphi(a)}{\Leftrightarrow}{{\EuScript M}\models\varphi(b).}
  
  This proves that $(\sim_{\EuScript M\!})$ is an $\mathds{L}$-relation.
  Finally, maximality is immediate.
  % Suppose $E$ and equivalence $\mathds{L}$-relation on ${\EuScript M\!}$ properly containing $(\sim_{\EuScript M\!})$.
  % Pick $a,b\in M$ such that $a\mathbin{E}b$ and $a\not\sim_{\EuScript M\!}b$.
\end{proof}


\begin{lemma}
  Let $R\subseteq  M\times N$ be total and surjective $\mathds{L}$-relation.
  Then there is a unique maximal $\mathds{L}$-relation containing $R$.
  This maximal $\mathds{L}$-relation is equal to both $(\sim_{\EuScript M\!})\,R$ and $R\,(\sim_{\EuScript N\!})$, where justapposition of relations stands for composition.
\end{lemma}
\begin{proof}
  It is immediate to verify that $(\sim_{\EuScript M\!})\,R$ is an $\mathds{L}$-relation containing $R$.
  Let $S$ be any maximal $\mathds{L}$-relation containing $R$.
  By maximality, $(\sim_{\EuScript M\!})\,S=S$.
  As $S$ is a total relation $(\sim_{\EuScript M\!})\subseteq SS^{-1}$.
  Therefore, by the lemma above, $(\sim_{\EuScript M\!})=SS^{-1}$.
  As $R$ is a surjective relation, $S\subseteq S\,S^{-1}R$.
  Finally, by maximality, we conclude that $S=(\sim_{\EuScript M\!})\,R$.
  A similar argument proves that $S=R\,(\sim_{\EuScript N\!})$.
\end{proof}

We write ${\rm Aut}({\EuScript M})$ for the set of maximal, total and surjective, $\mathds{L}$-relations $R\subseteq  M^2$.
The choice of the symbol Aut is motivated by the lemma above.
In fact any such relation $R$ induces a unique automorphism on the (properly defined) quotient structure ${\EuScript M}/{\sim_{\EuScript M\!}}$.

\end{document}