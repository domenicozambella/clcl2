\documentclass{amsproc}

\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{comment}
\usepackage[alphabetic]{amsrefs}
\usepackage{tikz}
\usepackage{xcolor}
\usepackage{datetime2} 
\usepackage[colorlinks=true,linkcolor=blue,]{hyperref}

\usepackage{stackengine}
\usepackage{scalerel}
\usepackage{mathtools}
\usepackage{calc}
\usepackage{amsthm}
\usepackage{thmtools}
\usepackage[framemethod=TikZ]{mdframed}
\usepackage{amssymb}
\usepackage{amsfonts}
\usepackage{euscript}
% \def\EuScript#1{\mathscr#1}
\usepackage{fourier-otf}
% \usepackage{palatino}
% \usepackage{mathpazo} % add possibly `sc` and `osf` options
%\usepackage{eulervm}
%\usepackage{bbm}
%\usepackage{latexsym}
% \usepackage{mathrsfs}
% \usepackage{stmaryrd}
% \usepackage{stix}
\def\dotminus{\stackon[.2ex]{$-$}{$.$}}
% \def\wneg{\stackon[-.2ex]{$\neg$}{$\neg$}}
\usepackage{dsfont}
% \newcommand*{\TakeFourierOrnament}[1]{{%
% \fontencoding{U}\fontfamily{futs}\selectfont\char#1}}
% \renewcommand*{\danger}{\TakeFourierOrnament{66}}
\parindent0ex
\parskip1.2ex
% \makeatletter
% \DeclareOldFontCommand{\rm}{\normalfont\rmfamily}{\mathrm}
% \DeclareOldFontCommand{\sf}{\normalfont\sffamily}{\mathsf}
% \DeclareOldFontCommand{\tt}{\normalfont\ttfamily}{\mathtt}
% \DeclareOldFontCommand{\bf}{\normalfont\bfseries}{\mathbf}
% \DeclareOldFontCommand{\it}{\normalfont\itshape}{\mathit}
% \DeclareOldFontCommand{\sl}{\normalfont\slshape}{\@nomath\sl}
% \DeclareOldFontCommand{\sc}{\normalfont\scshape}{\@nomath\sc}
% \makeatother

\newcommand{\mylabel}[1]{{#1}\hfill}
\renewenvironment{itemize}
  {\begin{list}{$\triangleright$}{%
  \setlength{\parskip}{0mm}
  \setlength{\topsep}{.4\baselineskip}
  \setlength{\rightmargin}{0mm}
  \setlength{\listparindent}{0mm}
  \setlength{\itemindent}{0mm}
  \setlength{\labelwidth}{3ex}
  \setlength{\itemsep}{.2\baselineskip}
  \setlength{\parsep}{.2\baselineskip}
  \setlength{\partopsep}{0mm}
  \setlength{\labelsep}{1ex}
  \setlength{\leftmargin}{\labelwidth+\labelsep}
  \let\makelabel\mylabel}}{%
\end{list}}

\declaretheoremstyle[
  headfont=\normalfont\bfseries,
  notefont=\bfseries,
  notebraces={(}{)},
  bodyfont=\normalfont,
  postheadspace=1em,
  mdframed={
  nobreak=true,
  outerlinewidth=1pt,
  linecolor=gray!20,
  roundcorner = 1ex,    
  backgroundcolor=gray!10, 
  innerleftmargin=1ex,
  leftmargin=-1ex,
  innerrightmargin=1ex,
  rightmargin=-1ex,
  innertopmargin=1.5ex, 
  innerbottommargin=1ex, 
  skipabove=3ex,
  skipbelow=1ex}, 
]{mystyle}

\declaretheorem[style=mystyle]%
{theorem}
\declaretheorem[style=mystyle,sibling=theorem]%
{lemma,proposition,fact,corollary,definition,notation,remark,example,claim,question}

\let\proof\relax
\declaretheoremstyle[
  spaceabove=6pt, 
  spacebelow=6pt, 
  headfont=\normalfont\itshape, 
  bodyfont = \normalfont,
  postheadspace=1em, 
  qed=\qedsymbol, 
  headpunct={.}]
{myproof} 
\declaretheorem[style=myproof, unnumbered]{proof}

\renewcommand*{\emph}[1]{%
   \smash{\tikz[baseline]\node[rectangle, fill=teal!25, rounded corners, inner xsep=0.5ex, inner ysep=0.2ex, anchor=base, minimum height = 2.7ex]{\strut #1};}}

%%%%%%% GETCOMMIT
\newcommand\dotGitHEAD{}
\newcommand\branch{}


\makeatletter\let\myfilehandle\@inputcheck\makeatother

\openin\myfilehandle=.git/HEAD\relax

\begingroup\endlinechar-1
  \global\read\myfilehandle to \dotGitHEAD
\endgroup
\closein\myfilehandle

\newcommand\GetBranch{}
\def\GetBranch ref: refs/heads/#1\relax{\renewcommand{\branch}{#1}}

\expandafter\GetBranch\dotGitHEAD\relax

\makeatother

\linespread{1.2}
\author{S. A. Polymath}
\begin{document}
\title{Standard analysis}
\hfill\texttt{Branch:\ \branch\ \DTMnow}\bigskip
\maketitle
\raggedbottom

\begin{abstract}
  Let ${\EuScript L}$ be a first-order two-sorted language.
  Let $I$ be some fixed structure.
  A \textit{standard\/} structure is an ${\EuScript L}$-structure of the form $\langle M,I\rangle$.
  When $I$ is a compact topological space (and ${\EuScript L}$ meets a few additional requirements) it is possible to adapt a significant part of model theory to the restricted class of standard strutures.
  This has been demostrated by Henson and Henson-Iovino for Banach spaces (see, e.g.~\cite{HI} and references cited therein) and has been generalized to arbitrary structures in~\cite{clcl}.
  The starting point is to prove that every standard structure has a \textit{positive\/} elementary extension that is standard and realizes all positive types that are finitely consistent.
  The main tool is the notion of approximation of a positive formula and of its negation.
  These have been introduced by Henson and Iovino.\\[1ex]
  \noindent
  We review and elaborate on the properties of positive formulas and their approximations.
  In parallel, we introduce \textit{continuous\/} formulas which provide a better counterpart to Henson and Iovino theory of normed spaces and the real-valued model theory of metric spaces of~\cite{BBHU}.
  Within this setting we discuss $\omega$-categoricity.
\end{abstract}

% The model theory of standard structures is based on the notions of positive formulas and of approximations.
% These evolved from the Henson-Iovino model theory of Banach spaces~\cite{HI}.
% Note that though the model theory of standard structures is an example of positive model theory there are important differences.
% For instance, we show that the negation of a positive formula is equivalent to an infinite disjunction of positive formulas.
% We also prove that these negations can be \textit{approximated\/} arbitrarily well by positive formulas.
% This makes the model theory of standard structures closer to classical model theory than one may expect.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Standard structures}\label{uno}

\def\ceq#1#2#3{\parbox[t]{23ex}{$\displaystyle #1$}\parbox{6ex}{\hfil $#2$}{$\displaystyle #3$}}

% We refer to the introduction of~\cite{clcl} for motivations.
% Aside from that, this paper is reasonably self-contained.
In order to make the paper reasonably self contained, in the first few sections we revisit some results of~\cite{clcl}.
Some theorems are rephrased and we add a few remarks and examples\footnote{We will omit Section~\ref{standard_part} from the final version of this paper and refer to~\cite{clcl} instead. 
% We will also omit a few proofs from Sections~\ref{morphisms}, \ref{compactness}, and~\ref{Ielimination}.
}.
Where necessary our notation and terminology slightly diverges.

Let \emph{$I$\/} be some fixed first-order structure which is endowed with a Hausdorff compact topology (in particular, a normal topology).
The language \emph{${\EuScript L}_{\sf I}$\/} contains a relation symbol for each compact subsets $C\subseteq I^n$ and a function symbol for each continuous functions $f:I^n\to I$.
In particular, there is a constant for each element of $I$.
According to the context, $C$ and $f$ denote either the symbols of ${\EuScript L}_{\sf I}$ or their interpretation in the stucture $I$.
Such a language ${\EuScript L}_{\sf I}$ is much larger than necessary but it is convenient because it uniquely associates a structure to a topological space.
The notion of a \textit{dense set of formulas\/} (Definition~\ref{def_dense}) helps to reduce the size of the language when required.

The most straightforward examples of structures $I$ are the unit interval $[0,1]$ with the usual topology, and its homeomophic copies $\mathds{R}^+\cup\{0,\infty\}$ and $\mathds{R}\cup\{\pm\infty\}$.

We also fix a first-order language \emph{${\EuScript L}_{\sf H}$\/} which we call the language of the \emph{home sort.}

\begin{definition}\label{def_0}
  Let ${\EuScript L}$ be a two sorted language that expands both ${\EuScript L}_{\sf H}$ and ${\EuScript L}_{\sf I}$.

  A \emph{standard structure\/} is a two-sorted ${\EuScript L}$-structure of the form $\langle M,I\rangle$, where $M$ is any ${\EuScript L}_{\sf H}$-structure.
  We write \emph{${\sf H}$} and \emph{${\sf I}$\/} to denote the two sorts of ${\EuScript L}$.
  
  The language ${\EuScript L}$ has a relation symbol $r_{\varphi}(x)$ for every $\varphi(x)\in {\EuScript L}_{\sf H}$.
  All ${\EuScript L}$-structures are assumed to model $r_{\varphi}(x)\leftrightarrow\varphi(x)$. 
  In other words, the Morleyzation of ${\EuScript L}_{\sf H}$ is assumed in the definition of ${\EuScript L}$-structure.
  
  Finally and most relevantly, ${\EuScript L}$ contains symbols for functions of sort ${\sf H}^n\to {\sf I}$.

  Standard structures are denoted by the domain of their home sort.
\end{definition}

% In some examples we need to replace the sort ${\sf H}$ with many sorts ${\sf H}_1\dots,{\sf H}_k$.
% In this case the language ${\EuScript L}_{\sf H}$ is replaced with $L_{{\sf H}_1\dots,{\sf H}_k}$, the language that governs the structure $\langle M_1\dots,M_k\rangle$.
% Models have the form $\langle M _1\dots,M_k, I\rangle$.
% The new symbols in the language ${\EuScript L}$ are of sort ${\sf H}_1^{n_1}\dots,{\sf H}_k^{n_k}\to {\sf I}$.

Clearly, saturated ${\EuScript L}$-structures exist but, with the exception of trivial cases (when $I$ is finite), these are not standard.
As a remedy, below we carve out a set of formulas ${\EuScript L}^{\rm p}$, the set of positive formulas, such that every model has an positive elementary saturated extension that is also standard.

As usual, ${\EuScript L}_{\sf I}$, ${\EuScript L}_{\sf H}$, and ${\EuScript L}$ denote both first-order languages and the corresponding set of formulas.
We write ${\EuScript L}_x$ when when we restrict variables to $x$.
% If $\varphi(x)\in{\EuScript L}$ contains only terms of sort ${\sf H}^n\to{\sf H}$ and relations of sort ${\sf H}^n$ we will improperly say that $\varphi(x)\in {\EuScript L}_{\sf H}$ (this is only correct up to equivalence).
% The symbols ${\EuScript L}^{\rm p}$ and ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$ defined below denote only sets of ${\EuScript L}$-formulas.
Note that ${\EuScript L}$ has two types of atomic formulas

\begin{itemize}
  \item[1.] $r_\varphi(x)$ for some $\varphi(x)\in{\EuScript L}_{\sf H}$  (maybe more, but these suffices up to equivalence);
  \item[2.] $\tau(x\,;\eta)\in C$, where $C\subseteq I^n$ is a compact set and $\tau(x\,;\eta)$ is a tuple of terms of sort ${\sf H}^{|x|}\times {\sf I}^{|\eta|}\to {\sf I}$ (up to equivalence, equality has also this form).
\end{itemize}

\begin{definition}\label{def_LL}
  A formula in ${\EuScript L}$ is \emph{positive\/} if it uses only the Boolean connectives $\wedge$, $\vee$; the quantifiers $\forall\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}$, $\exists\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}$ of sort ${\sf H}$; and the quantifiers $\forall\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}$, $\exists\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}$ of sort ${\sf I}$.
  The set of positive formulas is denoted by \emph{${\EuScript L}^{\rm p}$.}

  A \emph{continuous\/} formula is a positive formula where only atomic formulas as in (2) occur.
  The set of continuous formulas is denoted by \emph{${\EuScript L}^{\rm c}$.}

  %In propositions that holds for both ${\EuScript L}^{\rm p}$ and ${\EuScript L}^{\rm c}$ we write \emph{${\EuScript L}^{\rm p/c}$.}

  We will use Latin letters $x,y,z$ for variables of sort ${\sf H}$ and Greek letters $\eta,\varepsilon$ for variables of sort ${\sf I}$.
  Therefore we can safely drop the superscript from quantifiers if they are followed by variables.
\end{definition}

% \noindent\llap{\textcolor{red}{\Large\dangersign}\kern1ex}\ignorespaces

\begin{notation}
  Much of the theory below is developed in parallel in the positive and the continuous case.
  For the sake of conciseness, we write \emph{p/c} as a placeholder that can be replaced for either one of \emph{p} or \emph{c.}
\end{notation}

The positive formulas of Henson and Iovino correspond to those formulas in ${\EuScript L}^{\rm c}$ that do not have quantifiers of sort ${\sf I}$.

Allowing quantifiers of sort ${\sf I}$ comes almost for free.
In Section~\ref{cIelimination} will see that the formulas in ${\EuScript L}^{\rm c}$ are approximated by formulas in ${\EuScript L}^{\rm c}$ without quantifiers of sort ${\sf I}$.
Instead, working within ${\EuScript L}^{\rm p}$ comes at a price but it is convenient as it simplifies the comparision with classical model theory.

An important fact to note about ${\EuScript L}^{\rm c}$ is that it is a language without equality of sort ${\sf H}$.
The difference beween ${\EuScript L}^{\rm p}$ and ${\EuScript L}^{\rm c}$ is similar to the difference between the space of absolutely integrable functions (w.r.t.\@ some measure $\mu$) and the Lebesgue space $L^1(\mu)$.
For the latter only equality almost everywhere is relevant.
However, even when $L^1(\mu)$ is our focus of interest, it is often easier to argue about real valued functions.
For a similar reason ${\EuScript L}^{\rm p}$ and ${\EuScript L}^{\rm c}$ are better studied in parallel.

The extra expressive power offered by quantifiers of sort ${\sf I}$ is also convenient.
For instance, the example below (from~\cite{clcl}) should convince the reader that ${\EuScript L}^{\rm c}$ has at least the same expressive power as real valued logic.% (cf.\@ the example below taken from~\cite{clcl}).%
%\footnote{This unsubstantited claim should be interpreted as concjecture.
%A painstaking technical comparison with real valued logic is not in the scope of this indroductory exploratory paper.}.

\begin{example}\label{ex_Rvlogic}
  Let $I=[0,1]$, the unit interval.
  Let $\tau(x)$ be a term of sort ${\sf H}^{|x|}\to {\sf I}$.
  Then there is a positive formula that says $\sup_x \tau(x)=\alpha$.
  Indeed, consider the continuous formula

  \ceq{\hfill\forall x\ \big[\tau(x)\dotminus\alpha\in\{0\}\big]}
  {\wedge}{\forall \varepsilon \Big[\varepsilon\in\{0\}\ \vee\ \exists x\ \big[\alpha\dotminus (\tau(x)+\varepsilon)\in\{0\}\big]\Big]}

  which, in a more legible form, becomes

  \ceq{\hfill\forall x\ \big[\tau(x)\le\alpha\big]}{\wedge}{\forall \varepsilon>0\ \exists x\ \big[\alpha\le \tau(x)+ \varepsilon\big].}
\end{example}

The following example is inspired by~\cite{HPP}.

\begin{example}\label{ex_HPP}
  Let ${\EuScript U}$ be a saturated structure of signature ${\EuScript L}_{\sf H}$.
  The relevant part of ${\EuScript L}$ contains symbols for the functions $f:{\EuScript U}^n\to I$ that are continuous in the following sense: the inverse image of every compact $C\subseteq I$ is type-definable in ${\EuScript L}_{\sf H}(M)$ for every $M\preceq{\EuScript U}$.
  %It is easy to verify that $\langle{\EuScript U}, I\rangle$ is positively saturated as defined in Section~\ref{compactness}.
\end{example}

The theory of normed spaces is one of the motivating examples for standard structures.
The requirement for $I$ to be compact seems a limitation, but it is not a real one.
Essentially, functional analysis and model theory are only concerned with the unit ball of normed spaces.

To formalize the unit ball of a normed space as a standard structure (where $I$ is the unit interval) is straightforward in theory but cumbersome in practice.
Alternatively, one could view a normed space as a many-sorted structure: a sort for each ball of radius $n\in\mathds{Z}^+$.
Unfortunately, this also results in a bloated formalism.

A neater formalization is possible if one accepts that some positive elementary extensions (to be defined below) of a normed space could contain vectors of infinite norm hence not be themselves proper normed spaces.
However these infinities are harmless if one restrics to balls of fine radius.
In fact, inside any ball of finite radius these improper normed spaces are completely standard.

\begin{example}\label{ex_normed_spaces}
Let $I=\mathds{R}\cup\{\pm\infty\}
$.
Let ${\EuScript L}_{\sf H}$ be the language of real (or complex) vector spaces.
The language ${\EuScript L}$ contains a function symbol $\|\mbox{-}\|$ of sort ${\sf H}\to {\sf I}$.
Normed space are standard structures with the natural interpretation of the language.
It is easy to verify that the unit ball of a standard structure is the unit ball of a normed space.
Note that the same remains true if we add to the language any continuous (equivalently, bounded) operator or functional.
\end{example}

We conclude this introduction by advertising a question in~\cite{clcl}.
Is it possible to extend the Positive Compactness Theorem (Theorem~\ref{thm_compattezza}) to a larger class of languages?
E.g.\@ can we allow in ${\EuScript L}$ (and in ${\EuScript L}^{\rm p/c}$) function symbols of sort ${\sf H}^n\times {\sf I}^m\to {\sf I}$ with both $n$ and $m$ positive?
These would have natural interpretations, e.g.\@ a group acting on a compact set $I$.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Henson-Iovino approximations}\label{ultrapws} 
The notion of approximation is a central tool in the work of Hension and Henson-Iovino on normed spaces, see e.g.~\cite{HI}.
In~\cite{clcl} the natural generalization to standard structures is presented.
We recall the definitions and the main properties.

For $C,C'$ compact substes of $I^n$, we write $C'>C$ if $C'$ is a neighborhood of $C$.
For $\varphi,\varphi'$ (free variables are hidden) positive formulas possibly with parameters we write \emph{$\varphi'>\varphi$\/} if $\varphi'$ is obtained by replacing in $\varphi$ each atomic formula of the form $t\in C$ with $t\in C'$, for some $C'>C$.
If no such atomic formulas occurs in $\varphi$, then $\varphi>\varphi$.
We call $\varphi'$ a \emph{weakening\/} of $\varphi$.
Note that $>$ is a dense transitive relation and that  $\varphi\to\varphi'$ in every ${\EuScript L}$-structure.
For every type $p(x)$, we write 

\ceq{\hfill \emph{$p'(x)$}}{=}{\big\{\varphi'(x)\ :\ \varphi'>\varphi\textrm{ for some }\varphi(x)\in p\big\}}

in particular \emph{$\{\varphi(x)\}'$} = $\big\{\varphi'(x)\ :\ \varphi'>\varphi\big\}$.

We write \emph{$\tilde\varphi\perp\varphi$\/} when $\tilde\varphi$ is obtained by replacing each atomic formula $t\in C$ occurring in $\varphi$ with $t\in\tilde{C}$ where $\tilde{C}$ is some compact set disjoint from $C$.
The atomic formulas in ${\EuScript L}_{\sf H}$ are replaced with their negation.
Finally each connective is replaced by its dual i.e., $\vee, \wedge, \exists,\forall$ are replaced by $\wedge,\vee,\forall,\exists$, respectively.
We say that  $\tilde\varphi$ is a \emph{strong negation} of $\varphi$.
It is clear that $\tilde\varphi\rightarrow\neg\varphi$ in every ${\EuScript L}$-structure.

Notice that the weakening and the strong negation of a formula in ${\EuScript L}^{\rm c}$ is also in ${\EuScript L}^{\rm c}$.

\begin{lemma}\label{lem_interpolation}
  For all positive formulas $\varphi$
  \begin{itemize}
    \item[1.]for every $\varphi'>\varphi$ there is a formula $\tilde\varphi\perp\varphi$ such that $\varphi\rightarrow\neg \tilde\varphi\rightarrow\varphi'$;
    \item[2.] for every\, $\tilde\varphi\perp\varphi$ there is a formula $\varphi'>\varphi$ such that  $\varphi\rightarrow\varphi'\rightarrow\neg \tilde\varphi$.
  \end{itemize}
\end{lemma}

\begin{proof}
  If $\varphi\in {\EuScript L}_{\sf H}$ the claims are obvious.
  Suppose $\varphi$ is of the form $t\in C$.
  Let $\varphi'$ be $t\in C'$, for some $C'>C$.
  Let $O$ be an open set such that $C\subseteq O\subseteq C'$.
  Then $\tilde\varphi=(t\in I\smallsetminus O)$ is as required by the lemma.
  Suppose instead that $\tilde\varphi$ is of the form $t\in\tilde{C}$ for some compact $\tilde{C}$ disjoint from $C$.
  By the normality of $I$, there is  $C'>C$ disjoint from $\tilde{C}$.
  Then  $\varphi'=\big(t\in C'\big)$ is as required.
  The lemma follows easily by induction.
\end{proof}

\begin{definition}\label{def_dense}
  A set of formulas ${\EuScript F}\subseteq{\EuScript L}$ is \emph{p/c-dense\/} modulo $T$, a theory, if for every positive/continuous $\varphi(x)$ and every $\varphi'>\varphi$, there is a formula $\psi(x)\in{\EuScript F}$ such that $\varphi(x)\rightarrow\psi(x)\rightarrow\varphi'(x)$ holds in every standard structure that models $T$.
  % If $T$ is empty, we say p/c-dense modulo ${\EuScript L}$.
\end{definition}

\begin{example}
  By Lemma~\ref{lem_interpolation}, the set of negations of positive/continuous formulas is p/c-dense.
\end{example}

The following fact is easily proved by induction.

\begin{fact}
  Let ${\EuScript F}$ be a set of formulas closed under the connectives $\wedge$, $\vee$, $\forall\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}$, $\exists\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}$, $\forall\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}$, $\exists\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}$.
  Then ${\EuScript F}$ is p/c-dense if the condition in Definition~\ref{def_dense} is satisfied when $\varphi(x)$ atomic.
\end{fact}

Using the fact, it is immediate to verify the following.

\begin{example}\label{ex_prebase}
  Let ${\EuScript C}$ be a prebase of closed subsets of $I$.
  The set of formulas built inductively from atomic formulas of the form $\tau(x,\eta)\in C$ for $C\in{\EuScript C}$ is c-dense.
\end{example}

\begin{example}
  Let $I=[0,1]$.
  The set of formulas built inductively from atomic formulas of the form $\tau=0$ is c-dense.
  In fact, first note that by Example~\ref{ex_prebase} we can restrict to formulas built inductively from atomic formulas of the form $\tau\in[\alpha,\beta]$.
  Then note that $\tau\in[\alpha,\beta]$ is equivalent to $\tau\dotminus\beta\in\{0\}\ \wedge\ \alpha\dotminus\tau\in\{0\}$.
\end{example}


In Section~\ref{cIelimination} we prove that the set of continuous formulas without quantifiers of sort ${\sf I}$ is c-dense.
 


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{comment}
\section{Morphisms}\label{morphisms}

\def\ceq#1#2#3{\parbox[t]{34ex}{$\displaystyle #1$}\parbox{6ex}{\hfil $#2$}{$\displaystyle #3$}}

Let $M$ and $N$ be two standard structures.
We say that a partial map $f:M\to N$ is \emph{p-elementary\/} if for every $\varphi(x)\in{\EuScript L}^{\rm p}$ and every $a\in({\rm dom }f)^{|x|}$

\ceq{1.\hfill M\models\varphi(a)}{\Rightarrow}{N\models\varphi(fa).}

In words, we say that $f$ \emph{preserve the truth\/} of the positive formulas.
A p-elementary map that is total is called a p-elementary \emph{embedding.}
When the identity map ${\rm id}_M:M\rightarrow N$ is an p-elementary embedding, 
% that is, if for every  $\varphi(x)\in{\EuScript L}^{\rm p}$ and every $a\in M^{|x|}$
%
% \ceq{\hfill{\EuScript M}\models\varphi(a)}{\Rightarrow}{N\models\varphi(a)},
%
we write \emph{$M\preceq^{\rm p} N$\/} and say that $M$ is an p-elementary \emph{substructure\/} of $N$.

The discussion of c-elementarity needs some extra care because ${\EuScript L}^{\rm c}$ does not contains equality in the home sort.
Therefore we postpone it till Section~\ref{cIelimination}.

On the other hand, as p-elementary maps are in particular ${\EuScript L}_{\sf H}$-elementary, they are injective.
However, their inverse need not be p-elementary.
In other words, the converse of the implication in (1) may not hold.
Hence the following notion of elementarity which is more roboust.
% We have chosen to work with the classical notion of satisfaction at the cost of this asymmetric notion of elementarity.
% This differs from the approach of Henson and Iovino.
% They introduce the notion of \textit{approximate satisfaction.} 
% The approximate ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-morphisms we define below are the maps that preserve Henson-Iovino approximate satisfaction.
% These morphisms are invertible, cf.\@ Fact~\ref{fact_HImorphisms}.
We say that the map $f:M\to N$ is an \emph{approximate\/} p-elementary if for every formula $\varphi(x)\in{\EuScript L}^{\rm p}$, and every $a\in({\rm dom }f)^{|x|}$

\ceq{2.\hfill M\models\varphi(a)}{\Rightarrow}{N\models\big\{\varphi(fa)\big\}'.}

One convenient feature of approximate p-elementarity is that it suffices verify (2) for any/some p-dense set of formulas.
It is clear that p-elementarity implies its approximate variant.
We will see that with a slight amount of saturation also the converse holds (Proposition~\ref{prop_approx}).
Moreover, under full saturation, these morphims becomes ${\EuScript L}$-elementarity maps (Corollary~\ref{corol_Lcomplete}).

The following holds in general.

\begin{fact}\label{fact_HImorphisms}
  If $f:M\to N$ is approximate p-elementary then

  \ceq{\hfill M\models\big\{\varphi(a)\big\}'}{\Leftrightarrow}{N\models\big\{\varphi(fa)\big\}'.}

  for every $\varphi(x)\in{\EuScript L}^{\rm p}$, and every $a\in({\rm dom }f)^{|x|}$.
\end{fact}

\begin{proof}
  $\Rightarrow$ \ Fix $\varphi'>\varphi$ and assume $M\models\varphi'(a)$.
  Let  $\varphi'>\varphi''>\varphi$.
  By the definition of approximate elementarity, $N\models\varphi''(fa)$ and $N\models\varphi'(fa)$ follows.
  
  $\Leftarrow$  \ 
  Assume the r.h.s.\@ of the equivalence.
  Fix $\varphi'>\varphi$ and prove $M\models\varphi'(a)$.
  Let  $\varphi'>\varphi''>\varphi$.
  By Lemma~\ref{lem_interpolation} there is some $\tilde\varphi\perp\varphi''$ such that $\varphi''\rightarrow\neg\tilde\varphi\rightarrow\varphi'$.
  Then $N\models\neg\tilde\varphi(fa)$ and therefore  $M\models\neg\tilde\varphi(a)$.
  Then $M\models\varphi'(a)$.
\end{proof}

% \begin{comment}
Finally, we consider the notion of partial embeddings.
Though the definition seems weaker, we show that the notion is competely classical.
We say that the map $f:M\to N$ is a \emph{partial embedding\/} if the implication in (1) holds for all atomic formulas $\varphi(x)$.
Note that this is the same as requiring that (1) holds for all formulas without quantifiers of sort ${\sf H}$.

\begin{fact}\label{fact_partial_emb}
  If $f:M\to N$ is a partial embedding then 

  \ceq{\hfill M\models\varphi(a)}{\Leftrightarrow}{N\models\varphi(fa)}

  for every $a\in({\rm dom }f)^{|x|}$ and every formula $\varphi(x)\in{\EuScript L}^{\rm p}$ without quantifiers of sort ${\sf H}$.
\end{fact}

\begin{proof}
  The equivalence is trivial for formulas in ${\EuScript L}_{\sf H}$ so we only consider atomic formulas of the form $t\in C$.
  Implication $\Rightarrow$ holds by definition. 
  Vice versa, if $M\models \tau(a)\notin C$ then, by normality,  $M\models \tau(a)\in\tilde{C}$ for some compact $\tilde C$ disjoint of $C$.
  By the definition of partial embedding, $N\models \tau(a)\in\tilde{C}$.
  Hence $N\models \tau(a)\notin C$.
  Induction is immediate.
\end{proof}
  
\end{comment}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section[The standard part]{The standard part\boldmath$^1$}\label{standard_part}\footnotetext{We will omit this section from the final version of this paper and refer to~\cite{clcl} instead.}

Our goal is to prove a compactness theorem for positive theories that only requires standard structures.
To bypass lengthy routine applications of ultrafilters, ultrapowers, and ultralimits, % -- as it would be like reinventing the wiel.
we assume the classical Compactness Theorem and build on that.

In this section we recall the notion of standard part of an element of the elementary extension of a compact Hausdorff topological space.
Our goal is to prove Lemma~\ref{lem_st} which in turn is required for the proof of the positive Compactness Theorem (Theorem~\ref{thm_compattezza}).
The reader willing to accept it without proof may skip this section.

Let $\langle N, {}^*\!\!I\rangle$ be an ${\EuScript L}$-structure that extends ${\EuScript L}$-elementarily the standard structure $M$. %$\langle M, I\rangle$.
Let $\eta$ be a free variable of sort ${\sf I}$.
For each $\beta\in I$, we define the type

\ceq{\hfill{\rm m}_\beta(\eta)}{=}{\{\eta\in D\ :\  D \textrm{ compact neighborhood of }\beta\}.}

The set of the realizations of ${\rm m}_\beta(\eta)$ in ${}^*\!\!I$ is known to nonstandard analysts as the monad of $\beta$. 
% We write \emph{$\alpha\approx\alpha'$\/} if $\alpha\approx\beta\approx\alpha'$ for some $\beta\in I$.
% From the following fact it follows that $\,\approx\,$ is an equivalence relation on ${}^*\!\!I$.
The following fact is well-known.

\begin{fact}\label{fact_uniqueness_st}
  For every $\alpha\in{}^*\!\!I$ there is a unique $\beta\in I$ such that ${}^*\!\!I\models{\rm m}_\beta(\alpha)$.
\end{fact}

\begin{proof}
  Negate the existence of $\beta$.
  For every $\gamma\in I$ pick some compact neighborhood $D_\gamma$ of $\gamma$, such that ${}^*\!\!I\ \models\ \alpha\notin D_\gamma$.
  By compactness there is some finite $\Gamma\subseteq I$ such that $D_\gamma$, with $\gamma\in\Gamma$, cover $I$.
  By elementarity, the interpretation in ${}^*\!\!I$ of these $D_{\gamma}$ cover ${}^*\!\!I$.
  A contradiction.
  The uniqueness of $\beta$ follows from normality.
\end{proof}

We denote by \emph{${\rm st}(\alpha)$\/} the unique $\beta\in I$ such that ${}^*\!\!I\models{\rm m}_\beta(\alpha)$.
% We write \emph{$\alpha\approx\alpha'$\/} if ${\rm st}(\alpha)={\rm st}(\alpha')$.

\begin{fact}\label{fact_st1}
  For every $\alpha\in{}^*\! I$ and every compact $C\subseteq I$

\ceq{\hfill{}^*\!\!I}{\models}{\alpha\in C\ \rightarrow\ {\rm st}(\alpha)\in C.}
\end{fact}

\begin{proof}
  Assume ${\rm st}(\alpha)\notin C$.
  By normality there is a compact set $D$ disjoint from $C$ that is a neighborhood of ${\rm st}(\alpha)$.
  Then  ${}^*\!\!I\models\alpha\in D\subseteq\neg C$.
\end{proof}

\begin{fact}\label{fact_terms_st}
  For every $\alpha\in({}^*\!\!I)^{|\alpha|}$ and every function symbol $f$ of sort ${\sf I}^{|\alpha|}\to{\sf I}$

  \ceq{\hfill{}^*\!\!I}{\models}{{\rm st}\big(f(\alpha)\big)=f\big({\rm st}(\alpha)\big).}
\end{fact}

\begin{proof}
  By Fact~\ref{fact_uniqueness_st} and the definition of st(-) it suffices to prove that ${}^*\!\!I\models f(\alpha)\in D$ for every compact neighborhood $D$ of $f\big({\rm st}(\alpha)\big)$.
  
  Fix one such $D$.
  Then ${\rm st}(\alpha)\in f^{-1}[D]$ .
  By continuity $f^{-1}[D]$ is a compact neighborhood of ${\rm st}(\alpha)$.
  Therefore ${}^*\!\!I\models \alpha\in f^{-1}[D]$ and, as $I\preceq{}^*\!\!I$ we obtain ${}^*\!\!I\models f(\alpha)\in D$.
\end{proof}

The \emph{standard part of $\langle N,{}^*\!\!I\rangle$\/} is the standard structure $\langle N,I\rangle$ that interprets the symbols $f$ of sort ${\sf H}^n\to {\sf I}$ as the functions

\ceq{\hfill f^N(a)}{=}{{\rm st}\big({}^*\!\!f(a)\big)}\hfill for all $a\in N^n$,

where ${}^*\!\!f$ is the interpretation of $f$ in  $\langle N,{}^*\!\!I\rangle$.
Symbols in ${\EuScript L}_{\sf H}$ maintain the same interpretation.

\begin{fact}\label{fact_st2} 
  With the notation as above.
  Let $\tau(x\,;\eta)$ be a term of sort ${\sf H}^{|x|}\times{\sf I}^{|\eta|}\to {\sf I}$.
  Then for every $a\in M^{|x|}$ and $\alpha\in({}^*\!\!I)^{|\eta|}$

  \ceq{\hfill \tau^N\big(a\,;{\rm st}(\alpha)\big)}{=}{{\rm st}\big({}^*\!\tau(a\,;\alpha)\big)}
\end{fact}
\begin{proof}
  When a $t$ is a function symbol of sort  ${\sf H}^{|x|}\to {\sf I}$, the claim holds by definition.
  When $t$ is a function symbol of sort ${\sf I}^{|\eta|}\to {\sf I}$, the claim follows from Fact~\ref{fact_terms_st}.
  Now, assume inductively that 

  \ceq{\hfill t_i^N\big(a\,;{\rm st}(\alpha)\big)}{=}{{\rm st}\big({}^*t_i(a\,;\alpha)\big)}

  holds for the terms $t_1(x\,;\eta),\dots,t_n(x\,;\eta)$ and let $t=f(t_1,\dots,t_n)$ for some function $f$ of sort ${\sf I}^n\to {\sf I}$.
  Then the claim follows immediately from the induction hypothesis and Fact~\ref{fact_terms_st}.
\end{proof}

% Symbols in ${\EuScript L}_{\sf I}$ have the interpretation they have in models.

\begin{lemma}\label{lem_st}
  With the notation as above.
  For every $\varphi(x\,;\eta)\in{\EuScript L}^{\rm p}$, \  $a\in N^{|x|}$, $\alpha\in({}^*\!\!I)^{|\eta|}$ 
  
  \ceq{\hfill\langle N,{}^*\!\!I\rangle\models\varphi(a\,;\alpha)}
  {\Rightarrow}
  {N\models\varphi\big(a\,;{\rm st}(\alpha)\big)}
\end{lemma}

\begin{proof}
  Suppose $\varphi(x\,;\eta)$ is ${\EuScript L}^{\rm p}$-atomic.
  If $\varphi(x\,;\eta)$ is a formula of ${\EuScript L}_{\sf H}$ the claim is trivial. 
  Otherwise $\varphi(x\,;\eta)$ has the form $\tau(x\,;\eta)\in C$.
  Assume that the tuple $\tau(x\,;\eta)$ consists of a single term.
  The general case follows easily from this special case. 
  Assume that $\langle N,{}^*\!\!I\rangle\models \tau(a\,;\alpha)\in C$.
  Then ${\rm st}\big({}^*\tau(a\,;\alpha)\big)\in C$ by Fact~\ref{fact_st1}.
  Therefore $\tau^N\big(a\,;{\rm st}(\alpha)\big)\in C$ follows from Fact~\ref{fact_st2}.
  This proves the lemma for atomic formulas.
  Induction is immediate. 
\end{proof}

\begin{corollary}\label{corol_st}
  Let $M$ be a standard structure.
  Let $p(\eta)\subseteq{\EuScript L}^{\rm p}(M)$ be a type that does not contain existential quantifiers of sort ${\sf H}$.
  Then, if $p(\eta)$ is finitely consistent in $M$, it is realized in $M$.
 \end{corollary}
 
 The corollary has also a direct proof.
 This goes through the observation that the formulas in $p(\eta)$ define compact subsets of $I$.

 \begin{proof}
  Let $\langle ^*\!M,^*\!\!I\rangle$ be an ${\EuScript L}$-elementary saturated superstructure of $\langle M,I\rangle$.
  Pick some $\alpha\in ^*\!\!I$ such that $\langle ^*\!M,^*\!\!I\rangle\models p(\alpha)$.
  By Lemma~\ref{lem_st}, $^*\!M\models p({\rm st}(\alpha))$.
  Now observe that the truth of formulas without  existential quantifiers of sort ${\sf H}$ is preserved by substructures.
 \end{proof}
 
 The exclusion of existential quantifiers of sort ${\sf H}$ is necessary.
 For a counterexample take $M=I=[0,1]$.
 Assume that ${\EuScript L}$ contains a function symbol for the identity map $\iota:M\to I$.
 Let $p(\eta)$ contain the formulas $\exists x\,\big(x>0\,\wedge\;\iota x+\eta\in[0,1/n]\big)$ for all positive integers $n$.

% \begin{corollary}\label{corol_Isaturation}
%   Let $M$ be a model and let $p(\eta)\subseteq{\EuScript L}^{\rm p}(M)$ be a type that is finitely consistent in $M$, where $\eta$ is a tuple of variables of sort ${\sf I}$.
%   Then $p(\eta)$ is realized in a model $N$ such that $M\preceq^{\rm p}N$.
% \end{corollary}

% \begin{proof}
%   By the classical Compactess Theorem, the type $p(\eta)$ is realized in some ${\EuScript L}$-structure $\langle N,{}^*\!\!I\rangle$ by
%   some $\alpha\in ({}^*\!\!I)^{|\eta|}$.
%   Therefore, by the lemma above $N\models p\big({\rm st}(\alpha)\big)$.
% \end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Compactness}\label{compactness}

It is convenient to distinguish between consistency with respect to standard structures and consistency with respect to ${\EuScript L}$-structures.
We say that a theory $T$ is \emph{${\EuScript L}$-consistent\/} if $\langle M,{}^*\!\!I\rangle\models T$ for some ${\EuScript L}$-structure $\langle M,{}^*\!\!I\rangle$ (this is the classical notion of concistency).
We say that $T$ is \emph{standardly\/}  consistent if $M\models T$  is for some standard structure $M$.
By Lemma~\ref{lem_st} these two notions coincide if $T$ is positive.
Therefore we have the following.

\begin{theorem}[Positive Compactness Theorem]\label{thm_compattezza}
  Let $T$ be a positive theory. Then, if $T$ is finitely ${\EuScript L}$-consistent, it is also standardly consistent.
\end{theorem}

% \begin{proof}
%   Suppose $T$ is finitely ${\EuScript L}$-consistent.
%   By the Classical Compactness Theorem, there is an ${\EuScript L}$-structure $\langle M,{}^*\!\!I\rangle\models T$.
%   Let $\langle M,I\rangle$ be its standard part as defined in Section~\ref{standard_part}.
%   Then $M\models T$ by Lemma~\ref{lem_st}.
% \end{proof}

% \begin{corollary}\label{prop_tipi_compattezza}
%   Let $p(x\,;y)\subseteq{\EuScript L}^{\rm p}(M)$ be finitely consistent in $M$, a model.
%   Then $N\models\exists x\,\exists^I y\,p(x\,;y)$ for some model $N$ such that $M\preceq^{\rm p}N$.
% \end{corollary}

% \noindent\llap{\dangersign\kern2ex}%


% \begin{definition}
%   We say that $M$ is \emph{positively saturated\/} if for every $p(x)$ as in 1 and 2 below, $M\models\exists x\, p(a)$.
%   \begin{itemize}
%     \item[1.] $p(x)\subseteq{\EuScript L}^{\rm p}(A)$ for some $A\subseteq  M$ of cardinality $<|M|$ and $|x|=1$;
%     \item[2.] $p(x)$ is finitely satisfied in $M$.
%   \end{itemize}
% \end{definition}
An ${\EuScript L}$-structure $N$ is \emph{positively $\lambda$-saturated\/} if it realizes all types $p(x\,;\eta)\subseteq{\EuScript L}^{\rm p}(N)$ with fewer than $\lambda$ parameters that are finitely consistent in $N$.
When $\lambda=|N|$ we simply say \emph{p-saturated.}
The existence of p-saturated standard structures is obtained from the classical case just as for Theorem~\ref{thm_compattezza}.

We say that $M$ is a \emph{p-elementary\/} substructure of $N$ if $M\subseteq N$ and

\ceq{\hfill M\models\varphi(a)}{\Rightarrow}{N\models\varphi(a)}

for every $\varphi(x)\in{\EuScript L}^{\rm p}$ and every $a\in M^{|x|}$.

\begin{theorem}
  Every standard structure has a p-elementary extension to a p-satu\-rated standard structure (possibly of inaccessible cardinality).
\end{theorem}

\begin{proof}
  Let $\langle {}^*\!\!M,{}^*\!\!I\rangle$ be an ${\EuScript L}$-saturated ${\EuScript L}$-elementary extension of the standard structure $\langle M,I\rangle$.
  Let $\langle {}^*\!\!M,I\rangle$ be its standard part as defined in Section~\ref{standard_part}.
  By Lemma~\ref{lem_st}, $\langle {}^*\!\!M,I\rangle$ realizes all finitely consistent positive types with $<|{}^*\!\!M|$ parameters.
\end{proof}



% Homogeneity follows from saturation by the usual back-and-forth contruction.

% \begin{proposition}(Homogeneity)
%   Let $N$ be saturated and of cardinality larger than $|{\EuScript L}^{\rm p}|$.
%   Then for every $ab\in M^\alpha$, where $\alpha<|N|$, such that $a\equiv b$, there is an ${\EuScript L}^{\rm p}$-automorphism of $N$ that maps $a$ to $b$.
% \end{proposition}

The following proposition shows that a slight amount of saturation tames the positive formulas.

\begin{proposition}\label{prop_approx}
  Let $N$ be a positively $\omega$-saturated standard structure.
  Then 
  
  \ceq{\hfill\big\{\varphi(x\,;\eta)\big\}'}{\leftrightarrow}{\varphi(x\,;\eta)}
  
  holds in $N$ for every formula $\varphi(x\,;\eta)\in{\EuScript L}^{\rm p}(N)$.
\end{proposition}

\begin{proof}
  We prove $\rightarrow$, the non trivial implication.
  The claim is clear for atomic formulas.
  Induction for conjunction, disjunction and the universal quantifiers is immediate.
 % 
  % Consider disjunction.
  % Let $\varphi=\varphi_i\vee\varphi_1$.
  % Assume inductively
 % 
  % \ceq{\hfill\varphi_i(x)}
  % {\leftrightarrow}
  % {\bigwedge_{\varphi_i'>\varphi_i}\varphi_i'(x)}
%
  % Then
%
  % \ceq{\hfill\varphi(x)}
  % {\leftrightarrow}
  % {\bigwedge_{\varphi_1'>\varphi_1}\varphi_1'(x) \ \vee \bigwedge_{\varphi_2'>\varphi_2}\varphi_2'(x)}
%
  % \ceq{}
  % {\leftrightarrow}
  % {\bigwedge_{\substack{\varphi_1'>\varphi_1\\ \varphi_2'>\varphi_2}}\varphi_1'(x) \vee\varphi_2'(x)}
%
  % \ceq{}
  % {\leftrightarrow}
  % {\bigwedge_{\varphi'>\varphi}\varphi'(x)}
%
  We consider case of the existential quantifiers of sort ${\sf H}$.
  Assume inductively
  
  \ceq{\textrm{ih.}\hfill\{\varphi(x,z\,;\eta)\}'}
  {\rightarrow}
  {\varphi(x,z\,;\eta)}

  We need to prove

  \ceq{\hfill\{\exists z\,\varphi(x,z\,;\eta)\}'}
  {\rightarrow}
  {\exists z\,\varphi(x,z\,;\eta)}

  From (ih) we have

  \ceq{\hfill\exists z\,\{\varphi(x,z\,;\eta)\}'}
  {\rightarrow}
  {\exists z\,\varphi(x,z\,;\eta)}

  Therefore it suffices to prove

  \ceq{\hfill\{\exists z\,\varphi(x,z\,;\eta)\}'}
  {\rightarrow}
  {\exists z\,\{\varphi(x,z\,;\eta)\}'}

Replace the variables $x\,;\eta$ with parameters, say $a\,;\alpha$, and assume that $N\models\exists z\,\varphi'(a,z,;\alpha)$ for every $\varphi'>\varphi$.
We need to prove the consistency of the type $\{\varphi'(a,z,;\alpha):\varphi'>\varphi\}$.
By saturation, finite consistency suffices.
This is clear if we show that the antecedent is closed under conjunction.
Indeed it is easy to verify that if $\varphi_1,\varphi_2>\varphi$ then $\varphi_1\wedge\varphi_2>\varphi'$ for some $\varphi'>\varphi$.
In words, the set of approximations of $\varphi$ is a directed set.

For existential quantifiers of sort ${\sf I}$ we argue similarly.% by applying Corollary~\ref{corol_Isaturation}.
%
% \noindent\llap{\textcolor{red}{\Large\danger}\kern1ex}\ignorespaces
% Consider the existential quantifiers of sort $I$
% Assume inductively
%
% \ceq{\hfill\bigwedge_{\varphi'>\varphi}\varphi'(x;y)}
% {\rightarrow}
% {\varphi(x;y)}
%
% As above, it suffices to prove
%
% \ceq{\#\hfill\bigwedge_{\varphi'>\varphi}\exists^C\! y\,\varphi'(x;y)}
% {\rightarrow}
% {\exists^C\! y\,\bigwedge_{\varphi'>\varphi}\varphi'(x;y)}
%
\end{proof}

% \begin{remark}
%   If we restrict to formulas without quantifiers of sort ${\sf H}$, the proposition above holds in every model (this is clear from the proof).
% \end{remark}

\def\ceq#1#2#3{\parbox[t]{20ex}{$\displaystyle #1$}\parbox[t]{6ex}{\hfil $#2$}{$\displaystyle #3$}}

\begin{remark}\label{remk_approx_EH_free}
  By Corollary~\ref{corol_st}, when $\varphi(x\,;\eta)$ does not contains existential quantifiers of sort ${\sf H}$, Proposition~\ref{prop_approx} does not require any assumption of saturation.
  In general, some saturation is necessary: consider the model presented after Corollary~\ref{corol_st} and the formula $\exists x\,\big(x>0\ \wedge\ \iota(x)\in\{0\}\big)$.
  See~[Paragraph after Corollary~5.16]\cite{HI} for a counterexample in ${\EuScript L}^{\rm c}$.
\end{remark}

% \begin{remark}\label{rem_model_approx}
%   A consequence of Proposition~\ref{prop_approx} is that the approximate morphisms defined in Section~\ref{morphisms} coincide with their unapproximate version when the codomain is positively $\omega$-saturated.
%   In particular they are invertible by  Fact~\ref{fact_HImorphisms}.
% \end{remark}
  
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The monster model}\label{monster}

\def\ceq#1#2#3{\parbox[t]{18ex}{$\displaystyle #1$}\parbox{6ex}{\hfil $#2$}{$\displaystyle #3$}}

We denote by \emph{${\EuScript U}$\/} some large p-saturated standard structure which we call the positive monster model.
% For convenience we assume that the cardinality of ${\EuScript U}$ is an inaccessible cardinal.
Truth is evaluated in ${\EuScript U}$ unless otherwise is specified.
We denote by $T$ the positive theory of {${\EuScript U}$.
The density of a set of formulas is understood modulo $T$.
Below we say \emph{p/c-model\/} for p/c-elementary substructure of ${\EuScript U}$.
We stress that the truth of some $\varphi\in{\EuScript L}^{\rm p/c}(M)$ in a p/c-model $M$ implies the truth of $\varphi$ (in ${\EuScript U}$) but not vice versa.
% If also the converse implication holds we say $M$ a \emph{strong p-model.}
However, all p/c-models agree on the approximated truth.

\begin{fact}
  The following are equivalent 
  \begin{itemize}
    \item[1.] $M$ is a p/c-model;
    \item[2.] $M\models\big\{\varphi(a)\big\}'\ \ \Leftrightarrow\ \ \varphi(a)$\quad for every $\varphi(x)\in{\EuScript L}^{\rm p/c}$ and every $a\in M^{|x|}$.
  \end{itemize}
\end{fact}

\begin{proof}
  (1$\Rightarrow$2) \ Implication $\Rightarrow$ follows from Proposition~\ref{prop_approx}.
  For the converse, assume $\varphi(a)$.
  Let $\varphi'>\varphi$.
  We prove $M\models\varphi'(a)$.
  By Lemma~\ref{lem_interpolation} there is some $\tilde\varphi\perp\varphi''$ such that $\varphi''\rightarrow\neg\tilde\varphi\rightarrow\varphi'$.
  Then $\neg\tilde\varphi(a)$ and therefore  $M\models\neg\tilde\varphi(a)$.
  Then $M\models\varphi'(a)$.

  (2$\Rightarrow$1) \ If $M\models\varphi(a)$ then $M\models\big\{\varphi(a)\big\}'$.
  Then $\varphi(a)$ follows from (2).
\end{proof}

The following fact demostrates how positive compactness applies.
There are some subtle differences from the classical setting.
Let $A\subseteq{\EuScript U}$ be a small set throughout this section.

\begin{fact}\label{fact_compactness_imp}
  Let $p(x)\subseteq{\EuScript L}^{\rm p}(A)$ be a type.
  Then for every  $\varphi(x)\in{\EuScript L}^{\rm p}({\EuScript U})$
  \begin{itemize}
    \item[i.] if $p(x)\rightarrow\neg\varphi(x)$ then for some conjunction $\psi(x)$ of formulas in $p(x)$
    
    \noindent\kern-\leftmargin
    \ceq{\hfill\psi(x)}{\rightarrow}{\neg\varphi(x);}

    \item[ii.] if $p(x)\rightarrow\varphi(x)$ and $\varphi'>\varphi$ then for some conjunction $\psi(x)$ of formulas in $p(x)$
    
    \noindent\kern-\leftmargin
    \ceq{\hfill\psi(x)}{\rightarrow}{\varphi'(x).}
  \end{itemize} 
\end{fact}

\begin{proof}
  (i) is immediate by saturation; (ii) follows from (i) by Lemma~\ref{lem_interpolation}.
\end{proof}

\begin{fact}\label{fact_Fdense}
  Let ${\EuScript F}$ be a p/c-dense set of positive/continuous formulas.
  Then ${\EuScript F}'$ is p/c-dense.
\end{fact}

\begin{proof}
  Let $\varphi'>\varphi$.
  Pick $\varphi''$ such that $\varphi'>\varphi''>\varphi$.
  By density, $\varphi(x)\rightarrow\psi(x)\rightarrow\varphi''(x)$ for som $\psi(x)\in{\EuScript F}$.
  It suffices to prove that $\psi'(x)\rightarrow\varphi'(x)$ for some $\psi'>\psi$.
  By Proposition~\ref{prop_approx}, $\psi(x)\leftrightarrow\{\psi(x)\}'$.
  Therefore, $\psi'(x)\rightarrow\varphi'(x)$ follows from Fact~\ref{fact_compactness_imp}.
\end{proof}

% \begin{example}
%   The equivalence in the proposition above does not extend to all formulas in ${\EuScript L}^{\rm p}$.
%   For a counter example, let both $M$ and $I$ are the real interval $[0,1]$.
%   The language has a function symbol ${\rm d}$ of sort $M^2\to I$.
%   Its interpretation is ${\rm d}^{\EuScript M}(x,y)=|x-y|$.
%   The formula 
  
%   \ceq{\hfill\varphi}{=}{\exists\varepsilon\big[\varepsilon\in\{0\}\ \wedge\ \exists x,y\ \ {\rm d}(x,y)\cdot\varepsilon\in\{1\}\big]}

%   is false, though every $\varphi'>\varphi$ is true (in ${\EuScript M}$ and any ${\EuScript L}^{\rm p}$-extension of ${\EuScript M}$).\hfill\qedsymbol
% \end{example}


% The following fact is an immediate consequence.



% \begin{corollary}
%   If $\varphi(x),\psi(x)\in{\EuScript L}^{\rm p}(U)$ are mutually inconsistent then there are $\varphi'>\varphi$ and $\psi'>\psi$ that are mutually inconsistent.
% \end{corollary}





% \begin{fact}
%   Let $a\in M^{|x|}$ be such that ${\EuScript M}\not\models\varphi(a)$
%   Then, ${\EuScript M}\not\models\varphi'(a)$ for some $\varphi'>\varphi$.\hfill\qedsymbol
% \end{fact}














% \begin{fact}
%   Let $\varphi(x)\in{\EuScript L}^{\rm p}(A)$, where $A\subseteq M$.
%   Then for every $a\in M^{|x|}$ such that ${\EuScript M}\not\models\varphi(a)$ there is a formula $\tilde\varphi(x)\in{\EuScript L}^{\rm p}(A)$ such that ${\EuScript M}\models\tilde\varphi(a)$ and ${\EuScript M}\models\neg\exists x\,[\tilde\varphi(x)\wedge\varphi(x)]$.
% \end{fact}


% \begin{fact}
%   For every $\varphi(x),\psi(x)\in{\EuScript L}^{\rm p}(U)$ such that $\neg\exists x\,[\varphi(x)\wedge\psi(x)]$ there are $\varphi'>\varphi$ and $\psi'>\psi$ such that $\neg\exists x\,[\varphi'(x)\wedge\psi'(x)]$.
% \end{fact}

% \begin{proof}
%   By Proposition~\ref{prop_approx} and saturation.
% \end{proof}

% The following are immediate consequences of the proposition above and Lemma~\ref{lem_interpolation}.

% \begin{corollary}\label{corol_Hcomplete1}
%   For every $a\in {\EuScript U}^{|x|}$ and $\varphi(x)\in{\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}(U)$, if $\neg\varphi(a)$ then $\tilde\varphi(a)$ for some $\tilde\varphi\perp\varphi$.\hfill\qedsymbol
% \end{corollary}

We write \emph{$\mbox{p/c-tp}(a/A)$\/} for the positive/continuous type of $a$ over $A$, that is, the set of formulas $\big\{\varphi(x)\in{\EuScript L}^{\rm p/c}(A)\ :\ \varphi(a)\big\}$.
In general, if ${\EuScript F}$ is any set of formulas, we write \emph{${\EuScript F}\mbox{-tp}(a/A)$\/} for the type $\big\{\varphi(x)\in{\EuScript F}(A)\ :\ \varphi(a)\big\}$. 
The undecorated symbol \emph{$\mbox{tp}(a/A)$\/} denotes the ${\EuScript L}$-type.

\begin{fact}\label{fact_max_cons_L}
  Let $p(x)\subseteq{\EuScript L}^{\rm p/c}(A)$.
  The following are equivalent
  \begin{itemize}
    \item[1.] $p(x)$ is a subsets of ${\EuScript L}^{\rm p/c}_x(A)$ that is maximally consistent in ${\EuScript U}^{|x|}$;
    \item[2.] $p(x)=\mbox{p/c-tp}(a/A)$ for some $a\in{\EuScript U}^{|x|}$.
  \end{itemize}
\end{fact}

\begin{proof}
  (1$\Rightarrow$2) \ 
  If $p(x)$ is consistent then $p(x)\subseteq\mbox{p/c-tp}(a/A)$  for some $a\in{\EuScript U}^{|x|}$.
  By maximality $p(x)=\mbox{p/c-tp}(a/A)$.

  (2$\Rightarrow$1) \ 
  By Proposition~\ref{prop_approx} and Lemma~\ref{lem_interpolation}

  \ceq{\hfill\varphi(x)}
  {\leftrightarrow}
  {\bigwedge_{\tilde\varphi\perp\varphi}\neg\tilde\varphi(x).}

  Suppose $\varphi(x)\in{\EuScript L}^{\rm p/c}(A)\smallsetminus  p$.
  Then $\neg\varphi(a)$.
  Hence $\tilde\varphi(a)$ holds for some $\tilde\varphi\perp\varphi$.
  Therefore $p(x)\rightarrow\neg\varphi(x)$ follows.
\end{proof}

The Fact~\ref{fact_max_cons_L} extends as follows.

\begin{fact}\label{fact_max_cons_F}
  Let $p(x)\subseteq{\EuScript F}(A)$, where ${\EuScript F}$ is a p/c-dense set of positive/continuous formulas.
  Then the following are equivalent 
  \begin{itemize}
    \item[1.] $p(x)$ is a maximally standardly consistent subset of ${\EuScript F}_x(A)$;
    \item[2.] $p(x)={\EuScript F}\mbox{-tp}(a/A)$ for some $a\in{\EuScript U}^{|x|}$;
    \item[3.] $p(x)\leftrightarrow\mbox{p/c-tp}(a/A)$ for some $a\in{\EuScript U}^{|x|}$.
  \end{itemize}

\end{fact}
  
\begin{proof}
  (1$\Rightarrow$2) \ 
  As above.
  
  (2$\Rightarrow$3) \ 
  As $q(x)\leftrightarrow q'(x)$, then $q(x)\leftrightarrow p(x)={\EuScript F}\mbox{-tp}(a/A)$.

  (3$\Rightarrow$1) \ 
  Immediate.
\end{proof}

\begin{proposition}\label{prop_Fapprox}
  Let ${\EuScript F}$ be a p/c-dense set of positive/continuous formulas.
  Then for every formula $\varphi(x)\in{\EuScript L}^{\rm p/c}$
  
  \ceq{{\rm i.}\hfill\neg\varphi(x)}
  {\leftrightarrow}
  {\bigvee\big\{\psi(x)\in{\EuScript F}\ :\  \psi'(x)\rightarrow\neg\varphi(x)\textrm{ for some }\psi'>\psi\big\};}

  \ceq{{\rm ii.}\hfill\neg\varphi(x)}
  {\leftrightarrow}
  {\bigvee\big\{\neg\psi(x)\ :\ \neg\psi(x)\rightarrow\neg\varphi(x)\textrm{ and }\psi(x)\in{\EuScript F}\big\}.}

\end{proposition}
 
\begin{proof} 
  (i) \ Only $\rightarrow$ requires a proof.
  Let $a\in {\EuScript U}^{|x|}$ be such that $\neg\varphi(a)$.
  Let $p(x)=\mbox{p/c-tp}(a)$.
  By Fact~\ref{fact_max_cons_L}, $p(x)\rightarrow\neg\varphi(x)$.
  As ${\EuScript F}$ is p/c-dense, $p(x)\leftrightarrow q(x)={\EuScript F}\mbox{-tp}(a)$.
  Then $q'(x)\rightarrow\neg\varphi(x)$ hence, by compactness, $\psi'(x)\rightarrow\neg\varphi(x)$ for some $\psi(x)\in{\EuScript F}$.

  (ii) \ By density

  \ceq{\hfill\varphi(x)}
  {\leftrightarrow}
  {\bigwedge\big\{\psi(x)\in{\EuScript F}\ :\ \varphi(x)\rightarrow\psi(x)\big\}.}
  
  Negating both sides of the equivalence we obtain (ii).
\end{proof}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{comment}
\section{Elimination of quantifiers of sort \textsf{I} for positive formulas}\label{Ielimination}

We write \emph{${\EuScript L}^{\rm p/c}_{{\sf I}{\rm qf}}$} for the set of positive/continuous formulas without quantifiers of sort ${\sf I}$.

In this section we show that ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$ is p-dense modulo $T$ (the theory of ${\EuScript U}$).
In plain words, this amounts to the elimination of the quantifiers of sort ${\sf I}$ up to some approximation.
In Section~\ref{cIelimination} we prove the analogous result for ${\EuScript L}^{\rm c}_{{\sf I}{\rm qf}}$.

A partial map is \emph{${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-elementary\/} if it preserves the truth of formulas in ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$.

\begin{proposition}
  Every ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-elementary map $f:{\EuScript U}\to{\EuScript U}$ of small cardinality extends to an automorphism of ${\EuScript U}$.
\end{proposition}

\begin{proof}
  By Fact~\ref{fact_max_cons_L}, the inverse of an ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-elementary map is also ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-elementary.
  Then we can extend the map by back-and-forth as usual.
\end{proof}

Let $A\subseteq{\EuScript U}$ be a small set throughout this section.
We apply the proposition above to obtain a strengthening of Fact~\ref{fact_max_cons_F}.
For $a,b\in {\EuScript U}^{|x|}$ we write \emph{$a\equiv_Ab$\/} if $a$ and $b$ satisfy the same ${\EuScript L}$-formulas over $A$.

\begin{corollary}\label{corol_Lcomplete}
  Let $p(x)={\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}\mbox{-tp}(a/A)$ and $q(x)=\mbox{tp}(a/A)$. Then $p(x)\leftrightarrow q(x)$.
\end{corollary}

\begin{proof}
  Only $\rightarrow$ requires a proof.
  If $b\models p(x)$ then there is an ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-elementary map $f\supseteq{\rm id}_A$ such that $fa=b$.
  Then $f$ extends to an automorphism.
  As every automorphism is ${\EuScript L}$-elementary, $a\equiv_Ab$, and the corollary follows.
\end{proof}

The corollary says that ${\EuScript U}$ does not distinguish between ${\EuScript L}$, ${\EuScript L}^{\rm p}$, and ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$ types.
In the classical setting, from an equivalence between types one derives an equivalence between formulas.
Without negation, this is not true.
Still, we can infer an approximate form of equivalence.

\begin{proposition}\label{prop_LHapprox1}
  The set ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$ is p-dense modulo $T$.
\end{proposition}

\begin{proof}
  Let $\varphi(x)$ be a positive formula.
  We need to prove that for every $\varphi'>\varphi$ there is some formula $\psi(x)\in{\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$ such that $\varphi(x)\rightarrow\psi(x)\rightarrow\varphi'(x)$.
  By Corollary~\ref{corol_Lcomplete} and Proposition~\ref{prop_approx}

  \ceq{\hfill\neg\varphi(x)}{\rightarrow}{\bigvee_{p'(x)\rightarrow\neg\varphi(x)}p'(x)}

  where $p(x)$ ranges over the maximally consistent ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$-types.
  By Fact~\ref{fact_compactness_imp} and Lemma~\ref{lem_interpolation}

  \ceq{\hfill\neg\varphi(x)}{\rightarrow}{\bigvee_{\neg\tilde{\psi}(x)\rightarrow\neg\varphi(x)}\neg\tilde{\psi}(x),}

  where $\tilde{\psi}(x)\in{\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$.
  Equivalently,

  \ceq{\hfill\varphi(x)}{\leftarrow}{\bigwedge_{\tilde{\psi}(x)\leftarrow\varphi(x)}\tilde{\psi}(x).}

  By compactness, see Fact~\ref{fact_compactness_imp}, for every $\varphi'>\varphi$ there are some finitely many $\tilde{\psi}_i(x)\in{\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$ such that

  \ceq{\hfill\varphi'(x)}{\leftarrow}{\bigwedge_{i=1,\dots,n}\tilde{\psi}_i(x)\ \ \leftarrow\ \ \varphi(x)}

  which yields the interpolant required by the proposition.
\end{proof}

% \begin{proposition}\label{prop_LHapprox2}
%   Let $\varphi(x)\in{\EuScript L}^{\rm p}(A)$. For every given $\tilde\varphi\perp\varphi$ there is some $\psi(x)\in{\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}(A)$ such that $\varphi(x)\rightarrow\psi(x)\rightarrow\neg\tilde\varphi(x)$.
% \end{proposition}

  
\end{comment}

%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%
\section{Cauchy completions}\label{Cauchy}

For $\tau(x,z)=\tau_1(x,z),\dots,\tau_n(x,z)$ a tuple of terms of sort ${\sf H}^{|x|+|z|}\to {\sf I}$ we define the formula

\ceq{\hfill\emph{$x\sim_\tau y$}}{=}{\bigwedge_{i=1}^n\forall z\ \ \tau_i(x,z)=\tau_i(y,z),}

where the expression $\alpha=\beta$ is shorthand for $\langle\alpha,\beta\rangle\in\Delta$, where $\Delta$ is the diagonal of $I^2$.
We also define the type 

\ceq{\hfill\emph{$x\sim y$}}{=}{\Big\{x\sim_\tau y\ :\ \tau(x,z)\textrm{ as above}\Big\}.}

The following fact will be used below without mention.
% We define the following equivalence relation on $U$

% \ceq{\hfill\emph{$a\sim b$}}{=}{\forall y\ \big[\tau(a,y)=\tau(b,y)\big]}\hfill 

% When two tuples of the same length $\bar a=\langle a_i:i<\lambda\rangle$ and $\bar b=\langle b_i:i<\lambda\rangle$ are such that $a_i\sim b_i$ for every $i<\lambda$ we write \emph{$\bar a\sim_{\sf I}\bar b$.}

\begin{fact}\label{fact_productUniformity}
  For any $a=\langle a_i:i<\lambda\rangle$ and $b=\langle b_i:i<\lambda\rangle$ 
  
  \ceq{\hfill a\sim b}{\Leftrightarrow}{a_i\sim b_i}\quad for every $i<\lambda$.
\end{fact}

\begin{proof} 
  \def\ceq#1#2#3{\parbox[t]{30ex}{$\displaystyle #1$}\parbox[t]{6ex}{\hfil $#2$}{$\displaystyle #3$}}
  %
  By induction.
  Only implication $\Leftarrow$ requires a proof
  For limit ordinals induction is trivial.
  Assume $a_i\sim b_i$ for every $i\le\lambda$.
  Let $|a|=|b|=\lambda$ and assume inductively that (note that it suffices to consider tuples $\tau$ of arity $1$) 
  
  \ceq{\hfill\forall y,z\ \ \ \tau(a,y,z)}{=}{\tau(b,y,z)}

  holds for every term $\tau(x,y,z)$, with $|x|=\lambda$ and $|y|=1$ (universal quantification over the free variables is understood throughout the proof).
  In particular for any $a_\lambda$

  \ceq{1.\hfill\forall z\ \ \  \tau(a,a_\lambda,z)}{=}{\tau(b,a_\lambda,z).}

  As $a_\lambda\sim b_\lambda$ then

  \ceq{\hfill\forall x,z\ \ \   \tau(x,a_\lambda,z)}{=}{\tau(x,b_\lambda,z)}

  and in particular 

  \ceq{2.\hfill\forall z\ \ \ \tau(b,a_\lambda,z)}{=}{\tau(b,b_\lambda,z).}

  From (1) and (2) we obtain

  \ceq{\hfill\forall z\ \ \ \tau(a,a_\lambda,z)}{=}{\tau(b,b_\lambda,z).}
\end{proof}

Note that the approximations of the formula $x\sim_\tau\!y$ have the form

\ceq{\hfill\emph{$x\sim_{\tau,D} y$}}{=}{\bigwedge_{i=1}^n\forall z\ \ \langle \tau_i(x,z),\tau_i(y,z)\rangle\in D}

for some compact neighborhood $D$ of $\Delta$.
We write \emph{${\EuScript E}$} for the set containing the pairs $\tau,D$ as above.
The formulas $x\sim_\varepsilon\! y$, as $\varepsilon$ ranges over ${\EuScript E}$, form a base for a system of entougages on ${\EuScript U}^{|x|}$.
We refer to this uniformity and the topology associated as the topology \emph{induced by $I$.}
Though not needed in the sequel, it is worth mentioning that the topology induced by $I$ on ${\EuScript U}^{|x|}$ coincides with the product of the topology induced by $I$ on ${\EuScript U}$.
This can be verified by an argument similar to the proof of Fact~\ref{fact_productUniformity}.

\begin{fact}\label{fact_continuous}
  For every $\varphi(x)\in{\EuScript L}^{\rm c}$ 

  \ceq{\hfill x\sim y}{\rightarrow}{\varphi(x)\leftrightarrow\varphi(y)}
\end{fact}

\begin{proof}
  By induction.% on $\varphi(x,\eta)$.
  % Suppose $\varphi(x,\eta)$ as the form $\tau(x,\eta)\in C$.
  % Then clearly
  %
  % \ceq{\hfill x\sim_\tau y}{\rightarrow}{\varphi(x,\eta)\leftrightarrow\varphi(y,\eta)}
  %
  % Induction is easy.
  % As an example, we spell out the proof for the quantifier $\exists^{\scriptscriptstyle\sf H}$.
  % Assume inductively that
  %
  % \ceq{\hfill x,x'\sim y,y'}{\rightarrow}{\varphi(x,x',\eta)\leftrightarrow\varphi(y,y',\eta)}
  %
  % Then in paricular 
  %
  % \ceq{\hfill x\sim y}{\rightarrow}{\varphi(x,z,\eta)\leftrightarrow\varphi(y,z,\eta).}
  %
  % Therefore
  %
  % \ceq{\hfill x\sim y}{\rightarrow}{\exists z\,\varphi(x,z,\eta)\leftrightarrow\exists z\,\varphi(y,z,\eta).} 
\end{proof}

We define

\ceq{\hfill\emph{$x\sim'y$}}{=}{\Big\{x\sim_\varepsilon\! y\ :\ \varepsilon\in{\EuScript E}\Big\}.}

The following corollary corresponds to the Perturbation Lemma~\cite{HI}*{Proposition~5.15}.

\begin{corollary}\label{corol_pertubation}
  For every $\varphi(x)\in{\EuScript L}^{\rm c}$ and every $\varphi'>\varphi$ there an $\varepsilon\in{\EuScript E}$ such that

  \ceq{{\rm i.}\hfill x\sim_\varepsilon\! \!y\ \wedge\ \varphi(y)}{\rightarrow}{\varphi'(x)}
\end{corollary}

\begin{proof}
  As $x\sim' y\ \cup\ \big\{\varphi(x)\big\}\ \rightarrow\ \varphi(y)$ by Fact~\ref{fact_continuous}, (i) follows from Fact~\ref{fact_compactness_imp}.
\end{proof}



We say what a type $q(x)$ is \emph{finitely satisfiable\/} in $A$ if every conjunction of formulas in $q(x)$ has a solution in $A^{|x|}$.
This definition coincides with the classical one, but in our context, the notion is less roboust.
We may happen that $p(x)$ is finitely satisfiable while $q(x)\leftrightarrow p(x)$ is not.
In particular if $M$ is a p-model and $q(x)=\mbox{p-tp}(a/M)$ then $q'(x)$ is always finitely satisfiable while $q(x)$ need not.

% It is immediate that ${\EuScript L}^{\rm p}$-formulas constructed without using (ii) of Definition~\ref{def_LL} are ${\sf I}$-invariant.
A set $A\subseteq{\EuScript U}$ is \emph{Cauchy complete\/} if it contains all those $a\in{\EuScript U}$ such that $a\sim'x$ is finitely satisfied in $A$.
Note that Cauchy complete sets are in particular closed under the equivalence $(\sim)$.
The \emph{Cauchy completion\/} of $A$ is the set 

\ceq{\hfill\emph{${\rm Ccl}(A)$}}{=}{\big\{a:a\sim'x\textrm{ is finitely satisfied in }A\big\}}.

\begin{fact}\label{fact_finsat}
  ${\rm Ccl}(A)$ is Cauchy complete.
\end{fact}

\begin{proof}
  Suppose that $x\sim'a$ is finitely satisfied in ${\rm Ccl}(A)$.
  Let $\varepsilon\in{\EuScript E}$ be given.
  We prove that  $a\sim_\varepsilon\! x$ is satisfied in $A$.
  Let $\eta\in{\EuScript E}$ be such that $x\sim_\eta y\sim_\eta z\ \rightarrow\ x\sim_\varepsilon\! z$.
  There is some $b\in{\rm Ccl}(A)$ such that $b\sim_\eta a$.
  There is some $c\in A$ such that $c\sim_\eta b$.
  Then $c$ satisfies $x\sim_\varepsilon\! a$, as required.
\end{proof}

We say that $p(x)\subseteq{\EuScript L}^{\rm c}({\EuScript U})$ is a \emph{Cauchy type\/} if it is consistent and $p(x)\wedge p(y)\rightarrow x\sim y$.

\begin{fact}
  Let $M$ be a p/c-model and let $p(x)\subseteq{\EuScript L}^{\rm P/c}(M)$ be a Cauchy type.
  Then all realizations of $p(x)$ belong to ${\rm Ccl}(M)$.
\end{fact}

\begin{proof}
  If $p(x)$ is a Cauchy type, then $p(x)\rightarrow a\sim x$ for some $a\models p(x)$.
  As $M$ is a c-model, $p'(x)$ is finitely satisfied in $M$. 
  Then also $a\sim' x$ is finitely satisfied. 
  Hence $a\in{\rm Ccl}(M)$.
  % Assume that $a\sim'x$ is finitely satisfied in $A$. 
  % Let $a_{\tau,D}\in A$ be a solution of $a\sim_\varepsilon\! x$ where $\tau$ ranges over the finite tuples parameter-free terms and $D$ ranges over the compact neighborhoods of the diagonal.
  % Then, by the uniqueness of the limit (up to $\sim$-equivalence), the type $p(x)$ containing the formulas $x\sim_\varepsilon\! a_{\tau,D}$ is a Cauchy type.
  % Then $\Bar A$ contains all realizations of $p(x)$.
\end{proof}



%  (2$\Rightarrow$1)
%  Let $p(x)\subseteq{\EuScript L}^{\rm c}(M)$ be a Cauchy type.
% Then $p(x)\rightarrow a\sim x$ for some $a\models p(x)$.
% By (ac) above, $p'(x)$ is finitely satisfied in $M$. 
% Then also $a\sim' x$ is finitely satisfied. 
% Therefore, by (2), $p(x)$ is realized in $M$. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Morphims}\label{morphisms}

\begin{comment}
Let ${\EuScript F}$ be a set of formulas.
We say that the map $f:{\EuScript U}\rightarrow{\EuScript U}$ preserves the truth of formulas in ${\EuScript F}$ if $\varphi(a)\rightarrow\varphi(fa)$ for every $\varphi(x)\in{\EuScript F}$.
If ${\EuScript F}$ is ${\EuScript L}^{\rm p}$, we say that $f$ is \emph{p-elementary.}

It is easy to see that p-elemenrary maps are always injective (because it preserves the inequalities of sort ${\sf H}$).
By the following fact, also $f^{-1}$ is p-elementary.

\begin{fact}\label{fact_pel_invertible}
  Let ${\EuScript F}$ be a p-dense set of positive formulas. 
  If $f$ preserve the truth of formulas in ${\EuScript F}$, then $\varphi(a)\leftrightarrow\varphi(fa)$ for every $\varphi(x)\in{\EuScript L}^{\rm p}$ and every $a\in({\rm dom }f)^{|x|}$.
\end{fact}

\begin{proof}
  Assume $\neg\varphi(a)$ and apply Proposition~\ref{prop_Fapprox} to infer that  $\psi(fa)$ holds for some $\psi(x)\in{\EuScript L}^{\rm p}$ that implies $\neg\varphi(x)$.
\end{proof}

If $f$ is p-elementary, ${\rm dom}f\subseteq M$, and ${\rm range}f\subseteq N$ then we say that $f:M\rightarrow N$ is p-elementary.
This terminology is convenient but imprecise.
More correctly, in~\cite{clcl} such maps are called \textit{approximate\/} p-elementary.
In fact, from the elementarity of $f:{\EuScript U}\rightarrow{\EuScript U}$ we can (only) infer that

\ceq{\hfill M\models\{\varphi(a)\}'}{\Leftrightarrow}{N\models\{\varphi(fa)\}'.}

As below we always evaluate formulas in ${\EuScript U}$, we can safely drop the modifier \textit{approximate}.
  
\end{comment}

The notion of p-elementarity is discussed in detail in~\cite{clcl}.
In this section we are mostly concerned with the continuous case.
This is delicate due to the lack of equality of sort ${\sf H}$.
A possible approach is to work in the quotient ${\EuScript U}/{\sim}$.
A second possibility is to replace functions with relations.
The two options differs only in the notation.
Here we go for the second.

For semplicity, we only discuss morphisms between saturated structures.
We fix, besides ${\EuScript U}$, a second saturated structure ${\EuScript V}$.

Let $R\mathrel{\subseteq}{\EuScript U}\times{\EuScript V}$ be a binary relation.
If $a=\langle a_i:i<\lambda\rangle$ and $b=\langle b_i:i<\lambda\rangle$ we write $\langle a,b\rangle\in R$ to abbreviate: $\langle a_i,b_i\rangle\in R$ for all $i<\lambda$.
Let ${\EuScript F}$ be a set of formulas.
We say that $R$ preserves the truth of ${\EuScript F}$-formulas if 

\ceq{\#\hfill{\EuScript U}\models\varphi(a)}{\Rightarrow}{{\EuScript V}\models\varphi(b)}\hfill for every $\varphi(x)\in{\EuScript F}$ and every $\langle a,b\rangle\in R$.

We will consider four extreem cases for ${\EuScript F}$: the set of all positive/continuous formulas and the set of atomic positive/continuous formulas.
We donote the latter by \emph{${\EuScript L}^{\rm p/c}_{\rm at}$.}
Relations that preserve the truth of ${\EuScript L}^{\rm p/c}$-formulas are called \emph{p/c-elementary.}
Note that in p-elementary relations are (graphs of) injective functions and some of the facts below become trivial. 

% Below, for simplicity we only consider c-elementary relations between ${\EuScript U}$ and itself.
% Then, by Fact~\ref{fact_HImorphisms} and Proposition~\ref{prop_approx}, the condition above is aquivalent to

By the following fact, if $R$ preserves the truth of ${\EuScript F}$-formulas so does $R^{-1}$.

\begin{fact}\label{fact_Rinverse}
  Let ${\EuScript F}$ be either ${\EuScript L}^{\rm p/c}$ or ${\EuScript L}^{\rm p/c}_{\rm at}$.
  Let $R$ be a relation that preserves the truth of ${\EuScript F}$-formulas.
  Then the converse implication in (\#) holds.
\end{fact}

\begin{proof}
  ${\EuScript F}={\EuScript L}^{\rm p/c}$. \ 
  Assume ${\EuScript U}\models\neg\varphi(a)$ and apply Proposition~\ref{prop_Fapprox} to infer that ${\EuScript U}\models\psi(a)$ for some $\psi(x)\in{\EuScript L}^{\rm c}$ that implies $\neg\varphi(x)$.
  Then ${\EuScript V}\models\neg\varphi(b)$ follows.

  ${\EuScript F}={\EuScript L}^{\rm p/c}_{\rm at}$. \ 
  Assume ${\EuScript U}\models\tau(a)\notin C$ then ${\EuScript U}\models\tau(a)\in\tilde{C}$ for some compact $\tilde{C}$ disjoint of $C$.
  Then ${\EuScript V}\models\tau(b)\notin C$ follows.
\end{proof}

% The relation $(\sim)$ is c-elementary by Fact~\ref{fact_continuous}.
% Therefore, if $R$ is c-elementary, also $\mathrel{(\sim)}\circ \mathrel{R}\circ\mathrel{(\sim)}$ is c-elementary.
% We identify a c-elementary relation $R\ =\ \mathrel{(\sim)}\circ\mathrel{R}\circ\mathrel{(\sim)}$ with the map 
%
% \ceq{\hfill R_{/\sim}\ \ :\ \ {\EuScript U}/{\sim}}{\to}{{\EuScript U}/{\sim}}
%
% \ceq{\hfill [a]\ }{\mapsto}{\ [b]} \hfill for some/any $b$ such that $\langle a,b\rangle\in R$.
%
% It is easy to verify that the definition is well-given and that $R_{/\sim}$ is injective.

We denote by the same symbol $(\sim)$ the equivalence relation defined in Section~\ref{Cauchy} in ${\EuScript U}$ and ${\EuScript V}$.
The context will disambiguate.
We say that the relation $R$ is \emph{reduced\/} if there is no $R'\ \subset\ R$ such that $R\ \subseteq\ \mathrel{(\sim)}\circ \mathrel{R'}\circ\mathrel{(\sim)}$.

\begin{fact}
  For every $R$ there is a reduced relation $R'\subseteq R$ such that 
  
  \ceq{\hfill\mathrel{(\sim)}\circ \mathrel{R}\circ\mathrel{(\sim)}}{=}{\mathrel{(\sim)}\circ \mathrel{R'}\circ\mathrel{(\sim)}.}
\end{fact}

\begin{proof}
  Let $\langle R_i:i<\lambda\rangle$ be a decreasing chain of maximal length of relations such that $R_i\mathrel{\subseteq}R\ \subseteq\ \mathrel{(\sim)}\circ \mathrel{R_i}\circ\mathrel{(\sim)}$.
  Let  $R'$ the intersection  of the chain.
  By maximality, $R'$ is a reduced relation.
  Finally, $\mathrel{(\sim)}\circ \mathrel{R}\circ\mathrel{(\sim)}\ \ =\ \mathrel{(\sim)}\circ \mathrel{R'}\circ\mathrel{(\sim)}$ is clear.
\end{proof}

% Note that if the relations $R_i$ are such that $R\ \subseteq\ \mathrel{(\sim)}\circ \mathrel{R_i}\circ\mathrel{(\sim)}$, for every $i<\lambda$, then 

% \ceq{\hfill R}{\subseteq}{\mathrel{(\sim)}\circ\;\Big(\bigcap_{i<\lambda}R_i\Big)\;\circ\mathrel{(\sim)}.}

% It follows that for every $R$ there is a reduced $R'\ \subseteq\ R\ \subseteq\ \mathrel{(\sim)}\circ \mathrel{R'}\circ\mathrel{(\sim)}$.
% When $R\ =\ \mathrel{(\sim)}\circ \mathrel{R}\circ\mathrel{(\sim)}$ then the converse inclusion is obvious and we obtain that $R\ =\ \mathrel{(\sim)}\circ \mathrel{R'}\circ\mathrel{(\sim)}$.

\begin{fact}\label{fact_reduced_funct} 
  Let ${\EuScript F}={\EuScript L}^{\rm c}$.
  Let $R$ be a reduced relation that preserves of the truth of ${\EuScript F}$-formulas.
  Then $R$ is (the graph of) an injective map $f:{\rm dom}(R)\to{\rm range}(R)$.

  The same holds when ${\EuScript F}={\EuScript L}^{\rm c}_{\rm at}$ if ${\rm dom}(R)$ and ${\rm range}(R)$ are c-models.
\end{fact}

\begin{proof}
  ${\EuScript F}={\EuScript L}^{\rm c}$. \ 
  Let $a\in{\rm dom}(R)$ and assume that $\langle a,b\rangle,\langle a,b'\rangle\in R$.
  To prove functionality suppose for a contradiction that $b\neq b'$.
  As $R$ is reduced, $b\not\sim b'$.
  Then $b\not\sim_\varepsilon b'$ for some $\varepsilon\in{\EuScript E}$.
  By Proposition~\ref{prop_Fapprox} $b,b'$ satisfies a continuous formula $\psi(x,x')$ that implies  $x\not\sim_\varepsilon x'$.
  Then $a,a$ also satisfies $\psi(x,x')$, a contradiction.
  This proves functionality, for injectivity apply the same argument to $R^{-1}$.

  ${\EuScript F}={\EuScript L}^{\rm c}_{\rm at}$. \ 
  Reason as above to obtain $b\not\sim_\varepsilon b'$, say $\varepsilon=\langle\tau,D\rangle$.
  Then the formula 
  
  \ceq{\hfill\neg\varphi(b,b',z)}{=}{\neg\bigwedge_{i=1}^n\langle\tau_i(b,z),\tau_i(b',z)\rangle\in D}.
  
  is consistent.
  By the Tarski-Vaught test (Theorem~\ref{thm_Tarski_Vaught}) $\neg\varphi(b,b',z)$ has a solution, say $c$, in ${\rm range}(R)^{|z|}$.
  Then $\neg\varphi(a,a,d)$ for some $d\mathrel{R} c$ which is a contradiction.
\end{proof}

Let $f \subseteq\ R$ be a reduced c-elementary relation such that $R\ \subseteq\ \mathrel{(\sim)}\circ \mathrel{f}\circ\mathrel{(\sim)}$.
Then $f$ is a function defined in exacly one representative $a$ of each $(\sim)$-equivalence class $[a]$ that intersects ${\rm dom}(R)$.

\begin{fact}\label{fact_Rcompletion}
  Let ${\EuScript F}$ be either ${\EuScript L}^{\rm c}$ or ${\EuScript L}^{\rm c}_{\rm at}$.
  The following are equivalent
  \begin{itemize}
    \item[1.] $R$ preserves the truth of ${\EuScript F}$-formulas;
    \item[2.] ${\rm Ccl}(R)$ preserves the truth of ${\EuScript F}$-formulas.
  \end{itemize}
\end{fact}

\begin{proof}
  We prove the nontrivial implication, 1$\Rightarrow$2.
  Let $\varphi(x)\in{\EuScript F}$ and $\varphi''>\varphi'>\varphi$ be given.
  Let $\langle a,b\rangle\in{\rm Ccl}(R)$ and assume $\varphi(a)$.
  Let $\varepsilon\in{\EuScript E}$ be such that 

  \ceq{1.\hfill x\sim_\varepsilon\! y\wedge\varphi\phantom{'}(x)}{\rightarrow}{\varphi'(y)}

  \ceq{2.\hfill x\sim_\varepsilon\! y\wedge\varphi'(x)}{\rightarrow}{\varphi''(y)}

  By the definition of Cauchy completion, there are $a',b'\sim_\varepsilon\! a,b$ such that $\langle a',b'\rangle\in R$.
  Then from (1) we infer that $\varphi'(a')$.
  Note that $\varphi'(x)\in{\EuScript F}$, then $\varphi'(b')$. 
  Then $\varphi''(b)$ follows from (2).
  As $\varphi''>\varphi$ is arbitrary, the fact follows from Proposition~\ref{prop_approx}.
\end{proof}

\begin{definition}\label{def_ciso}
  Let $M$ and $N$ be p/c-elementary substructures of ${\EuScript U}$, respectively ${\EuScript V}$.
  An \emph{p/c-isomorphism\/} between $M$ and $M$ is a relation $R$ that preserves the truth of ${\EuScript L}^{\rm p/c}_{\rm at}$-formulas and $M={\rm dom}(R)$,  $N={\rm range}(R)$.
\end{definition}

 It is clear that p-isomorphisms coincide with ${\EuScript L}$-isomorphisms. 
 Indeed, in this case $R$ is a bijective function that preserve the truth of atomic and, by Fact~\ref{fact_Rinverse}, negated atomic formulas.
 On the other hand, in the continuous case the term isomorphism may sound inappropriate.
 It is justified by the following fact.

\begin{fact}\label{fact_c_iso}
  Let $R$ be a c-isomorphism between $M$ and $N$.
  Let $f\subseteq{\rm Ccl}(R)$ be a reduced relation such that ${\rm Ccl}(R)\ =\ \mathrel{(\sim)}\circ \mathrel{f}\circ\mathrel{(\sim)}$.
  Then $f:{\rm Ccl}(M)\rightarrow{\rm Ccl}(N)$ is an injective map such that 
  
  \ceq{\hfill{\EuScript U}\models\varphi(a)}{\Leftrightarrow}{{\EuScript V}\models\varphi(fa)}\hfill for all $\varphi(x)\in{\EuScript L}^{\rm c}$ and $a\in{\rm dom}(f)^{|x|}$.
\end{fact}

\begin{proof}
  From Fact~\ref{fact_reduced_funct} we obtain that $f:{\rm Ccl}(M)\rightarrow{\rm Ccl}(N)$ is an injective map.
  To prove $\varphi(a)\leftrightarrow\varphi(fa)$ we reason by induction as in the classical case.
\end{proof}

Note that, though $f:{\rm Ccl}(M)\rightarrow{\rm Ccl}(N)$ above is neither total nor surjective, ${\rm dom}(f)$ and ${\rm range}(f)$ intersect every $(\sim)$-equivalence class.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Elimination of quantifiers of sort \textsf{I}}\label{cIelimination}

We write \emph{${\EuScript L}^{\rm p/c}_{{\sf I}{\rm qf}}$} for the set of positive/continuous formulas without quantifiers of sort ${\sf I}$.
In~\cite{clcl} it is proved that ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$ is a p-dense set.
Here we adapt the argument so that it it applies also to the continuous case.

\begin{proposition}\label{prop_Iqf_elim}
  Every relation of small cardinality $R$ that preserves the truth of formulas in ${\EuScript L}^{\rm p/c}_{{\sf I}{\rm qf}}$ extends to p/c-automorphisms of ${\EuScript U}$.
\end{proposition}

\begin{proof}
  We prove the proposition in the continuous case.
  A simplified version of the same argument applies to the positive case.

  We construct by back-and-forth a sequence $f_i:{\EuScript U}\rightarrow{\EuScript U}$ of reduced relations (i.e.\@ injective maps) that preserve the truth formulas in ${\EuScript L}^{\rm c}_{{\sf I}{\rm qf}}$.
  Finally we set 
  
  \ceq{\hfill R}{=}{\bigcup_{i\in|{\EuScript U}|}(\sim)\circ f_i\circ(\sim).}

  We will ensure that ${\EuScript U}={\rm dom}(R)={\rm range}(R)$, hence that $R$ is a c-automorphism of ${\EuScript U}$.

  Let $i$ be even.
  Let $a$ be an enumeration of ${\rm dom}(f_n)$.
  Let $b\in{\EuScript U}$. 
  Let $p(x,y)=\mbox{c-tp}(a,b)$.
  By c-elementarity the type $p(f_ia,y)$ is finitely satisfied.
  Let $c\in{\EuScript U}$ realize $p(f_ia,y)$.
  Let $f_{i+1}$ be a reduced relation such that $f_{i+1}\ \subseteq\ f_i\cup\{\langle b,c\rangle\}\ \subseteq\ (\sim)\circ f_{i+1}\circ(\sim)$.

  When $i$ is odd we proceed similarly with $f_i^{-1}$ for $f_i$.
  Limit stages are obvious.
\end{proof}

\begin{corollary}\label{corol_cLcomplete}
  % Let $a\in{\EuScript U}^{|x|}$.
  Let $p(x)$ and $q(x)$ be as in (i) or (ii) below.
  Then $p(x)\leftrightarrow q(x)$.
  \begin{itemize}
    \item[i.] $p(x)={\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}\mbox{-tp}(a)$ and $q(x)=\mbox{tp}(a)$.
    \item[ii.] $p(x)={\EuScript L}^{\rm c}_{{\sf I}{\rm qf}}\mbox{-tp}(a)$ and $q(x)=\mbox{c-tp}(a)$.
  \end{itemize}
\end{corollary}

\begin{proof}
  (i) \ 
  By Proposition~\ref{prop_Iqf_elim} as p-isomorphisms are ${\EuScript L}$-isomorphisms.


  (ii) \ 
  Only $\rightarrow$ requires a proof.
  If $a$ contains entries $a_i\sim a_j$, replace $a_j$ with $a_i$.
  Note that the tuple $a'$ obtained in this manner has the same c-type of $a$.
 
  Let $b\models p(x)$ and let $b'$ obtained with the same procedure as $a'$.
  
  Then the function that maps $a'\mapsto b'$ preserves the truth of ${\EuScript L}^{\rm c}_{{\sf I}{\rm qf}}$-formulas.
  Then $f$ extends to an c-automorphism.
  As every c-automorphism is c-elementary and the corollary follows.
\end{proof}

\begin{proposition}\label{prop_cLHapprox1}
  The set ${\EuScript L}^{\rm p/c}_{{\sf I}{\rm qf}}$ is p/c-dense modulo $T$.
\end{proposition}

\begin{proof}
  Let $\varphi(x)$ be a positive formula.
  We need to prove that for every $\varphi'>\varphi$ there is some formula $\psi(x)\in{\EuScript L}^{\rm p/c}_{{\sf I}{\rm qf}}$ such that $\varphi(x)\rightarrow\psi(x)\rightarrow\varphi'(x)$.
  By Corollary~\ref{corol_cLcomplete} and Proposition~\ref{prop_approx}

  \ceq{\hfill\neg\varphi(x)}{\rightarrow}{\bigvee_{p'(x)\rightarrow\neg\varphi(x)}p'(x)}

  where $p(x)$ ranges over the maximally consistent ${\EuScript L}^{\rm p/c}_{{\sf I}{\rm qf}}$-types.
  By Fact~\ref{fact_compactness_imp} and Lemma~\ref{lem_interpolation}

  \ceq{\hfill\neg\varphi(x)}{\rightarrow}{\bigvee_{\neg\tilde{\psi}(x)\rightarrow\neg\varphi(x)}\neg\tilde{\psi}(x),}

  where $\tilde{\psi}(x)\in{\EuScript L}^{\rm p/c}_{{\sf I}{\rm qf}}$.
  Equivalently,

  \ceq{\hfill\varphi(x)}{\leftarrow}{\bigwedge_{\tilde{\psi}(x)\leftarrow\varphi(x)}\tilde{\psi}(x).}

  By compactness, see Fact~\ref{fact_compactness_imp}, for every $\varphi'>\varphi$ there are some finitely many $\tilde{\psi}_i(x)\in{\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$ such that

  \ceq{\hfill\varphi'(x)}{\leftarrow}{\bigwedge_{i=1,\dots,n}\tilde{\psi}_i(x)\ \ \leftarrow\ \ \varphi(x)}

  which yields the interpolant required by the proposition.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{The Tarski-Vaught test and the L\"owenheim-Skolem theorem}

The following proposition is our version of the Tarski-Vaught test.

\begin{theorem}\label{thm_Tarski_Vaught}
  Let $M$ be a subset of ${\EuScript U}$.
  Let ${\EuScript F}$ be a p-dense set of positive formulas.
  Then the following are equivalent
  \begin{itemize}
    \item[1.] $M$ is a p-model;
    \item[2.] for every formula $\psi(x)\in{\EuScript F}(M)$
    
    \noindent\kern-\leftmargin
    \ceq{\hfill\exists x\,\psi(x)}{\Rightarrow}
    {\textrm{ for every }\psi'>\psi\textrm{ there is an }a\in M\textrm{ such that }\psi'(a);}
  
    \item[3.] for every formula $\psi(x)\in{\EuScript F}(M)$
    
    \noindent\kern-\leftmargin
    \ceq{\hfill \exists x\,\neg\psi(x)}{\Rightarrow}
    {\textrm{ there is an }a\in M\textrm{ such that }\neg\psi(a).}
  \end{itemize}
  If ${\EuScript F}$ is a c-dense set of continuous formulas then (2) and (3) are equivalent to
  \begin{itemize}
    \item[1$'$.] ${\rm Ccl}(M)$ is a c-model.
  \end{itemize}
  Moreover, if $M$ is a substructure, then (1$'$), (2) and (3) are equivalent to
  \begin{itemize}
    \item[1$''$.] $M$ is a c-model.
  \end{itemize}
\end{theorem}

\begin{proof}
  (1$\Rightarrow$2) \ 
  Assume $\exists x\,\psi(x)$ and let $\psi'>\psi$ be given.
  By Lemma~\ref{lem_interpolation} there is some $\tilde{\psi}\perp\psi$ such that  $\psi(x)\rightarrow\neg\tilde{\psi}(x)\rightarrow\psi'(x)$.
  Then $\neg\forall x\,\tilde{\psi}(x)$ hence, by (1), $M\models\neg\forall x\,\tilde{\psi}(x)$.
  Then $M\models\neg\tilde{\psi}(a)$ for some $a\in M$. Hence $M\models\psi'(a)$ and $\psi'(a)$ follows from (1).

  (2$\Rightarrow$3) \ 
  Assume (2) and let $\psi(x)\in{\EuScript F}(M)$ be such that $\exists x\,\neg\psi(x)$.
  By Proposition~\ref{prop_Fapprox}.i, there are a consistent $\varphi(x)\in{\EuScript F}(M)$ and some $\varphi'>\varphi$ such that $\varphi'(x)\rightarrow\neg\psi(x)$.
  Then (3) follows.

  (3$\Rightarrow$2) \ 
  Let $\psi'>\psi$ for some $\psi(x)\in{\EuScript F}(M)$.
  Let $\tilde{\psi}\bot\psi$ such that $\psi(x)\rightarrow\neg\tilde{\psi}(x)\rightarrow\psi'(x)$.
  By Proposition~\ref{prop_Fapprox}.ii, $\neg\varphi(x)\rightarrow\neg\tilde{\psi}(x)$ for some $\varphi(x)\in{\EuScript F}(M)$ such that $\neg\varphi(x)$ is consistent.
  Then (2) follows from (3).
  
  (2$\Rightarrow$1) \ 
  Assume (2).
  By the classical Tarski-Vaught test $M\preceq_{\sf H}{\EuScript U}$.
  Then $M$ is the domain of a substructure of ${\EuScript U}$.
  Then $M\models\varphi(a)\ \Rightarrow\ \varphi(a)$ holds for every atomic formula $\varphi(x)$ and for every $a\in M^{|x|}$.
  Now, assume inductively
  
  \ceq{\hfill M\models\varphi(a,b)}{\Rightarrow}{\varphi(a,b).}

  Using (2) and the induction hypothesis we prove that

  \ceq{\hfill M\models\exists y\,\varphi(a,y)}{\Rightarrow}{\forall y\,\varphi(a,y)}.

  Indeed, for any $\varphi'>\varphi$,

  \ceq{\hfill M\models\exists y\,\varphi(a,y)}
  {\Rightarrow}{M\models\exists y\,\psi(a,y)}\hfill for some $\psi\in{\EuScript F}$ such that $\varphi\rightarrow\psi\rightarrow\varphi'$
  
  \ceq{}
  {\Rightarrow}
  {M\models\psi(a,b)}\hfill for some $b\in M$ by (2)
  
  \ceq{}
  {\Rightarrow}
  {M\models\varphi'(a,b)}
  
  \ceq{}
  {\Rightarrow}
  {\varphi'(a,b)}\hfill by induction hypothesis

  \ceq{}
  {\Rightarrow}
  {\exists y\,\varphi'(a,y).}

  As $\varphi'>\varphi$ is arbitrary, $\exists y\,\varphi(a,y)$ follows from Proposition~\ref{prop_approx}.

  Induction for the connectives $\vee$, $\wedge$, $\forall\raisebox{1.1ex}{\scaleto{\sf H}{.8ex}\kern-.2ex}$, $\exists\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}$, and $\forall\raisebox{1.1ex}{\scaleto{\sf I}{.8ex}\kern-.2ex}$ is straightforward.

\hfil***

  (1$'\!\Rightarrow$2) \ 
  Let $\psi'>\psi''>\psi$.
  Reasoning as in the proof of (1$\Rightarrow$2) we obtain that ${\rm Ccl}(M)\models\psi''(a)$ for some $a\in{\rm Ccl}(M)$.
  By Corollary~\ref{corol_pertubation}, $a\sim_\varepsilon\! x\rightarrow\psi'(x)$ for some $\varepsilon$.
  As $a\sim'x$ is finitely satisflied in $M$, it follows that $\psi'(c)$ for some $c\in M$.

  (2$\Leftrightarrow$3) \ 
  The proof above applies verbatim when ${\EuScript F}$ is a c-dense set of continuous formulas.
  
  (2$\Rightarrow$1$'$) \ 
  Assume (2).
  We claim that ${\rm Ccl}(M)$ is a substructure of ${\EuScript U}$.  
  Let $a\in M^{n}$ and let $f$ be a function symbol of sort ${\sf H}^{n}\to{\sf H}$.
  We prove that $fa\in M$.
  We show that $fa\sim' x$ is finitely satisfied in $M$.
  Consider the formula $fa\sim_\varepsilon\!  x$ where $\varepsilon$ is the pair $\tau,D$.
  By Lemma~\ref{lem_interpolation}, there is a formula in $\tilde\varphi(x)\in{\EuScript L}^{\rm p}(M)$ such that
  
  \ceq{\hfill fa\sim_\tau x}{\rightarrow}{\neg\tilde\varphi(x)}\parbox{6ex}{\hfil$\rightarrow$}$fa\sim_\varepsilon\!  x$

  By Fact~\ref{fact_Fdense}.ii there is a consistent formula  $\neg\psi(x)$, for some $\psi(x)\in{\EuScript F}(M)$, that implies $fa\sim_\varepsilon\!  x$.
  Then, by (3), $fa\sim_\varepsilon\!  x$ is satisfied in $M$.
  This proves our claim.

  Now, we claim that (2) holds also for every $\psi(x)\in{\EuScript F}\big({\rm Ccl}(M)\big)$.
  Let $\psi(x,z)\in{\EuScript F}(M)$ and $\psi'>\psi$ be given.
  Let $b\in{\rm Ccl}(M)^{|z|}$.
  Suppose that $\exists x\,\psi(x,b)$ and let $\varepsilon$ be such that $z\sim_\varepsilon\! b\rightarrow\exists x\,\psi''(x,z)$ where $\psi'>\psi''>\psi$.
  By Corollary~\ref{corol_pertubation}, we can also assume that $z\sim_\varepsilon\! b\wedge\psi''(x,z)\rightarrow\psi'(x,b)$. 
  Let $b'\in M^{|z|}$ be such that $b'\sim_\varepsilon\! b$.
  By (2) there is an $a\in M^{|x|}$ such that $\psi''(a,b')$.
  Then $\psi'(a,b)$ follows.
  This proves the second claim.

  By the two claims above, the inductive argument in the proof in (2$\Rightarrow$1) applies to prove that ${\rm Ccl}(M)$ is a c-model.

  \hfil***

  (1$''\!\Rightarrow$2) \ 
  By the same argument as in (1$\Rightarrow$2).


  (2$\Rightarrow$1$''$) \ 
  As $M$ is a substructure by assumption, the inductive argument in the proof in (2$\Rightarrow$1) applies.
\end{proof}


% \begin{remark}
%   We will need the Tarski-Vaught test for strong p-models.
%   The classical proof yields the following:
%   if $M$ and ${\EuScript F}$ are as above, then the following are equivalent
%   \begin{itemize}
%     \item[1.] $M$ is a strong p-model;
%     \item[2.] for every formula $\psi(x)\in{\EuScript F}(M)$
    
%     \noindent\kern-\leftmargin
%     \ceq{\hfill\exists x\,\psi(x)}{\Rightarrow}
%     {\textrm{ there is an }a\in M\textrm{ such that }\psi(a);}
   
%   \end{itemize}
% \end{remark}


\begin{remark}\label{rem_Tarski_Vaught}
  Theorem~\ref{thm_Tarski_Vaught} shows in particular that for every substructure $M$ the following are equivalent
  \begin{itemize}
    \item[1.] $M$ is a c-model;
    \item[2.] ${\rm Ccl}(M)$ is a c-model.
  \end{itemize}
\end{remark}

Classically, the first application of the Tarski-Vaught test is in the proof of the downward L\"owen\-heim-Skolem Theorem.
Note that by the classical downward L\"owenheim-Skolem Theorem every $A\subseteq{\EuScript U}$ is contained in a standard structure of cardinality $|{\EuScript L}(A)|$.
In this form the L\"owenheim-Skolem Theorem is not very informative.
In fact, the cardinality of ${\EuScript L}$ is eccessively large because of the aboundance of symbols in ${\EuScript L}_{\sf I}$.

We say that ${\EuScript L}^{\rm p/c}$ is \emph{separable\/} if there is a countable p/c-dense set ${\EuScript F}$ of positive/continuous formulas.

\begin{proposition}
  Let ${\EuScript L}^{\rm p/c}$ be separable.
  Let $A$ be a countable set.
  Then there is a countable p/c-model $M$ containing $A$.
\end{proposition}

\begin{proof}
  Let ${\EuScript F}$ be a countable p/c-dense set of positive/continuous formulas.
  As in the classical proof of the L\"owenheim-Skolem Theorem, we construct a countable $M\subseteq{\EuScript U}$ that contains a witness of every consistent formula $\neg\psi(x)$ for $\psi(x)\in{\EuScript F}(M)$.
  In continuous case we also ensure that $M$ is a substructure.
  Then the proposition follows from Theorem~\ref{thm_Tarski_Vaught}.
\end{proof}

\begin{proposition}
  If ${\EuScript L}$ has at most countably many symbols of sort ${\sf H}^n\to {\sf I}$ and $I$ is a second countable (the topology has a countable base), then ${\EuScript L}^{\rm c}$ is separable.
  Moreover if ${\EuScript L}_{\sf H}$ is countable then also ${\EuScript L}^{\rm p}$ is separable.
\end{proposition}

\begin{proof}
  Fix a countable filter of compact neighborhoods of the diagonal of ${\sf I}^2$.....  
\end{proof}



% The \emph{weight\/} of ${\EuScript L}$, which we denote by \emph{${\rm wgt}\big({\EuScript L}\big)$\/} is the minimal cardinality of a set of formulas ${\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}'$ such that for every $\varphi''>\varphi\in{\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}$ there is a $\varphi'\in{\EuScript L}^{\rm p}_{{\sf I}{\rm qf}}'$ such that $\varphi''>\varphi'>\varphi$.
% If this minimal cardinality is $\omega$, we say that ${\EuScript L}$ is sparable. 
% It is not difficult to see that when $I$ is the real unit interval and ${\EuScript L}$ contains at most countably many symbols of sort ${\sf H}^n\to{\sf I}$ then ${\EuScript L}$ is separable.

% \begin{proposition}
%   Let $A\subseteq U$.
%   Then  $A$ is contained in a p-model of cardinality at most ${\rm wgt}\big({\EuScript L}\big)+|A|$.  
% \end{proposition}

% \begin{proof}
%   As in the classical L\"owenheim-Skolem Theorem, using (2) of Theorem~\ref{thm_Tarski_Vaught}.
% \end{proof}


% \begin{proposition}
%   The following are equivalent
%   \begin{itemize}
%     \item[1.] ${\EuScript L}$ is separable;
%     \item[2.] there is an ${\EuScript L}$-structure $\langle M_0,R_0\rangle\preceq{\EuScript U}$ with $|M_0|=|R_0|=\omega$.
%   \end{itemize}  
% \end{proposition}




\begin{comment}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Positive omitting types}

\def\ceq#1#2#3{\parbox[t]{30ex}{$\displaystyle #1$}\parbox[t]{6ex}{\hfil $#2$}{$\displaystyle #3$}}

In this section we prove a version of the omitting types theorem.

A type $p(x)$ is isolated by $\varphi(x)$, a consistent formula, if $\varphi(x)\rightarrow p(x)$.
If $p(x)$ is isolated by $\neg\varphi(x)$ for some $\varphi(x)\in{\EuScript L}^{\rm p/c}(A)$ we say that it is \emph{p/c-isolated\/} by $A$.
We we omit reference to $A$ when this is clear from the context (e.g.\@ when $A$ is the set of parameters of $p(x)$).

% When $A$ is clear from the context (e.g., when $p(x)$ is presented as a type over $A$) we say simply p/c-isolated. 
Note that, by Theorem~\ref{thm_Tarski_Vaught}, $p(x)$ is p/c-isolated by $A$, then $p(x)$ is realized in every p/c-model containing $A$.
We also have that if $p(x)$ is is realized in $M$, a p-model, then $p(x)$ is p-isolated by $M$.
In fact, if $b\models p(x)$ then $\neg(b\neq x)$ isolates $p(x)$ where $b\neq x$ is positive by Morleyzation.

The continuous case will be considered in the next section.
In this case a weaker notion of isolation is appropriate.

\begin{fact}\label{fact_isolation}
  Let ${\EuScript F}$ be a p/c-dense set of positive/continuous formulas.
  Then the following are equivalent
  \begin{itemize}
  \item[1.] $p(x)$ is p/c-isolated by $A$;
  \item[2.] $p(x)$ is isolated by $\neg\varphi(x)$ for some $\varphi(x)\in{\EuScript F}(A)$;
  \item[3.] $p(x)$ is isolated by some $\varphi'(x)$ such that  $\varphi'>\varphi$ for some consistent $\varphi(x)\in{\EuScript F}(A)$.
  \end{itemize}
\end{fact}

\begin{proof}
  (1$\Rightarrow$2) By Proposition~\ref{prop_Fapprox}.ii.

  (1$\Rightarrow$3) By Proposition~\ref{prop_Fapprox}.i.

  (3$\Rightarrow$1) Let $\varphi'>\varphi$ be as in (3). 
  Let $\tilde\varphi\bot\varphi$ be such that $\varphi(x)\rightarrow\neg\tilde\varphi(x)\rightarrow\varphi'(x)$. 
  Then $\neg\tilde\varphi(x)$ isolates $p(x)$.
\end{proof}


\begin{lemma}\label{lem_kuratowskiUlam}
  Let ${\EuScript L}^{\rm p/c}(A)$ be separable.
  Let $p(x)\subseteq{\EuScript L}^{\rm p/c}(A)$, be non p/c-isolated by $A$.
  Then every consistent formula $\neg\psi(z)$, with $\psi(z)\in{\EuScript L}^{\rm p/c}(A)$, has a solution $a$ such that $A,a$ does not p/c-isolate $p(x)$.
\end{lemma}

\begin{proof}
  We construct a sequence of ${\EuScript L}^{\rm p/c}(A)$-formulas $\langle\gamma_i(z):i<\omega\rangle$ such that any realization $a$ of the type $\big\{\gamma_i(z):i<\omega\big\}$ is the required solution of $\neg\psi(z)$.
  
  Let $\langle\xi_i(x,z):i<\omega\rangle$ enumerate a countable p/c-dense subset of ${\EuScript L}^{\rm p/c}_{x,z}(A)$.
  Let $\gamma_0(z)$ be a consistent positive/continuous formulas such that $\gamma'_0(z)\rightarrow\neg\psi(z)$ for some $\gamma'_0>\gamma_0$.
  This exists by Proposition~\ref{prop_Fapprox}.
  Now we define $\gamma_{i+1}(z)$ and  $\gamma'_{i+1}>\gamma_{i+1}$.
  Let  $\gamma_i(z)$ and $\gamma'_i>\gamma_i$ be given.
  Pick $\tilde{\gamma}\perp\gamma_i$ such that $\gamma_i(z)\rightarrow\neg\tilde{\gamma}(z)\rightarrow\gamma'_i(z)$.
  
  \begin{itemize}
  \item[1.] If $\neg\xi_i(x,z)\wedge\gamma_i(z)$ is inconsistent, let $\gamma_{i+1}=\gamma_i$ and  $\gamma'_{i+1}=\gamma'_i$.
  \item[2.] Otherwise, pick $\varphi(x)\in p$ such that (\#) below is consistent
  
  (\#)\hfil $\neg\tilde{\gamma}(z)\ \wedge\ \exists x\,\big[\neg\xi_i(x,z)\wedge\neg\varphi(x)\big].$\kern19ex
  
  Finally, let $\gamma_{i+1}(z)$ and $\gamma'_{i+1}>\gamma_{i+1}$ consistent positive/continuous formulas such that $\gamma'_{i+1}(z)$ implies (\#).
  Such formulas exist by Proposition~\ref{prop_Fapprox}.
  \end{itemize}
  
  Let $a\models\{\gamma_i(z):i<\omega\}$.
  We claim that that $A,a$ does not p/c-isolate $p(x)$.
  Otherwise, by Fact~\ref{fact_isolation}, $\neg\xi_i(x,a)\rightarrow p(x)$ for some consistent $\neg\xi_i(x,a)$.
  This contradicts $a\models\gamma_{i+1}(z)$.
  
  Therefore the proof is complete if we can show that it is always possible to find the formula $\varphi(x)$ required in (2).
  
  Suppose for a contradiction that $\neg\xi_i(x,z)\wedge\gamma_i(z)$ is consistent while (\#) is inconsistent for all formulas $\varphi(x)\in p$.
  This immediately implies that 
  
  \ceq{\hfill\exists z\;\big[\neg\xi_i(x,z)\wedge\neg\tilde{\gamma}(z)\big]}{\rightarrow}{p(x).}
  
  By Fact~\ref{fact_isolation}, $p(x)$ is p/c-isolated, a contradiction.
\end{proof}

From the lemma we easily obtain an omitting types theorem for positive types that is very close to the classical one.

\begin{theorem}[Positive Omitting Types]\label{thm_pOTT}
  Let ${\EuScript L}^{\rm p}$ be separable.
  Let $A$ be countable.
  Assume also that $p(x)\subseteq{\EuScript L}^{\rm p}(A)$ is not p-isolated.
  Then there is a p-model $M$ containing $A$ that omits $p(x)$. 
\end{theorem}

\begin{proof}
  As in the classical proof, appy the lemma above and the Tarski-Vaught test (Theorem~\ref{thm_Tarski_Vaught}) to obtain a countable p-model $M$ that does not isolate $p(x)$.
  For p-models, p-isolating a type is equivalent to  realizing it.
\end{proof}
\end{comment}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Continuous omitting types}

\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\parbox{6ex}{\hfil $#2$}{$\displaystyle #3$}}

In this section we present a version of the omitting types theorem.
We are interested in omitting types in Cauchy complete models.
We only consider the continuous case.

A type $p(x)$ is isolated by $\varphi(x)$, a consistent formula, if $\varphi(x)\rightarrow p(x)$.
If $p(x)$ is isolated by $\neg\varphi(x)$ for some $\varphi(x)\in{\EuScript L}^{\rm c}(A)$ we say that it is \emph{c-isolated\/} by $A$.
We omit the reference to $A$ when this is clear from the context (e.g., when $p(x)$ is presented as a type over $A$).
By Theorem~\ref{thm_Tarski_Vaught}, $p(x)$ is c-isolated by $A$, then $p(x)$ is realized in every c-model containing $A$.
% We also have that if $p(x)$ is is realized in $M$, a p-model, then $p(x)$ is p-isolated by $M$.
% In fact, if $b\models p(x)$ then $\neg(b\neq x)$ isolates $p(x)$ where $b\neq x$ is positive by Morleyzation.

\begin{fact}\label{fact_isolation}
  Let ${\EuScript F}$ be a c-dense set of continuous formulas.
  Then the following are equivalent
  \begin{itemize}
  \item[1.] $p(x)$ is c-isolated by $A$;
  \item[2.] $p(x)$ is isolated by $\neg\varphi(x)$ for some $\varphi(x)\in{\EuScript F}(A)$;
  \item[3.] $p(x)$ is isolated by some $\varphi'(x)$ such that  $\varphi'>\varphi$ for some consistent $\varphi(x)\in{\EuScript F}(A)$.
  \end{itemize}
\end{fact}

\begin{proof}
  (1$\Rightarrow$2) By Proposition~\ref{prop_Fapprox}.ii.

  (1$\Rightarrow$3) By Proposition~\ref{prop_Fapprox}.i.

  (3$\Rightarrow$1) Let $\varphi'>\varphi$ be as in (3). 
  Let $\tilde\varphi\bot\varphi$ be such that $\varphi(x)\rightarrow\neg\tilde\varphi(x)\rightarrow\varphi'(x)$. 
  Then $\neg\tilde\varphi(x)$ isolates $p(x)$.
\end{proof}

We say that the type $p(x)\subseteq{\EuScript L}^{\rm c}({\EuScript U})$ is \emph{approximately c-isolated\/} by $A$ if for every $\varepsilon\in{\EuScript E}$ there is a formula $\varphi_\varepsilon(x)\in{\EuScript L}^{\rm c}(A)$ such that $\neg\varphi_\varepsilon(x)$ is consistent with $p(x)$ and isolates $\exists x'\sim_\varepsilon\! x\ p(x')$.
Notice the requirement that the formula that isolates $\exists x'\sim_\varepsilon\! x\ p(x')$ is consistent with $p(x)$.
This is used in the proof of Lemma~\ref{lem_atomic_iso}.

Assume for the rest of this section that ${\EuScript L}^{\rm c}$ is separable.
Let $\langle\varepsilon_n:n\in\omega\rangle$ be such that for every $\varepsilon\in{\EuScript E}$ there is an $n$ such that $x\sim_{\varepsilon_n}y\ \rightarrow\ x\sim_\varepsilon\! y$.
We abbreviate $x\sim_{\varepsilon_n}y$ by \emph{$x\sim_ny$.}

\begin{fact}\label{fact_isolationpp}
  Let ${\EuScript L}^{\rm c}$ be separable.
  Let $p(x)\subseteq{\EuScript L}^{\rm c}(A)$ be maximally consistent type that is approximately c-isolated.
  Then this is witnessed by formulas $\psi(x)\in{\EuScript L}^{\rm c}(A)$ such that $\psi_n(x)\rightarrow\psi_{n+1}(x)$.
  Finally, if $a_n\models\neg\psi_n(x)$ the the type $p(x)\cup\big\{a_n\sim_nx\ :\ n\in\omega\big\}$ is consistent.
\end{fact}

\begin{proof}
  Let $\psi_n(x)=\varphi_0(x)\vee\dots\vee\varphi_n(x)$.
  Clearly $\neg\psi_n(x)\ \rightarrow\ x\sim_n\! y$, then we only need verify that $\neg\psi_n(x)$ is consistent with $p(x)$.
  But this is the case because by maximality $p(x)\rightarrow\neg\varphi_n(x)$.
  The second claim follows immediately.
\end{proof}
% When a maximally consistent type $p(x)$ is approximately c-isolated, say $\neg\varphi_n(x)$ isolates $\exists x'\sim_nx\ p(x')$, then we my assume that $\neg\varphi_{n+1}(x)\rightarrow\neg\varphi_n(x)$.



\begin{fact}\label{fact_sim_n}
  Let ${\EuScript L}^{\rm c}$ be separable.
  Let $p(x)\subseteq{\EuScript L}^{\rm c}(A)$ be maximally consistent and approximately c-isolated by $A$.
  Let $M$ be a c-model containing $A$.
  Then $p(x)$ is realized in ${\rm Ccl}(M)$.
\end{fact}

\begin{proof}
  Let $a_n\in M$ be as in Fact~\ref{fact_isolationpp}.
  Then any solution of $p(x)\cup\big\{a_n\sim_nx\ :\ n\in\omega\big\}$ belongs to ${\rm Ccl}(M)$.
\end{proof}

In words, the proof above shows that if $p(x)$ is approximately c-isolated, then in every c-model contains a sequence of elements that converges, in the topology induced by $I$, to a realization of $p(x)$.

\begin{fact}\label{fact_wcisolatio_realization}
  Let ${\EuScript L}^{\rm c}$ be separable.
  Let $M$ be a c-model containing $A$.
  Then every type $p(x)\subseteq{\EuScript L}^{\rm c}(A)$ that is realized in ${\rm Ccl}(M)$ is approximately c-isolated by $M$.
\end{fact}

\begin{proof}
  Let $b\in{\rm Ccl}(M)^{|x|}$ realize $p(x)$.
  Let $\varepsilon\in{\EuScript E}$ be given.
  By Fact~\ref{fact_isolation} it suffices to find a continuous formula $\varphi(x)$ and some $\varphi'>\varphi$ such that $\varphi'(x)\rightarrow\exists x'\sim_\varepsilon\! x\ p(x')$.

  Let $\eta'\in{\EuScript E}$ be such that $x\sim_{\eta'} y\sim_{\eta'} z\ \rightarrow\ x\sim_\varepsilon\! z$.
  Pick some $a\in M^{|x|}$ that satisfies $x\sim_{\eta'} b$.
  Then $x\sim_{\eta'}a\ \rightarrow\exists\ x'\sim_\varepsilon\! x\ p(x')$.
  Finally, note that $(\sim_{\eta'})>(\sim_\eta)$ for some $\eta\in{\EuScript E}$.
\end{proof}

\begin{lemma}\label{lem_kuratowskiUlam_cont}
  Let ${\EuScript L}^{\rm c}(A)$ be separable.
  Assume that $p(x)\subseteq{\EuScript L}^{\rm c}(A)$ is not approximately c-isolated.
  Then every consistent formula $\neg\psi(z)$, with $\psi(z)\in{\EuScript L}^{\rm c}(A)$, has a solution $a$ such that $A,a$ does not approximately c-isolate $p(x)$.
\end{lemma}

\begin{proof}
  %   The proof is essentially that of Lemma~\ref{lem_kuratowskiUlam}.
  %   We go over it again to check that the stronger requirement of consistency does not invalidate the argument.
  %
  Let $\varepsilon\in{\EuScript E}$ witness that $p(x)$ is not approximately c-isolated by $A$. 
  We construct a sequence of ${\EuScript L}^{\rm c}(A)$-formulas $\langle\gamma_i(z):i<\omega\rangle$ such that any realization $a$ of the type $\big\{\gamma_i(z):i<\omega\big\}$ is the required solution of $\neg\psi(z)$, witnessed by the same $\varepsilon$.
  
  Let $\langle\xi_i(x,z):i<\omega\rangle$ enumerate a countable c-dense subset of ${\EuScript L}^{\rm c}_{x,z}(A)$.
  Let $\gamma_0(z)$ be a consistent continuous formulas such that $\gamma'_0(z)\rightarrow\neg\psi(z)$ for some $\gamma'_0>\gamma_0$.
  This exists by Proposition~\ref{prop_Fapprox}.
  Now we define $\gamma_{i+1}(z)$ and $\gamma'_{i+1}>\gamma_{i+1}$.
  Let $\gamma_i(z)$ and $\gamma'_i>\gamma_i$ be given.
  Pick $\tilde{\gamma}\perp\gamma_i$ such that $\gamma_i(z)\rightarrow\neg\tilde{\gamma}(z)\rightarrow\gamma'_i(z)$.
  
  \begin{itemize}
  \item[1.] If $\neg\xi_i(x,z)\wedge\gamma_i(z)$ is inconsistent with $p(x)$, let $\gamma_{i+1}(z)=\gamma_i(z)$ and  $\gamma'_{i+1}(z)=\gamma'_i(z)$.
  \item[2.] Otherwise, pick $\varphi(x)\in p$ such that (\#) below is consistent
  
  (\#)\hfil $\neg\tilde{\gamma}(z)\ \wedge\ \exists x\,\big[\neg\xi_i(x,z)\wedge\neg\exists x'\sim_\varepsilon\! x\ \varphi(x')\big].$\kern15ex
  
  Finally, let $\gamma_{i+1}(z)$ and $\gamma'_{i+1}>\gamma_{i+1}$ consistent continuous formulas such that $\gamma'_{i+1}(z)$ implies (\#).
  Such formulas exist by Proposition~\ref{prop_Fapprox}.
  \end{itemize}
  
  Let $a\models\{\gamma_i(z):i<\omega\}$.
  We claim that that $A,a$ does not c-isolate $p(x)$, witnessed by $\varepsilon$.
  Otherwise $\neg\xi_i(x,a)\rightarrow\exists x'\sim_\varepsilon\! x\  p(x')$ for some $\neg\xi_i(x,a)$ consistent with $p(x)$.
  This contradicts $a\models\gamma_{i+1}(z)$.
  
  Therefore the proof is complete if we can show that it is always possible to find the formula $\varphi(x)$ required in (2).
  
  Suppose for a contradiction that $\neg\xi_i(x,z)\wedge\gamma_i(z)$ is consistent with $p(x)$ while (\#) is inconsistent for all formulas $\varphi(x)\in p$.
  This immediately implies that 
  
  \ceq{\hfill\exists z\;\big[\neg\xi_i(x,z)\wedge\neg\tilde{\gamma}(z)\big]}{\rightarrow}{\exists x'\sim_\varepsilon\! x\ p(x').}
  
  By Fact~\ref{fact_isolation}, this yelds the desired contradiction.
\end{proof}

\begin{theorem}[Continuous Omitting Types]\label{thm_cOTT}
  Let ${\EuScript L}^{\rm c}$ be separable.
  Let $A$ be countable.
  Assume also that $p(x)\subseteq{\EuScript L}^{\rm c}(A)$ is not approximately c-isolated.
  Then there is a c-model $M$ containing $A$ such that ${\rm Ccl}(M)$ omits $p(x)$. 
\end{theorem}

\begin{proof}
  By assumption $\exists y\sim_\varepsilon\! x\ p(y)$ is not approximately c-isolated for some $\varepsilon\in{\EuScript E}$. 
  Just as in the classical case, we appy Lemma~\ref{lem_kuratowskiUlam_cont} and the Tarski-Vaught test (Theorem~\ref{thm_Tarski_Vaught}) to obtain a countable c-model $M$ that does not isolate $\exists y\sim_\varepsilon\! x\ p(y)$.
  By Fact~\ref{fact_wcisolatio_realization}, ${\rm Ccl}(M)$ omits $p(x)$. 
\end{proof}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Continuous countable categoricity}

\def\ceq#1#2#3{\parbox[t]{25ex}{$\displaystyle #1$}\parbox[t]{6ex}{$\displaystyle\hfil #2$}{$\displaystyle #3$}}

In the discussion of countable categoricity we assume that the underlying theory is complete.
This assumption is not necessary (it is rather a consequence of categoricity), but it allows to work inside a monster model and simplify the notation.

Let $M$ be a c-model.
We say that $M$ is \emph{atomic\/} if for every finite tuple $a$ of elements of $M$ the type $\mbox{c-tp}(a)$ is approximately c-isolated.

\begin{lemma}\label{lem_atomic_iso}
  Let ${\EuScript L}^{\rm c}$ be separable.
  Let $M$ and $N$ be two atomic c-models.
  Let $k$ be a finite c-elementary relation between ${\rm Ccl}(M)$ and ${\rm Ccl}(N)$.
  Then for every $c\in M$ there is $d\in{\rm Ccl}(N)$ such that $k\cup\{\langle c,d\rangle\}$ is a c-elementary relation.
\end{lemma}

\begin{proof}
  We can assume that $k$ is reduced, i.e.\@ it is an injective map ${\rm Ccl}(M)\rightarrow{\rm Ccl}(N)$.
  Let $a$ enumerate ${\rm dom}(k)$.
  Let $p(x,y)=\mbox{c-tp}(a,c)$, it suffices to prove that $p(x,y)$ is realized by some $d\in{\rm Ccl}(N)$.
  By Fact~\ref{fact_isolationpp} there are some formulas $\psi_n(x,y)\in{\EuScript L}^{\rm c}$ such that
  
  \ceq{\hfill\neg\psi_n(x,y)}{\rightarrow}{\exists x',y'\sim_nx,y\ \ p(x',y')}
  
  and $\psi_n(x,y)\rightarrow\psi_{n+1}(x,y)$.
  As $\neg\psi_n(x,y)$ is consistent with $p(x,y)$ then $a,c\models\neg\psi_n(x,y)$.
  Then by c-elementarity, $\neg\varphi(ka,y)$ is consistent.
  Let $d_n\in{\rm Ccl}(M)$ be such that $ka,d_n\models\neg\psi_n(x,y)$.
  Let $b,d$ be a realization of the type $\{ka,d_n\sim_nx,y:n\in\omega\}\cup p(x,y)$.
  As $ka\sim b$, also $ka,d$ realizes $p(x,y)$.
  As $d\in{\rm Ccl}(N)$, the proof is complete.
\end{proof}

\begin{fact}\label{fact_atomic_iso}
  Let $M$ and $N$ be countable atomic c-models.
  Then ${\rm Ccl}(M)$ and ${\rm Ccl}(N)$ are c-isomorphic.
\end{fact}

\begin{proof}
  We construct by back-and-forth a sequence $f_n:{\rm Ccl}(M)\rightarrow{\rm Ccl}(N)$ of finite c-elementary reduced relations (i.e.\@ injective maps) and let 
  
  \ceq{\hfill R}{=}{\bigcup_{n\in\omega}(\sim)\circ f_n\circ(\sim).}

  We will ensure that $M\subseteq{\rm dom}(R)$ and $N\subseteq{\rm range}(R)$, hence that $R$ is a c-isomorphism between $M$ and $N$.

  Let $n$ be even.
  Let $a$ be an enumeration of ${\rm dom}(f_n)$.
  Let $c\in M$.
  Let $p(x,y)=\mbox{c-tp}(a,b)$.
  As $M$ is atomic by Lemma~\ref{lem_atomic_iso}, for some $d\in{\rm Ccl}(N)$ the relation $f_n\cup\{\langle c,d\rangle\}$ is c-elementary.
  Let $f_{n+1}$ be a reduced relation such that $f_{n+1}\ \subseteq\ f_n\cup\{\langle a,c\rangle\}\ \subseteq\ (\sim)\circ f_{n+1}\circ(\sim)$.

  When $n$ is odd we proceed similarly with $f_n^{-1}$.
\end{proof}

Let ${\EuScript L}^{\rm c}$ be separable.
We say that $T$ is \emph{c-$\omega$-categorical\/} if any two countable c-models are c-isomorphic, see Definition~\ref{def_ciso}.
The following analogue of Ryll-Nardzewski's Theorem follows by the classical argument.

\begin{theorem}
  Assume that ${\EuScript L}^{\rm c}$ is separable.
  Then the following are equivalent
  \begin{itemize}
    \item[1.] $T$ is c-$\omega$-categorical;
    \item[2.] every consistent type $p(x)\subseteq{\EuScript L}^{\rm c}$, for $x$ any finite tuple of variables, is approximately c-isolated.
  \end{itemize}
\end{theorem}

\begin{proof}
  (1$\Rightarrow$2) \ 
  If $p(x)$ is consistent it is realized in some countable c-model $M$.
  If $p(x)$ is not approximately c-isolated, by the continuous omitting type theorem there is a c-model $N$ such that  ${\rm Ccl}(N)$ omits $p(x)$.
  Then ${\rm Ccl}(M)$ and ${\rm Ccl}(N)$ are not c-isomorphic, hence $T$ is not c-$\omega$-categorical.

  (2$\Rightarrow$1) \ 
  By (2), every c-model is atomic.
  Then c-$\omega$-categoricity follows from Fact~\ref{fact_atomic_iso}.
\end{proof}

%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
\section{Indiscernibles}

\def\ceq#1#2#3{\parbox[t]{15ex}{$\displaystyle #1$}\parbox[t]{6ex}{$\displaystyle\hfil #2$}{$\displaystyle #3$}}

Let $J,<$ be an infinite linear order.
A sequence $a=\langle a_i:i\in J\rangle$ is p/c-indiscernible if 

\ceq{\hfill\mbox{p/c-tp}(a_{\restriction J_0})}{=}{\mbox{p/c-tp}(a_{\restriction J_1})}

for every $J_0,J_1\subseteq J$ such that $|J_0|=|J_1|<\omega$.
Note that as maximal positive types are complete, positive indisceribles are classical indiscernibles.

Let $x=\langle x_i:i<\omega\rangle$.
Let $b=\langle b_i:i\in L\rangle$. 
The Ehrenfeucht-Mostowski p/c-type of $a$ is the type

\ceq{\hfill\mbox{EM-p/c-tp}(b)}{=}{\bigcup_{n<\omega}\Big\{\varphi(x_{\restriction n})\in{\EuScript L}^{\rm p/c}\ \ :\ \ \varphi(b_{\restriction L_0})\textrm{ for every } L_0\subseteq L, |L_0|=n\Big\}.}

The following classical results holds unmodified.

\begin{theorem}
  Let $J,<$ and $L,<$ be infinite linear orders.
  Let $b=\langle b_i:i\in L\rangle$.
  Then there is a sequence of p/c-indiscernibles $a=\langle a_i:i\in J\rangle$ with the same Ehrenfeucht-Mostowski p/c-type as $b$.
\end{theorem}

\begin{proof}
  The usual argument works but requires tuch of additional attention.

  If $\psi(z)$ is a formula and $w$ is tuple of variables of the same length of $z$, we write $\psi(/w)$ for the formula obtained replacing $z$ by $w$ in $\psi(z)$.

  Let $e(x)=\mbox{EM-p/c-tp}(b)$.
  Let $z=\langle z_i:i\in J\rangle$.
  Define

  \ceq{\hfill q(z)}{=}{\bigcup_{n<\omega}\Big\{\varphi(/z_{\restriction J_0})\ \ :\ \ \varphi(x_{\restriction n})\in e,\  J_0\subseteq J, |J_0|=n\Big\}\quad\cup}

  \ceq{\hfill }{ }{\bigcup_{n<\omega}\Big\{\varphi(/z_{\restriction J_0})\leftrightarrow\varphi(/z_{\restriction J_1})\ \ :\ \ \varphi(x_{\restriction n})\in{\EuScript L}^{\rm p/c},\  J_i\subseteq J,\  |J_i|=n\Big\}.}

  By Ramsey's theorem $q(z)$ is finitely consistent (but note that positive saturation is not enough to infer the existence of a realization in ${\EuScript U}$).
  Let $p(z)\subseteq{\EuScript L}^{\rm p/c}$ be maximal among the types that are finitely consistent with $q(z)$.

  We claim that $p(z)$ is complete.
  Namely, that $p(z)\rightarrow\neg\varphi(z)$ whenever $\varphi(z)\notin p$.
  In fact, if $\varphi(z)\notin p$ then $\varphi'(z)\notin p$ for some $\varphi'>\varphi$.
  Pick $\tilde\varphi\perp\varphi$ such that $\varphi\rightarrow\neg\tilde\varphi\rightarrow\varphi'$.
  Then $\tilde\varphi(z)\vee\varphi'(z)$ is tautological.
  As $\varphi'(z)\notin p$, by maximality $\tilde\varphi(z)\in p$ and $p(z)\rightarrow\neg\varphi(z)$ follows.

  Then any $a\models p(z)$ is as required by the theorem.
\end{proof}


%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
\section{Stable formulas (tentative)}

\def\ceq#1#2#3{\parbox[t]{20ex}{$\displaystyle #1$}\parbox[t]{6ex}{$\displaystyle\hfil #2$}{$\displaystyle #3$}}

The following definition is classical.
A partitioned formula $\varphi(x\,;z)\in{\EuScript L}$ is stable if for some $n<\omega$ there is no sequence $\langle a_i\,;b_i\,:\,i<n\rangle$ such that for every $i,j<n$

\ceq{{\rm i.}\hfill i<j}{\Rightarrow}{\varphi(a_i\,;b_j)}

\ceq{{\rm ii.}\hfill i>j}{\Rightarrow}{\neg\varphi(a_i\,;b_j)}



\begin{fact}\label{fact_stable_p}
  For every $\varphi(x\,;z)\in{\EuScript L}^{\rm p}$ the following are equivalent
  \begin{itemize}
    \item[1.] $\varphi(x\,;z)$ is stable;
    \item[2.] for some $n<\omega$ there is no sequence $\langle a_i\,;b_i\,:\,i<n\rangle$ and no $\tilde\varphi\perp\varphi$ such that (i) above and 

    \noindent\kern-\leftmargin
    \ceq{\kern\leftmargin{\rm ii'.}\hfill i>j}{\Rightarrow}{\tilde\varphi(a_i\,;b_j)}
  \end{itemize} 
\end{fact}

\begin{proof}
  (1$\Rightarrow$2) \ 
  Negate (2).
  Then for every $n$ there is a sequence $\langle a_i\,;b_i\,:\,i<n\rangle$ and a formula $\tilde\varphi$ such that (i) and (ii$'$).
  As $\tilde\varphi(x\,;z)\rightarrow\neg\varphi(x\,;z)$, then $\varphi(x\,;z)$ is not stable.

  (2$\Rightarrow$1) \ 
  Negate (1).
  Then for every $n$ there is a sequence $\langle a_i\,;b_i\,:\,i<n\rangle$ such that (i) and (ii).
  By Proposition~\ref{prop_approx} and Lemma~\ref{lem_interpolation}
  
  \ceq{\hfill\neg\varphi(x\,;z)}{\leftrightarrow}{\bigvee_{\tilde\varphi\perp\varphi}\tilde\varphi(x\,;z).}
  
  Then for every $j<i<n$ there is a formula  $\tilde\varphi_{i,j}\perp\varphi$ such that $\tilde\varphi_{i,j}(a_i\,;b_j)$.
  By the definition of strong negation we infer that there is some $\tilde\varphi_n\perp\varphi$ such that $\tilde\varphi_{i,j}(x\,;z)\rightarrow\tilde\varphi_n(x\,;z)$ for all $j<i<n$.
  Then $\neg$(2) follows.
\end{proof}

% \begin{fact}[wrong?!]
%   For every $\varphi(x\,;z)\in{\EuScript L}^{\rm p}$ the following are equivalent
%   \begin{itemize}
%     \item[1.] $\varphi(x\,;z)$ is stable;
%     \item[2.] there is no sequence $\langle a_i\,;b_i\,:\,i<\omega\rangle$ of indiscernibles such that $\varphi(a_0\,;b_1)$ and $\tilde\varphi(b_1\,;a_0)$ for every $\tilde\varphi\perp\varphi$.
%   \end{itemize} 
% \end{fact}

% \begin{proof}[wrong proof]
%   Only 2$\Rightarrow$1 requires a proof.
%   Negate (1).
%   For every $n$ let $\tilde\varphi_n\perp\varphi$ withness the failure of (2).
%   Reasoning as in the proof of Fact~\ref{fact_stable_p}, we can require that $\tilde\varphi_n(x\,;z)\rightarrow\tilde\varphi_{n+1}(x\,;z)$.
  
%   Let $\bar x\,;\bar y=\langle x_i\,;z_i\ :\ i<\omega\rangle$.
%   Our choice of $\tilde\varphi_n(x\,;z)$ ensures that the following type is finitely consistent

%   \ceq{\hfill p(\bar x\,;\bar z)}{=}{\big\{\varphi(x_i\,;z_j)\ :\ i<j<\omega\big\}\ \cup\ \big\{\tilde\varphi_n(x_i\,;z_j)\ :\ j<i<\omega\big\}.}

%   Any realization of $p(\bar x\,;\bar z)$ is as required by (2).
% \end{proof}

Using the terminology of~\cite{Hr}, $\varphi(x\,;z)$ is stable if it is stably separated from all $\tilde\varphi\perp\varphi$.

A set ${\EuScript D}\subseteq{\EuScript U}^{|z|}$ is \emph{finitely definable\/} by $\varphi(x\,;z)$ if for every finite set $B\subseteq{\EuScript U}$ there is an $a\in{\EuScript U}^{|x|}$ and $\tilde\varphi\bot\varphi$ such that

\ceq{{\rm i.}\hfill B^{|z|}\ \cap\ \varphi(a\,;{\EuScript U})}{=}{B^{|z|}\, \cap\, {\EuScript D}}

\ceq{{\rm ii.}\hfill B^{|z|}\ \cap\ \tilde\varphi(a\,;{\EuScript U})}{=}{B^{|z|}\, \smallsetminus\, {\EuScript D}}

We say that ${\EuScript D}$ is \emph{externally definable\/}  by $\varphi(x\,;z)$ if there is a maximal consistent $\varphi(x\,;z)$-type $p(x)\subseteq{\EuScript L}({\EuScript U})$ such that ${\EuScript D}=\big\{b\ :\  \varphi(x\,;b)\in p\big\}$.

\begin{fact}
  The following are equivalent
  \begin{itemize}
    \item[1.] ${\EuScript D}$ is finitely definable;
    \item[2.] ${\EuScript D}$ is externally definable;
  \end{itemize}
\end{fact}

\begin{proof}
  (1$\Rightarrow$2) \ 
  Let 
  
  \ceq{\hfill p(x)}{=}{\big\{\varphi(x\,;b)\ :\ b\in{\EuScript D}\big\}\ \cup\ \big\{\neg\varphi(x\,;b)\ :\ b\notin{\EuScript D}\big\}}. 
  
  By 
\end{proof}

%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%
\newcommand\biburl[1]{\url{#1}}
\BibSpec{arXiv}{%
  +{}{\PrintAuthors}{author}
  +{,}{ \textit}{title}
  +{}{ \parenthesize}{date}
  +{,}{ arXiv:}{eprint}
  % +{,}{ \url}
}

\begin{bibdiv}
\begin{biblist}[]\normalsize


\bib{BBHU}{article}{
  label={BBHU},
  author={Ben Yaacov, Ita\"{\i}},
  author={Berenstein, Alexander},
  author={Henson, C. Ward},
  author={Usvyatsov, Alexander},
  title={Model theory for metric structures},
  conference={
      title={Model theory with applications to algebra and analysis. Vol. 2},
  },
  book={
      series={London Math. Soc. Lecture Note Ser.},
      volume={350},
      publisher={Cambridge Univ. Press, Cambridge},
  },
  %  isbn={978-0-521-70908-8},
  date={2008},
  pages={315--427},
  %  review={\MR{2436146}},
  %  doi={10.1017/CBO9780511735219.011},
}

% \bib{G}{article}{
%   label={G},
%   author = {Goldbring, Isaac},
%   title = {Lecture notes on nonstandard analysis},
%   conference={
%     title={UCLA Summer School in Logic 2012}
%    },
%   eprint = {www.math.uci.edu/~isaac/NSA\%20notes.pdf},
% }

% \bib{H}{arXiv}{
%   label={H},
%   author = {Hart, Bradd},
%   title = {An Introduction To Continuous Model Theory},
%   eprint={2303.03969},
%   doi = {10.48550/arXiv.2303.03969},
%   url = {https://arxiv.org/abs/},
%   publisher = {arXiv},
%   date = {2023},
% }

\bib{Hr}{article}{
   label={Hr},
   author={Hrushovski, Ehud},
   title={Stable group theory and approximate subgroups},
   journal={J. Amer. Math. Soc.},
   volume={25},
   date={2012},
   number={1},
   pages={189--243},
   %issn={0894-0347},
   %doi={10.1090/S0894-0347-2011-00708-X},
}

\bib{HPP}{article}{
   label={HPP},
   author={Hrushovski, Ehud},
   author={Peterzil, Ya'acov},
   author={Pillay, Anand},
   title={Groups, measures, and the NIP},
   journal={J. Amer. Math. Soc.},
   volume={21},
   date={2008},
   number={2},
   pages={563--596},
  %  issn={0894-0347},
  %  review={\MR{2373360}},
  %  doi={10.1090/S0894-0347-07-00558-9},
}

\bib{HI}{article}{
  label={HI},
  author={Henson, C. Ward},
  author={Iovino, Jos\'{e}},
  title={Ultraproducts in analysis},
  conference={
    title={Analysis and logic},
    address={Mons},
    date={1997},
   },
   book={
      series={London Math. Soc. Lecture Note Ser.},
      volume={262},
      publisher={Cambridge Univ. Press, Cambridge},
   },
   date={2002},
   pages={1--110},
  %  review={\MR{1967834}},
}

\bib{clcl}{article}{
  label={CLCL},
  author = {Polymath, C.L.C.L.},
  title = {Continuous Logic for the Classical Logician},
  note={T.a.},
  date = {202?},
}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% \section{Continuous group actions}
\end{biblist}
\end{bibdiv}
\end{document}